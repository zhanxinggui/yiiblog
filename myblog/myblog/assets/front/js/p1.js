var gMailTips={};(function(){var b=$.createClass($N("util.Shift"));$.Object.extend(b,{checkbox:null,handle:a});function a(h,j,n){var o=$.Event.getEvent();var c=this.checkbox;if(o.shiftKey&&c&&h!=c){var f=false;for(var l=0,d=j.length;l<d;l++){var k=j[l];if(f){if(e(k,c,h)){if(!k.checked){k.setChecked(true);if(n){n(l,k,true)}}}else{break}}else{if(!e(j[l],c,h)){f=true}}}try{if(window.getSelection){window.getSelection().removeAllRanges()}else{document.selection.empty()}}catch(g){}}if(h.checked){this.checkbox=h}else{this.checkbox=null}function e(m,i,p){if(m!=i&&m!=p&&i!=p){return true}else{return false}}}})();(function(){var a=$.createClass($N("util.Contextmenu"));$.Object.extend(a,{menu:null,show:b});function b(j){var m=$.Event;var d=$.Event.get();if(a.menu){a.menu.hide()}var n=a.menu=new $.Menu({left:d.pageX+"px",top:d.pageY+"px",groups:j.groups,renderTo:document.body,width:j.width});m.stop();var e=n.getEl();var g=e.dom.offsetWidth;var k=e.dom.offsetHeight;var c=e.position();var i=c[0];var l=c[1];var o=document.documentElement;var f=o.clientWidth+o.scrollLeft;var h=o.clientHeight+o.scrollTop;if(g+i>f){e.dom.style.left=i-g+"px"}if(k+l>h){e.dom.style.top=l-k+"px"}}})();(function(){var j=$.Object;var l=$.String;var h=$.createClass($N("util.AutoComplete"));j.extend(h.prototype,{initialize:g,listen:n,createMenu:e,finishMenu:k,operate:a,_remove:c,_click:b,_mouseover:m,_mousedown:d,_fill:f,product:"",MAX_COLUMN:20,_timer:0,nostore:false,match:null,input:null,last:null,data:null});function g(o){j.extend(this,o);this.listen()}function n(){try{var q=$L("support.AddressSupport")}catch(p){return p}var o=this;this.input.listen("keyup",function(){if($.Event.get().which==13){return}var r=o.data||q.data.rawDataArray.contact;if(r.length>500&&$.Browser.isIE()){if(o.createMenuTimeout){window.clearTimeout(o.createMenuTimeout)}else{o.createMenuTimeout=window.setTimeout(function(){o.createMenu()},150)}window.setTimeout(function(){o.createMenu()},100)}else{o.createMenu()}});this.input.listen("keydown",function(){o.operate()})}function a(){var s=this;var q=$.Event.getEvent();var r=q.keyCode;var p=s.div;var o=s.table;if(p&&o){var t=o.rows.length;var v=this.selectedIndex;switch(r){case 9:$.Event.cancel();case 13:var v=this.selectedIndex;if(typeof v!="undefined"){var u=this.table.rows[v];if(this.groupFill&&u.groupIndex>=0){this.groupFill(u.groupIndex)}else{this._fill(u.name)}this._remove()}return;break;case 27:if(this.div){this._remove();return}break;case 38:s.finishMenu();if(typeof v=="undefined"){this.selectedIndex=0}else{if(v==0){this.selectedIndex=t-1}else{this.selectedIndex--}}break;case 40:s.finishMenu();if(typeof v=="undefined"){this.selectedIndex=0}else{if(v==t-1){this.selectedIndex=0}else{this.selectedIndex++}}break;default:break}i.call(this)}}function e(){try{var p=$L("support.AddressSupport")}catch(L){return L}var y=this;var q;if(y.data){q=y.data}else{if($S("isCorp")){q=p.data.extDataMap.contactLiteArray.concat(p.entData.rawDataArray.contact)}else{q=p.data.extDataMap.contactLiteArray}}var B=[];var r=y.match;var A=y.input.dom.value;if(!A){if(y.div){y._remove()}return}if(A==y.key&&y.div){return}if(y.div){y._remove()}var D=q;if(y.key&&A.indexOf(y.key)==0&&y.last&&!y.nostore){if(y.groupMatch&&y.key.length<=2){}else{D=y.last}}y.last=[];for(var H=0,E=D.length;H<E;H++){var F=D[H];var t=r(A,F);if(t){B.push(t);y.last.push(F)}}var x=[];if(y.groupData){var I=y.groupData;if(y.key&&A.indexOf(y.key)==0&&y.lastGroup){I=y.lastGroup}y.lastGroup=[];for(var H=0;H<I.length;H++){var N=I[H];if(y.groupMatch(A,N)){x.push(N);y.lastGroup.push(N)}}}y.key=A;var C=B.length+x.length;if(C){var w=y.inputDiv||y.input;var o=w.position();var u=o[1]+w.dom.offsetHeight+1;var v=o[0]-1;var K=document;var z=K.createElement("DIV");z.className="nui-menu nui-menu-scroll nui-menu-hasMaxHeight nui-scroll";z.style.styleFloat="left";z.setAttribute("unselectable","on");z.style.top=u+"px";if(y.rightAlign){z.style.right="0px";z.style.left="auto"}else{z.style.left=v+"px"}if(y.isTop){z.style.zIndex=1000}var G=K.createElement("TABLE");G.setAttribute("unselectable","on");var M=K.createElement("TBODY");M.setAttribute("unselectable","on");G.appendChild(M);z.appendChild(G);K.body.appendChild(z);y.div=z;y.table=G;$.Array.each(B,function(S,R){if(S>y.MAX_COLUMN&&x.length==0){y.toFinish=true;y.matchData=B;throw $.BREAK}else{y.toFinish=false;y.matchData=null}var O=R.replace(new RegExp(A,"g"),"__strong_start__"+A+"__strong_end__");O=l.encodeHTML(O);O=O.replace(new RegExp("__strong_start__","g"),'<strong unselectable="on">');O=O.replace(new RegExp("__strong_end__","g"),"</strong>");O='<span class="nui-menu-item-text" unselectable="on">'+O+"</span>";var P=M.insertRow(-1);P.setAttribute("unselectable","on");P.name=R;P.className="nui-menu-item";var Q=P.insertCell(-1);Q.setAttribute("unselectable","on");Q.style.cursor="pointer";Q.className="nui-menu-item-link";Q.innerHTML=O;$(P).listen("click",$.Function.bind(y._click,y));$(P).listen("mouseover",$.Function.bind(y._mouseover,y))});if(x.length>0){var s=M.insertRow(-1);s.setAttribute("unselectable","on");var J=s.insertCell(-1);J.setAttribute("unselectable","on");J.className="nui-menu-split nui-split"}$.Array.each(x,function(S,T){var R=T.N;var O=R.replace(new RegExp(A,"g"),"__strong_start__"+A+"__strong_end__");O=l.encodeHTML(O);O=O.replace(new RegExp("__strong_start__","g"),"<strong>");O=O.replace(new RegExp("__strong_end__","g"),"</strong>");O='<span class="nui-menu-item-icon" style="top:9px;"><b class="nui-ico nui-ico-user nui-ico-user-group" unselectable="on"></b></span><span class="nui-menu-item-text" unselectable="on"> '+O+' <span class="txt-info" unselectable="on">(联系组)</span></span>';var P=M.insertRow(-1);P.groupIndex=T.index;P.setAttribute("unselectable","on");var Q=P.insertCell(-1);Q.setAttribute("unselectable","on");Q.style.cursor="pointer";Q.className="nui-menu-item-link";Q.innerHTML=O;$(P).listen("click",$.Function.bind(y._click,y));$(P).listen("mouseover",$.Function.bind(y._mouseover,y))});if(!y.selectNon){y.selectedIndex=0}if(!$.Browser.isIE()){$(z).listen("mousedown",y._mousedown)}if(y.toFinish){$(z).listen("scroll",$.Function.bind(y.finishMenu,y))}y.docClick=$.Function.bind(y._remove,y);$.Event.listen(K,"click",y.docClick);i.call(y);if(z.offsetWidth+z.offsetLeft>K.body.offsetWidth){z.style.right="0px";z.style.left="auto"}}}function k(){var o=this;if(o.toFinish){o.toFinish=false;var p=o.key;var q=o.table.firstChild;$.Array.each(o.matchData,function(v,u){if(v<=o.MAX_COLUMN){throw $.CONTINUE}var r=u.replace(new RegExp(p,"g"),"__strong_start__"+p+"__strong_end__");r=l.encodeHTML(r);r=r.replace(new RegExp("__strong_start__","g"),'<strong unselectable="on">');r=r.replace(new RegExp("__strong_end__","g"),"</strong>");r='<span class="nui-menu-item-text" unselectable="on">'+r+"</span>";var s=q.insertRow(-1);s.setAttribute("unselectable","on");s.name=u;s.className="nui-menu-item";var t=s.insertCell(-1);t.setAttribute("unselectable","on");t.style.cursor="pointer";t.className="nui-menu-item-link";t.innerHTML=r;$(s).listen("click",$.Function.bind(o._click,o));$(s).listen("mouseover",$.Function.bind(o._mouseover,o))});o.matchData=null}}function i(r){var q=this;var t=q.selectedIndex;if(typeof t!="undefined"){var s=q.table.rows[t];if(q.div&&s){var p=this.currItem;if(p){p.className="nui-menu-item"}s.className="nui-menu-item nui-menu-item-hover";this.currItem=s;if(!r){var o=200;var u=t*27-o+15;if(u>0){q.div.scrollTop=u+100}else{q.div.scrollTop=0}}}}}function f(p){var o=this;if(o.fill){o.fill(p)}else{o.input.dom.value=p}}function c(){var q=this;var p=q.div;if(p){try{p.parentNode.removeChild(p)}catch(r){try{p.removeNode(true)}catch(r){p.style.display="none";p.id=""}}delete this.selectedIndex;p=null;q.div=null;q.table=null}var o=q.isTop?top.document:window.document;$.Event.unlisten(o,"click",q.docClick);q.removing=true;setTimeout(function(){q.removing=false},0)}function b(){var p=this.selectedIndex;if(typeof p!="undefined"){var o=this.table.rows[p];if(this.groupFill&&o.groupIndex>=0){this.groupFill(o.groupIndex)}else{this._fill(o.name)}this._remove()}}function m(s){var r=this;var p=$.Event.getTarget(s);while(p.tagName!="TR"){p=p.parentNode}if(p.tagName=="TR"){var t=r.table.rows;for(var q=0,o=t.length;q<o;q++){if(t[q]==p){r.selectedIndex=q;i.call(r,true);break}}}}function d(){$.Event.cancel()}})();(function(){var b=$.Object;Dtd=$.createClass($N("component.editor.Dtd"));b.extend(Dtd,{rules:d(),isNonFormat:a,isInline:e,isBlock:f,canRemoveIfEmpty:g,isDtdAlow:c});function d(){var h=function(B){var D=arguments.length;for(var C=1;C<D;C++){var A=arguments[C];for(var E in A){B[E]=A[E]}}return B},ab={isindex:1,fieldset:1},aa={input:1,button:1,select:1,textarea:1,label:1},Z=h({a:1},aa),Y=h({iframe:1},Z),W={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},z={ins:1,del:1,script:1,style:1},y=h({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},z),x=h({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},y),w=h({p:1},x),v=h({iframe:1},x,aa),u={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},t=h({a:1},v),r={tr:1},q={"#":1},p=h({param:1},u),o=h({form:1},ab,Y,W,w),n={li:1},m={style:1,script:1},l={base:1,link:1,meta:1,title:1},k=h(l,m),j={head:1,body:1},i={html:1};var s={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:h(i,j,l),$block:s,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:t,$body:h({script:1,style:1},s),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:j,head:k,style:q,script:q,body:o,base:{},link:{},meta:{},title:q,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:o,td:o,br:{},th:o,center:o,kbd:t,button:h(w,W),basefont:{},h5:t,h4:t,samp:t,h6:t,ol:n,h1:t,h3:t,option:q,h2:t,form:h(ab,Y,W,w),select:{optgroup:1,option:1},font:t,ins:t,menu:n,abbr:t,label:t,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:t,script:q,tfoot:r,cite:t,li:o,input:{},iframe:o,strong:t,textarea:q,noframes:o,big:t,small:t,span:t,hr:{},dt:t,sub:t,optgroup:{option:1},param:{},bdo:t,"var":t,div:o,object:p,sup:t,dd:o,strike:t,area:{},dir:n,map:h({area:1,form:1,p:1},ab,z,W),applet:p,dl:{dt:1,dd:1},del:t,isindex:{},fieldset:h({legend:1},u),thead:r,ul:n,acronym:t,b:t,a:v,blockquote:o,caption:t,i:t,u:t,tbody:r,s:t,address:h(Y,w),tt:t,legend:t,q:t,pre:h(y,Z),p:t,em:t,dfn:t}}function a(h){h=h.toLowerCase();return this.rules.$empty[h]==1?true:false}function e(h){h=h.toLowerCase();return this.rules.$inline[h]==1?true:false}function f(h){h=h.toLowerCase();return this.rules.$block[h]==1?true:false}function g(h){h=h.toLowerCase();return this.rules.$removeEmpty[h]==1?true:false}function c(j,i){var k=j.nodeName.toLowerCase();var h=i.nodeName.toLowerCase();return this.rules[k]?(this.rules[k][h]==1?true:false):false}})();(function(){var c=$.Object;var g=$.Event,b,h=$.createClass($N("component.editor.Event"));c.extend(h,{init:i,add:d,remove:e,fire:a,commonHandle:f});function i(l){b=$L("component.editor.Editor");l.evts={};l.listeners={};var j=b.ui,k=h.add;k(l,"click",j.hidePopup,document);k(l,"click",j.hidePopup,l.doc);k(l,"selectionChanged",function(){j.changeToolbar(l)})}function d(n,m,o,k){if(k){var j;if(typeof k==="string"){j=k}else{if(k.nodeType==9){j=n.doc==k?"editorDoc"+n.num:"doc"+n.num}else{if(!k.getAttribute("evId")){var l=new Date();j=l.getTime()+Math.random()+"";k.setAttribute("evId",j)}else{j=k.getAttribute("evId")}}}if(!n.evts[m]){n.evts[m]={}}if(!n.evts[m][j]){n.evts[m][j]=[]}n.evts[m][j].push(o)}else{if(!n.listeners){n.listeners={}}n.listeners[m]=o}}function e(n,m,o,k){if(n.evts&&n.evts[m]&&n.evts[m][sId]){var j=n.evts[m][sId];for(var l=0;l<j.length;l++){if(j[l]==o){delete j[l];return true}}return false}}function a(p,j,n){if(n&&n.el){var l=n.el;if(l.fireEvent){l.fireEvent("on"+j)}else{var r=document.createEvent("MouseEvents");r.initEvent(j,true,true);l.dispatchEvent(r)}}else{var o=p.listeners[j];if(o){var m=[];for(var k=2,q=arguments.length;k<q;k++){m.push(arguments[k])}return o(m)}}}function f(q){if(!q.win){return}var m,r=g.get(q.win.event),k=r.type,l=r.target;while(l){if(l.nodeType==1){m=l.getAttribute("evId")}else{if(l.nodeType==9){m=q.doc==l?"editorDoc"+q.num:"doc"+q.num}}if(m&&q.evts&&q.evts[k]&&q.evts[k][m]){var p=q.evts[k][m];for(var o=0;o<p.length;o++){p[o].call(l,q,r)}if(m.indexOf("doc")<0&&m.indexOf("Doc")<0&&q.history){var n=m.replace(/\d+/,"");n="e_"+n.replace("full","f").replace("basic","b");var j={};j[n]=1;Log.cache(j,function(s){if(s){s.value+=1}})}}l=l.parentNode}}})();(function(){var r=$.Object;var n,b="startContainer",h="startOffset",p="endContainer",i="endOffset",j="collapsed",t="commonAncestorContainer",e=$.createClass($N("component.editor.Format"));r.extend(e.prototype,{initialize:a,getEditor:g,getEl:m,execCmd:o,edit:k,getAttrs:f,getStyle:q,addStyle:l,addStyleForRange:u,removeStyleForRange:d,custCmd:c,turnToHtml:s});function a(v){this._editor=v;n=$L("component.editor.Editor")}function g(){return this._editor}function m(v){return this._editor.doc.createElement(v)}function o(y,v){var x=this.getEditor();x.focus();try{x.doc.execCommand(y,false,v);return true}catch(w){return false}}function k(A,w,v){var z=this.getEditor();z.focus();var y=n.event.fire(z,"onStartFormat",{command:A});if(y&&y.stop){return false}var B=n.Plugin[A],x;if(B){x=n.Plugin[A].execCmd}if(x){x.call(this,w,v)}else{z.format.execCmd(A,w,v)}}function f(C){if(n.IE){var B=this.turnToHtml(C),x=B.match(/<[^>]+>/)[0],v=x.match(/[^ ]+=[^( |>)]+/g),A=[];for(var y=0;v&&y<v.length;y++){var z=v[y];var w={};w.nodeName=z.substring(0,z.indexOf("="));w.nodeValue=z.substring(z.indexOf("=")+1,z.length);A.push(w)}return A}else{return C.attributes}}function q(v,w){var y=this.getEditor(),A;if(w=="lineHeight"){A=v.style.lineHeight;if(A){return A}}A=w?v.currentStyle?v.currentStyle[w]:y.win.getComputedStyle(v,false)[w]:v.currentStyle?v.currentStyle:y.win.getComputedStyle(v,false);if(w=="lineHeight"){if(A&&A.indexOf("px")>0){function x(B){if(typeof B=="string"&&B.indexOf("px")<0){if(B=="1"){B="10px"}else{if(B=="2"){B="13px"}else{if(B=="3"){B="16px"}else{if(B=="4"){B="18px"}else{if(B=="5"){B="24px"}else{if(B=="6"){B="32px"}else{if(B=="7"){B="48px"}}}}}}}}return B}var z=this.getStyle(v,"fontSize")||x(v.getAttribute("size"));A=Math.round(parseFloat(A.replace(/px/,"")*10)/parseFloat(z.replace(/px/,"")))*10+"%";if(A=="110%"){A="120%"}}}return A?A:null}function l(J,x,H,F){var E=this;if(!J||n.dtd.isNonFormat(J.nodeName)){return null}else{if(J.hasChildNodes()){var v=J.childNodes,K=v.length,B=E.getAttrs(J);if(/span/i.test(J.nodeName)){var G=E.turnToHtml(J),A;if(x=="fontSize"){A="font-size"}else{if(x=="lineHeight"){A="line-height"}else{A=x}}function I(){var N=J.parentNode;for(var M=0;M<v.length;M++){var L=v[M].cloneNode(true);N.insertBefore(L,J);if(L.nodeType!=3){F.push(L)}}N.removeChild(J)}var C=new RegExp('^<span style=\\"'+A+':[^(:|\\")]+\\">',"i");if(C.test(G)){if(E.getStyle(J.parentNode,x)==H){I();K=0;return}else{if(E.getStyle(J,x)!=H){J.style[x]=H}}}else{if(E.getStyle(J.parentNode,x)==H){J.style[x]="";if(/^<span style=\"line-height:[^(:|\")]+\">/i.test(E.turnToHtml(J))&&E.getStyle(J.parentNode,"lineHeight")==J.style.lineHeight){I();K=0}}}}for(var z=0;z<K;z++){F.push(v[z])}}else{if(J.nodeType==3){var w=J.parentNode;if(E.getStyle(w,x)!=H){var y=J.previousSibling;if(w.childNodes.length==1&&!/body/i.test(w.nodeName)){w.style[x]=H}else{var D=E.getEl("span");D.style[x]=H;w.insertBefore(D,J);D.appendChild(J)}}}else{if(n.dtd.canRemoveIfEmpty(J.nodeName)){J.parentNode.removeChild(J)}}}}return J}function u(y,v,z){var E=this,K=E.getEditor(),x=K.query;var I,X,U;if(z){U=z}else{var H=new n.Selection(K);U=H.getRange();if(H.isCollapsed()){var A=U[b];if(A==U[p]&&A.nodeType==1&&A.nodeName!="body"&&A.nodeName!="BODY"&&!!!A.innerHTML){A.style[y]=v}else{var J=E.getEl("span");J.style[y]=v;U.insertNode(J);var C=K.doc.createTextNode("\uFEFF");J.appendChild(C);U.selectNode(C);U.collapse()}K.focus();return U}}var D=U[t],R=U[b],S=U[h],V=U[p],G=U[i];if(R.nodeType==3&&S==R.nodeValue.length&&R.nextSibling){R=R.nextSibling;S=0}if(G==0&&V!=R&&V.previousSibling){V=V.previousSibling;if(V.nodeType==3){G=V.nodeValue.length}else{if(V.hasChildNodes()){G=V.childNodes.length}}}if(R.nodeType==1&&R.hasChildNodes()){R=R.childNodes[S];S=0}if(V.nodeType==1&&V.hasChildNodes()){V=V.childNodes[G-1];G=-1}if(R.nodeType==3&&R==V&&S==0&&G==R.nodeValue.length&&R.parentNode.childNodes.length==1){I=R.parentNode}else{if(R.nodeType!=3&&R==V&&S==0&&G==-1){I=R}else{if(D.nodeType!=3&&!/body/i.test(D.nodeName)&&U.getStartNode()==D&&D==U.getEndNode()){I=D}else{if(U.canSurroundContents()){I=E.getEl("span");U.surroundContents(I)}else{var w=U.cloneRange(),M=false,B=false,N=false,F=U.cloneRange(),Y=U[b];if(Y.hasChildNodes()){Y=Y.childNodes[U[h]]}while(Y.parentNode!=D){if(Y!=Y.parentNode.firstChild||(Y.nodeType==3&&U[h]>0)){if(Y.nodeType==3){F.setEndAfter(Y)}else{F.setEndAfter(Y.parentNode.lastChild)}X=arguments.callee.call(E,y,v,F);M=true;U.setStart(X[b],X[h]);Y=X[p].childNodes[X[i]-1];while(Y!=D){if(Y.nextSibling){w.setStartBefore(Y.nextSibling);B=true;break}Y=Y.parentNode}break}Y=Y.parentNode}var L=U.cloneRange(),Q=U[p];if(Q.hasChildNodes()){Q=Q.childNodes[U[i]-1]}while(Q.parentNode!=D){if(Q!=Q.parentNode.lastChild||(Q.nodeType==3&&U[i]<Q.nodeValue.length)){if(Q.nodeType==3){L.setStartBefore(Q)}else{L.setStartBefore(Q.parentNode.firstChild)}X=arguments.callee.call(E,y,v,L);N=true;U.setEnd(X[p],X[i]);Q=X[b].childNodes[X[h]];while(Q!=D){if(Q.previousSibling){w.setEndAfter(Q.previousSibling);B=true;break}Q=Q.parentNode}break}Q=Q.parentNode}if(B&&!w[j]){X=arguments.callee.call(E,y,v,w);if(!M){U.setStart(X[b],X[h])}if(!N){U.setEnd(X[p],X[i])}}}}}}if(I){I.style[y]=v;var O=[],W=I.childNodes;for(var P=0;P<W.length;P++){O.push(W[P])}while(O.length>0){var T=O.shift();E.addStyle(T,y,v,O)}U.selectNode(I)}return U}function d(){}function c(A,w){var y=this.getEditor();try{var z=this.addStyleForRange(A,w);var v=new n.Selection(y);v.addRange(z);return true}catch(x){return false}}function s(w){var v=this.getEditor().doc.createElement("div");v.appendChild(w.cloneNode(true));return v.innerHTML}})();(function(){var i=$.Object;var f,n=$.Event,b=$.createClass($N("component.editor.History"));i.extend(b.prototype,{autoSave:true,keyCount:0,interval:15,maxUndoCount:200,_pos:0,initialize:c,getEditor:k,shortcut:g,getBookmark:e,setBookmark:a,save:j,undo:m,redo:h,smartSave:d,queryUndo:o,queryRedo:l});function c(s){var r=this;r._editor=s;r._history=[["",null]];f=$L("component.editor.Editor");var q=f.event.add,p=s.doc;q(s,"keydown",r.shortcut,p);q(s,"contentChange",r.save);if(r.autoSave){q(s,"keydown",r.smartSave,p)}}function k(){return this._editor}function g(s,q){var r=s.history,p=s.win.event||q;if(p.ctrlKey){if(p.keyCode==90){r.undo();n.stop(p)}else{if(p.keyCode==89){r.redo();n.stop(p)}}}}function e(){var s=this.getEditor();var q=s.editMode;if(q=="text"||q=="source"){return null}if(f.IE){var p=f.util.getSelection(s);if(/text/i.test(p.type)){return p.createRange().getBookmark()}else{return null}}else{try{var t=new f.Selection(s).getRange();return t?t.getBookmark():null}catch(r){return null}}}function a(q){if(q){var p=this.getEditor();if(f.IE){var r=p.doc.body.createTextRange();if(q!="[object]"){if(r.moveToBookmark(q)){r.select()}}}else{new f.Range(p).moveToBookmark(q)}}}function j(w){var u=this;u.keyCount=0;var p=u._history;var v=u.getEditor();var q=v.getContent();var t=v.clicked&&!w;var s=u._pos;var r=p[s][0];if(r!=q){p=u._history=p.slice(0,s+1);p.push([q,t?u.getBookmark():null]);if(p.length>u.maxUndoCount){p.shift()}u._pos=p.length-1;return true}return false}function m(){var p=this,r=p.getEditor();p.save();if(p._pos>0){p._pos--;var q=p._history[p._pos];r.setContent(q[0]);p.setBookmark(q[1]);return true}else{return false}}function h(){var p=this,r=p.getEditor();if(p._pos!=p._history.length-1){p._pos++;var q=p._history[p._pos];r.setContent(q[0]);r.focus();p.setBookmark(q[1]);return true}else{return false}}function d(v,r){var t=v.history,p=v.win.event||r;function q(w){var x=$.Browser.opera()||window.navigator.userAgent.indexOf("TencentTraveler")>0||($.Browser.getInfo().os=="macintosh"&&$.Browser.safari());if(w){setTimeout(function(){t.save(x)},0)}else{t.save(x)}}var s={16:1,17:1,18:1,37:1,38:1,39:1,40:1};var u=p.keyCode;if((p.ctrlKey&&u==86)||((u==8||u==46)&&t.lastKey!=u)){q()}else{if(!s[u]&&!p.ctrlKey&&!p.metaKey&&!p.shiftKey&&!p.altKey){t.keyCount++;if(t.keyCount>t.interval){q(true)}}}t.lastKey=u}function o(){if(this._pos>0){return true}else{return false}}function l(){var p=this;if(p._pos!=p._history.length-1){return true}else{return false}}})();(function(){var m=$.Object;var aj=$.Browser,l=$.Event,C=null,A=$.createClass($N("component.editor.Plugin"));m.extend(A.prototype,{initialize:ag});m.extend(A,{backcolor:{type:"button",popup:true,uiInfo:{title:"选择字体背景"},menu:{name:"backcolor",width:"180px",Class:"nui-menu APP-editor-color",template:'<div class="nui-menu-item"  cmd="backcolor" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-text"><b class="nui-ico APP-editor-ico-color" style="background:$0$2"></b>$1</span></div></div>',menus:[["#ffffff","白色<span class='txt-info'>(默认)</span>",";border:1px solid #ccc;height:7px;width:7px"],"sep",["#880000","暗红色"],["#800080","紫色"],["#ff0000","红色"],["#ff00ff","鲜粉色"],["#000080","深蓝色"],["#0000ff","蓝色"],["#00ffff","湖蓝色"],["#008080","蓝绿色"],["#008000","绿色"],["#808000","橄榄色"],["#00ff00","浅绿色"],["#ffcc00","橙黄色"],["#808080","灰色"],["#c0c0c0","银色"],["#000000","黑色"]]},execCmd:Q,query:E},backspace:{type:"shortcut",init:ac},basic:{type:"button",uiInfo:{title:"切换到简单功能"},click:o},bold:{type:"button",uiInfo:{title:"加粗"}},capture:{type:"button",custom:true,uiInfo:{title:"截图"}},copy:{type:"button",uiInfo:{title:"复制"}},currentTime:{type:"button",uiInfo:{title:"当前日期(自动更新)"},click:Z},cut:{type:"button",uiInfo:{title:"剪切"}},editImage:{type:"shortcut",init:f,popup:S,edit:L},fontname:{type:"button",popup:true,uiInfo:{title:"选择字体"},menu:{name:"fontname",width:"150px",template:'<div class="nui-menu-item"  cmd="fontname" val="$0" style="font-family:$0"><div class="nui-menu-item-link"><span class="nui-menu-item-text">$1</span></div></div>',menus:[["simsun","宋体"],["simhei","黑体"],["楷体_GB2312","楷体,楷体_GB2312"],["隶书","隶书"],["幼圆","幼圆"],["Microsoft Yahei","微软雅黑"],["Arial","Arial"],["Arial Black","Arial Black"],["Comic Sans MS","Comic Sans MS"],["Courier","Courier"],["System","System"],["Times New Roman","Times New Roman"],["Verdana","Verdana"],["Georgia","Georgia"]]},execCmd:w,query:u},fontsize:{type:"button",popup:true,uiInfo:{title:"选择字体大小"},menu:{name:"fontsize",width:"190px",Class:"nui-menu APP-editor-fontSize",template:'<div class="nui-menu-item nui-menu-item-hasExt APP-editor-fontSize-$1" cmd="fontsize" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-text">$2</span><span class="nui-menu-item-ext">$0</span></div></div>',menus:[["14px","0","默认大小"],"sep",["10px","1","极小"],["13px","2","特小"],["16px","3","小"],["18px","4","中"],["24px","5","大"],["32px","6","特大"],["48px","7","极大"]]},execCmd:T,query:g},forecolor:{type:"button",popup:true,uiInfo:{title:"选择字体颜色"},menu:{name:"forecolor",width:"180px",Class:"nui-menu APP-editor-color",template:'<div class="nui-menu-item" cmd="forecolor" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-text"><b class="nui-ico APP-editor-ico-color" style="background:$0$2"></b>$1</span></div></div>',menus:[["#000000","黑色<span class='txt-info'>(默认)</span>"],"sep",["#880000","暗红色"],["#800080","紫色"],["#ff0000","红色"],["#ff00ff","鲜粉色"],["#000080","深蓝色"],["#0000ff","蓝色"],["#00ffff","湖蓝色"],["#008080","蓝绿色"],["#008000","绿色"],["#808000","橄榄色"],["#00ff00","浅绿色"],["#ffcc00","橙黄色"],["#808080","灰色"],["#c0c0c0","银色"],["#ffffff","白色",";border:1px solid #ccc;height:7px;width:7px"]]},execCmd:W,query:R},full:{type:"button",uiInfo:{title:"切换到全部功能"},click:p},image:{type:"button",custom:true,uiInfo:{title:"添加图片"}},indent:{type:"button",popup:true,uiInfo:{title:"设置缩进"},menu:{name:"indent",width:"110px",template:'<div class="nui-menu-item"  cmd="indent" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-icon"><b class="g-menu-item-extIcon ico ico-editor ico-editor-$1"></b></span><span class="nui-menu-item-text">$2</span></div></div>',menus:[["indent","addIndent","增加缩进"],["outdent","cutIndent","减少缩进"]]},execCmd:G},insertHorizontalRule:{type:"button",uiInfo:{title:"插入横线"}},insertTable:{type:"button",uiInfo:{title:"添加表格"},click:ae,valid:b,insert:H,createTable:B,refreshPreview:t,change:x},insertTime:{type:"button",uiInfo:{title:"添加日期"},getTime:M,execCmd:J},italic:{type:"button",uiInfo:{title:"斜体"}},justify:{type:"button",popup:true,uiInfo:{title:"选择对齐方式"},menu:{name:"justify",width:"110px",template:'<div class="nui-menu-item"  cmd="justify" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-icon"><b class="g-menu-item-extIcon ico ico-editor ico-editor-$0"></b></span><span class="nui-menu-item-text">$1</span></div></div>',menus:[["justifyLeft","左对齐"],["justifyCenter","居中对齐"],["justifyRight","右对齐"]]},execCmd:D},lineheight:{type:"button",popup:true,uiInfo:{title:"设置行高"},menu:{name:"lineheight",width:"140px",template:'<div class="nui-menu-item"  cmd="lineheight" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-text">$0$1</span></div></div>',menus:[["170%","<span class='txt-info'>(默认)</span>"],"sep",["50%"],["80%"],["100%"],["120%"],["150%"],["180%"],["200%"]]},execCmd:v,query:s},link:{type:"button",uiInfo:{title:"插入/删除链接"},regex:{url:/(((http|https|ftp):\/\/)|(www\.))[a-zA-Z0-9-\.]+\.[a-zA-Z]+[a-zA-Z0-9-\/\.:\?=&]*$/ig,email:/(mailto:)?[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$/ig,emailStart:/mailto:/i},init:K,click:z,execCmd:a,autoCreateLink:e,autoDeleteLink:r},list:{type:"button",popup:true,uiInfo:{title:"设置列表"},menu:{name:"list",width:"110px",template:'<div class="nui-menu-item"  cmd="list" val="$0"><div class="nui-menu-item-link"><span class="nui-menu-item-icon"><b class="g-menu-item-extIcon ico ico-editor ico-editor-$1"></b></span><span class="nui-menu-item-text">$2</span></div></div>',menus:[["insertUnorderedList","cList","符号列表"],["insertOrderedList","nList","数字列表"]]},execCmd:X},paste:{type:"button",uiInfo:{title:"粘贴"}},portrait:{type:"button",popup:true,uiInfo:{title:"添加表情"}},redo:{type:"button",uiInfo:{title:"重做"},execCmd:Y,query:ai},removeFormat:{type:"button",uiInfo:{title:"清除格式"}},setDefault:{type:"menu",conf:{fontname:[["宋体","simsun","1"],["黑体","simhei","2"],["楷体_GB2312","楷体,楷体_GB2312","3"],["隶书","隶书","4"],["幼圆","幼圆","5"],["Microsoft Yahei","微软雅黑","e"],["Arial","arial","6"],["Arial Black","Arial Black","7"],["Comic Sans MS","Comic Sans MS","8"],["Courier","Courier","9"],["System","System","a"],["Times New Roman","Times New Roman","b"],["Verdana","Verdana","c"],["Georgia","Georgia","d"]],fontsize:[["默认大小","14px","1"],["极小","10px","2"],["特小","13px","3"],["小","16px","4"],["中","18px","5"],["大","24px","6"],["特大","32px","7"],["极大","48px","8"]],forecolor:[["黑色","#000000","1"],["暗红色","#880000","2"],["紫色","#800080","3"],["红色","#ff0000","4"],["鲜粉色","#ff00ff","5"],["深蓝色","#000080","6"],["蓝色","#0000ff","7"],["湖蓝色","#00ffff","8"],["蓝绿色","#008080","9"],["绿色","#008000","a"],["橄榄色","#808000","b"],["浅绿色","#00ff00","c"],["橙黄色","#ffcc00","d"],["灰色","#808080","e"],["银色","#c0c0c0","f"],["白色","#ffffff","g"]]},showWin:q,getDef:V,setDef:ad},sign:{type:"button",popup:true,Class:"nui-menu APP-editor-addSign",uiInfo:{title:"签名"},init:P,getCallName:U,getTextSigns:y,getEcardSigns:O,getGraphSigns:I,setSign:j,createMenu:F},av:{type:"button",popup:true,uiInfo:{title:"录制音视频"},click:function(){Log.cache({cl_av:1},$.EMPTYFUNC);try{var ak=$L("product.AvMail")}catch(al){return al}ak.init()}},source:{type:"button",uiInfo:{title:"切换到源码功能"},click:ab},stationery:{type:"button",custom:true,uiInfo:{title:"添加信纸"}},underline:{type:"button",uiInfo:{title:"下划线"}},undo:{type:"button",uiInfo:{title:"撤销"},execCmd:c,query:af},microphone:{type:"button",custom:true,uiInfo:{title:"语音输入"}},typo:{type:"link",uiInfo:{title:"拼写检查"},reg:/^<[^>]*style=[^>]*>/i,init:i,click:h,clickMenu:N,showMenu:d,check:ah,showError:n,clear:k,ignoreAll:aa},dict:{type:"link",uiInfo:{title:"查词典"},click:function(){Log.cache({cl_dict:1},$.EMPTYFUNC);try{var al=$L("product.Translate")}catch(ak){return ak}al.change()}}});function ag(au){C=$L("component.editor.Editor");var an=C.ui,al=C.event.add,ar=au.settings.plugins,aB=false;au.editMode="basic";au.toolbar={};au.haveInited={};au.popupMenus={};function aq(aE,aF){var aD=aF.click;if(aD){return aD}if(aF.custom){aD=function(){C.event.fire(au,aE+"Click")}}else{if(aF.popup){aD=an.menuClick}else{aD=an.buttonClick}}return aD}function aA(aD,aG,aE){try{if(aG=="|"||aG=="||"){an.createTbItem(au,aD,aG);return}if(aG=="source"){aB=true}var aI=A[aG];if(aI){if(aI.type=="button"){if((aG=="undo"||aG=="redo")&&!au.history){au.history=new C.History(au);al(au,"contentChanged",function(){au.history.save()})}var aH=an.createTbItem(au,aD,aG,aI,aE);au.toolbar[aD+aG]=aH;al(au,"click",aq(aG,aI),aH);if(aI.popup&&aI.menu&&!au.popupMenus[aG]){al(au,"create"+aG+"Menu",function(){var aJ=an.createMenu(au,aI.menu);al(au,"click",an.clickList,aJ);return aJ})}}if(aI.type=="link"){var aH=an.createTbItem(au,aD,aG,aI,aE);if(aG=="typo"){$(aH).listen("click",$.Function.bind(A.typo.click,au));au.typoData={}}else{al(au,"click",aq(aG,aI),aH)}}if(aI.init&&!au.haveInited[aG]){aI.init(au);au.haveInited[aG]=true}}}catch(aF){}}for(var az in ar){var ao=ar[az],at=ao.length;for(var ay=0;ay<at;ay++){var av=null;av=ao[ay];if(!av.length){var aw=av,av=null;for(var aC in aw){if(aj[aC]()){av=aw[aC];break}}}if(av){if(typeof av!="string"){var ak=av[0];var ap=false;if(ak=="ext"){ap=true;ak="30px"}var am=an.createTbGroup(au,az,ak,ap);for(var ax=1;ax<av.length;ax++){if($S("isCorp")&&av[ax]=="typo"){continue}if(av[ax]=="av"&&!Ext.avMail){continue}aA(az,av[ax],am)}}else{if(av=="av"&&!Ext.avMail){continue}aA(az,av)}}}if(aB){an.createSourceTb(au);al(au,"click",function(){an.changeEditMode(au,"full")},"sourcefull"+au.num)}}}function Q(am){var ak=this;var an=ak.getEditor();var ao=C.util;function al(ap,aq){ao.execCmd(an,ap,aq)}if(aj.ie()){al("backcolor",am)}else{if(aj.firefox()){if(ao.getRange(an).collapsed){ak.custCmd("backgroundColor",am);return}al("usecss",false);al("hilitecolor",ao.rgb2Hex(am));al("usecss",true)}else{al("hilitecolor",am)}}}function E(){var al=this.getEditor();function ak(am){var an=C.util.getStyle(al.win,am,"backgroundColor");if(an=="transparent"){an="#ffffff"}else{if(an.indexOf("rgb")>=0){an=C.util.rgb2Hex(an)}else{if(an.indexOf("#")<0){an=C.util.num2HexForIe(an)}}}return an}return this.custQuery("backgroundColor",ak)}function ac(ak){C.event.add(ak,"keydown",function(ap,ao){if(ao&&ao.keyCode==8){var am=ap.getSelectedText();if(am==undefined){var al=C.util.getSelection(ap);if(/control/i.test(al.type)){al.clear()}l.stop(ao);ap.hidePopup()}else{if(am==""&&C.IE){var an=C.util.getRange(ap);var aq=an.parentElement();if(aq.innerHTML==""&&aq.nodeName!="BODY"&&ap.body.innerHTML!="<DIV>&nbsp;</DIV>"){aq.parentNode.removeChild(aq)}}}}},ak.doc)}function o(ak){C.ui.changeEditMode(ak,"basic");C.event.fire(ak,"selectionChanged");Ud.set({field:"ntes_letter",flag:"editorToolbar",value:"0"})}function Z(ak){ak.insertHtml("<img title='写信时会自动替换为当天日期' src='http://mimg.127.net/p/js5/lib/img/currenttime.png'/>")}function f(ak){C.event.add(ak,"mouseup",this.popup,ak.doc)}function S(ao,an){var aq=an.target;if(aq.nodeName=="IMG"){ao.img=aq;var ap;if(aq.getAttribute("data-media")){if(!ao.popupMenus.flashImage){ap=C.ui.getEl("div");ap.id="imageMenuDiv"+ao.num;ap.className="APP-editor-imgEditBar bdr-light";ap.style.width="135px";ap.style.display="none";ap.innerHTML='					        <a href="javascript:void(0)" func="play">播放</a>&nbsp;-&nbsp;					        <a href="javascript:void(0)" func="delete">删除</a>&nbsp;&nbsp;[					        <a href="javascript:void(0)" func="close">关闭</a>]						';ao.editorDv.appendChild(ap);ao.popupMenus.flashImage=ap;C.event.add(ao,"click",A.editImage.edit,ap)}else{ap=ao.popupMenus.flashImage}if(ao.popupDiv&&ao.popupDiv!=ao.popupMenus.image){ao.hidePopup()}var ak=$(aq).position();ap.style.left=ak[0]+"px";var am=ak[1]+aq.offsetHeight+28+(ao.editMode=="full"?27:0);var ar=ao.editorDv.offsetHeight-22;if(am>ar){am=ar}ap.style.top=am+"px";C.ui.delayPopup(ao,ap,0)}else{if(!ao.popupMenus.image){ap=C.ui.getEl("div");ap.id="imageMenuDiv"+ao.num;ap.className="APP-editor-imgEditBar bdr-light";ap.style.width="235px";ap.style.display="none";ap.innerHTML='					        <a href="javascript:void(0)" func="little">小</a>&nbsp;-&nbsp;					        <a href="javascript:void(0)" func="medium">中</a>&nbsp;-&nbsp;					        <a href="javascript:void(0)" func="big">大</a>&nbsp;-&nbsp;					        <a href="javascript:void(0)" func="original">原始大小</a>&nbsp;-&nbsp;					        <a href="javascript:void(0)" func="delete">删除</a>&nbsp;&nbsp;[					        <a href="javascript:void(0)" func="close">关闭</a>]				       ';ao.editorDv.appendChild(ap);ao.popupMenus.image=ap;C.event.add(ao,"click",A.editImage.edit,ap)}else{ap=ao.popupMenus.image}if(ao.popupDiv&&ao.popupDiv!=ao.popupMenus.image){ao.hidePopup()}var ak=$(aq).position();ap.style.left=ak[0]+"px";var am=ak[1]+aq.offsetHeight+28+(ao.editMode=="full"?27:0);var ar=ao.editorDv.offsetHeight-22;if(am>ar){am=ar}ap.style.top=am+"px";C.ui.delayPopup(ao,ap,0);var al=ao.img;if(!al.getAttribute("orgWidth")){al.setAttribute("orgWidth",al.clientWidth);al.setAttribute("orgHeight",al.clientHeight)}}}}function L(au,az){if(C.IE){try{C.util.getSelection(au).empty()}catch(aq){}}var am=az.target;if(am.nodeName!="A"){return false}var ar=am.getAttribute("func"),al=au.img,ay=am.parentNode;if(ar=="delete"){var ak=al.parentNode;var an=al.getAttribute("data-media");if(an){ak.parentNode.removeChild(ak);C.event.fire(au,"related",{action:"deleteAttach",id:an})}else{if(ak.nodeName=="A"&&ak.childNodes.length==1){ak.parentNode.removeChild(ak)}else{al.parentNode.removeChild(al)}}$(ay).hide();C.event.fire(au,"contentChanged");return true}else{if(ar=="close"){$(ay).hide();return true}else{if(ar=="play"){var an=al.getAttribute("data-media");try{var ao=$L("product.AvMail")}catch(aq){return aq}ao.preview(an);return true}}}var ax;switch(ar){case"little":ax=[100,80];break;case"medium":ax=[300,240];break;case"big":ax=[600,480];break;case"original":al.removeAttribute("style");break}var av=parseInt(al.getAttribute("orgWidth"),10);var at=parseInt(al.getAttribute("orgHeight"),10);if(ax){var aw=0;var ap=0;if(av>at){aw=ax[0];ap=Math.round(aw*at/av)}else{ap=ax[1];aw=Math.round(ap*av/at)}if(aw&&ap){al.style.height=ap+"px";al.style.width=aw+"px"}}else{al.style.height=at+"px";al.style.width=av+"px"}$(ay).hide();C.event.fire(au,"contentChanged")}function w(ak){this.custCmd("fontFamily",ak)}function u(){return this.custQuery("fontFamily")}function T(ak){this.custCmd("fontSize",ak)}function g(){function al(am){if(typeof am=="string"&&am.indexOf("px")<0){if(am=="1"){am="10px"}else{if(am=="2"){am="13px"}else{if(am=="3"){am="16px"}else{if(am=="4"){am="18px"}else{if(am=="5"){am="24px"}else{if(am=="6"){am="32px"}else{if(am=="7"){am="48px"}}}}}}}}return am}function ak(am){}return this.custQuery("fontSize")}function W(ak){this.custCmd("color",ak)}function R(){var al=this.getEditor();function ak(am){var an=C.util.getStyle(al.win,am,"color");if(an.indexOf("rgb")>=0){an=C.util.rgb2Hex(an)}else{if(an.indexOf("#")<0){an=C.util.num2HexForIe(an)}}return an}return this.custQuery("color",ak)}function p(ak){C.ui.changeEditMode(ak,"full");C.event.fire(ak,"selectionChanged");Ud.set({field:"ntes_letter",flag:"editorToolbar",value:"1"})}function G(ak){this.execCmd(ak)}function ae(au){var at='<div class="APP-editor-addTable nui-fClear"><div id="editorInsertTableDv" class="APP-editor-addTable-form"><div class="item item-rows"><span class="item-rows-name nui-fIBlock">行数</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="row" maxlength="6" value="2" type="text" class="nui-ipt-input"></div></div><div class="item item-cols"><span class="item-cols-name nui-fIBlock">列数</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="column" maxlength="6" value="2" type="text" class="nui-ipt-input"></div></div><div class="item"><span class="item-name nui-fIBlock">表格宽度</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="width" value="80" type="text" class="nui-ipt-input"></div><select name="widthUnit" class="APP-editor-addTable-sel"><option value="%">%</option><option value="px">px</option></select></div><div class="item"><span class="item-name nui-fIBlock">边框粗细</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="border" value="1" type="text" class="nui-ipt-input"></div>像素</div><div class="item"><span class="item-name nui-fIBlock">单元格间距</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="borderSpacing" value="1" type="text" class="nui-ipt-input"></div>像素</div><div class="item"><span class="item-name nui-fIBlock">单元格边距</span><div class="nui-ipt APP-editor-addTable-ipt"><input name="cellPadding" value="1" type="text" class="nui-ipt-input"></div>像素</div></div><div class="APP-editor-addTable-pre"><span class="APP-editor-addTable-preTit">预览</span><div id="editorTablePreviewDv" style="height:100%;overflow:hidden"><table border="1px" cellspacing="1px" style="width:90%;border-color:#808080;border-style:outset;border-collapse:separate;border-width:1px;border-spacing:1px"><tbody><tr><td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td><td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td></tr><tr><td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td><td style="border-style:inset;border-color:#808080;padding:1px;border-width:1px">&nbsp;</td></tr></tbody></table></div></div><div id="insertTableErrDv" style="float:right;width:223px;color:red"></div></div>';var ao=A.insertTable;new $.Msgbox({title:"插入表格",contentType:"wide",content:at,type:"confirm",ok:function(){return !ao.insert(au)}});function ar(ax){return parent.document.getElementById(ax)}var ak=ar("editorInsertTableDv");au.tablePreviewDv=ar("editorTablePreviewDv");function ap(ax){return $.Function.bind(ao.change,au,ax)}var al=ak.getElementsByTagName("input");var aw=al.length;var aq=au.tableWin={};for(var an=0;an<aw;an++){var am=al[an].name;aq[am]={el:al[an],value:al[an].value};l.listen(al[an],"keyup",ap(al[an]))}var av=ak.getElementsByTagName("select")[0];l.listen(av,"change",ap(av));var am=av.name;aq[am]={el:av,value:av.value}}function b(al){function am(ar){var aq=ar.name;var au=ar.value;var ao=true;var ap="";if(/^\d+\.+\d*$/.test(au)){ap="请输入整数"}else{if(!/^\d*$/.test(au)){ap="请输入数字"}else{switch(aq){case"row":if(au==""){ap="行数不能为空"}else{if(parseInt(au)>100){ap="行数不能超过100"}else{if(parseInt(au)<1){ap="行数不能小于1"}}}break;case"column":if(au==""){ap="列数不能为空"}else{if(parseInt(au)>100){ap="列数不能超过100"}else{if(parseInt(au)<1){ap="列数不能小于1"}}}break;case"width":if(au==""){ap="表格宽度不能为空"}else{if(parseInt(au)>1000){ap="表格宽度不能超过1000"}else{if(parseInt(au)<1){ap="表格宽度不能小于1"}}}break;case"border":if(au==""){ap="边框粗细不能为空"}else{if(parseInt(au)>1000){ap="边框粗细不能超过1000"}else{if(parseInt(au)<0){ap="边框粗细不能小于0"}}}break;case"cellPadding":if(au==""){ap="单元格边距不能为空"}else{if(parseInt(au)>1000){ap="单元格边距不能超过1000"}else{if(parseInt(au)<0){ap="单元格边距不能小于0"}}}break;case"borderSpacing":if(au==""){ap="单元格间距不能为空"}else{if(parseInt(au)>1000){ap="单元格间距不能超过1000"}else{if(parseInt(au)<0){ap="单元格间距不能小于0"}}}break}}}if(ap!=""){ao=false}var at=parent.document.getElementById("insertTableErrDv");at.innerHTML=ap;return ao}if(al.nodeName=="INPUT"){return am(al)}else{for(var ak in al){var an=al[ak]["el"];if(an.nodeName=="INPUT"&&!am(an)){return false}}}return true}function H(am){var ao=A.insertTable,ak=am.tableWin;if(!ao.valid(ak)){return false}for(var al in ak){ak[al]["value"]=ak[al]["el"].value}var an=ao.refreshPreview(am);am.insertHtml(an);return true}function B(ar){var an=[],aq=ar.cellspacing,al=ar.width,au=ar.borderWidth,at=ar.padding;var av;if(aj.ie()){av="<div>&nbsp;</div>"}else{av="<br>"}var ak;an.push("<table border='1' ");if(aq){an.push(" cellspacing=");an.push(aq+"px")}var ap=ar.other;if(ap){for(var aw in ap){if(aw=="style"){ak=ap[aw]}else{an.push(aw);an.push("='");an.push(ap[aw]);an.push("' ")}}}an.push(" style='border-color:#808080;border-style:outset;border-collapse:");if(aq>0){an.push("separate;")}else{an.push("collapse;")}if(ak){an.push(ak);an.push(";")}if(al){an.push("width:");an.push(al)}if(au){an.push(";border-width:");an.push(au+"px")}if(aq){an.push(";border-spacing:");an.push(aq+"px")}an.push(";'>");for(var ao=0;ao<ar.row;ao++){an.push("<tr>");for(var am=0;am<ar.column;am++){an.push("<td");if(at){an.push(" style='border-style:inset;border-color:#808080;padding:");an.push(at);an.push("px;border-width:");an.push(au+"px");an.push("'>");if(av){an.push(av)}an.push("</td>")}}an.push("</tr>")}an.push("</table>");return an.join("")+"\uFEFF"}function t(al){var ak=al.tableWin;var am=A.insertTable.createTable({row:ak.row["value"],column:ak.column["value"],width:ak.width["value"]+ak.widthUnit["value"],borderWidth:ak.border["value"],cellspacing:ak.borderSpacing["value"],padding:ak.cellPadding["value"]});al.tablePreviewDv.innerHTML=am;return am}function x(ak){var am=this,an=A.insertTable;if(ak.nodeName=="INPUT"&&!an.valid(ak)){am.tablePreviewDv.innerHTML="";return false}var al=ak.name;var ao=ak.value;am.tableWin[al]["value"]=ao;if(!an.valid(am.tableWin)){return false}an.refreshPreview(am);return true}function M(aq){var ar=new Date();var ao=ar.getFullYear();var an=ar.getMonth()+1;var ak=ar.getDate();var ap=ao+(an<10?"-0":"-")+an+(ak<10?"-0":"-")+ak;if(aq){var am=ar.getHours();var al=ar.getMinutes();var at=ar.getSeconds();ap+=(am<10?" 0":" ")+am+(al<10?":0":":")+al+(at<10?":0":":")+at}return ap}function J(){this.getEditor().insertHtml(A.insertTime.getTime())}function D(ak){this.execCmd(ak)}function v(ak){this.custCmd("lineHeight",ak)}function s(){var al=this.getEditor();function ak(am){var an=C.util.getStyle(al.win,am,"color");if(an.indexOf("rgb")>=0){an=C.util.rgb2Hex(an)}else{if(an.indexOf("#")<0){an=C.util.num2HexForIe(an)}}return an}return this.custQuery("color",ak)}function K(am){var al=C.event.add,ak=am.doc,an=A.link;al(am,"keydown",an.autoCreateLink,ak);al(am,"keydown",an.autoDeleteLink,ak)}function z(ao){if(ao.deleteLink()){return}var ak=ao.getSelectedText();var am=ak==undefined;var ap='<div class="nui-txt-s14 nui-txt-normal" style="padding:10px 0 5px"><strong>请输入链接标题</strong></div><div id="editorLinkTitleDv"></div><div class="nui-txt-s14 nui-txt-normal" style="padding:10px 0 5px"><strong>请输入链接</strong>（如：http://www.163.com）</div><div id="editorLinkUrlDv"></div>';var an=new $.Msgbox({type:"confirm",contentType:"normal",content:ap,ok:function(){if(!am){ak=$.String.trim(al.getValue());if(ak==""){al.showTips("链接标题不能为空","err");return true}}var ar=$.String.trim(aq.getValue());if(ar&&ar!="http://"){A.link.execCmd(ao,ak,ar)}else{aq.showTips("链接地址无效","err");return true}}});if(!am){var al=an.add({xtype:"input",value:ak,width:"400px",renderTo:"editorLinkTitleDv"})}var aq=an.add({xtype:"input",value:"http://",width:"400px",renderTo:"editorLinkUrlDv"});if(ak){al.focus()}else{aq.focus()}}function a(am,ak,al){am.focus();if(ak!=undefined){am.insertHtml("<a id='editorAddLink010' target='_blank'>"+ak+"</a>");var an=am.doc.getElementById("editorAddLink010");an.href=al;an.removeAttribute("id")}else{C.util.execCmd(am,"createLink",al)}return true}function e(ar,ax){if(C.IE||(ax.keyCode!=32&&ax.keyCode!=13)){return}var av=new C.Selection(ar);if(!av.isCollapsed()){return}var an=C.util.getRange(ar),aw=an.endContainer,ao=an.endOffset;if(aw.nodeType==3){var au=aw.nodeValue,ay=au.substring(0,ao),aq=A.link.regex,at=ay.match(aq.url)||ay.match(aq.email);if(at){var al=at.pop(),ak=ay.lastIndexOf(al);an.setStart(aw,ak);var ap=C.util.getSelection(ar);ap.removeAllRanges();ap.addRange(an);var am=al;if(!aq.emailStart.test(am)){if(am.indexOf("@")>=0){am="mailto:"+am}else{if(am.indexOf("://")<0){am="http://"+am}}}ar.insertHtml("<a href='"+am+"' target='_blank'>"+al+"</a>")}}}function r(ao,at){if(!C.IE&&at.keyCode==8){var aq=new C.Selection(ao);if(!aq.isCollapsed()){return}var al=C.util.getRange(ao);var ar=al.endContainer;var am=al.endOffset;function ap(az,aw){var ay,ax=az.parentNode;if(az.childNodes.length==1&&az.childNodes[0].nodeType==3){var ay=az.previousSibling;if(ay&&ay.nodeType==3){ay.nodeValue=ay.nodeValue+az.innerHTML+"."}else{var ay=ao.doc.createTextNode(az.innerHTML+".");ax.insertBefore(ay,az)}}else{var ay=C.ui.getEl("span");ay.innerHTML=az.innerHTML+"&nbsp;";ax.insertBefore(ay,az)}ax.removeChild(az);al.setEndAfter(ay);var av=C.util.getSelection(ao);av.removeAllRanges();av.addRange(al)}if(ar&&ar.nodeType==3){var au=ar.nodeValue.substring(0,am);if(am==0){var an=ar.previousSibling;if(an&&(an.nodeName=="A"||an.nodeName=="a")){ap(an,am>0)}}else{if(am==ar.nodeValue.length){var ak=ar.parentNode;if(ak.nodeName=="A"||ak.nodeName=="a"){ap(ak)}}}}if(ar&&ar.nodeType==1&&ar.hasChildNodes()){ar=ar.childNodes[am-1]}if(ar&&(ar.nodeName=="A"||ar.nodeName=="a")){ap(ar)}}}function X(ak){this.execCmd(ak)}function Y(){this.getEditor().history.redo()}function ai(){return this.getEditor().history.queryRedo()}function q(au){var ap=A.setDefault;var al=au.settings;var ak=al.fontsize;var am=al.fontname;var av=al.forecolor;var at='<div class="APP-editor-setDft nui-fClear"><ul class="APP-editor-setDft-form"><li id="setDefFn" class="item"><span class="item-name">字体</span></li><li id="setDefFs" class="item"><span class="item-name">字号</span></li><li id="setDefFc" class="item item-color"><span class="item-name">颜色</span></li></ul><div class="APP-editor-setDft-pre"><div class="APP-editor-setDft-pre-tit">预览</div><div id="setDefPre" class="APP-editor-setDft-pre-cont" style="font-family:'+am+";font-size:"+ak+";color:"+av+'"><table style="height:100%;width:100%"><tbody><tr><td style="height:100%;width:100%" align="center" valign="middle">网易免费邮<br>NetEase</td></tr></tbody></table></div></div></div>';var ao=new $.Msgbox({title:"设置编辑器默认值",type:"confirm",contentType:"wide",content:at,ok:$.Function.bind(ap.setDef,au)});function aq(aA,aC){var aD=au[aC]||au.settings[aC];var aB=null;var az=aA.find("menu");if(az){$.Array.each(az[0],function(aE,aF){if(aF.rawConfig.value==aD){aB=aF;throw $.BREAK}});if(aB){aB.setChecked(true)}}else{aA.rawConfig.menu.items.findObject("value",aD).checked=true}}function ay(aD,aC,aB){var az=aD.rawConfig;var aE=au[aC]=az.value;$("#setDefPre").dom.style[aB]=aE;var aA=ao.find("#"+aC);aA.setText(az.text);return aA}function an(){ay(this,"fontname","fontFamily")}function ar(){ay(this,"fontsize","fontSize")}function ax(){var az=this;var aA=ay(this,"forecolor","color");aA.find("icon")[0].update({type:"color-"+az.rawConfig.icon.subtype})}function aw(aE,aD,aA){var aI=ap.conf[aE];var az=[];var aB="";var aK=0;for(var aF=0,aM=aI.length;aF<aM;aF++){var aC=aI[aF];var aL=aC[1];var aH=aC[0];var aJ={};if(aL==aA){aB=aH;aK=aF}if(aE=="fontsize"){aJ.linkExtcls="g-menu-fontSize-"+aF}else{if(aE=="fontname"){aH="<span style='font-family:"+aL+"'>"+aH+"</span>"}}aJ.text=aH;aJ.value=aL;if(aE=="fontname"){aJ.click=an}else{if(aE=="fontsize"){aJ.click=ar;aJ.extText=aL}else{aJ.click=ax;aJ.icon={xtype:"icon",type:"color",subtype:aF}}}az.push(aJ);if(aF==0&&aE!="fontname"){az.push({type:"split"})}}var aG={id:aE,text:aB,subclass:"dropdownBtn",xtype:"button",renderTo:aD,menu:{xtype:"menu",checkType:"radio",groups:[{type:"scroll",items:az}]},listeners:[{name:"arrclick",handler:function(){aq(this,aE)},dom:true}]};if(aE=="forecolor"){aG.icon="color-"+aK;aG.menu.extcls="APP-editor-color"}else{if(aE=="fontsize"){aG.menu.extcls="g-menu-fontSize"}}ao.add(aG)}aw("fontname","setDefFn",am);aw("fontsize","setDefFs",ak);aw("forecolor","setDefFc",av)}function V(al){var ak=A.setDefault.conf;function am(ap){var ar=Ud.get({field:"ntes_buzz",flag:"def_"+ap});if(ar=="0"){return}var aq=ak[ap];for(var ao=0;ao<aq.length;ao++){var an=aq[ao];if(an[2]==ar){al.settings[ap]=an[1];break}}}am("fontname");am("fontsize");am("forecolor")}function ad(){var ao=this;var am=A.setDefault.conf;var an=ao.fontname;var ap=ao.fontsize;var ar=ao.forecolor;var aq;function ak(au){if(!au){return}var at=au.code;if(at==S_OK){var aw=ao.settings;var av=ao.doc.body;if(an){aw.fontname=an;av.style.fontFamily=an}if(ap){aw.fontsize=ap;av.style.fontSize=ap}if(ar){aw.forecolor=ar;av.style.color=ar}$.Tips.show({succ:true,text:"默认字体设置成功"})}else{$.Tips.show({text:"设置失败，请稍候再试"})}}function al(ay,at,ax){aq=at;if(!aq){return}var az=am[ay];var av=0;for(var aw=az.length;av<aw;av++){var au=az[av];if(au[1]==aq){aq=au[2];break}}Ud.set({field:"ntes_buzz",flag:"def_"+ay,value:aq,notPost:!ax,forcePost:ax,call:ak})}al("fontname",an,!(ap||ar));al("fontsize",ap,!ar);al("forecolor",ar,true)}function P(al){if(al.settings.setDefault){return}var ak=A.sign;ak.getTextSigns(al);if($S("isFree")){ak.getEcardSigns(al)}else{ak.getGraphSigns(al)}}function U(an,ak){var am="ComposeCall";if(typeof window[am]!="object"){window[am]={}}var al="f"+$I("util.Misc").getTime(true).valueOf();window[am][al]=function(){if(ak){delete window[am][al]}if(an){return an.apply(null,arguments)}};return am+"."+al}function y(ak){$I("support.OptionSupport").getSignList(function(al){if(al){ak.textSigns=al}})}function O(am){var al=Ud.get({field:"ntes_compose",flag:"card"});if(al=="1"||al=="2"){var ak=Uri.getUrl("compose_ecard",true);$.Ajax.jsonp(ak,function(an){if(an.result=="success"){am.ecardSigns=an.msg}})}}function I(am,al){var an=A.sign.getCallName(function(ao){if(ao&&ao.length){if(al){al(ao)}}},true);var ak=$.String.addParam(Uri.getUrl("compose_graphsign"),"func=window."+an);$.Ajax.request({url:ak,charset:"gbk",requestType:$.Ajax.SCRIPT})}function j(aq,am,ak){var al;if(ak=="text"){if(am==$.String.stripTags(am)){am=am.replace(/ /g,"&nbsp;");am=am.replace(/\n/g,"<br>")}if(am.indexOf("$date$")!=-1){var at=$I("util.Misc").getTime(true);var ao=$.Date.format(at,"yyyy年M月d日");am=am.replace(/\$date\$/g,ao)}am="--<br>"+am;al="spnEditorSign"}else{al=ak=="ecard"?"divNeteaseMailCard":"divEditorGraphSign"}var ap=aq.getContent("html");if(ap.indexOf(al)!=-1){try{var ar=aq.getIframeEl("#"+al);if(ar){ar.innerHTML=am}}catch(an){}}else{ap=[ap,aq.getBreakLine(3),'<div id="'+al+'">',am,"</div>"].join("");aq.setContent(ap,"html")}}function F(at,av){var au=A.sign;var al=au.setSign;var am=[];var ar={};var ao={renderTo:av,groups:[ar]};if($S("isVip")){ao.width="403px";var ap=A.sign.getCallName(function(ay,aw,ax){switch(ay){case"get":return at.textSigns;break;case"set":if(aw==0){$E("interface.OutlinkInterface",function(az){az.goOutlink({key:"vcard"})})}else{if(aw==1){$E("interface.OptionInterface",function(az){az.entry("options.SignModule")})}else{if(aw==2){$E("interface.OutlinkInterface",function(az){az.goOutlink({key:"shangdao"})})}}}break;case"select":if(aw==0){au.setSign(at,ax,"graph")}else{if(aw==1){au.setSign(at,ax,"text")}}break}});var ak=$.String.addParam(Uri.getUrl("compose_sign"),"call=window.parent."+ap);ar.content='<iframe src="'+ak+'" style="display:block;width:401px;height:240px" scrolling="no" frameborder="1"></iframe>'}else{var an=at.textSigns;if(an&&an.length>0){$.Array.each(an,function(ax,aw){if(aw){am.push({text:$.String.escapeHTML(aw.name),click:function(){al(at,aw.content,"text")}})}})}var aq=at.ecardSigns;if(aq&&aq.length>0){$.Array.each(aq,function(aw,ax){if(aw==0&&am.length){am.push({type:"split"})}am.push({text:$.String.escapeHTML(ax.cardName),click:function(){al(at,ax.html,"card")}})})}if(am.length){am.push({type:"split"})}am.push({text:"个性签名",click:function(){$E("interface.OptionInterface",function(aw){aw.showSignList(function(ax){if(ax){al(at,ax,"text")}})})}});am.push({text:"设置签名",click:function(){$E("interface.OptionInterface",function(aw){aw.entry("options.SignModule")})}});if($S("isFree")){am.push({text:"设置电子名片",click:function(){$E("interface.OutlinkInterface",function(aw){aw.goOutlink({key:"compose_ecard_entry"})})}})}ar.items=am}return(new $.Menu(ao).getEl()["dom"])}function ab(ak){C.ui.changeEditMode(ak,"source")}function i(al){var ak=al.settings.typoLinkId;if(!ak){return}var am=$("#"+ak);am.html("拼写检查");am.listen("click",$.Function.bind(A.typo.click,al));al.typoData={}}function N(ao){var ak=this;var al=$.Event.getTarget();var am=ak.getAttribute("typoId");var an=ao.curTypoSpan;var ap=al.innerHTML;if(ap.indexOf("全部")>=0){A.typo.ignoreAll(ao);return false}else{if(ap.indexOf("忽略")>=0){A.typo.clear(an,ao.doc)}else{if(ap&&ap.indexOf("暂无提示")<0&&ap.indexOf("nui-menu-split nui-split")<0){$(an).replace(ap,ao.doc)}}}return false}function d(au){var ao=this;var aw=$("#typoMenuDv");var aq=ao.getAttribute("evId");au.curTypoSpan=ao;var ar=false;if(!aw){ar=true;aw=document.createElement("div");aw.id="typoMenuDv";aw.className="nui-menu";aw.style.display="none";au.editorDv.appendChild(aw);C.event.add(au,"click",A.typo.clickMenu,aw)}else{aw=aw.dom}function az(aA){var aB='<div class="nui-menu-item"><div class="nui-menu-item-link"><span class="nui-menu-item-text">'+aA+"</span></div></div>";return aB}if(ar||aw.getAttribute("typoId")!=aq){aw.setAttribute("typoId",aq);var ay=au.typoData[aq];if(!ay){return}var al=ay.list;if(!al||al.length==0&&ay["case"]){al=[ay["case"]]}var at="";for(var am=0,ax=al.length;am<ax+2;am++){if(ax==0&&am==0){at+=az("暂无提示")}if(am==ax){at+='<div class="nui-menu-split nui-split"></div>'}at+=az((am<ax?al[am]:(am==ax?"忽略":"忽略全部")))}aw.innerHTML=at}var an=$(ao).position();aw.style.left=an[0]+"px";var ak=an[1];var ap=au.doc.body.scrollTop;aw.style.top=ak-ap+ao.offsetHeight+31+(au.editMode=="full"?27:0)+"px";C.ui.delayPopup(au,aw,0,function(){if(ak-ap>au.innerDv.offsetHeight/2){ak=ak-ap+31+(au.editMode=="full"?27:0)-aw.offsetHeight;aw.style.top=ak+"px"}});var av=$(aw).find(".nui-menu-item");av.each(function(aB,aA){var aC=$(aA);aC.listen("mouseover",function(){aC.addClass("nui-menu-item-hover")});aC.listen("mouseout",function(){aC.removeClass("nui-menu-item-hover")})})}function h(){var am=this;var al=A.typo.check;var ak=am.editMode;if(ak=="text"||ak=="source"){new $.Msgbox({type:"confirm",content:"拼写检查需要切换到富文本编辑模式，是否切换？",okText:"是",cancelText:"否",ok:function(){am.changeEditMode("basic");al.apply(am)}})}else{al.apply(am)}}function ah(){var aq=this;if(aq.isChecking){$.Tips.show({text:"正在进行拼写检查，请稍后再试"});return}A.typo.ignoreAll(aq);var an=aq.getContent();var ao=false;if(an.indexOf("\n")>=0){an=an.replace(/\n/g,"");ao=true}function ap(au){var av=aq.doc.getElementById(au);if(av){av.parentNode.removeChild(av);ao=true}}ap("isReplyContent");ap("isForwardContent");var ak=C.util.getText(aq.body,true);if(ao){aq.setContent(an)}function ar(){aq.showMask(5000);aq.isChecking=true;var au=$I("core.DataAction");(new au()).request({type:au.FLASH,data:{url:Uri.getUrl("compose_typo"),method:$.Ajax.POST,body:"text="+encodeURIComponent(ak),call:$.Function.bind(A.typo.showError,aq)}})}var al;function at(){var au=al.getEl().find("#editorTypoChk");if(au.dom.checked){Ud.set({field:"ntes_buzz",flag:"typo_prompt",value:"1"})}}var am=Ud.get({field:"ntes_buzz",flag:"typo_prompt"})!=1;if(!/[a-zA-z]+/.test(ak)){$.Msgbox.show({title:"对不起，拼写检查暂时只支持英文。"})}else{if(am&&/[\u4E00-\u9FA5]+/.test(ak)){al=new $.Msgbox({type:"confirm",title:'拼写检查暂不支持中文。不过，我们仍可以检查您邮件中的所有英文拼写。<br><br>                         <input id="editorTypoChk" type="checkbox"/>&nbsp;不再提示',okText:"检查",cancelText:"不检查",ok:function(){at();ar()},cancel:at})}else{ar()}}}function n(au){var av=this;av.showMask(false);var al=netease.mail.base.Eval;var aq=al.get(au);aq=aq.res;av.focus();var am=new C.Selection(av);var an=am.getRange();an.setEnd(av.body,0);var ap=av.doc.createElement("span");ap.className="typoRed";var ak=0;av.typoData={};for(var ao=0,ax=aq.length;ao<ax;ao++){var ay=aq[ao];var at=an.findText(ay,ak);if(at){ak=ay.pos+ay.src.length;var ar=ap.cloneNode(true);at.cloneRange().surroundContents(ar);at.setEndAfter(ar);an=at;C.event.add(av,"click",A.typo.showMenu,ar);var aw=ar.getAttribute("evId");ar.id=aw;av.typoData[aw]=aq[ao]}else{ak=undefined}}av.isChecking=false;$.Tips.show({text:"检查成功",succ:true})}function k(al,ak){var am=A.typo.reg;if(!am.test(C.util.nodeToHtml(al,ak))){$(al).replace(al.innerHTML,ak)}else{al.removeAttribute("class");al.removeAttribute("id");al.removeAttribute("evId")}}function aa(an,ak){var al=an.typoData,am;if(!al||m.isEmpty(al)){return false}if(ak){am=an.ignoreTypoDv;if(!am){am=an.ignoreTypoDv=document.createElement("div");am.style.display="none";an.editAreaDv.appendChild(am)}am.innerHTML=an.getContent()}else{am=an.body}(function(aq){if(aq.childNodes){var ap=aq.childNodes;for(var ao=0;ao<ap.length;ao++){arguments.callee.call(null,ap[ao])}}if(aq.nodeName=="SPAN"&&aq.className=="typoRed"){A.typo.clear(aq,(ak?document:an.doc))}})(am);if(ak){return am.innerHTML}}function c(){this.getEditor().history.undo()}function af(){return this.getEditor().history.queryUndo()}})();(function(){var e=$.Object;var d,b=$.createClass($N("component.editor.Query"));e.extend(b.prototype,{initialize:g,getEditor:f,queryState:i,queryValue:c,custQuery:h,query:a});function g(j){this._editor=j;d=$L("component.editor.Editor")}function f(){return this._editor}function i(k){var m=this.getEditor();var j=false;try{j=m.doc.queryCommandState(k)}catch(l){}return j}function c(j){var l=this.getEditor();var m;try{m=l.doc.queryCommandValue(j)}catch(k){}return m?m:false}function h(m,v){try{var t=this.getEditor(),r;t.focus();var k=new d.Selection(t);var l=k.getRange();var s=l.getFocusNodes();k.addRange(l)}catch(q){return false}if(m=="backcolor"){m="backgroundColor"}else{if(m=="lineheight"){m="lineHeight"}}var x,u,p;while(s.length>0){x=s.pop();if(x.nodeType==3){x=x.parentNode;if(v){p=v(x)}else{p=d.util.getStyle(t.win,x,m)}if(m=="lineHeight"){if(p&&p.indexOf("px")>0){var n=d.util.getStyle(t.win,x,"fontSize")||_changeToPx(x.getAttribute("size"));p=Math.round(parseFloat(p.replace("px",""))*10/parseFloat(n.replace("px","")))*10+"%";if(p=="110%"){p="120%"}}}if(p){if(!u){u=p}else{if(p!=u){return false}}}}else{if(x.hasChildNodes()){var y,j=x.childNodes,w=j.length;for(var o=0;o<w,y=j[o];o++){if(!d.dtd.isNonFormat(y.nodeName)){s.push(y)}}}}}u=u.replace(/\'/g,"");return u?u:false}function a(n){var m=this,l={};function k(q){var o=d.Plugin[q].query;if(o){try{return o.call(m)}catch(p){return false}}else{return m.queryState(q)}}if(typeof n=="string"){return k(n)}for(var j=0;j<n.length;j++){l[n[j]]=k(n[j])}return l}})();(function(){var l=$.Object;var B,i="startContainer",Y="startOffset",Q="endContainer",z="endOffset",s="collapsed",f="commonAncestorContainer",W=$.createClass($N("component.editor.Range"));l.extend(W.prototype,{initialize:Z,_getPath:y,_getNodeByPath:K,_getSelectedNode:J,_isCollapsed:b,_compareBoundaryPoints:O,_setEndPoint:k,_traverse:p,_traverseSameContainer:w,_traverseCommonStartContainer:aa,_traverseCommonEndContainer:F,_traverseCommonAncestors:L,_traverseRightBoundary:D,_traverseLeftBoundary:M,_traverseNode:A,_traverseFullySelected:H,getEditor:U,setStart:E,setEnd:g,setStartBefore:N,setStartAfter:P,setEndBefore:R,setEndAfter:x,collapse:I,selectNode:o,selectNodeContents:n,compareBoundaryPoints:v,deleteContents:T,extractContents:e,cloneContents:t,insertNode:r,surroundContents:a,cloneRange:C,getStartNode:j,getEndNode:u,canSurroundContents:G,getBookmark:c,moveToBookmark:V,getSelectedNodes:d,getFocusNodes:h,toString:q,position:X,move:S,findText:m});function Z(ab){this._editor=ab;B=$L("component.editor.Editor")}function U(){return this._editor}function y(af){var ac=[];var ae=af.parentNode;while(!/body/i.test(af.nodeName)){var ad=ae.childNodes;for(var ab=0;ab<ad.length;ab++){if(ad[ab]==af){ac.push(ab)}}af=ae;ae=af.parentNode}return ac}function K(ac){var ae=ac.slice();var af=this.getEditor().doc.body;var ab=ae.pop();while(ab!=undefined){var ad=af.childNodes;if(ab<0||ab>ad.length){return null}else{af=ad[ab]}ab=ae.pop()}return af}function J(ab,ad){var ac;if(ab.nodeType==3){return ab}if(ad<0){return ab}ac=ab.firstChild;while(ac&&ad>0){--ad;ac=ac.nextSibling}if(ac){return ac}return ab}function b(){var ab=this;return(ab[i]==ab[Q]&&ab[Y]==ab[z])}function O(ae,ah,ad,ag){var ai=this,ak,af,al,aj,ac,ab;if(ae==ad){if(ah==ag){return 0}if(ah<ag){return -1}return 1}ak=ad;while(ak&&ak.parentNode!=ae){ak=ak.parentNode}if(ak){af=0;al=ae.firstChild;while(al!=ak&&af<ah){af++;al=al.nextSibling}if(ah<=af){return -1}return 1}ak=ae;while(ak&&ak.parentNode!=ad){ak=ak.parentNode}if(ak){af=0;al=ad.firstChild;while(al!=ak&&af<ag){af++;al=al.nextSibling}if(af<ag){return -1}return 1}aj=B.util.findCommonAncestor(ae,ad);ac=ae;while(ac&&ac.parentNode!=aj){ac=ac.parentNode}if(!ac){ac=aj}ab=ad;while(ab&&ab.parentNode!=aj){ab=ab.parentNode}if(!ab){ab=aj}if(ac==ab){return 0}al=aj.firstChild;while(al){if(al==ac){return -1}if(al==ab){return 1}al=al.nextSibling}}function k(ae,af,ag){var ac=this,ab,ad;if(ae){ac[i]=af;ac[Y]=ag}else{ac[Q]=af;ac[z]=ag}if(!ac[i]||!ac[Q]){return}ab=ac[Q];while(ab.parentNode){ab=ab.parentNode}ad=ac[i];while(ad.parentNode){ad=ad.parentNode}if(ad==ab){if(ac._compareBoundaryPoints(ac[i],ac[Y],ac[Q],ac[z])>0){ac.collapse(ae)}}else{ac.collapse(ae)}ac[s]=ac._isCollapsed();ac[f]=B.util.findCommonAncestor(ac[i],ac[Q])}function p(ah){var af=this;if(af[i]==af[Q]){return af._traverseSameContainer(ah)}var ai=0,aj,ab;for(aj=af[Q],ab=aj.parentNode;ab;aj=ab,ab=ab.parentNode){if(ab==af[i]){return af._traverseCommonStartContainer(aj,ah)}++ai}var ad=0;for(aj=af[i],ab=aj.parentNode;ab;aj=ab,ab=ab.parentNode){if(ab==af[Q]){return af._traverseCommonEndContainer(aj,ah)}++ad}var al=ad-ai;var ac=af[i];while(al>0){ac=ac.parentNode;al--}var ae=af[Q];while(al<0){ae=ae.parentNode;al++}var ag,ak;for(ag=ac.parentNode,ak=ae.parentNode;ag!=ak;ag=ag.parentNode,ak=ak.parentNode){ac=ag;ae=ak}return af._traverseCommonAncestors(ac,ae,ah)}function w(ah){var ad=this,aj=ad.getEditor().doc,af;if(ah!="delete"){af=aj.createDocumentFragment()}if(ad[Y]==ad[z]){return af}if(ad[i].nodeType==3){var ag=ad[i].nodeValue;var ab=ag.substring(ad[Y],ad[z]);if(ah!="clone"){ad[i].deleteData(ad[Y],ad[z]-ad[Y]);ad.collapse(true)}if(ah=="delete"){return}af.appendChild(aj.createTextNode(ab));return af}var ak=ad._getSelectedNode(ad[i],ad[Y]);var ai=ad[z]-ad[Y];var ae,ac;while(ai>0){ae=ak.nextSibling;ac=ad._traverseFullySelected(ak,ah);if(af){af.appendChild(ac)}--ai;ak=ae}if(ah!="clone"){ad.collapse(true)}return af}function aa(ai,af){var ac=this,ah=ac.getEditor().doc,ae;if(af!="delete"){ae=ah.createDocumentFragment()}var aj=ac._traverseRightBoundary(ai,af);if(ae){ae.appendChild(aj)}var ak=B.util.getNodeIndex(ai);var ag=ak-ac[Y];if(ag<=0){if(af!="clone"){ac.setEndBefore(ai);ac.collapse(false)}return ae}var ad,ab;aj=ai.previousSibling;while(ag>0){ad=aj.previousSibling;ab=ac._traverseFullySelected(aj,af);if(ae){ae.insertBefore(ab,ae.firstChild)}--ag;aj=ad}if(af!="clone"){ac.setEndBefore(ai);ac.collapse(false)}return ae}function F(ac,ag){var ad=this,ai=ad.getEditor().doc,af;if(ag!="delete"){af=ai.createDocumentFragment()}var aj=ad._traverseLeftBoundary(ac,ag);if(af){af.appendChild(aj)}var ak=B.util.getNodeIndex(ac);++ak;var ah=ad[z]-ak,ae,ab;aj=ac.nextSibling;while(ah>0){ae=aj.nextSibling;ab=ad._traverseFullySelected(aj,ag);if(af){af.appendChild(ab)}--ah;aj=ae}if(ag!="clone"){ad.setStartAfter(ac);ad.collapse(true)}return af}function L(ac,am,aj){var af=this,al=af.getEditor().doc,ah,ab;if(aj!="delete"){ah=al.createDocumentFragment()}var an=af._traverseLeftBoundary(ac,aj);if(ah){ah.appendChild(an)}var ae=ac.parentNode;var ad=B.util.getNodeIndex(ac);var ai=B.util.getNodeIndex(am);++ad;var ak=ai-ad;var ag=ac.nextSibling;while(ak>0){ab=ag.nextSibling;an=af._traverseFullySelected(ag,aj);if(ah){ah.appendChild(an)}ag=ab;--ak}an=af._traverseRightBoundary(am,aj);if(ah){ah.appendChild(an)}if(aj!="clone"){af.setStartAfter(ac);af.collapse(true)}return ah}function D(ae,ak){var ah=this,ad=ah._getSelectedNode(ah[Q],ah[z]-1),aj=ad!=ah[Q];if(ad==ae){return ah._traverseNode(ad,aj,false,ak)}var ab=ad.parentNode,ag=ah._traverseNode(ab,false,false,ak),ac,ai,af;while(ab){while(ad){ac=ad.previousSibling;ai=ah._traverseNode(ad,aj,false,ak);if(ak!="delete"){ag.insertBefore(ai,ag.firstChild)}aj=true;ad=ac}if(ab==ae){return ag}ad=ab.previousSibling;ab=ab.parentNode;af=ah._traverseNode(ab,false,false,ak);if(ak!="delete"){af.appendChild(ag)}ag=af}}function M(ae,ak){var ah=this,ac=ah._getSelectedNode(ah[i],ah[Y]),aj=ac!=ah[i];if(ac==ae){return ah._traverseNode(ac,aj,true,ak)}var ab=ac.parentNode;var ag=ah._traverseNode(ab,false,true,ak),ad,ai,af;while(ab){while(ac){ad=ac.nextSibling;ai=ah._traverseNode(ac,aj,true,ak);if(ak!="delete"){ag.appendChild(ai)}aj=true;ac=ad}if(ab==ae){return ag}ac=ab.nextSibling;ab=ab.parentNode;af=ah._traverseNode(ab,false,true,ak);if(ak!="delete"){af.appendChild(ag)}ag=af}}function A(ai,ag,ab,ah){var af=this;if(ag){return af._traverseFullySelected(ai,ah)}if(ai.nodeType==3){var aj=ai.nodeValue,ak,ad,ac;if(ab){ac=af[Y];ak=aj.substring(ac);ad=aj.substring(0,ac)}else{ac=af[z];ak=aj.substring(0,ac);ad=aj.substring(ac)}if(ah!="clone"){ai.nodeValue=ad}if(ah=="delete"){return}var ae=ai.cloneNode(false);ae.nodeValue=ak;return ae}if(ah=="delete"){return}return ai.cloneNode(false)}function H(ac,ab){if(ab!="delete"){return ab=="clone"?ac.cloneNode(true):ac}ac.parentNode.removeChild(ac)}function E(ab,ac){this._setEndPoint(true,ab,ac)}function g(ab,ac){this._setEndPoint(false,ab,ac)}function N(ab){this.setStart(ab.parentNode,B.util.getNodeIndex(ab))}function P(ab){this.setStart(ab.parentNode,B.util.getNodeIndex(ab)+1)}function R(ab){this.setEnd(ab.parentNode,B.util.getNodeIndex(ab))}function x(ab){this.setEnd(ab.parentNode,B.util.getNodeIndex(ab)+1)}function I(ac){var ab=this;if(ac){ab[Q]=ab[i];ab[z]=ab[Y]}else{ab[i]=ab[Q];ab[Y]=ab[z]}ab[s]=true}function o(ab){this.setStartBefore(ab);this.setEndAfter(ab)}function n(ab){this.setStart(ab,0);this.setEnd(ab,ab.nodeType===1?ab.childNodes.length:ab.nodeValue.length)}function v(ab,ad){var ac=this;if(ab===0){return ac._compareBoundaryPoints(ac[i],ac[Y],ad[i],ad[Y])}if(ab===1){return ac._compareBoundaryPoints(ac[i],ac[Y],ad[Q],ad[z])}if(ab===2){return ac._compareBoundaryPoints(ac[Q],ac[z],ad[Q],ad[z])}if(ab===3){return ac._compareBoundaryPoints(ac[Q],ac[z],ad[i],ad[Y])}}function T(){this._traverse("delete")}function e(){return this._traverse("extract")}function t(){return this._traverse("clone")}function C(){var ab=this.getEditor();var ac=new B.Range(ab);ac[i]=this[i];ac[Y]=this[Y];ac[Q]=this[Q];ac[z]=this[z];ac[s]=this[s];ac[f]=this[f];return ac}function r(ah){var ae=this,ag=ae[i],ac=ae[Y],ab,ad;if((ag.nodeType===3||ag.nodeType===4)&&typeof ag.nodeValue=="string"){if(!ac){ag.parentNode.insertBefore(ah,ag)}else{if(ac>=ag.nodeValue.length){var af=ag.nextSibling;if(af){ag.parentNode.insertBefore(ah,af)}else{ag.parentNode.appendChild(ah)}}else{ab=ag.splitText(ac);ab.parentNode.insertBefore(ah,ab)}}}else{if(ag.childNodes.length>0){ad=ag.childNodes[ac]}if(ad){ag.insertBefore(ah,ad)}else{ag.appendChild(ah)}}}function a(ae){var ac=this;var ab=ac.extractContents();var ad=ac.getEditor();ac.insertNode(ae);ae.appendChild(ab);ac.selectNode(ae)}function j(){function ab(af){return af.parentNode.firstChild==af}var ae=this[i];var ac=this[Y];if(ae.nodeType!=3){ae=ae.childNodes[ac]}if(ae.nodeType!=3||ac==0){var ad=this[f];while(ae!=ad){if(ab(ae)){ae=ae.parentNode}else{break}}}return ae}function u(){function ab(af){return af.parentNode.lastChild==af}var ae=this[Q];var ac=this[z];if(ae.nodeType!=3){ae=ae.childNodes[ac-1]}if(ae.nodeType==1||(ae.nodeType==3&&ac>=ae.nodeValue.length)){var ad=this[f];while(ae!=ad){if(ab(ae)){ae=ae.parentNode}else{break}}}return ae}function G(){var ac=this.getStartNode();var ab=this.getEndNode();var ad=this[f];return(ac==ad||ac.parentNode==ad)&&(ab==ad||ab.parentNode==ad)}function c(){var ac=this.getEditor();if(!this[i]){return null}try{if(B.IE){return B.util.getRange(ac).getBookmark()}else{return{startContainer:this._getPath(this[i]),startOffset:this[Y],endContainer:this._getPath(this[Q]),endOffset:this[z]}}}catch(ab){return null}}function V(ah){var ag=this.getEditor();var ac=B.util.getRange(ag);if(B.IE){ac.moveToBookmark(ah)}else{var af=this._getNodeByPath(ah[i]);var ad=this._getNodeByPath(ah[Q]);try{ac.setStart(af,ah[Y]);ac.setEnd(ad,ah[z])}catch(ae){}var ab=B.util.getSelection(ag);ab.removeAllRanges();ab.addRange(ac)}}function d(){var aj=this;var an=aj[i],am=aj[Q],ag=aj[Y],ad=aj[z],ak=new Array();aj.getEditor().doc.body.normalize();if(an==am){if(ag==ad){return ak}if((an.nodeType===3||an.nodeType===4)&&an.nodeValue){ak.push(an)}else{var ac=an.childNodes;var ao=ac.length;for(var ai=ag;ai<ad;ai++){ak.push(ac[ai])}}}else{if(an!=aj[f]){var ab=an;if(ab.nodeType==3){ak.push(ab)}else{ak.push(ab.childNodes[ag])}var af=ab.parentNode;while(af&&af!=aj[f]){var ae=ab.nextSibling;while(ae){if(ae.nodeType!=8){ak.push(ae)}ae=ae.nextSibling}ab=af;af=ab.parentNode}}if(am!=aj[f]){var al=am;if(al.nodeType==3){ak.push(al)}else{ak.push(al.childNodes[ad-1])}af=al.parentNode;while(af&&af!=aj[f]){var ah=al.previousSibling;while(ah){if(ah.nodeType!=8){ak.push(ah)}ah=ah.previousSibling}al=af;af=al.parentNode}}var ae=ab.nextSibling;while(ae&&ae!=al){if(ae.nodeType!=8){ak.push(ae)}ae=ae.nextSibling}}return ak}function h(){if(this[i]==this[Q]&&this[Y]==this[z]){return[this[i]]}else{return this.getSelectedNodes()}}function q(){return B.util.getText(this.cloneContents())}function X(){var af=this,ad=0,ab=af[Q],ag=af[z];var ae=false;if(ab.nodeType==3){ad+=ag}else{var ac=ab.childNodes;if(ac.length==ag){ag--}ab=ac[ag]}while(ab.nodeName!="BODY"){if(ae){if(ab.nodeType==3){ad+=ab.nodeValue.length}else{ad+=B.util.getText(ab).length}}if(ab.previousSibling){ab=ab.previousSibling;ae=true}else{ab=ab.parentNode;ae=false}}return ad}function S(ag,ab){var af=this,al,ad;function ac(){while(al){var am=al.nextSibling;if(am){al=am;ad=0;break}al=al.parentNode}}var ak,aj=ab?af.cloneRange():af,al=aj[Q],ad=aj[z];if(al.nodeType==1&&ad==al.childNodes.length){ac();aj.setEnd(al,ad)}while(ag>=0){if(al.nodeType==3){if(ag>0){var ae=al.nodeValue;if(ae.indexOf("\n")>=0){ae=ae.replace(/\n/g,"");al.nodeValue=ae}var ak=al.nodeValue.length;if(ak>ag||(ab&&ak==ag)){ad+=ag;break}else{ag-=ak;ac()}}else{break}}else{ak=B.util.getText(al).length;if(ad!=0){for(var ah=0;ah<ad;ah++){ak-=B.util.getText(al.childNodes[ah]).length}}if(ak>ag||(ab&&ak==ag)){var ai=al.childNodes;if(ai.length<=ad){al=al.lastChild}else{al=ai[ad]}ad=0}else{ac();ag-=ak}}}af[ab?"setEnd":"setStart"](al,ad)}function m(ac,ab){try{var ag=this;var af=ac.src;var aj=ac.pos-(ab==undefined?ag.position():ab);var ah=af.length;var ai=0,ae=0;var ad=true;while(ai<5){if(aj+ae>=0){var al=ag.cloneRange();al.move(aj+ae);al.move(ah+ae,true)}if(al.toString()!=af){if(ad){ai++;ae=ai;ad=false}else{ae=0-ai;ad=true}}else{return al;break}}return false}catch(ak){return false}}})();(function(){var i=$.Object;var h,c="startContainer",f="startOffset",d="endContainer",j="endOffset",l="collapsed",m="commonAncestorContainer",n=$.createClass($N("component.editor.Selection"));i.extend(n.prototype,{initialize:g,getEditor:a,getRange:e,addRange:b,isCollapsed:k});function g(o){this._editor=o;h=$L("component.editor.Editor")}function a(){return this._editor}function e(){var x=this,z=x.getEditor(),p=new h.Range(z);if(!z.cleaned){z.cleaned=true;var t=z.doc.body.firstChild;if(t&&t.nodeType==3){var q=t.nextSibling;var A=t.nodeValue;var B=A.length;if((B==9||(B==1&&A=="\n"))&&q&&q.nodeType==3){t.parentNode.removeChild(t)}else{if(B==2&&q&&q.nodeName=="TABLE"){t.parentNode.removeChild(t)}}}}z.doc.body.normalize();var s=h.util.getRange(z);if(!s){return null}if(h.IE){var v=s,u,y;u=v.item?v.item(0):v.parentElement();if(u.ownerDocument!=z.doc){return}var r=h.util.getSelection(z);if(/control/i.test(r.type)&&(v.item||!u.hasChildNodes())){p.setStart(u.parentNode,z.getNodeIndex(u));p.setEnd(p[c],p[f]+1);p[l]=true;return p}var w=v.duplicate();w.collapse();p[l]=y=v.isEqual(w)?true:false;function o(M){var H,I,E,F,J=0,K,D,C,L,G;L=v.duplicate();L.collapse(M);H=z.doc.createElement("a");C=L.parentElement();if(!C.hasChildNodes()){p[M?"setStart":"setEnd"](C,0);return}C.appendChild(H);L.moveToElementText(H);G=v.compareEndPoints(M?"StartToStart":"EndToEnd",L);if(G>0){p[M?"setStartAfter":"setEndAfter"](C);H.parentNode.removeChild(H);return}F=C.childNodes;K=F.length-1;while(J<=K){D=Math.floor((J+K)/2);C.appendChild(H);C.insertBefore(H,F[D]);L.moveToElementText(H);G=v.compareEndPoints(M?"StartToStart":"EndToEnd",L);if(G>0){J=D+1}else{if(G<0){K=D-1}else{break}}}I=G>0||D==0?H.nextSibling:H.previousSibling;if(I.nodeType==1){H.parentNode.removeChild(H);E=h.util.getNodeIndex(I);I=I.parentNode;if(!M||D>0){E++}}else{if(G>0||D==0){L.setEndPoint(M?"StartToStart":"EndToEnd",v);E=L.text.length}else{L.setEndPoint(M?"StartToStart":"EndToEnd",v);E=I.nodeValue.length-L.text.length}H.parentNode.removeChild(H)}p[M?"setStart":"setEnd"](I,E)}o(true);if(!y){o()}else{p[d]=p[c];p[j]=p[f]}p[m]=h.util.findCommonAncestor(p[c],p[d])}else{p[c]=s[c];p[f]=s[f];p[d]=s[d];p[j]=s[j];p[l]=s[l];p[m]=s[m]}return p}function b(s){var u=this,w=u.getEditor(),p=h.util.getRange(w),z=s[c],t=s[f],x=s[d],o=s[j];if(h.IE){var y=u.getEditor().doc,q=y.body;function v(D){var B,F,A,C,E;A=y.createElement("a");B=D?z:x;F=D?t:o;C=p.duplicate();if(B==y){B=q;F=0}if(B.nodeType==3){B.parentNode.insertBefore(A,B);C.moveToElementText(A);C.moveStart("character",F);A.parentNode.removeChild(A);p.setEndPoint(D?"StartToStart":"EndToEnd",C)}else{E=B.childNodes;if(E.length){if(F>=E.length){B.appendChild(A)}else{B.insertBefore(A,E[F])}C.moveToElementText(A)}else{A=y.createTextNode("\uFEFF");B.appendChild(A);C.moveToElementText(A.parentNode);C.collapse(true)}p.setEndPoint(D?"StartToStart":"EndToEnd",C);A.parentNode.removeChild(A)}}v(true);v();p.select();p.scrollIntoView()}else{var r=h.util.getSelection(w);p.setStart(z,t);p.setEnd(x,o);r.removeAllRanges();r.addRange(p)}}function k(){try{var r=this.getEditor();var p=h.util.getRange(r);if(h.IE){var o=p.duplicate();o.collapse();if(p.isEqual(o)){return true}else{return false}}else{return p[l]}}catch(q){}}})();(function(){var s=$.Object;var m=null,n=$.createClass($N("component.editor.Ui"));s.extend(n,{el:{},getEl:o,init:g,delayPopup:p,hidePopup:b,createTbGroup:c,createTbItem:f,createSourceTb:l,buttonClick:i,createMenu:e,menuClick:a,clickList:j,changeEditMode:d,changeToolbar:r,selectMenu:h,setSize:k,fixSize:q});function o(u){var t=n.el;if(!t[u]){t[u]=document.createElement(u)}return t[u].cloneNode(true)}function g(C){m=$L("component.editor.Editor");var A=this.getEl,w=C.innerDv=A("div"),v=C.settings,x=v.editMode;C.editMode=x;if(x=="hide"){C.viewMode=x;C.editMode="basic"}w.className="APP-editor APP-editor-"+x;C.toolbarDv=A("div");C.toolbarDv.className="APP-editor-tbar";C.toolbarDv.style.zIndex=2;w.appendChild(C.toolbarDv);if(Ext.festival){C.springDv=A("div");C.springDv.className="EGG-editor-lantern";if(Ud.get({field:"ntes_htmlbar"})==2){C.springDv.style.top="0px"}w.appendChild(C.springDv)}w=C.toolbarDv;C.basicTBDv=A("div");C.basicTBDv.className="APP-editor-tbar-basic";w.appendChild(C.basicTBDv);C.fullTBDv=A("div");C.fullTBDv.className="APP-editor-tbar-full";w.appendChild(C.fullTBDv);C.sourceTBDv=A("div");C.sourceTBDv.className="APP-editor-tbar-source";w.appendChild(C.sourceTBDv);var z=C.editAreaDv=A("div");z.className="APP-editor-edtr";z.style.position="relative";var B=C.maskDv=A("div");B.className="APP-editor-edtr-mask";B.style.display="none";z.appendChild(B);var u=C.iframe=A("iframe"),t=v.tabIndex;u.style.position="absolute";u.setAttribute("tabIndex",t);u.hideFocus=true;u.setAttribute("frameborder","0",0);u.className="APP-editor-iframe";z.appendChild(u);var y=C.textarea=A("textarea");y.className="APP-editor-textarea";y.setAttribute("tabIndex",t);y.hideFocus=true;z.appendChild(y);C.innerDv.appendChild(z);w=C.editorDv;w.style.position="relative";w.appendChild(C.innerDv);var D=C.containerDv;D.appendChild(w);n.setSize(C,{height:v.height,width:v.width});C.win=C.iframe.contentWindow;C.doc=C.win.document}function p(y,w,A,z){var v=w.id;var t=$(w);var x=A||300;if(v.indexOf("_")>=0){setTimeout(function(){var B=t.get("_item");if(B){B.show();y.popupDv=w}},x);return}function u(B){B.removeClass("fn-animation-hiding");B.addClass("fn-animation-showing");if(z){z()}}setTimeout(function(){t.show();t.setStyle({visibility:"visible"});if(!$.Browser.ie()){setTimeout($.Function.bind(u,null,t),0)}else{u(t)}y.popupDv=w},x)}function b(x){var y=x.popupDv;function w(z){z.hide();z.setStyle({visibility:"hidden"})}if(y){var v=$(y);var u=y.id;if(u.indexOf("_")>=0){var t=v.get("_item");if(t){t.hide()}return}v.removeClass("fn-animation-showing");v.addClass("fn-animation-hiding");if(!$.Browser.ie()){setTimeout($.Function.bind(w,null,v),0.5)}else{w(v)}}}function c(x,t,w,u){var v=n.getEl("div");if(u){v.className="APP-editor-extOpt"}else{v.className="APP-editor-btnGrp";v.style.width=w}x[t+"TBDv"].appendChild(v);return v}function f(B,C,v,u,t){var A=this.getEl,y=A("a");u=u||{};var z=u.uiInfo;if(u.type=="link"){y.innerHTML=z.title;y.className="APP-editor-extOpt-item nui-txt-link"}else{if(z){var x=A("span");if(v=="undo"||v=="redo"){y.className="APP-editor-btn APP-editor-btn-dis"}else{y.className="APP-editor-btn"}if(v=="full"||v=="basic"){y.className+=" APP-editor-btn-switchFunction"}else{if(v=="source"){y.className+=" APP-editor-btn-switchSource"}}if(C=="source"&&v!="full"){y.title="源码模式下不能使用该功能"}else{y.setAttribute("val",v);y.title=z.title}if((C=="full"||C=="source")&&(v=="fontsize"||v=="fontname")){y.className+=" APP-editor-btn-select";x.innerHTML=v=="fontname"?"字体":"字号"}else{var w=A("b");w.className="ico ico-editor ico-editor-"+v;w.innerHTML=z.title;x.appendChild(w)}x.className="APP-editor-btn-rc";y.setAttribute("evId",C+v+B.num);y.appendChild(x)}else{if(v=="|"||v=="||"){y.className="APP-editor-btn APP-editor-btn-spln"+(v=="||"?" APP-editor-btn-spln-l":"")}}}y.href="javascript:void(0)";y.hideFocus=true;if(t){t.appendChild(y)}else{B[C+"TBDv"].appendChild(y)}return y}function l(t){var u=t.fullTBDv.innerHTML;u=u.replace("切换到源码功能","###");u=u.replace(/title=\"[^\"#]+\"/ig,"title='源码模式下不能使用该功能'");u=u.replace("APP-editor-btn APP-editor-btn-switchSource","APP-editor-btn APP-editor-btn-switchSource APP-editor-btn-selected");u=u.replace("###","返回可视化视图");u=u.replace("fullsource","sourcefull");u=u.replace(/evId(?!=\"sourcefull)/ig,"evd");t.sourceTBDv.innerHTML=u}function i(w){var u=this,v=u.getAttribute("val"),x=m.event.fire;x(w,"beforeClick",v);var t=m.Plugin[v].click;if(t){t(w)}else{w.format.edit(v)}x(w,"selectionChanged");x(w,"contentChanged")}function e(B,y){var v=y.name,A="";var F=y.menus,E=F.length,x=y.template;for(var w=0;w<E;w++){var t=F[w];if(t=="sep"){A+='<div class="nui-menu-split nui-split"></div>'}else{var z=t.length;A+=x.replace(/\$\d/g,function(H){var G=parseInt(H.substring(1));return G<z?t[G]:""})}}if(B.settings.setDefault&&(v=="fontname"||v=="fontsize")||v=="forecolor"){A+='<div class="nui-menu-split nui-split"></div><div class="nui-menu-item"  cmd="setDefault"><div class="nui-menu-item-link"><span class="nui-menu-item-text">设置默认</span></div></div>'}var D=n.getEl("div");D.id=v+"MenuDv"+B.num;var u=y.Class||"nui-menu";D.className=u;D.style.width=y.width;D.style.display="none";D.innerHTML=A;D.setAttribute("evId",v+"Menu"+B.num);B.editorDv.appendChild(D);var C=$(D).find(".nui-menu-item");C.each(function(H,G){var I=$(G);I.listen("mouseover",function(){I.addClass("nui-menu-item-hover")});I.listen("mouseout",function(){I.removeClass("nui-menu-item-hover")})});return D}function a(A){var u=this,y=u.getAttribute("val"),x=A.popupMenus[y];if(!x||y=="sign"){if(y=="sign"&&x){var t=$(x).get("_item");if(t){t.destroy()}}x=m.event.fire(A,"create"+y+"Menu",A.editorDv);if(!x){var v=m.Plugin[y].createMenu;x=v?v(A,A.editorDv):null}if(x){A.popupMenus[y]=x}else{return}}n.selectMenu(A,x,y);var z=$(u).position();var w=$(A.editorDv).position();x.style.left=z[0]-w[0]+2+"px";x.style.top=z[1]-w[1]+21+"px";n.delayPopup(A,x);if(A.range&&m.IE){A.range.select()}}function j(x,u){var v=this;n.hidePopup(x);var A=u.target||u.srcElement;var z=$(A).findParent("DIV");var w=z.dom.getAttribute("cmd")||z.dom.parentNode.getAttribute("cmd");var t=z.dom.getAttribute("val")||z.dom.parentNode.getAttribute("val");if(w=="setDefault"){m.Plugin[w].showWin(x)}else{x.format.edit(w,t);var y=m.event.fire;y(x,"selectionChanged");y(x,"contentChanged")}}function d(z,u){var x=z.editMode;if(x==u||z.viewMode==u||(u=="html"&&(x=="basic"||x=="full"))){return false}var t=z.innerDv,w=z.textarea;function y(A){var B;if(A=="full"){B="APP-editor APP-editor-full"}else{if(A=="source"){B="APP-editor APP-editor-source"}else{if(A=="text"){B="APP-editor APP-editor-text"}else{if(A=="hide"){B=t.className+" APP-editor-hide"}else{B="APP-editor APP-editor-basic"}}}}t.className=B}if(u=="full"){y(u);if(x=="source"){z.editMode=u;z.setContent(w.value)}}else{if(u=="source"){y(u);w.value=z.getContent()}else{if(u=="basic"){var v;if(x=="text"){v=m.util.textToHtml(w.value)}else{if(x=="source"){v=w.value}}y(u);if(v){z.body.innerHTML=v}}else{if(u=="text"){y(u);m.event.fire(z,"contentChanged");w.value=z.getContent("text");z.editModeTmp=x}else{if(u=="html"){var v=m.util.textToHtml(w.value);z.editMode=z.editModeTmp;if(z.editModeTmp!="source"){z.setContent(v)}else{w.value=v}y(z.editModeTmp)}else{if(u=="hide"){z.viewMode=u;y(u)}else{if(u=="show"){z.viewMode=u;y(x);x="hide"}}}}}}}if(u!="hide"&&u!="show"&&u!="html"){z.editMode=u}if(u!="hide"&&(z.editMode=="basic"||z.editMode=="full")){n.changeToolbar(z)}n.fixSize(z,x);m.event.fire(z,"onEndChangeEditMode",u)}function r(z,t){var x=z.editMode,w=z.toolbar;t=t||["undo","redo","bold","italic","underline"];for(var v=0;v<t.length;v++){if(!w[x+t[v]]){t.splice(v,1);v--}}if(t.length==0){return}var y=z.query.query(t);var w=z.toolbar;for(var u in y){var A=$(w[x+u]);if(A){if(y[u]==true){if(u=="redo"){A.removeClass("APP-editor-btn-dis")}else{if(u=="undo"){A.removeClass("APP-editor-btn-dis")}else{A.addClass("APP-editor-btn-on")}}}else{if(u=="redo"){A.addClass("APP-editor-btn-dis")}else{if(u=="undo"){A.addClass("APP-editor-btn-dis")}}A.removeClass("APP-editor-btn-on")}}}}function h(A,D,u){if(u=="fontname"||u=="fontsize"||u=="forecolor"||u=="backcolor"){A.focus();var B=A.query.query(u)||A.settings[u];if(!B){B=u=="fontname"?"arial":"#ffffff"}B=B.toLowerCase();var C=false;D=$(D);var w=D.find(".nui-menu-item");for(var v=0;v<w.doms.length;v++){var x=w.doms[v];var z=$(x);var t=x.getAttribute("val");if(t&&t.toLowerCase()==B){C=true;if(!z.find(".nui-menu-item-icon")){var y=$.Element.create("SPAN");y.setClass("nui-menu-item-icon");y.html('<b class="nui-ico nui-ico-radio nui-ico-radio-checked"></b>');z.previous(y.dom)}}else{var y=z.find(".nui-menu-item-icon");if(y){y.remove()}}}if(!C){var y=D.find(".nui-menu-item-icon");if(y){y.remove()}}}}function k(w,v){var t=w.innerDv;if(v.height){var u=v.height;u=parseInt(u.replace("px",""))-2;t.setAttribute("height",u);t.style.height=u+"px";n.fixSize(w)}if(v.width){t.style.width=v.width}}function q(x,u){var w=x.innerDv;var t=w.getAttribute("height")||m.util.getStyle(window,w,"height");var v=x.toolbarDv.offsetHeight;if(typeof t=="string"){t=parseInt(t.replace("px",""))}w.style.height=t-v+"px";x.textarea.style.height=x.editAreaDv.offsetHeight+"px"}})();(function(){var h=$.Object;var k=$.createClass($N("component.editor.Util"));h.extend(k,{getStyle:i,htmlToText:f,textToHtml:l,nodeToHtml:d,getText:j,getNodeIndex:n,findCommonAncestor:c,execCmd:e,getSelection:g,getRange:b,num2HexForIe:m,rgb2Hex:a});function i(o,p,q){return q?p.currentStyle?p.currentStyle[q]:o.getComputedStyle(p,false)[q]:p.currentStyle?p.currentStyle:o.getComputedStyle(p,false)}function f(o,p){o=o.replace(/\n/ig,"");o=o.replace(/\\s+/ig,"");if(!p){o=o.replace(/<\/(address|blockquote|center|dir|div|dl|fieldset|form|hr|h[1-6]|isindex|iframe|menu|ol|p|pre|table|ul)>/gi,"\n");o=o.replace(/<br>/gi,"\n")}o=o.replace(/<li>/gi," . ");o=o.replace(/<[^>]+>/g,"");o=o.replace(/&nbsp;/gi," ");o=o.replace(/&lt;/gi,"<");o=o.replace(/&gt;/gi,">");o=o.replace(/&quot;/gi,'"');o=o.replace(/&amp;/gi,"&");return o}function l(o){o=o.replace(/&/g,"&amp;");o=o.replace(/</g,"&lt;");o=o.replace(/>/g,"&gt;");o=o.replace(/ /ig,"&nbsp;");o=o.replace(/\"/g,"&quot;");o=o.replace(/\n/ig,"<br>");return o}function d(r,q){var o=q||document;var p=o.createElement("div");p.appendChild(r.cloneNode(true));return p.innerHTML}function j(r,p){var o=$L("component.editor.Dtd");var q="";(function(u){if(p&&(u.nodeName=="BR"||o.isBlock(u.nodeName))){q+="\n"}if(u.nodeType==3){q+=u.nodeValue}else{if(u.childNodes){var t=u.childNodes;for(var s=0;s<t.length;s++){arguments.callee.call(null,t[s])}}}})(r);return p?q:q.replace(/\n/g,"")}function n(t,p){var o=0,r,s,q;if(t){for(r=t.nodeType,t=t.previousSibling,s=t;t;t=t.previousSibling){q=t.nodeType;if(p&&q==3){if(q==r||!t.nodeValue.length){continue}}o++;r=q}}return o}function c(p,o){var r=p;while(r){var q=o;while(q){if(r==q){return r}q=q.parentNode}r=r.parentNode}return r}function e(q,r,o){q.focus();try{q.doc.execCommand(r,false,o);return true}catch(p){return false}}function g(o){o.focus();return o.IE?o.doc.selection:o.win.getSelection()}function b(q){q.focus();if(q.IE){return q.doc.selection.createRange()}else{var r;try{var o=q.win.getSelection();if(o&&o.rangeCount>0){q.cacheRange=r=o.getRangeAt(0)}else{r=q.cacheRange}}catch(p){}return r}}function m(s){if(s==false){return"#000000"}var r=s.toString(16);if(r.length==1){r="00000"+r}else{if(r.length==2){r="0000"+r}else{if(r.length==3){r="000"+r}else{if(r.length==4){r="00"+r}else{if(r.length==5){r="0"+r}}}}}var q=r.substring(0,2);var p=r.substring(2,4);var o=r.substring(4);return"#"+o+p+q}function a(s){if(!/^rgb/i.test(s)){return s}var q=s.match(/[0-9]+/g);var r=parseInt(q[0]);var p=parseInt(q[1]);var o=parseInt(q[2]);return"#"+(r>15?r.toString(16):"0"+r.toString(16))+(p>15?p.toString(16):"0"+p.toString(16))+(o>15?o.toString(16):"0"+o.toString(16))}})();(function(){try{var D="component.editor.",r=$.Component,i=$L(D+"Ui"),M=$L(D+"Event"),f=$L(D+"Util"),n=$L(D+"Dtd"),x=$L(D+"Plugin"),X=$L(D+"Range"),I=$L(D+"Selection"),l=$L(D+"History"),c=$L(D+"Format"),J=$L(D+"Query")}catch(U){return U}var q=$.Object;var Y=$.Browser;var o=$.Event;var z=$.createClass($N(D+"Editor"));q.mix(z,r,{xtype:"editor",version:"2.0",IE:!!document.selection,num:0,getNum:N,_listeners:[{name:"click",handler:function(){M.commonHandle(this)},target:function(){return $(document)}},{name:"click",handler:function(){var e=this;if(!e.clicked){e.clicked=true;M.fire(e,"contentChanged")}M.commonHandle(e);M.fire(e,"selectionChanged")},target:function(){return $(this.doc)}},{name:"mouseup",handler:function(){M.commonHandle(this)},target:function(){return $(this.doc)}},{name:"keydown",handler:function(){M.commonHandle(this);M.fire(this,"selectionChanged")},target:function(){return $(this.doc)}},{name:"keyup",handler:function(){M.commonHandle(this);M.fire(this,"selectionChanged")},target:function(){return $(this.doc)}}],config:{editMode:"basic",tabIndex:0,fontsize:"14px",forecolor:"#000000",fontname:"arial",plugins:{basic:["bold","italic","underline","fontsize","forecolor","backcolor","|","justify","list","indent","|","image","capture","portrait","stationery","insertTime","microphone","sign","av","full"],full:[["27px","undo","redo"],"||",{ie:["54px","cut","copy","paste"]},{ie:"||"},["216px","fontname","fontsize","justify","list","indent","lineheight","bold","italic","underline","forecolor","backcolor","insertHorizontalRule","insertTable","removeFormat"],"||",["108px","image","capture","portrait","link","stationery","insertTime","sign"],"||",["24px","microphone","source"],["86px","av"],["ext","typo","dict"],"basic"],other:["backspace","editImage"]}}},true);if(Y.ie()){z._listeners=z._listeners.concat({name:"beforedeactivate",handler:function(){var e=this;$(e.innerDv).removeClass("APP-editor-active");if(e.clicked){e.saveRange();if(e.history){e.history.save()}}},target:function(){return $(this.iframe)}},{name:"activate",handler:function(){var aa=this;$(aa.innerDv).addClass("APP-editor-active");if(aa.springDv){aa.springDv.style.display="none";aa.springDv=null}if(aa.range){try{aa.range.select();aa.cleanRange()}catch(ab){}}},target:function(){return $(this.iframe)}})}else{z._listeners=z._listeners.concat({name:"focusout",handler:function(){var e=this;if(e.clicked&&e.history){e.history.save()}},target:function(){return $(this.doc)}},{name:"focus",handler:function(){var e=this;$(e.innerDv).addClass("APP-editor-active");if(e.springDv){e.springDv.style.opacity="0";window.setTimeout(function(){e.springDv.style.display="none";e.springDv=null},1200)}},target:function(){return $(this.win)}},{name:"blur",handler:function(){$(this.innerDv).removeClass("APP-editor-active")},target:function(){return $(this.win)}})}q.extend(z.prototype,{autoListen:false,initialize:R,getInitHtml:A,makeEditable:Z,saveRange:L,setEventListeners:T,destroy:B,cleanRange:j,setContent:S,getContent:v,getFinalContent:H,getPreviewContent:W,insertHtml:h,focus:t,setDefStyle:G,changeEditMode:E,getIframeEl:s,isTextMode:C,toogleToolbar:p,insert:k,del:K,getSelectedText:O,getSelectedHtml:P,execFormat:b,deleteLink:y,addListener:u,setSize:w,isEmpty:g,hidePopup:a,getWin:F,getTbHeight:V,getMask:d,showMask:Q,getBreakLine:m});function N(){z.num++;return z.num}function R(ae){try{var ac=this;z.ui=i;z.event=M;z.util=f;z.dtd=n;z.Plugin=x;z.Range=X;z.Selection=I;z.History=l;z.Format=c;z.Query=J;ac.IE=z.IE;z.superClass.initialize.call(ac);ac.editorDv=ac._getDom();ac.num=z.getNum();ac.settings={};if(ae.setDefault){try{x.setDefault.getDef(ac)}catch(ad){}}q.extend(ac.settings,z.config,true);var aa=ac.settings;if(typeof ae=="string"){ac.containerDv=$("#"+ae).dom}else{if(typeof ae=="object"){if(ae.nodeName){ac.containerDv=ae}else{q.extend(aa,ae);ac.containerDv=$("#"+ae.container).dom}}}z.ui.init(ac);z.event.init(ac);var ab=aa.content||"";if(Y.firefox()){ab+="&nbsp;"}var af=ac.getInitHtml({fontsize:aa.fontsize,fontname:aa.fontname,forecolor:aa.forecolor});ac.makeEditable(ac.doc,af);ac.body=ac.doc.body;new z.Plugin(ac);ac.format=new z.Format(ac);ac.query=new z.Query(ac);ac.setEventListeners();ac.setContent(z.IE?"<div>"+ab+"</div>":ab);return ac}catch(ad){ac.destroy();return false}}function A(e){var aa="<head><title>您已进入编辑器编辑区，按Esc可以退出当前焦点，按Shift+Tab可以返回上一个焦点</title><style>html{word-wrap:break-word;}body{color:"+e.forecolor+";font-size:"+e.fontsize+";font-family:"+e.fontname+';line-height:1.7;padding:8px 10px;margin:0;background-color:#ffffff;}pre{white-space: pre-wrap;white-space: -moz-pre-wrap;white-space: -pre-wrap;white-space: -o-pre-wrap;word-wrap: break-word;font-family:arial;}span.typoRed{border-bottom:2px dotted #ff0000;cursor:pointer;}.nui-scroll{overflow:auto}.nui-scroll::-webkit-scrollbar {width: 8px;height:8px}.nui-scroll::-webkit-scrollbar-track {border-radius:10px;-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0); }.nui-scroll::-webkit-scrollbar-track:hover {-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.4); background-color:rgba(0,0,0,0.01)}.nui-scroll::-webkit-scrollbar-track:active {-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.4); background-color:rgba(0,0,0,0.05)}.nui-scroll::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.05);border-radius:10px;-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}.nui-scroll:hover::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.2);border-radius:10px;-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}.nui-scroll::-webkit-scrollbar-thumb:hover {background-color:rgba(0, 0, 0, 0.4);-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}.nui-scroll::-webkit-scrollbar-thumb:active {background:rgba(0,0,0,0.6); }</style></head><body class="nui-scroll">'+(e.content||"")+"</body>";return aa}function Z(e,aa){e.open("text/html","replace");e.writeln(aa);e.close();if(z.IE){if(Y.ie()=="5.0"){e.designMode="on"}else{e.body.contentEditable=true}}else{e.designMode="on";e.execCommand("useCSS",false,true)}}function T(){var ab=this;var ad=z._listeners;for(var aa=0;aa<ad.length;aa++){var ag=ad[aa];var e=ag.target.call(ab);if(e){var ac=$.Function.bind(ag.handler,ab);ag.bind=ac;e.listen(ag.name,ac)}}var af=$.Component._queue;for(var aa=0;af&&aa<af.length;aa++){var ae=af[aa];if(ae==ab){af.splice(aa,1);break}}}function B(){var ac=this;var ad=z._listeners;for(var ab=0;ab<ad.length;ab++){var ae=ad[ab];var e=ae.target.call(ac);if(e){e.unlisten(ae.name,ae.bind)}}z.superClass.destroy.call(ac);for(var aa in ac){ac[aa]=null}ac=null}function L(){var e=this;e.range=z.util.getRange(e)}function j(){this.range=null}function S(aa,ac){var ab=this;if(ac){z.ui.changeEditMode(ab,ac)}var e=ac||ab.editMode;if(e=="text"||e=="source"){ab.textarea.value=aa}else{ab.body.innerHTML=aa}if(z.IE&&ab.range&&ab.range.collapse){ab.range.collapse(false)}}function v(af){var ac=this,ae;var ab=ac.editMode;if(ab=="text"||ab=="source"){ae=ac.textarea.value;if(af=="html"&&ab!="source"){ae=z.util.textToHtml(ae)}else{if(af=="text"){ae=$.String.trim(z.util.htmlToText(ae))}}}else{var aa=ac.body;if(af=="text"){var ad=aa.innerHTML;var e=ad.indexOf("<style>")>=0;if(e){aa.innerHTML=ad.replace(/<style>[^\/]+<\/style>/,"")}if(typeof aa.textContent=="string"){ae=$.String.trim(aa.textContent)}else{if(typeof aa.innerText=="string"){ae=$.String.trim(aa.innerText)}else{ae=""}}if(e){aa.innerHTML=ad}}else{ae=aa.innerHTML}}return ae}function H(ad){var ab=this,ac=ab.settings,e=ab.editMode=="text",aa;if(!e){aa=x.typo.ignoreAll(ab,true)}aa=aa||ab.getContent(ad);if(ad!="text"&&!e){aa="<div style='line-height:1.7;color:"+ac.forecolor+";font-size:"+ac.fontsize+";font-family:"+ac.fontname+"'>"+aa+"</div>"}return aa}function W(){var aa=this;var e=aa.getInitHtml({content:aa.getFinalContent()});return e}function h(aa){var e=this;if(z.IE){z.util.getRange(e).pasteHTML(aa)}else{z.util.execCmd(e,"inserthtml",aa)}}function t(ag){var ad=this;if(!ag){var e=ad.editMode;if(e=="text"||e=="source"){ad.textarea.focus()}else{ad.win.focus()}}else{var ae=ag.name||"win";if(ae=="win"){ad.win.focus()}else{if(ae=="doc"){ad.doc.focus()}else{if(ae=="body"){ad.doc.body.focus()}}}var aa=ag.element;if(ag.id){aa=ad.getNode(ag.id)}if(aa){var ac=ag.pos;if(isNaN(ac)){ac=0}var af;if(window.getSelection){var ab=ad.win.getSelection();if(!ab){return false}if(ab.rangeCount>0){ab.removeAllRanges()}af=ad.doc.createRange();af.selectNode(aa.firstChild||aa);af.collapse(true);ab.addRange(af)}else{af=(aa.createTextRange?aa:ad.doc.body).createTextRange();af.moveToElementText(aa);af.moveStart("character",ac);af.collapse(true);af.select()}}}}function G(e){var aa=this;if(e.fontsize){aa.settings.fontsize=e.fontsize;aa.body.style.fontSize=e.fontsize}if(e.fontname){aa.settings.fontname=e.fontname;aa.body.style.fontFamily=e.fontname}if(e.forecolor){aa.settings.forecolor=e.forecolor;aa.body.style.color=e.forecolor}}function E(e){z.ui.changeEditMode(this,e)}function s(aa){var e=this.doc;if(aa.indexOf("#")==0){return e.getElementById(aa.substring(1))}else{return e.getElementsByTagName(aa)}}function C(){return this.editMode=="text"?true:false}function p(){if(this.viewMode=="hide"){this.changeEditMode("show");return true}else{this.changeEditMode("hide");return false}}function k(ad){var aa=this;var ac=ad.html||ad.text;var e=ad.image;aa.focus({name:"body"});if(e){if(z.IE){var ab=aa.range;if(!ab){ab=z.util.getRange(aa)}ab.collapse(false);ab.select();aa.cleanRange()}ac='<img src="'+e+'"/>'}if(ac){aa.insertHtml(ac)}}function K(ag){var ac=ag.element;var e=ag.tag;var af=ag.reg;if(ac){ac.parentNode.removeChild(ac)}else{if(e&&af){var ae=this.doc.getElementsByTagName(ag.tag);for(var ab=0;ab<ae.length;ab++){var aa=ae[ab];var ad=aa.src;if(af.test(ad)){aa.parentNode.removeChild(aa);ab--}}}}}function O(){if(z.IE){return this.doc.selection.createRange().text}else{var e=this.win.getSelection().toString();if(e==""){var aa=this.getSelectedHtml();if(/<[^>]*>/.test(aa)){return undefined}}return e}}function P(){var e=z.util.getSelection(this);if(z.IE){return e.createRange().htmlText}else{var ab=document.createElement("span");var aa=e.getRangeAt(0).cloneContents();ab.appendChild(aa);return ab.innerHTML}}function b(ab,e){var aa=this;return aa.format.edit.apply(aa.format,arguments)}function y(){var e=this;var aa=e.getSelectedHtml();if(/<a[^>]+>.+<\/a>/i.test(aa)){z.util.execCmd(e,"unLink")}else{return false}return true}function u(e,aa){z.event.add(this,e,aa)}function w(e){z.ui.setSize(this,e)}function g(e){var aa=this.getContent();if(/img/i.test(aa)){return false}if(aa==e){return true}aa=$.String.trim(this.getContent("text"));return aa?false:true}function a(){z.ui.hidePopup(this)}function F(){return this.win}function V(){return this.toolbarDv.offsetHeight+1}function d(){return this.maskDv}function Q(ad){var ac=this;var aa=ac.editMode;var e=$(ac.maskDv);if(ad==false){e.hide()}else{if(aa!="text"&&aa!="source"){ac.saveRange();e.show();if(typeof ad=="number"){var ab=setTimeout(function(){e.hide();clearTimeout(ab)},ad)}}}}function m(ad){var aa="",ac="",ab="",e=Y.ie();if(e){aa="<div>";ab="</div>";if(e=="9.0"){ad--}}if(ad!=undefined&&ad>0){ac=new Array(ad+1).join((Y.opera()||Y.safari())?"<div><br></div>":"<br>")}return aa+ac+ab}})();(function(){var j=$.Component;var r=$.Object;var t=$.String;var f=$.createClass($N("component.emailinput.EmailInput"));r.mix(f,j,{_template:'<div id="#{id}" class="nui-editableAddr nui-editableAddr-edit nui-addr"><input type="text" class="nui-editableAddr-ipt" #{tabIndex} #{inputLable} /><span class="nui-editableAddr-txt">W</span></div>',_listeners:[{name:"keydown",handler:function(){this.keydownAction()},target:v},{name:"keyup",handler:function(){this.keyupAction()},target:v},{name:"focus",handler:function(){this.ownerCt.fire("containerfocus");this.ownerCt.getEl().addClass("nui-ipt-focus")},target:v},{name:"blur",handler:function(){this.ownerCt.addItem(this.get());this.input.dom.value="";this.widthSpan.dom.innerHTML="W";this.ownerCt.getEl().removeClass("nui-ipt-focus");this.ownerCt.fire("containerblur")},target:v},{name:"render",handler:function(){var w=this;w.input=v.call(w);w.widthSpan=w.getEl().find("SPAN")},custom:true}],xtype:"emailinput"},{index:-1,initialize:i,_getData:m,get:a,set:l,clear:d,focus:c,select:n,blur:p,keydownAction:g,keyupAction:e,paste:b,syncWidth:o,isMobile:u,move:k,autoComplete:s,setPos:h,getPos:q});function v(){var w=this.getEl();if(w){return w.find("INPUT")}return null}function i(w){f.superClass.initialize.call(this,w)}function m(x){var w={tabIndex:x.tabIndex>=0?("tabIndex='"+x.tabIndex+"'"):"",inputLable:x.inputLable?("aria-label='"+x.inputLable+"'"):"",id:x.id?x.id:"emailinput"};return w}function a(){return this.input.dom.value}function l(w){this.input.dom.value=w;this.syncWidth()}function d(){this.input.dom.value=""}function c(w){var x=this.input.dom;if(w){window.setTimeout(function(){try{x.focus()}catch(z){}},0)}else{try{x.focus()}catch(y){}}}function n(){var w=this.input.dom;w.select()}function p(){var w=this.input.dom;w.blur()}function g(){var z=this;var A=z.ownerCt;A.clearTips();var D=z.get();var C=z.getPos();var w=$.Event.get();var B=w.which;switch(B){case 8:if(C.start==0){var E=z.getEl();var y=E.pre();A.removeItem({el:y})}break;case 16:break;case 27:break;case 46:if(D.length==C.start){var E=z.getEl();var x=E.next();A.removeItem({el:x})}break;case 35:if(w.shiftKey){if(t.trim(D)==""){A.selectPos("inputRight")}}else{if(D.length>0){if(C.end==D.length){A.addItem(D);z.clear();z.move("last")}}else{if(t.trim(D)==""){z.move("last")}}}break;case 36:if(w.shiftKey){if(t.trim(D)==""){A.selectPos("inputLeft");$.Event.cancel()}}else{if(D.length>0){if(C.start==0){A.addItem(D);z.clear();z.move("first")}}else{if(D.length==0){z.move("first")}}}break;case 37:if(w.shiftKey){if(t.trim(D)==""){A.selectPos("shiftLeft")}}else{if(D.length>0){if(C.start==0){A.addItem(D,"after");z.clear()}}else{if(t.trim(D)==""){z.move("pre")}}}break;case 38:break;case 39:if(w.shiftKey){if(t.trim(D)==""){A.selectPos("shiftRight")}}else{if(D.length>0){if(C.end==D.length){A.addItem(D);z.clear()}}else{if(t.trim(D)==""){z.move("next")}}}break;case 40:break;case 65:if((w.ctrlKey||w.metaKey)&&t.trim(D)==""){A.selectAllItem();$.Event.cancelBubble()}else{z.syncWidth()}break;case 32:case 59:case 186:case 188:if(B==32||!w.shiftKey){if(D.indexOf("@")==-1){if(z.isMobile(D)){A.addItem(D);z.clear();$.Event.cancel()}}else{A.addItem(D);z.clear();$.Event.cancel()}}z.syncWidth();break;case 86:if(w.ctrlKey||w.metaKey){var D=z.get();if(!D){z.keydownPaste=true}}break;default:z.syncWidth();break}this.autoComplete()}function e(){var y=this;var x=y.ownerCt;var A=y.get();var w=$.Event.get();var z=w.which;switch(z){case 13:if(A.indexOf("@")==-1){if(y.isMobile(A)){y.ownerCt.addItem(A);y.clear()}}break;case 17:case 86:if(y.keydownPaste){y.paste()}y.syncWidth();break;case 9:case 35:case 36:case 37:case 38:case 39:case 40:break;case 59:case 186:case 188:break;default:y.syncWidth()}y.keydownPaste=false}function b(){var x=this;var y=t.trim(x.get());if(!y){return}var w=Uri.getEmails(y,null,true);if(w&&w.match&&w.match.length){y=y.replace(/[ ]+ ?(?![^"]+"\s*<)/g,",");x.ownerCt.addItem(y);x.input.dom.value=""}}function o(){var w=this;var x=w.get();x=x.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /ig,"&nbsp;");w.widthSpan.dom.innerHTML=x+"WW"}function u(x){if(!this.ownerCt.domain){return false}x=x||this.get();var w=/^1\d{10}$/gi;if(w.test(x)){return true}return false}function k(D,z,C){var B=this;var E=B.ownerCt;var A=E.getEl();var F=B.getEl();var w=F.dom;if(t.trim(B.get())){E.addItem(B.get());B.clear();B.widthSpan.dom.innerHTML="W"}switch(D){case"first":A.previous(w);break;case"last":A.append(w);break;case"pre":var y=F.pre();if(y&&y.dom){y.before(w)}break;case"next":var x=F.next();if(x&&x.dom){x.after(w)}break;case"itemPre":if(z){z.before(w)}break;case"itemNext":if(z){z.after(w)}break}if(C){B.focus(C)}else{B.select()}}function s(){try{var I=$L("support.AddressSupport",this);var E=$I("util.AutoComplete")}catch(B){return B}try{if(!I.dataInited){return}if(this.autoCompltedInited){return}this.autoCompltedInited=true;var y=I.data.extDataMap.groupArray||[];var C=[];for(var D=0,A=y.length;D<A;D++){var H=y[D];if(H.N&&H.CONTACTS&&H.CONTACTS.length){var x=C.length;H.index=x;C[x]=H}}}catch(B){return B}var F=this;var J=F.ownerCt;var z=F.input;new E({product:"emailinput",input:z,fill:G,match:w,groupData:C,groupFill:L,groupMatch:K});function G(M){J.addItem(M);F.clear()}function w(Q,P){if(Q==""){return}var N;try{var N=P.name;var M=P.email;var S=N.toLowerCase();var T=M.toLowerCase()}catch(R){return}Q=t.trim(Q).toLowerCase();var O=M;if(N){O='"'+N+'"<'+M+">"}if(Q==""){return O}else{if(Q.length==1){if(T.indexOf(Q)==0||S.indexOf(Q)==0){return O}}else{if(T.indexOf(Q)>-1||S.indexOf(Q)>-1||(P.py&&P.py.indexOf(Q)>-1)){return O}}}}function L(M){J.addItem(C[M].CONTACTS);F.clear()}function K(N,M){N=t.trim(N).toLowerCase();var O=M.N.toLowerCase();if(N==""){return null}if(O.indexOf(N)>-1){return true}}}function h(w){var y=this.input.dom;if(y.setSelectionRange){y.focus();y.setSelectionRange(w,w)}else{if(y.createTextRange){var x=y.createTextRange();x.collapse(true);x.moveEnd("character",w);x.moveStart("character",w);x.select()}}}function q(){var A=this.input.dom;var y=0;var z=0;var w=window.document;if(w.selection){var x=w.selection.createRange();x.setEndPoint("EndToStart",A.createTextRange());y=(x.text||"").length;x=w.selection.createRange();x.setEndPoint("StartToStart",A.createTextRange());z=(x.text||"").length}else{y=A.selectionStart;z=A.selectionEnd}return{start:y,end:z}}})();(function(){var i=$.Component;var d=$.Object;var c=$.createClass($N("component.emailinput.EmailHide"));d.mix(c,i,{_template:'<div class="nui-fGetout"><input tabindex="-1" role="presentation" type="text" /></div>',_listeners:[{name:"keydown",handler:function(){this.keydownAction()},target:b},{name:"keyup",handler:function(){this.keyupAction()},target:b},{name:"focus",handler:function(){},target:b},{name:"blur",handler:function(){},target:b},{name:"render",handler:function(){this.input=this.getEl().find("INPUT")},custom:true}],xtype:"emailhide"},{initialize:g,_getData:f,selectData:h,keydownAction:e,keyupAction:a});function b(){var j=this.getEl();if(j){return j.find("INPUT")}return null}function g(j){c.superClass.initialize.call(this,j)}function f(k){var j={};return j}function h(j){if($.String.trim(j)){this.input.dom.value=j;this.input.dom.select()}}function e(){var l=this;var k=l.ownerCt;var n=k.emailinput;var j=$.Event.get();var m=j.which;switch(m){case 8:case 46:if(k.lastSelectItem){n.move("itemNext",k.lastSelectItem.getEl())}k.delSelectItem();k.select();break;case 35:if(j.shiftKey){k.selectPos("inputRight")}else{k.resetSelectItem();n.move("last")}break;case 36:if(j.shiftKey){k.selectPos("inputLeft")}else{k.resetSelectItem();n.move("first")}break;case 37:case 38:if(j.shiftKey){k.selectPos("shiftLeft")}else{k.resetSelectItem();if(k.lastSelectItem){n.move("itemPre",k.lastSelectItem.getEl())}}break;case 39:case 40:if(j.shiftKey){k.selectPos("shiftRight")}else{k.resetSelectItem();if(k.lastSelectItem){n.move("itemNext",k.lastSelectItem.getEl())}}break;case 65:if(j.ctrlKey||j.metaKey){k.selectAllItem()}else{$.Event.cancel()}break;case 67:if(j.ctrlKey||j.metaKey){}else{$.Event.cancel()}break;case 86:if(j.ctrlKey||j.metaKey){$.Event.cancel()}else{$.Event.cancel()}break;case 88:if(j.ctrlKey||j.metaKey){k.delSelectItem()}else{$.Event.cancel()}break;default:$.Event.cancel();break}}function a(){var l=this;var k=l.ownerCt;var n=k.emailinput;var j=$.Event.get();var m=j.which;switch(m){case 88:k.focus();break;default:break}}})();(function(){var l=$.Component;var j=$.Object;var c=$.createClass($N("component.emailinput.EmailBlock"));j.mix(c,l,{_listeners:[{name:"keydown",handler:function(){}},{name:"mouseover",handler:function(){var o=this.getEl();var n=this.valid?"nui-addr-hover nui-editableAddr-hover":"nui-editableAddr-errHover";o.addClass(n)}},{name:"mouseout",handler:function(){var o=this.getEl();var n=this.valid?"nui-addr-hover nui-editableAddr-hover":"nui-editableAddr-errHover";o.removeClass(n)}},{name:"mousedown",handler:function(){var p=this;var o=$.Event.getTarget();if(o.tagName=="A"||o.parentNode.tagName=="A"){}else{var n=$.Event.get();if(n.ctrlKey||n.metaKey){if(p.selected){p.unselect(true)}else{p.select(true)}}else{if(p.selected){}else{p.ownerCt.resetSelectItem();p.select(true)}}}}},{name:"click",handler:function(){try{var r=$L("support.AddressSupport")}catch(q){return q}var p=this;var o=$.Event.getTarget();if(o.tagName=="A"||o.parentNode.tagName=="A"){if(p[EMAIL_ID]){r.contactDialog({type:"modify",addr:{id:p[EMAIL_ID]},callback:function(s){p.refreshAddr(s)}})}else{r.contactDialog({type:"add",addr:{name:p.name,email:p.address},callback:function(s){p.refreshAddr(s)}})}}else{var n=$.Event.get();if(n.ctrlKey||n.metaKey){p.ownerCt.selectData({allSelect:true})}else{if(n.which!=3){if(p.selected){p.ownerCt.resetSelectItem();p.select(true)}}p.ownerCt.selectData({value:p.getValue().toString()})}p.ownerCt.fire("containerfocus");this.ownerCt.drag._start=false}}},{name:"dblclick",handler:function(){this.ownerCt.drag._start=false;this.toEdit()}},{name:"render",handler:function(){var n=this;n.getEl().set("key",this.address)},custom:true}],xtype:"emailblock"},{name:null,address:null,key:null,index:-1,selected:false,valid:true,initialize:k,html:d,getValue:g,select:b,unselect:e,getsub:a,setWarn:i,fixWarn:f,refreshAddr:m,toEdit:h});function k(n){var o=this;o.uri=n.uri;o.name=n.uri.name;o.address=n.uri.address;o.key=o.address.toLowerCase();o.valid=n.valid;c.superClass.initialize.call(o,n)}function d(){try{var t=$L("support.AddressSupport")}catch(s){return s}var r=this;var p=r.getsub(r.name);var y=r.getsub(r.address);var n=r.name?('<strong class="nui-addr-name" unselectable="on">'+p+"</strong>"):"";var w=r.name?("&lt;"+y+"&gt;"):y;var u=r.valid?r.address:"该地址格式有误，请双击修改";u=$.String.escapeHTML(u);var o="nui-editableAddr nui-addr nui-addr-hasAdd";var x="";if(r.valid){var q=t.getAddrObj(r.address);if(q){r[EMAIL_ID]=q[EMAIL_ID];x='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus"><b class="nui-ico nui-ico-edit"></b></a>'}else{x='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus">+</a>'}}else{o="nui-editableAddr nui-addr nui-editableAddr-err"}var v='<div class="'+o+'" title="'+u+'"  unselectable="on">'+n+'<em class="nui-addr-email" unselectable="on">'+w+"</em>"+x+"</div>";return v}function g(){return this.uri}function b(o){var q=this;var n=q.ownerCt;var p=q.getEl();if(o){n.selectItem(q);return}p.addClass("nui-addr-active");p.addClass("nui-editableAddr-active");q.selected=true;n.lastSelectItem=q}function e(o){var q=this;var n=q.ownerCt;var p=q.getEl();if(o){n.unselectItem(q);return}p.removeClass("nui-addr-active");p.removeClass("nui-editableAddr-active");this.selected=false}function a(s){var q=30;var o=26;if(!s){return""}if(s.length<=q){return $.String.escapeHTML(s)}if(s.indexOf("@")!=-1){var p=s.split("@");var r=p[0];var n=p[1];if(r.length>q){r=r.substr(0,o)+".."}if(n.length>50){n=n.substr(0,46)+".."}return $.String.escapeHTML(r+"@"+n)}else{return $.String.escapeHTML(s.substr(0,o)+"..")}}function i(p){var s=this;s.warn=true;var r=this.getEl();if(p==1){var q=s.address.split("@");var t=q[0]+'<span class="nui-txt-err">@'+q[1]+"</span>";if(s.name){t="&lt;"+t+"&gt;"}var o=r.dom;var n=o.getElementsByTagName("EM")[0];n.innerHTML=t;r.setAttr({title:"该地址的域名可能不存在，请双击修改"})}else{if(p==0){r.addClass("nui-editableAddr-err");r.setAttr({title:"您输入的地址可能有误，请双击修改"})}}}function f(n){var r=this;var o=this.getEl();var t=r.ownerCt;t.itemMap[r.key]=null;r.warn=false;r.address=n.address||r.address;oUri=new Email(r.address,r.name);oUri.valid=true;r.uri=oUri;r.key=r.address.toLowerCase();var v=r.getsub(r.address);var s=r.name?("&lt;"+v+"&gt;"):v;var u=$.String.escapeHTML(r.address);var q=o.dom;var p=q.getElementsByTagName("EM")[0];p.innerHTML=s;o.setAttr({title:u});o.removeClass("nui-editableAddr-err")}function m(t){var s=this;var n=s.getEl();s.name=t.name;s.address=t.address;var o=new Email(s.address,s.name);o.valid=true;s.uri=o;var r=n.dom;var p=r.getElementsByTagName("STRONG")[0];if(p){p.innerHTML=s.getsub(s.name)}else{p=document.createElement("STRONG");p.className="nui-addr-name";p.unselectable="on";p.innerHTML=s.getsub(s.name);var q=r.getElementsByTagName("EM")[0];$(q).before(p)}if(!s[EMAIL_ID]){s[EMAIL_ID]=t.id;var u=r.getElementsByTagName("A")[0];u.innerHTML='<b class="nui-ico nui-ico-edit"></b>'}var v="<"+s.getsub(s.address)+">";var q=r.getElementsByTagName("EM")[0];q.innerHTML=s.getsub(v)}function h(){var o=this;var n=o.ownerCt;n.emailinput.move("itemNext",o.getEl());n.emailinput.set(o.uri);n.removeItem({item:o});var p=0;if(o.name){p=o.name.length+3}else{p=o.address.length}n.emailinput.setPos(p)}})();(function(){var c=$.Component;var b=$.Object;var a=$.createClass($N("component.emailinput.EmailTips"));b.mix(a,c,{_template:'<label class="nui-ipt-placeholder">#{text}</label>',_listeners:[],xtype:"emailtips"},{_getData:e});function d(f){a.superClass.initialize.call(that,f)}function e(g){var h=this;var f={text:g.text};return f}})();(function(){var m=$.Component;var ab=$I("util.Uri");var X=$I("util.DragDrop");try{var s=$L("component.emailinput.EmailBlock");var t=$L("component.emailinput.EmailTips");var e=$L("component.emailinput.EmailInput");var C=$L("component.emailinput.EmailHide")}catch(ad){return ad}var k=$.Object;var U=$.String;var q=$.createClass($N("component.emailinput.EmailContainer"));k.mix(q,m,{_template:'<div class="nui-multiLineIpt nui-ipt#{cls_type}" #{title} unselectable="on">#{input}</div>',_events:["containerfocus","containerblur","containerresize","containerupdate","itemwarnremove"],_listeners:[{name:"init",handler:function(){}},{name:"mousedown",handler:function(){var af=this;var ae=$.Event.getTarget();var ag=af.findItemByDom(ae);if(ag){switch(ag.xtype){case"emailblock":break;case"emailinput":af.resetSelectItem();af.clearTips();af.fire("containerfocus");af.initSelect();break;case"emailcontainer":af.locate();af.resetSelectItem();af.clearTips();af.fire("containerfocus");af.initSelect();break;case"emailhide":af.clearTips();af.locate();af.fire("containerfocus");break;case"emailtips":af.clearTips();af.locate();af.fire("containerfocus");break;default:af.clearTips();af.locate();af.fire("containerfocus");break}}else{af.clearTips();af.locate();af.fire("containerfocus")}}},{name:"click",handler:function(){try{var ae=$.Browser.getInfo().os;if(ae=="ipad"||ae=="iphone"||ae=="ipod"||ae=="android"){this.emailinput.focus();$.Event.stop()}}catch(af){}}},{name:"mouseover",handler:function(){var ae=this.getEl();ae.addClass("nui-ipt-hover")}},{name:"contextmenu",handler:function(){this.contextMenu()}},{name:"keydown",handler:function(){}},{name:"mouseout",handler:function(){var ae=this.getEl();ae.removeClass("nui-ipt-hover")}},{name:"render",handler:function(){var ae=this;ae.emailinput=ae.find("emailinput")[0];var ag={xtype:"emailhide"};var af=ae.add(ag,true);af.render(ae.getEl().dom,"before");ae.emailhide=ae.find("emailhide")[0];ae.dragItem=new m({renderTo:window.document.body,hidden:true,html:'<div class="nui-addr nui-editableAddr nui-editableAddr-hover nui-editableAddr-draging" style="left:0px;top:0px;"></div>'});this.drag=new X({drag:ae.dragItem.getEl().dom,trigger:ae.getEl().dom,triggerOffset:5,noListenerSelect:true,listeners:[{name:"mousedown",handler:$.Function.bind(ae._dragInit,ae)},{name:"start",handler:$.Function.bind(ae._dragStart,ae)},{name:"drag",handler:$.Function.bind(ae._dragMove,ae)},{name:"drop",handler:$.Function.bind(ae._dragDrop,ae)}]});ae.drag._start=false},custom:true},{name:"fullrender",handler:function(){var af=this;var ae=af.find("emailtips");if(ae){af.tipsItemList=af.tipsItemList.concat(ae)}},custom:true}],xtype:"emailcontainer",getEmails:H,matchEmails:v,getEmail:V},{itemList:null,itemMap:null,selectItemList:null,selectItemMap:null,tipsItemList:null,height:0,shiftIndex:0,selectStartX:0,selectStartY:0,_getData:T,initialize:d,get:K,addItem:c,clearItem:O,setItem:o,delItem:A,choose:y,leave:M,select:B,focus:r,blur:a,build:p,exit:Z,getInputValue:E,buildIndex:Q,findItem:z,findItemByDom:R,findItemsByPos:i,selectData:W,selectAllItem:ac,resetSelectItem:j,selectItem:x,selectPos:J,unselectItem:w,delSelectItem:f,removeItem:h,addTips:l,clearTips:Y,_dragInit:b,_dragStart:L,_dragMove:G,_dragDrop:N,contextMenu:P,menuCut:u,menuCopy:S,menuPaste:g,checkHeight:I,initSelect:D,mouseSelect:n,locate:F,getPosition:aa});function H(ag){var ae=[];if(k.isArray(ag)){for(var af=0;af<ag.length;af++){var ah=q.getEmail(ag[af]);if(ah){ae.push(ah)}}}else{if(typeof ag=="object"){ae.push(q.getEmail(ag))}else{ae=ae.concat(q.matchEmails(ag))}}return ae}function v(ag,ae){ag=U.trim(ag).replace(/[，；;]+/g,",");var ah=[];var af=ab.getEmails(ag,"Email");if(af.match.length>0){$.Array.each(af.match,function(ai,aj){aj.valid=true;ah.push(aj)})}if(!ae){if(af.wrong.length>0){$.Array.each(af.wrong,function(ai,aj){var ak=new Email(aj);ak.valid=false;ah.push(ak)})}}return ah}function V(ae){var af=null;if(typeof ae=="string"&&U.trim(ae)){af=new ab(ae,ab.type.EMAIL);if(af.type==ab.type.EMAIL){af.valid=true}else{af=new Email(ae);af.valid=false}}else{if(typeof ae=="object"){if(ae.type==ab.type.EMAIL){af=ae;af.valid=true}else{if(ae[EMAIL_ADDRESS]){af=new Email(ae[EMAIL_ADDRESS],ae.FN);af.valid=true}}}}return af}function d(af){var ae=this;ae.domain=af.domain;ae.itemList=[];ae.itemMap={};ae.selectItemList=[];ae.selectItemMap={};ae.tipsItemList=[];q.superClass.initialize.call(ae,af);if(af.containerfocus){ae.listen("containerfocus",af.containerfocus)}if(af.containerblur){ae.listen("containerblur",af.containerblur)}if(af.containerresize){ae.listen("containerresize",af.containerresize)}if(af.containerupdate){ae.listen("containerupdate",af.containerupdate)}if(af.itemwarnremove){ae.listen("itemwarnremove",af.itemwarnremove)}}function T(ag){var ae={cls_type:"",defaultValue:ag.defaultValue?ag.defaultValue:"",title:ag.title?'title="'+ag.title+'"':""};if(ag.tips&&(!ag.tips.pos||ag.tips.pos=="left")){ag.items=[{xtype:"emailtips",type:"tips",text:ag.tips.text}]}var af=({xtype:"emailinput",tabIndex:ag.tabIndex,inputLable:ag.inputLable});ae.input=this._getChildHtml(af);return ae}function K(ae){var ao=this;var ar=ao.itemList;var aq=[];var ag=[];var an=[];var al=null;if(ae=="object"){ao.build(true)}if(ae!="empty"&&ae!="suc"){var ai=ar.length;for(var ak=0;ak<ai;ak++){var ap=ao.itemList[ak];var ah=ap.getValue();if(ap.valid){aq.push(ah)}else{ag.push(ah)}an.push(ah)}}if(ae=="suc"){var aj=ao.getEl();if(aj){var at=aj.find("DIV");var af=at.doms;for(var ak=0,ai=af.length;ak<ai;ak++){var am=af[ak];var ap=$(am).get("_item");if(ap.xtype=="emailblock"&&ap.valid){var ah=ap.getValue();aq.push(ah)}}}}switch(ae){case"object":al={suc:aq,fail:ag};break;case"array":al=an;break;case"suc":al=aq;break;case"fail":al=ag;break;case"empty":al=ar.length>0?false:true;break;case"dom":al=this.getEl.dom;break}return al}function l(ag){var af=this;var ae=ag.pos||"left";if(ae=="left"){var ai={xtype:"emailtips",text:ag.text};var ah=af.add(ai);af.tipsItemList.push(ah)}}function c(ag,ar,av){var ap=this;if(typeof ag=="string"){if(U.trim(ag)==""){return}else{if(ap.domain&&ap.emailinput.isMobile(ag)){ag+=("@"+ap.domain)}}}ap.clearTips();var ah=ap.emailinput.getEl();var af=q.getEmails(ag);ar=ar||"before";var al=false;for(var ak=0;ak<af.length;ak++){var an=af[ak];an.name=U.trim(an.name||"");var au=an.address.toLowerCase();if(av&&!an.valid){continue}if(ap.itemMap[au]){var aq=ap.findItem(au);aq.render(ah.dom,ar)}else{var ai={xtype:"emailblock",uri:an,valid:an.valid};var aq=ap._addChild(ai);var at=aq.html();var ao=aq.rawConfig;var ae=(ao.doc||aq.constructor._doc).createElement("DIV");ae.innerHTML=at;var am=ae.firstChild;var aj=$(am);aq.el=aj;aq.setEventListeners();aq.render(ah.dom,ar);ap.itemList.push(aq);ap.itemMap[au]=aq;al=true}}ap.checkHeight();if(al){ap.fire("containerupdate")}}function O(){var ae=this;$.Array.each(ae.itemList,function(af,ag){ag.destroy()});ae.itemList=[];ae.itemMap={};ae.checkHeight()}function o(ae){this.clearItem();this.addItem(ae)}function A(ai){var ah=this;var ae=q.getEmails(ai);for(var af=0;af<ae.length;af++){var ag=ae[af].address.toLowerCase();ah.removeItem({address:ag})}}function y(){}function M(){}function E(){return this.emailinput.get()}function B(){this.emailinput.select()}function r(){this.emailinput.focus()}function a(){this.emailinput.blur()}function p(ag){var ae=this;var af=U.trim(ae.getInputValue());if(af){ae.addItem(af,null,ag);ae.emailinput.set("")}}function Z(){var ae=this;ae.clearTips();$.Array.each(ae.itemList,function(ag,ah){ah.destroy()});if(ae.tipsItemList&&ae.tipsItemList.length){$.Array.each(ae.tipsItemList,function(ag,ah){ah.destroy()})}if(ae.menu){ae.menu.destroy()}if(ae.dragItem){ae.dragItem.destroy()}delete ae.itemList;delete ae.selectItemList;delete ae.tipsItemList;delete ae.menu;for(var af in ae.itemMap){delete ae.itemMap[af]}for(var af in ae.selectItemMap){delete ae.selectItemMap[af]}}function Q(){var aj=this;var ah=aj.getEl();var ak=ah.find("DIV");var ae=ak.doms;for(var ai=0,af=ae.length;ai<af;ai++){var ag=ae[ai];$(ag).get("_item").index=ai}}function z(af){var ae=this;af=af.toLowerCase();var ag=null;$.Array.each(ae.itemList,function(ah,ai){if(ai.key==af){ag=ai;throw $.BREAK}});return ag}function i(af){var ah=this;ah.buildIndex();var ae=[];var ag=ah.emailinput.index;switch(af){case"shiftLeft":ah.shiftIndex--;if(ah.shiftIndex+ag<0){ah.shiftIndex=-ag}return ah.findItemsByPos("shift");break;case"shiftRight":ah.shiftIndex++;if(ah.shiftIndex+ag>ah.itemList.length){ah.shiftIndex=ah.itemList.length-ag}return ah.findItemsByPos("shift");break;case"shift":$.Array.each(ah.itemList,function(ai,aj){if((aj.index<ag&&aj.index>=ag+ah.shiftIndex)||(aj.index>ag&&aj.index<=ag+ah.shiftIndex)){ae.push(aj)}});ah.resetSelectItem(true);break;case"inputLeft":$.Array.each(ah.itemList,function(ai,aj){if(aj.index<ag){ae.push(aj)}});ah.resetSelectItem();break;case"inputRight":$.Array.each(ah.itemList,function(ai,aj){if(aj.index>ag){ae.push(aj)}});ah.resetSelectItem();break}return ae}function R(ae,ag){while(ae.tagName!="DIV"){ae=ae.parentNode}if(ae){var af=$(ae).get("_item");if(af){if(ag){if(af.xtype==ag){return af}else{return null}}else{return af}}}return null}function ac(){var ae=this;var af="";$.Array.each(ae.itemList,function(ag,ah){ae.selectItemList.push(ah);ae.selectItemMap[ah.key]=true;ah.select();af+=ah.getValue()+";"});ae.selectData({value:af})}function W(ae){var af=this;var ag="";if(ae.value){ag=ae.value}if(ae.allSelect){$.Array.each(af.selectItemList,function(ah,ai){ag+=ai.getValue()+";"})}af.emailhide.selectData(ag)}function j(ae){var af=this;$.Array.each(af.selectItemList,function(ag,ah){ah.unselect()});af.selectItemList=[];af.selectItemMap={};if(!ae){af.shiftIndex=0}}function x(ah){var af=this;var ag=ah.key;var ae=af.selectItemMap;if(!ae[ag]){ae[ag]=ah;af.selectItemList.push(ah);ah.select()}}function J(ag){var ai=this;var ak="";var af=ai.findItemsByPos(ag);for(var ah=0,ae=af.length;ah<ae;ah++){var aj=af[ah];ai.selectItem(aj);ak+=aj.getValue()+";"}ai.selectData({value:ak})}function w(ah){var af=this;var ag=ah.key;var ae=af.selectItemMap;if(ae[ag]){ae[ag]=null;$.Array.remove(af.selectItemList,ah);ah.unselect()}}function f(){var ae=this;$.Array.each(ae.selectItemList,function(af,ag){$.Array.remove(ae.itemList,ag);ae.itemMap[ag.key]=null;ag.destroy();if(ag.warn){ae.fire("itemwarnremove",ag.key)}});ae.selectItemList=[];ae.selectItemMap={};ae.checkHeight()}function h(ae){var af=this;var ag=null;if(ae.el&&ae.el.dom){ag=ae.el.get("_item")}else{if(ae.address){ag=af.findItem(ae.address)}else{if(ae.item){ag=ae.item}}}if(ag){var af=this;$.Array.remove(af.itemList,ag);af.itemMap[ag.key]=null;$.Array.remove(af.selectItemList,ag);af.selectItemMap[ag.key]=null;ag.destroy();if(ag.warn){af.fire("itemwarnremove",ag.key)}af.checkHeight()}}function Y(){var ae=this;if(ae.tipsItemList&&ae.tipsItemList.length){$.Array.each(ae.tipsItemList,function(af,ag){ag.destroy()});ae.tipsItemList=[]}}function b(){var ag=this;var ae=$.Event.get();if(ae.which==3){return}var af=$.Event.getTarget();var ak=ag.findItemByDom(af);if(!ak||ak.xtype!="emailblock"){return}var ae=$.Event.get();var al=ag.dragItem;var aj;var ah=ag.selectItemList.length;if(ah>1){aj='<div class="nui-addr nui-editableAddr"><em class="nui-addr-email">您选择了'+ah+"个地址</em></div>"}else{aj=ak.getEl().dom.innerHTML}al.getEl().html(aj);var ai=al.getEl().dom;ai.style.left=ae.pageX+2+"px";ai.style.top=ae.pageY+2+"px";ag.drag._start=true}function L(){this.dragItem.show()}function G(){var af=this;var ae=$.Event.getTarget();var ag=af.findItemByDom(ae);if(ag&&(ag.xtype=="emailcontainer"||ag.owenCt.xtype=="emailcontainer")){if(ag.xtype!="emailcontainer"){ag=ag.owenCt}if(ag!=af){ag.locate();ag.fire("containerfocus");af.destItem=ag}else{af.locate();af.destItem=af}}else{af.locate();af.destItem=af}}function N(){var af=this;if(af.drag._start==false){return}else{af.drag._start=false}af.dragItem.hide();var ae=[];$.Array.each(af.selectItemList,function(ag,ah){if(ah.valid){ae.push(ah.getValue())}else{ae.push(ah.getValue().toString())}});af.delSelectItem();af.destItem.addItem(ae)}function I(){var af=this;var ae=this.getEl().dom.scrollHeight;if(af.height!=ae){af.height=ae;this.fire("containerresize")}}function D(){var af=this;if(U.trim(af.getInputValue())!=""){return}var ae=$.Event.get();af.selectStartX=ae.pageX;af.selectStartY=ae.pageY;af.buildIndex();af.mousemove=$.Function.bind(af.mouseSelect,af);$.Event.listen(document,"mousemove",af.mousemove);$.Event.listen(document,"mouseup",function(){if(af.mousemove){$.Event.unlisten(document,"mousemove",af.mousemove);af.mousemove=null}})}function n(aH){var ao=this;var ah=ao.getEl();if(!ah||!ah.dom){return}var am=$.Event.get();var ay=am.pageX;var ax=am.pageY;var an=ay-ao.selectStartX;var ak=ax-ao.selectStartY;if(Math.abs(ak)>10||Math.abs(an)>10){ao.isSelect=true;var ag=ah.dom;var ap=ag.childNodes;var aA=ao.getPosition();var aK=aA[0];var au=aA[1];var aI=aA[2];var av=aA[3];var aE=ap[0];if(ay<av+aE.offsetLeft){ay=av+aE.offsetLeft+1}if(ay>au){ay=au-1}if(ax<=aK+aE.offsetTop){ax=aK+aE.offsetTop+1}if(ax>aI-4){ax=aI-4}var aq=null;var al=null;for(var aD=0,az=ap.length;aD<az;aD++){var ai=ap[aD];var aC=aK+ai.offsetTop;var at=ay<=av+ai.offsetLeft+2;var ar=ax<=aC+ai.offsetHeight;var aG=ax<=aC;var aj=ax>aC&&ax<=aC+ai.offsetHeight;var aF=ay>av+ai.offsetLeft&&ay<av+ai.offsetLeft+ai.offsetWidth+2;if(aj&&aF){if(ao.findItemByDom(ai,"emailblock")){aq=ai;break}else{ao.resetSelectItem();return}}else{if(!at&&aG){if(ai.previousSibling){aq=ai.previousSibling;break}}else{if(aj){al=ai}}}}if(!aq){if(al&&ao.findItemByDom(al,"emailblock")){aq=al}}if(!aq){ao.resetSelectItem();return}try{var aB=ao.emailinput.index;var ae=ao.findItemByDom(aq,"emailblock").index}catch(aH){return}var aJ=[];var af="";ao.resetSelectItem();if(aB>ae){$.Array.each(ao.itemList,function(aL,aM){if(aM.index>=ae&&aM.index<aB){aJ.push(aM)}})}else{$.Array.each(ao.itemList,function(aL,aM){if(aM.index<=ae&&aM.index>aB){aJ.push(aM)}})}for(var aD=0,az=aJ.length;aD<az;aD++){var aw=aJ[aD];ao.selectItem(aw);af+=aw.getValue()+";"}ao.selectData({value:af})}}function F(){var ai=this;var af=ai.getEl();if(!af||!af.dom){return}var ae=af.dom;var aj=ae.childNodes;var ar=ai.getPosition();var an=ar[3];var ay=ar[0];var ak=0;try{ak=document.getElementById("divComposeScroll").scrollTop||0}catch(ax){}var ah=$.Event.get();var ap=ah.pageX;var ao=ah.pageY+ak;var av=false;for(var au=0,aq=aj.length;au<aq;au++){var ag=aj[au];var at=ay+ag.offsetTop;var am=ap<=an+ag.offsetLeft+2;var al=ao<=at+ag.offsetHeight;var aw=ao<=at;if((am&&al)||(!am&&aw)){av=true;ai.emailinput.move("itemPre",$(ag),true);break}}if(!av){ai.emailinput.move("last",null,true)}}function aa(){var ag=this.getEl().dom;var af=[0,ag?ag.offsetWidth:0,ag?ag.offsetHeight:0,0];for(var ae=ag;ae;ae=ae.offsetParent){af[3]+=ae.offsetLeft;af[0]+=ae.offsetTop-(document.all?(ae.offsetParent?ae.scrollTop:0):0)}af[1]+=af[3];af[2]+=af[0];return af}function P(){var aj=this;var ag="nui-menu-item-disabled";var an;if(aj.menu){an=aj.menu.find("menuitem")}else{var ai={xtype:"menu",width:110,hidden:true,groups:[{items:[{text:"剪切    Ctrl+X",click:function(){aj.menuCut()}},{text:"复制    Ctrl+C",click:function(){aj.menuCopy()}},{text:"粘贴    Ctrl+V",click:function(){aj.menuPaste()}},{text:"删除    Delete",click:function(){aj.delSelectItem()}},{type:"split"},{text:"全选    Ctrl+A",click:function(){aj.selectAllItem()}}]}]};aj.menu=new $.Menu(ai);aj.menu.render(document.body);an=aj.menu.find("menuitem");if(!$.Browser.isIE()){an[0].getEl().addClass(ag);an[1].getEl().addClass(ag)}}var ae=$.Event.getTarget();var al=aj.findItemByDom(ae);if(al){switch(al.xtype){case"emailinput":return;break;case"emailblock":if($.Browser.isIE()){an[0].getEl().setClass("nui-menu-item");an[1].getEl().setClass("nui-menu-item")}an[3].getEl().setClass("nui-menu-item");$.Event.cancel();break;case"emailcontainer":if($.Browser.isIE()){an[0].getEl().addClass(ag);an[1].getEl().addClass(ag)}an[3].getEl().addClass(ag);$.Event.cancel();break}}var af=$.Event.get();var ak=af.pageX+"px";var am=af.pageY+"px";var ah=aj.menu.getEl();ah.setStyle({top:am,left:ak});aj.menu.show()}function u(){if(this.menuCopy()){this.delSelectItem()}}function S(){var af="";$.Array.each(this.selectItemList,function(ag,ah){af+=ah.getValue()+";"});try{if(window.clipboardData){window.clipboardData.clearData();window.clipboardData.setData("Text",af);return true}}catch(ae){}}function g(){var af=this;if($.Browser.isIE()){try{var ae=window.clipboardData.getData("Text");if(ae){af.emailinput.set(ae);af.emailinput.paste()}return}catch(ag){}}var ae=window.prompt("因为您的浏览器安全设置原因，不能直接访问剪贴板内容，需要重新粘贴一次。\n\n请使用键盘快捷键(Ctrl+V)把内容粘贴到下面的方框里，再按 确定。");af.emailinput.set(ae);af.emailinput.paste()}})();(function(){var b=$.createClass($N("support.Ad"));$.Object.extend(b,{request:a});function a(c,g){if(c.indexOf("action=el")>-1){if(window.fIphoneAd){var h=fIphoneAd();if(h){g(h);return}}}if(window.fCorpAd){var h=fCorpAd();if(h){g(h);return}}if(window.fQuanAd){fQuanAd(g);return}var f=14;var e=$S("is163")?6:5;var d=Uri.getUrl("youdao_ad")+"&yauid="+$S("uid")+"&posid="+f+"&syndid="+e+"&siteid=1"+c+"&rnd="+(new Date()).valueOf();$.Ajax.jsonp(d,g)}})();(function(){var f=window.$,g=netease.mail.base,o,e;o=$I("core.ContactDataAction");e=g.createClass($N("support.AddressSupportAction"));g.Object.mix(e,o,null,{_support:null,initialize:c,_response:m,getVersion:r,getData:j,addContact:b,removeContact:i,updateContact:k,updateGroup:q,removeGroup:a,getRecentContact:l,splitName:n,splitAddr:d,contactClone:h,batchDeal:p});function c(t){var s=this;e.superClass.initialize.call(s);s._support=t}function m(u,t,x){var v=this,s=u.data,w;if(s){w=s.order;if(w){v._support.orderParam=w}}v._support.resetData(t.rev===null?0:t.rev,t.contacts,t.groups,t.attachinfos,x);if(u.call){u.call({requestParam:u,responseData:t,returns:x})}}function r(s){this._request({command:"getVer",call:s.call})}function j(s){var u=this,s=s||{},v=s.data||{},t;v.order=v.order||u._support.orderParam||[{field:"N",desc:"false"}];t={vcardver:"3.0",ctype:"all",attachinfos:"yellowpage"};if($S("isVip")){t.limitinfo="get"}u._request({command:"getCon",call:s.call,data:v,ext:t,error:s.error,extData:s.extData})}function b(s){var u=s.extData;var t={vcardver:"3.0"};if(s.returnType){t.cType=s.returnType}this._request({command:"addCon",requireNewData:true,data:s.data,call:s.call,error:s.error,ext:t,extData:s.extData})}function i(s){var u=s.extData;var t={vcardver:"3.0"};if(s.returnType){t.cType=s.returnType}this._request({command:"removeCon",requireNewData:true,data:s.data,call:s.call,ext:t,error:s.error,extData:s.extData})}function k(s){var u=s.extData;var t={vcardver:"3.0"};if(s.returnType){t.cType=s.returnType}this._request({command:"updateCon",requireNewData:true,data:s.data,ext:t,call:s.call,error:s.error,extData:s.extData})}function q(s){var u=s.extData;var t={vcardver:"3.0"};if(s.returnType){t.cType=s.returnType}this._request({command:"updateGrp",requireNewData:true,data:s.data,ext:t,call:s.call,error:s.error,extData:s.extData})}function a(s){var u=s.extData||{};var t={vcardver:"3.0",recurse:s.deleteContact||false};if(s.returnType){t.cType=s.returnType}this._request({command:"removeGrp",requireNewData:true,data:s.data,call:s.call,ext:t,error:s.error,extData:u})}function l(s){var t=this;t._request({url:t._recentContactURL,command:"getRecent",call:s.call,ext:{limit:s.limit||20},error:s.error})}function n(s){var t=this,v=t._support.data.cache.nameCache,u=s.name;if(v[u]!==undefined||!u){return}v[u]==null;t._request({url:t._smartSplitURL,command:"splitName",call:function(x){var w=x.responseData;if(w){v[u]=w;if(s.call){s.call()}}},data:{name:u},error:s.error})}function d(u){var v=this,s=v._support.data.cache.addrCache,t=u.addr;if(s[t]!==undefined||!t){return}s[t]==null;v._request({url:v._smartSplitURL,command:"splitAddr",call:function(x){var w=x.responseData;if(w){s[t]=w;if(u.call){u.call()}}},data:{address:t},error:u.error})}function h(u){var s=this._support,t=Uri.getUrl("address_clone_ssl");t+="&cookiestr="+window.encodeURIComponent("Coremail="+f.Cookie.get("Coremail",true));t+="&inmode="+u.inmode;t+="&exportuser="+u.username.replace(/%/g,"%25").replace(/&/g,"%26");if(u.password){t+="&password="+u.password.replace(/%/g,"%25").replace(/&/g,"%26")}if(u.verifyCode){t+="&validcode="+u.verifyCode}t+="&group="+u.group;t+="&rnd="+(new Date()).getTime();f.Ajax.request({requestType:f.Ajax.SCRIPT,url:t,paddingFunc:f.Function.bind(s.cloneResponse,s,u),paddingParam:"callback"})}function p(s){var u=s.extData;var t={vcardver:"3.0"};if(s.returnType){t.cType=s.returnType}this._request({command:"batchDeal",requireNewData:true,data:s.data,call:s.call,error:s.error,ext:t,extData:s.extData})}})();(function(){var L=window.$,aa=window.Uri,E=netease.mail.base,Z,W,D;try{Z=$L("support.AddressSupportAction")}catch(ae){return ae}D=$I("util.PyDict");W=E.createClass($N("support.AddressSupport"));E.Object.extend(W,{__action:null,__cloneList:window.ADDR_CLONE_LIST,__localKey:window.ADDR_LOCAL_KEY,__localVer:"5.0.1",__initCalls:[],data:{ver:null,rawDataArray:{contact:[],group:[],attach:[]},extDataMap:{contact:{},contactLite:{},contactLiteArray:[],email:{},group:{},groupArray:[],yellowPage:{}},cache:{nameCache:{},addrCache:{}},delayedContact:{}},dataInited:false,__initData:U,__formatData:P,__formatGroupData:ac,__formatYellowPageData:i,__formatContactData:ad,__getReg:z,__addInitCall:d,checkLocalState:w,getLocalData:K,setLocalData:h,readLocalData:f,updateLocalData:x,clearLocalData:c,getDataVersion:l,resetLocalStorage:b,init:Y,resetData:G,addGroup:J,addContact:O,updateContact:Q,deleteContact:m,deleteContactAttr:X,addExtContact:t,registerContact:j,showError:M,parseName:af,parseN:T,parseADR:p,getName:R,getGivenName:ab,setGivenName:A,getContactEmails:u,getAddrObj:B,getGroupId:r,mappingEmails:C,toAddrString:o,search:N,searchContacts:F,getGroupLength:V,getRecentContact:v,clonePermitCheck:S,contactClone:q,cloneResponse:H,getCloneInfo:k,contactDialog:a,contactListDialog:n,contactSelector:I,dataCall:s,fixedGroupingCid:g});function U(){var ag=this;var e=true;if(Ext.localStorage){if(this.readLocalData()){ag.__formatData();e=false}}else{ag.clearLocalData()}if(e){if($S("isVip")){ag.__action.getData({error:function(ah){},call:function(ah){ag.data.rawDataArray.limitinfo=ah.responseData.limitinfo||{}}})}else{ag.__action.getData({error:function(ah){}})}}}function P(){var ai=this,ah=ai.__initCalls;ai.__formatGroupData();ai.__formatContactData();if(!ai.dataInited){ai.dataInited=true;try{window.Listener.fire("addr:dataInit")}catch(ak){}}for(var ag=0,aj=ah.length;ag<aj;ag+=1){try{ah.shift().call()}catch(ak){}}}function ac(){var am=this,e=[],aq=[],ag=am.data,ak=ag.rawDataArray.group,ao=ag.rawDataArray.contact,al,an,av=ag.extDataMap.group={},au=ag.extDataMap.groupArray=[],at,ah;for(var aj=0,ar=ak.length,ai,ap;aj<ar;aj+=1){ap=ak[aj];ai=ap.N||"";if(ai){if(ap["X-TYPE1"]==="SYSTEM"){if(ap.UID==="RECENT"){al=ap}else{e.push(ap)}}else{if(ai=="我的邮件列表"){an=ap}else{if(ap.PRODID&&ap.PRODID.indexOf("Apple Inc.")!=-1){ap.N=ap.N.replace(/\\;/gi,";")}aq.push(ap)}}}else{ap.error=true;ak.splice(aj,1);aj-=1;ar-=1}}if(al){e.unshift(al)}if(an){e.push(an)}aq.sort(function(ax,aw){return ax.N.localeCompare(aw.N)});ak=ag.rawDataArray.group=e.concat(aq);at={CID:"ALL",UID:"ALL",N:"所有",CONTACTS:ao};av[at.CID]=at;au.push(at);L.Array.each(ak,function(aw,ax){ax=L.Object.clone(ax);if(!ax.CONTACTS){ax.CONTACTS=[]}av[ax.CID]=ax;au.push(ax)});ah={CID:"OTHERS",UID:"OTHERS",N:"未分组",CONTACTS:[]};av[ah.CID]=ah;au.push(ah)}function i(){var aj=this,al=aj.data,ag=al.rawDataArray.attach||[],ah={};for(var ai=0,ak=ag.length,e;ai<ak;ai+=1){e=ag[ai];if(e.type==="yellowpage"){ah[e.CID]=e.companyId||-1}}al.extDataMap.yellowPage=ah}function ad(){var al=this,ah=window.Uri,e=L.Browser.ie()||0;oData=al.data,aContact=oData.rawDataArray.contact,oGroups=oData.extDataMap.group,oOthers=oGroups.OTHERS,oEmailMap=oData.extDataMap.email={},oContactMap=oData.extDataMap.contact={},oContactLiteMap=oData.extDataMap.contactLite={},aContactLiteArray=oData.extDataMap.contactLiteArray=[],oYellowPage=oData.extDataMap.yellowPage;_fFormat=function(at){var ap,aB,aC=at.CID,az=at.N,aw,ao=at.FN,ay,aI,aE,aH=[],av,au;az=(typeof az=="string"?az:";;;;");if(ao instanceof Array){at.FN=ao=ao.join("")}aw=az.split(";");if(!aw.join("")){aw[1]=(ao||"").replace(";","")}while(aw.length<5){aw.push("")}at.N=aw.join(";");var aq=at.GROUPING||at.Grouping||"";ay=al.getGivenName(at);at.GROUPING=aq;delete at.Grouping;aB=aq.split(";");if(aq.length>0){for(var aG=0,ax=aB.length,ar;aG<ax;aG+=1){ar=oGroups[aB[aG]];if(ar){ar.CONTACTS.push(at)}else{aB.splice(aG,1);ax-=1;aG-=1}}}else{oOthers.CONTACTS.push(at)}oContactMap[aC]=at;ap=al.getContactEmails(at);for(var aG=0,aD=ap.length,an,aF;aG<aD;aG+=1){var aA={};an=L.String.trim(ap[aG]);if(ah.matchEmail(an)){aF=oEmailMap[an];if(aF){aF.push(at)}else{oEmailMap[an]=[at]}aA={email:an,name:ay};if(e>=9){au=D.getPy(ay).toLowerCase();aA.py=au||""}aContactLiteArray.push(aA);aH.push(an)}}if(aH.length>0){aE={email:aH,name:ay};if(e>=9){aE.py=au||""}av=oYellowPage[aC];if(av){aE.yellowPage=av}oContactLiteMap[aC]=aE}};var am=aContact.length,ag=Math.floor(am/8),ak=am%8,ai=0;if(ak){do{_fFormat(aContact[ai++])}while(--ak)}var aj=new Date();if(ag){do{_fFormat(aContact[ai++]);_fFormat(aContact[ai++]);_fFormat(aContact[ai++]);_fFormat(aContact[ai++]);_fFormat(aContact[ai++]);_fFormat(aContact[ai++]);_fFormat(aContact[ai++]);_fFormat(aContact[ai++])}while(--ag)}}function af(e){var ai=this;var ah=ai.getContactEmails(e)[0]||"",ak=sFullName=sUnName="",al=e.FN,aj=e.N,ag=(aj?aj.split(";"):[]);sFullName=ai.parseN(ag);if(sFullName.length==0){if(!al||al==ah){if(ah){sFullName=(new aa(ah,aa.type.EMAIL)).defaultName||sUnName}else{sFullName=sUnName}}else{sFullName=al}}return sFullName}function T(e){var ag=e,ai=sFullName="",ah;if(typeof ag=="string"){ag=ag.split(";")}if(ag.length==5){ai=ag.join(";");ah=/[a-zA-Z]+/.test(ai);if(ah){sFullName=L.String.trim([ag[3],ag[1],ag[2],ag[0],ag[4]].join(" "))}else{sFullName=L.String.trim([ag[3],ag[0],ag[2],ag[1],ag[4]].join(""))}}return L.String.trim(sFullName)}function p(ai){var ag=ai,ah=sFullAddr="",e;if(typeof ag=="string"){ag=ag.split(";")}if(ag.length==7){ah=ag.join(";");e=/.*[\u4e00-\u9fa5]+.*$/.test(ah);if(e){sFullAddr=L.String.trim([ag[0],ag[1],ag[2],ag[3],ag[6]].join(" "))}else{sFullAddr=L.String.trim([ag[3],ag[2],ag[1],ag[0],ag[6]].join(" "))}}else{return ag.join(" ")}return L.String.trim(sFullAddr)}function R(ag){var ai=this,e=ai.data.extDataMap.email,al=ag.name,aj=ag.address,ah,ak;if(!al){al=aa.getDefaultName(aj)}if(aj){if(aj==$S("uid")){al="我"}else{if(Ud.get({field:"ntes_option",flag:"sendershow"})=="2"){ah=e[aj.toLowerCase()];if(ah&&ah.length>0){ak=ai.getGivenName(ah[0]);al=ak?ak:al}}}}return al.replace(/^[+|-]/,"")}function ab(e){var ai=e.FN||"",ah=e.N,ag=ah?ah.split(";"):null;if(ag){return this.parseN(ag)||ai}else{return L.String.trim(ai)}}function A(e,ai){var ag=this,ah=ag.getGivenName(e);if(ai!==ah){e.N=";"+ai+";;;"}e.FN=ai}function w(){return this.readLocalData(true)}function K(){var ag=this,ai;try{ai=L.Storage.get(ag.__localKey);return ai?JSON.parse(ai,function(ak,e){var aj;if(typeof e==="string"){aj=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(e);if(aj){return new Date(Date.UTC(+aj[1],+aj[2]-1,+aj[3],+aj[4],+aj[5],+aj[6]))}}return e}):null}catch(ah){return null}}function h(ai){var ag=this;try{L.Storage.set(ag.__localKey,ai?JSON.stringify(ai):"")}catch(ah){}}function f(ap){var ak=this,ah=false,ai,am,an,ao,ag=ak.data.rawDataArray,aj=ak.getLocalData();if(aj){if(aj.ver===ak.__localVer||ap){try{an=aj.data;if(an){ao=an[$S("uid")]}if(ao){if(ap){return true}if(ao.ver===ak.data.ver){ai=ao.group;am=ao.allInfo}}if(typeof ai=="object"&&typeof am=="object"){if(!ap){ag.group=ai;ag.contact=am}ah=true}}catch(al){}}else{ak.clearLocalData(true)}}return ah}function x(ag,aj){var ak=this,ai=ak.data.rawDataArray,an,am=$S("uid");if(!ag&&ak.dataInited){ak.getDataVersion({call:function(){var e=ak.updateLocalData(true);if(aj){aj(e)}}});return false}try{var ah=ak.getLocalData(),ao={ver:ak.data.ver,group:ai.group,allInfo:ai.contact};if(ah&&ah.ver===ak.__localVer){an=ah.data;if(an){an[am]=ao;ak.setLocalData(ah);return true}}ah={ver:ak.__localVer,data:{}};ah.data[am]=ao;ak.setLocalData(ah)}catch(al){return false}return true}function c(ag){var ah=this,aj,ai,al;try{if(ag){aj=ah.__localKey;if(L.Storage.get(aj)){L.Storage.set(aj,"")}}else{ai=$S("uid"),al=ah.getLocalData();if(al&&al.data&&al.data[ai]){al.data[ai]=null;delete al.data[ai];ah.setLocalData(al)}}}catch(ak){return false}return true}function l(e){var ag=this;ag.__action.getVersion({call:function(ah){if(e.call){e.call()}}})}function b(ag){var ah=this;try{if(ag.type==="download"){ah.updateLocalData(false,ag.call)}else{if(ag.call){ag.call(ah.clearLocalData())}}}catch(ai){return false}}function Y(){var e=this;e.__action=new Z(e);if(Ext.localStorage&&e.checkLocalState()){e.getDataVersion({call:L.Function.bind(e.__initData,e)})}else{e.__initData()}}function G(ao,an,ag,aj){var ak=this,ah=ak.data,ai=ak.dataInited,am={};if(typeof ao=="number"){ah.ver=ao}if(an){am.contact=true;ah.rawDataArray.contact=an;ak.data.delayedContact={}}if(ag){am.group=true;ah.rawDataArray.group=ag}if(aj){ah.rawDataArray.attach=aj;try{ak.__formatYellowPageData()}catch(al){}}if(an||ag){ak.__formatData();if(Ext.localStorage&&ak.checkLocalState()){ak.updateLocalData(true)}if(ai){try{window.Listener.fire("addr:dataReset",am)}catch(al){}}}}function J(ai){var aj=this,al=L.String.trim(ai.name||""),am="添加联系人分组出错",e;if(al.length==0){return aj.showError({title:am,content:"请填写联系组名称。",error:ai.error})}if(L.String.len(al)>40){return aj.showError({title:am,content:"分组名长度超过20个中文或40个字符，请重新输入。",error:ai.error})}e=aj.data.rawDataArray.group;for(var ah=0,ak=e.length,ag;ah<ak;ah+=1){ag=e[ah];if(al===ag.N){return aj.showError({title:am,content:"已存在名称为“"+L.String.encodeHTML(al)+"”的分组，请输入其他名称。",error:ai.error})}}aj.__action.updateGroup({data:{groups:{groups:[{N:al}]}},call:ai.call,error:function(an){aj.showError({title:am,content:an.content,error:ai.error,reason:"action_error"})}})}function O(ai){var ak=this,au=ak.data.delayedContact,ap=!L.Object.isEmpty(au),aq="@@",at=window.EMAIL_ADDRESS;aContacts=ai.contacts,aAddList=[],aModifyList=[];if(ap){for(var al in au){var ag=au[al][at];if(ag){aq+=(ag+"@@")}}}for(var ay=0,am=aContacts.length,ar;ay<am;ay+=1){ar=aContacts[ay];var ah=ar.name?L.String.trim(ar.name.replace("&nbsp;"," ").replace(";","")):"",e=(ar.email||"").toLowerCase(),av=ar.phone,an=ar.group||[],aj={},ao;if(ap){if(e&&aq.indexOf(e)>0){aModifyList=aModifyList.concat(aContacts.splice(ay,1));am-=1;ay-=1;continue}}ao=aa.matchEmail(e);if(!ao||ao.address!==e){ai.error({content:"请输入正确的Email地址",type:"email"});return}ak.setGivenName(aj,ah);aj[window.EMAIL_ADDRESS]=e;if(an.length>0){aj.GROUPING=an.join(";")}if(typeof av=="string"){aj["TEL;type=CELL;type=VOICE;type=pref"]=av}aAddList.push(aj)}var ax=function(){for(var aB=0,aC=aModifyList.length;aB<aC;aB+=1){var aA=aModifyList[aB],az=ak.getAddrObj(aA[at]||aA.email);aA.id=az.CID}ak.updateContact({contacts:aModifyList,call:ai.call,error:ai.error})};if(aAddList.length>0){var aw="添加联系人";ak.__action.addContact({data:{contacts:aAddList},call:function(az){if(aModifyList.length>0){ax()}else{ak.dataCall(true,aw,L.Function.bind(ai.call,ai,az.returns))}},error:function(az){ak.dataCall(false,aw,ai.error,az)}})}else{if(aModifyList.length>0){ak.registerContact({call:ax,request:true})}}return true}function Q(ah){var ak=this,at=ah.contacts,ao=[],ai=[],au=ak.data.extDataMap.email,an=ak.data.extDataMap.contact;for(var av=0,aw=at.length,al;av<aw;av+=1){al=at[av];var aj=al.id,ag=L.String.trim(al.name||"").replace("&nbsp;"," ").replace(";",""),e=(al.email||"").toLowerCase(),aq=al.phone,ap=au[e]||[],am=al.group||null;oEmail=oEmailTmp=null;oEmail=an[aj];oEmailTmp=L.Object.clone(oEmail);if(oEmail){oEmail=L.Object.clone(oEmail);if(ag){ak.setGivenName(oEmail,ag)}if(aq!=undefined){var ax="TEL;type=CELL;type=VOICE;type=pref";var ay=oEmail[ax];if(ah.incremental){if(!ay){oEmail[ax]=aq}else{if(typeof ay=="string"&&aq!==ay){oEmail[ax]=[ay,aq]}else{if(!L.Array.has(ay,aq)){ay.push(aq)}}}}else{if(!ay||typeof ay=="string"){oEmail[ax]=aq}else{ay[0]=aq}}}if(am){oEmail.GROUPING=am.join(";")}if(!L.Object.compare(oEmail,oEmailTmp)){ao.push(oEmail)}}else{ai.push(al)}}var ar="修改联系人";if(ai.length>0){ak.addContact({contacts:ai,call:function(){ak.dataCall(true,ar,ah.call)},error:function(az){ak.dataCall(false,ar,ah.error,az)}})}if(ao.length>0){ak.__action.updateContact({data:{contacts:ao},call:function(az){ak.dataCall(true,ar,function(){ah.call(az.returns)})},error:function(az){ak.dataCall(false,ar,ah.error,az)}})}if(ai.length+ao.length==0){ak.dataCall(false,ar,null,{content:"联系人没有修改"})}return true}function m(ag){var ah=this;var e="删除联系人";ah.__action.removeContact({data:{contactIds:ag.contacts},call:function(){ah.dataCall(true,e,ag.call)},error:function(ai){ah.dataCall(false,e,ag.error,ai)}})}function X(ag){var ah=this;var e=ah.data.extDataMap.contact[ag.id],ak=ag.value,aj=false;if(e){switch(ag.type){case"email":for(var ai in e){oValue=e[ai];if(ai.indexOf("EMAIL")>=0&&oValue){if(oValue===ak){delete e[ai];aj=true}else{if(oValue instanceof Array){L.Array.each(oValue,function(al,am){if(am===ak){oValue.splice(al,1);aj=true;throw E.BREAK}})}}if(aj){break}}}break;default:break}if(aj){ah.__action.updateContact({data:{contacts:[e]},call:function(al){ah.dataCall(true,sText,function(){ag.call(al.returns)})},error:function(al){ah.dataCall(false,sText,ag.error,al)}})}}}function t(au){var an=this,ak=an.data.rawDataArray.contact,aq,av=an.data.extDataMap.contact,ag=an.data.extDataMap.email,aj=an.data.extDataMap.contactLite,ap=an.data.extDataMap.contactLiteArray;for(var am=0,aw=au.length,al,at,ai,ar,ah;am<aw;am+=1){ar=au[am];if(ar.action=="added"){ar=ar.item;at=ar["EMAIL;PREF"]||"";ah={UID:ar.id,FN:ar.FN,N:ar.N||";;;;",GROUPING:""};ah[window.EMAIL_ADDRESS]=at;ak.unshift(ah);al=an.getGivenName(ah);ap.unshift({name:al,email:at});aj["delay"+ah.UID]={name:al,email:[at]};ai=ag[at];if(ai){ai.unshift(ah)}else{ag[at]=[ah]}an.data.delayedContact[ah.UID]=ah;aq=true}}if(aq){try{window.Listener.fire("addr:dataReset",{contact:true})}catch(ao){}}}function j(e){var ag=this,ah=e.UID,aj=e.request;if(aj||ag.data.delayedContact[ah]){ag.__action.getData({call:ai,error:function(ak){}})}else{ai()}function ai(ao){var an=ag.data.rawDataArray.contact;if($S("isVip")){ag.data.rawDataArray.limitinfo=ao.responseData.limitinfo||{}}for(var am=an.length,al=am-1,ak;al>-1;al-=1){ak=an[al];if(aj||ak.UID===ah){e.call(ak);return}}}}function M(ag){var e={title:ag.title||"通讯录出错",content:ag.content||"未知错误",reason:ag.reason||""};if(ag.error){ag.error(e)}else{if(ag.noAlert){return}new L.Msgbox(e)}}function u(e){var ai,ak=[],ag,ah;for(var aj in e){ah=e[aj];if(aj.indexOf("EMAIL")>=0&&ah){if(typeof ah=="string"){if(!ag&&aj==window.EMAIL_ADDRESS){ag=ah}else{ak.push(ah)}}else{if(ah instanceof Array){ah=L.Object.clone(ah);if(!ag&&aj==window.EMAIL_ADDRESS){ag=ah.shift()}ak=ak.concat(ah)}}}}if(ag){ak.unshift(ag)}ai=ak.join("@@").toLowerCase();return ai.split("@@")}function B(ag){var e;e=this.data.extDataMap.email[ag.toLowerCase()];if(e){e=e[0]}return e}function r(ak,am){var ai=this,ah=ai.data.extDataMap.groupArray,e="";ak=L.String.trim(ak);if(!ak){e="zall"}else{for(var ag=0,aj=ah.length,al;ag<aj;ag+=1){al=ah[ag];if(al.N===ak){e=al.CID;break}}}if(e.length>0){am(e)}else{ai.addGroup({name:ak,call:function(ao){if(ao){var an=ai.data.extDataMap.group[ao.returns[0]];if(an){if(an.UID==="null"){delete an.UID}am(an.CID,true)}}}})}}function C(ah,e){var al=this;var ap=al.data.extDataMap.email;var ag=0;var am=$S("uid");for(var ai=0,aq=ah.length,an,ao,ak,aj;ai<aq;ai+=1){an=ah[ai],ao=(an.address||"undefined").toLowerCase();ak=ap[ao];if(ak){ak=ak[0]||ak;ag+=1;an.exist=true;if(e){if(ao==am){aj="我"}else{aj=al.getGivenName(ak)}if(aj){an.name=aj}}}}return{data:ah,exist:ag,inexist:ah.length-ag}}function o(e,ak,am){var aj=this,ah,al,ak=ak;al=aj.getGivenName(e);ak=ak||aj.getContactEmails(ak)[0]||"";var ag="&lt;",ai="&gt;";if(am){ag="<";ai=">"}if(!al){al=ak.split("@")[0]||""}if(ak===$S("uid")){al="我"}return al+(ak?(ag+ak+ai):"")}function N(ah){var an=this,aj=ah.contact,ar=ah.extDataMap,ak=ah.fields||[],ai=an.__getReg(ah.key),am=false,av;try{if(ak.length>0){for(var al=0,au=ak.length;al<au;al+=1){av=aj[ak[al]];if(typeof av=="string"){am=ai.test(av);if(am){break}}if(ar){var ag=ar[aj.CID];try{av=ag[ak[al]];if(typeof av=="string"){am=ai.test(av);if(am){break}}}catch(ao){}}}}else{for(var at in aj){av=aj[at];if(at=="CID"||at=="Grouping"||at=="GROUPING"||at=="UID"||at=="REV"){continue}if(typeof av=="string"){am=ai.test(av)}else{if(typeof av.splice=="function"&&typeof av.length=="number"){for(var al=0,au=av.length;al<au;al+=1){var aq=av[al];if(typeof aq=="string"){am=ai.test(aq);if(am){break}}}}}if(am){break}if(ar){var ag=ar[aj.CID];try{for(var ap in ag){av=ag[ap];if(typeof av=="string"){am=ai.test(av);if(am){break}}}}catch(ao){}}}}}catch(ao){}return am}function F(aj){var ak=this,ai=aj.contacts||ak.data.rawDataArray.contact,an=[];try{for(var ah=0,al=ai.length;ah<al;ah++){var ag=ai[ah];if(ak.search({key:aj.key,contact:ag,fields:aj.fields,extDataMap:aj.extDataMap})){an.push(ag)}}}catch(am){}return an}function z(e){var e=e.replace("\\","\\\\");e=e.replace(new RegExp("[$ ( [ { ^ | ) ? * + .]","gi"),function(ag){return"\\"+ag});return new RegExp(e,"gi")}function d(e){this.__initCalls.push(e)}function y(ak){if($S("uid")!=ak){return}var ai=this;var al=ai.data.rawDataArray.contact;var ag=[];for(var ah=0,aj=al.length;ah<aj;ah+=1){var e=al[ah];if(e.FN&&e.N){delete e.N;ag.push(e)}}if(ag.length>0&&!ai.dataFixed){ai.__action.updateContact({data:{contacts:ag}});ai.dataFixed=true}}function V(ag){var am=this.data.extDataMap,ak,e,ah=ag.id,ai=ag.name;if(ah){ak=am.group;var ao=ak[ah];if(ao){return ao.CONTACTS.length}}else{if(ai){e=am.groupArray;for(var aj=0,an=e.length,al;aj<an;aj+=1){al=e[aj];if(al.N===ai){return al.CONTACTS.length}}}}}function v(ah){var ai=this,ag=ai.data.recentContacts;if(!Ext.contact_record){return null}if(ag){ah.call(e(ag))}else{ai.__action.getRecentContact({limit:20,call:function(aj){ai.data.recentContacts=ag=aj.responseData||[];ah.call(e(ag))},error:function(aj){}})}function e(ap){var aj=ai.data.extDataMap.email,aq=[];for(var al=0,an=ap.length,am,ak;al<an;al+=1){am=L.String.trim(ap[al]);ak=aj[am];if(ak){aq.push(ak[0])}else{var ao={};ao[EMAIL_ADDRESS]=am;aq.push(ao)}}return aq}}function S(e){var ag="|";return((ag+this.__cloneList.join(ag)+ag).indexOf(ag+e+ag)>-1)}function q(e){var ag=this;if(typeof e.group=="undefined"){ag.getGroupId(e.folder,function(ah,ai){e.group=ah;if(ai){e.newGroup=true}ag.__action.contactClone(e)})}else{ag.__action.contactClone(e)}}function H(ag,aj,am){var ak=this,ap=ak.getCloneInfo(aj),ah,an;if(!ap){ah={id:"addrCloneMBox",type:"prompt",inSubject:"请输入上图中看到的字符",header:"输入验证码",content:'<img alt="校验码图片" id="imgVerify" src="'+aa.getUrl("address_cloneimg")+"&rnd="+(new Date()).valueOf()+'" ></img>',ok:function(aq){var e=L.String.trim(aq);if(!e){return"(验证码不能为空)"}ag.verifyCode=e;ak.contactClone(ag)},cancel:function(){L.Tips.loading()},close:function(){L.Tips.loading()}};new L.Msgbox(ah);return}if(!ap.suc){try{var ao=ap.code;var ai=L.String.trim(ag.username.split("@")[1]);if((ai==="yahoo.cn"||ai==="yahoo.com.cn")&&ao===2){ap.msg="因雅虎服务器繁忙，您的通讯录复制请求暂时未能完成，系统会继续在后台为您处理，请稍候再登录查看。"}}catch(al){}if(ag.newGroup){ak.__action.removeGroup({data:{contactIds:[ag.group]}})}ag.callback(ap)}an=ak.data.extDataMap[ag.group];if(an){ap.count+=an.CONTACTS.length}if(ap.suc&&aj){ak.__action.getData({call:function(){if(ag.callback){ag.callback(ap)}},error:function(e){}})}}function k(ah){var ag="",e=false;if(ah.code){var aj="抱歉，",ai=aj+"复制通讯录失败";switch(ah.code){case 1:ag="帐号不存在";break;case 2:ag=ai;break;case 3:return false;case 4:ag=ai;break;case 5:ag="请求不合法";break;case 6:ag=aj+"此邮箱暂时不支持通讯录复制";break;case 7:ag=aj+"登陆次数过于频繁，请稍候再试";break;case 8:ag=ah.desc||ai;break;case 501:ag=aj+"权限不足，请求失败";break;case 502:ag=aj+"通讯录已满，暂无法复制更多数据";break;case 503:ag=aj+"通讯录已满，暂无法复制更多数据";break;case 505:ag=ai;break;case 509:ag=aj+"没有可以复制的联系人数据";break;default:ag="链接超时，可能是网络问题引起，请重试";break}}else{e=true;if(ah.addedcnt){ag+=("恭喜，成功复制"+ah.addedcnt+"条，保存在通讯录分组中！")}else{ag+=("本次没有新增记录，您可进入通讯录分组中新建联系人。")}if(ah.existcnt>0){ag+=("有"+ah.existcnt+"条联系人已存在于现有通讯录中，");ag+=ah.replacedcnt>0?"已覆盖。":"没有再次导入。"}}return{code:ah.code,suc:e,msg:ag,count:ah.addedcnt||0}}function a(aj){var ao=this,ag=aj.addr,aA=ao.data.extDataMap.groupArray,ah=ao.data.extDataMap.contact,av=ao.data.delayedContact,am,an=sName=sEmail=sPhone="",aq,ap,at=[],aB=[],ax=aj.disabled,au=(aj.type=="modify"),ak=false;if(!ao.dataInited){ao.__addInitCall(L.Function.bind(ao.contactDialog,ao,aj));return}if(ag){an=ag.CID||ag.id;if(an&&(av[an]||!ah[an])){ao.registerContact({UID:an,call:function(aC){ag.id=aC.CID;ao.contactDialog(aj)}});return}var az=Context.getModule();if(az&&az.mtype=="contact.ContactModule"){$E(["interface.AddressInterface"],function(aC){aC.contactModify({id:an})});return}sName=ag.name||sName;sEmail=ag.email||sEmail;sPhone=ag.phone||sPhone}if(au){am=ah[an];if(!am){aj.type="add";ao.contactDialog(aj);return}ax=true;ap="快速修改联系人";an=am.CID;at=am.GROUPING.split(";");sName=sName||ao.getGivenName(am);sEmail=sEmail||ao.getContactEmails(am)[0];sPhone=sPhone||am["TEL;type=CELL;type=VOICE;type=pref"]}else{ax=false;ap="快速添加联系人"}for(var ay=0,ar=aA.length,al;ay<ar;ay+=1){al=aA[ay];if(al.N&&al.CID!=="OTHERS"&&al.CID!=="ALL"){aB.push({text:L.String.encodeHTML(al.N),value:al.CID,checked:L.Array.has(at,al.CID)})}}var aw=['<div class="nui-simpleForm nui-form">',"<table>","<tbody>","<tr>",'<th class="nui-form-title">姓名</th>','<td class="nui-form-cont">',L.Input.html({id:"contactDialogName",value:sName,width:"250px"}),"</td>","</tr>","<tr>",'<th class="nui-form-title">邮箱地址</th>','<td class="nui-form-cont">',L.Input.html({id:"contactDialogEmail",value:sEmail,disabled:ax,width:"250px"}),"</td>","</tr>","<tr>",'<th class="nui-form-title">手机/电话</th>','<td class="nui-form-cont">',L.Input.html({id:"contactDialogCell",value:sPhone,width:"250px"}),"</td>","</tr>","<tr>",'<th class="nui-form-title">分组</th>','<td class="nui-form-cont">','<div class="ca nui-scroll">',L.CheckGroup.html({id:"contactDialogGrps",checkType:"checkbox",items:aB}),'<p id="contactDialogAddGrpP">',L.Link.html({text:"添加分组",cls:"nui-txt-link",click:function(){var aE=$C("contactDialogAddGrpIpt");aE.hideTips();aE.setValue("");L.fly("#contactDialogAddGrpP").hide();L.fly("#contactDialogAddGrpDiv").show();var aC=aE.getEl().dom,aD=aC.parentNode.offsetTop-8;if(aD>0){aC.parentNode.parentNode.scrollTop=aD}aE.focus()}}),"</p>",'<div id="contactDialogAddGrpDiv" style="margin-bottom:2px;display:none;">',L.Input.html({id:"contactDialogAddGrpIpt",width:"150px"}),L.Link.html({id:"contactDialogAddGrpSubmit",text:"确定",cls:"nui-txt-link",click:e}),'<span id="contactDialogAddGrpInfo" class="nui-txt-tips" style="display:none;">通讯中...</span>',"&nbsp;&nbsp;",L.Link.html({id:"contactDialogAddGrpCancel",text:"取消",cls:"nui-txt-link",click:function(){L.fly("#contactDialogAddGrpDiv").hide();L.fly("#contactDialogAddGrpP").show()}}),"</div>","</div>","</td>","</tr>","</tbody>","</table>","</div>"].join("");aq=new L.Msgbox({type:"confirm",contentType:"normal",header:ap,content:aw,footer:{xtype:"link",text:"去通讯录编辑更多&gt;&gt;",cls:"nui-txt-link",hidden:gCommon.newwin,click:function(){$E(["interface.AddressInterface"],function(aC){aC.contactModify(ai(true));aq.close()})}},ok:ai});L.Component.setEvents(10);function ai(aD){var aH=$C("contactDialogEmail"),aI=L.String.trim($C("contactDialogName").getValue()),aG=L.String.trim(aH.getValue()),aF=L.String.trim($C("contactDialogCell").getValue()),aJ=[],aC=$C("contactDialogGrps").getValue();aH.hideTips();for(var aE in aC){aJ.push(aC[aE])}if(aD){return{id:an,name:aI,email:aG,phone:aF,grouping:aJ.join(";")}}if(!aG){aH.showTips("请输入联系人的Email地址");return true}if(!aI){aI=aG.split("@")[0]}ao[au?"updateContact":"addContact"]({contacts:[{id:an,name:aI,email:ax?undefined:aG,phone:aF,group:aJ}],call:function(aK){if(aj.callback){aj.callback({id:aK[0],name:aI,address:aG})}aq.close()},error:function(aK){if(aK.type==="email"){aH.showTips(aK.content);return}L.Msgbox.show({content:"抱歉，"+aK.content,ok:function(){if(!aK.dataErr){ao.contactDialog(aj)}}})}});return true}function e(){if(ak){return}ak=true;var aF=$C("contactDialogAddGrpIpt"),aE=$C("contactDialogAddGrpSubmit"),aD=$C("contactDialogAddGrpCancel"),aC="#contactDialogAddGrpInfo";aE.hide();aD.hide();L.fly(aC).show();ao.addGroup({name:L.String.trim(aF.getValue()),call:function(aI){L.fly(aC).hide();aE.show();aD.show();var aG=aI.returns[0],aH=ao.data.extDataMap.group[aG];$C("contactDialogGrps").add({text:L.String.encodeHTML(aH.N),value:aH.CID,checked:true});L.fly("#contactDialogAddGrpDiv").hide();L.fly("#contactDialogAddGrpP").show();ak=false},error:function(aG){L.fly(aC).hide();aE.show();aD.show();aF.showTips(aG.content);aF.select();var aH=aF.getEl().dom,aI=aH.parentNode.offsetTop-8;if(aI>0){aH.parentNode.parentNode.scrollTop=aI}ak=false}})}}function n(ag){var ai=this,al=ag.data,av=ag.callback,ay={},aw={},au=$S("uid"),ar=ai.data.extDataMap.email,at=[],aq=[],aj=[],ak;if(!ai.dataInited){ai.__addInitCall(L.Function.bind(ai.contactListDialog,ai,ag));return}if(!(al instanceof Array)||al.length==0){ao({code:false,msg:"没有其他联系人可以添加！"});return}L.Array.each(al,function(az,aA){aA=(aA+"").toLowerCase();var aB=aa.getAddress(aA).toLowerCase();if(!aB){aB=aa.getEmails(aA,"Email",true).match[0]}if(!aB||aw[aB]){return}aw[aB]=true;if(!ay[aA]&&aA!=au){ay[aA]=!!(ar[aB])}});for(var an in ay){(ay[an]?aq:at).push('<li class="cD nui-txt-'+(ay[an]?"aside":"normal")+'"><label class="nui-chk nui-chk-hasText"><input class="nui-chk-symbol" type="checkbox" value="'+aa.getAddress(an)+'"'+(ay[an]?"":' checked="true"')+' id="chk_'+aa.getAddress(an)+'"></input><span class="nui-chk-text">'+L.String.escapeHTML(an)+(ay[an]?"(已存在)":"")+"</span></label></li>")}aj=at.concat(aq);var ap='            <div class="WB3-gRead-saveContacts">                <div class="g-dialogBox-scrollArea">                    <ul>'+aj.join("")+'</ul>                </div>                <div id="addrGroupReadDiv" class="bdr-light WB3-gRead-saveContacts-moveTo">                    将以上联系人添加或移动到组：<br>                    <span>'+am()+"</span>&nbsp;"+L.Input.html({id:"readNewGroupInput",hidden:true})+"&nbsp;"+L.Button.html({id:"readNewGroupBtn",text:"确定",hidden:true})+"                </div>            </div>        ";ap=['<ul class="cC nui-scroll">',aj.join(""),"</ul>",'<div class="nui-txt-normal bR">',"将以上联系人加入到分组：",'<div class="nui-item nui-item-spc2x ">',"<span>",am(),"</span>",L.Input.html({id:"readNewGroupInput",hidden:true}),L.Button.html({id:"readNewGroupButton",text:"添加",subclass:"inputBtn",click:function(){var az=this,aA=$C("readNewGroupInput"),aB=L.String.trim(aA.getValue());ai.addGroup({name:aB,call:function(aC){az.hide();aA.hide();L.fly(L.fly("#selNewGroupRead").findParent("span").doms[0]).html(am(aC.returns[0]));ah();ak.footer.empty()},error:function(aC){ak.footer.html('<span class="nui-txt-err">'+aC.content+"</span>");aA.focus()}})},hidden:true}),"</div>","</div>"].join("");ak=new L.Msgbox({type:"confirm",contentType:"wide",header:"保存联系人",content:ap,ok:e});L.Component.setEvents(10);ah();function e(){var aF=[],aC=[],aA=ak.el.find("#selNewGroupRead").dom,az=aA.value,aG;for(var aD in ay){aD=L.String.decodeHTML(aD),sEmail=aa.getAddress(aD);aG={name:aa.getDefaultName(aD),email:aa.getAddress(aD,true)};if(!aG.email){if(!aG.email){var aB=aa.getEmails(aD,"Email",true);if(aB.match.length>0){aG.email=aB.match[0].address;aG.name=aB.match[0].defaultName}}}if(!aG.name){aG.name=aG.email.split("@")[0]}if(az!="-1"){aG.group=[az]}if(document.getElementById("chk_"+sEmail).checked){if(!ay[aD]){aF.push(aG)}aC.push(sEmail)}}var aE;if(aF.length+aC.length==0){aE="请选择需要保存的联系人。"}else{if(az=="-2"){aE="请选择联系人分组。";aA.focus()}}if(aE){ak.footer.html('<span class="nui-txt-err">'+aE+"</span>");return true}if(aF.length>0){ai.addContact({contacts:aF,call:ao,error:function(aH){ak.footer.html('<span class="nui-txt-err">'+aH.content+"</span>")}})}if(aC.length>0){ax(aC,az)}}function ax(aB,aA){if(aA=="-1"){av({code:S_OK});return}var az=ai.data.extDataMap.email,aC=[];L.Array.each(aB,function(aE,aF){try{var aG=az[aF],aD;if(aG){aD=aG[0];var aH=aD.GROUPING.split(";");if(!L.Array.has(aH,aA)){aH.push(aA);aC.push({id:aD.CID,group:aH,name:ai.getGivenName(aD)})}}}catch(aI){}});if(aC.length>0){ai.updateContact({contacts:aC,call:ao,error:function(aD){ak.footer.html('<span class="nui-txt-err">'+aD.content+"</span>")}})}else{ao()}}function am(aA){var az=[],aB=ai.data.extDataMap.groupArray;aA=aA+"";L.Array.each(aB,function(aC,aD){az.push('<option value="'+aD.CID+'"'+(aD.CID===aA?' selected="true"':"")+">"+L.String.left(aD.N,30)+(L.String.len(aD.N)>30?"...":"")+"</option>")});az=az.slice(1,-1);return'<select id="selNewGroupRead"><option value="-1">默认分组</option>'+az.join("")+'<option value="">--------</option><option value="-2">添加分组</option></select>'}function ah(){var az=ak.el.find("#selNewGroupRead");az.listen("change",function(){var aB=az.dom,aC=$C("readNewGroupInput"),aA=$C("readNewGroupButton");if(aB.value=="-2"){aC.setValue("");aC.show();aA.show();aC.focus()}else{if(aB.value==""){aB.selectedIndex=0}aC.hide();aA.hide()}})}function ao(){av({code:S_OK})}}function I(ak){var aC=this,aO=aC.data.extDataMap.groupArray,ag=ak.renderTo,aj,al,aM,aD="contactSelector_"+((new Date()).getTime()+""),an=aD+"_tree",aG=aD+"_search",aA,ao,e={},aN=false,au;if(!aC.dataInited){aC.__addInitCall(L.Function.bind(aC.contactSelector,aC,ak));return null}if(!(ag instanceof L.Element)){if(typeof ag=="string"){ag=L("#"+ag)}else{ag=L(ag)}if(!ag||!ag.append){return null}}aj=L.Element.create("div");al={id:an,items:[],isRoot:true,extcls:"nui-simpleTree"};for(var aJ=0,aF=aO.length,aw=al.items,aq,ai,aL,aB;aJ<aF;aJ+=1){aq=aO[aJ];if(aq.CID=="ALL"){continue}ai=aq.CONTACTS||[];aL={text:at(aq.N||"未命名分组",120),items:[],isFold:true};aB=aL.items;for(var aI=0,aE=ai.length,aK,az,av;aI<aE;aI+=1){aK=ai[aI];if(aK){az=aC.getGivenName(aK)||"";av=aC.getContactEmails(aK)[0]||"";if(!az){if(av){az=av.split("@")[0]}else{continue}}aB.push({text:az,click:L.Function.bind(ak.call,ak,{id:aK.CID,name:az,email:av})})}}if(aB.length==0&&aq.CID!="OTHERS"){continue}aL.extItems=[{xtype:"link",text:"("+aB.length+")"}];aw.push(aL)}if(aw.length==1&&aw[0].text=="未分组"){aw[0].text="所有"}aM={placeholder:"查找联系人",iconBtn:"search",extcls:"nui-contacts-input",blur:am,keydown:aH,keyup:ap,iconbtnclick:ax};aj.setClass("nui-contacts");aj.html([L.Input.html(aM),'<div class="nui-contacts-list nui-scroll">',L.Tree.html(al),'<div id="'+aG+'" class="nui-contacts-search" style="display:none;"><div class="nui-assistBlock nui-block nui-contacts-search-tit">正在搜索...</div></div>',"</div>"].join(""));ag.append(aj.dom);L.Component.setEvents(10);L.fly("#"+aG).listen("click",function(){var aR=L.Event.getTarget(),aQ,aT,aS,aU;if(aR){if(aR.nodeName.toLowerCase()=="a"){aS=aR.id}else{aQ=L(aR).findParent("a");aR=aQ?aQ.doms[0]:aR;if(aQ){aR=aQ.doms[0];aQ.destroy()}if(aR){aS=aR.id}}}if(aS){aS=aS.split("__")[1];if(aS){aU=e[aS];aU.id=aS;ak.call(aU)}}});ag.destroy();function am(){var aQ=this;if(L.String.trim(L.String.trim(aQ.getValue()))==""){ar(aQ)}}function aH(){var aS=this;var aQ=L.Event.getEvent(),aR=aQ.keyCode.toString();if(aR=="27"){aS.setValue("");return false}}function ap(){var aR=this,aS=L.String.trim(aR.getValue()),aQ=L("#"+aG);if(aS==""||aS===aA){return false}if(!aN){$C(an).hide();aQ.show()}ao=[];aA="";aQ.html('<div class="nui-assistBlock nui-block nui-contacts-search-tit">正在搜索...</div>');ah(aS);aR.iconBtn.update({type:"close"});aN=true;aQ.destroy()}function ax(){var aQ=this;if(aN){ar(aQ)}}function ar(aR){var aQ=L("#"+aG);aR.setValue("");aR.iconBtn.update({type:"search"});aQ.hide();$C(an).show();aQ.empty();ao=[];aA="";aN=false;aQ.destroy()}function ah(aY){var aX=aC.data.rawDataArray.contact,aS,aT=[],aW=[];e={};if(aA.length>0&&aY.length>0&&aY.indexOf(aA)==0){aS=aLastEmail}else{aS=aX}for(var aR=0,aZ=aS.length,aU,aQ,aV;aR<aZ;aR+=1){aU=aS[aR];aV=aC.getContactEmails(aU)[0]||"";aQ=aC.getGivenName(aU)||aV.split("@")[0]||"";if(aQ||aV){if(aQ.indexOf(aY)>-1||aV.indexOf(aY)>-1){aT.push(aU);e[aU.CID]={name:aQ,email:aV};aW.push(ay(aY,{id:aU.CID,name:aQ,email:aV}))}}}ao=aT;aA=aY;if(aW.length==0){aW.push('<div class="nui-assistBlock nui-block nui-contacts-search-tit">没有搜索到有关“<strong>'+aY+"</strong>”的联系人</div>")}L.fly("#"+aG).html(aW.join(""))}function ay(aS,aU){var aR=L.String.encodeHTML(aU.name),aQ=L.String.encodeHTML(aU.email),aT=aC.__getReg(aS);return['<a id="'+aG+"__"+aU.id+'" class="nui-contacts-search-item" href="javascript:void(0)" title="&quot;'+aR+"&quot;&lt;"+aQ+'&gt;">','<strong class="nui-tree-item-text">',(aS?aR.replace(aT,aP):aR),"</strong>",'<p class="nui-tree-item-text">&lt;',(aS?aQ.replace(aT,aP):aQ),,"&gt</p>","</a>"].join("")}function aP(aQ){return'<b class="nui-txt-mark">'+aQ+"</b>"}function at(aW,aV){var aT=aW,aR="",aU=L.Element.create("span");aU.setClass("txt-info");aU.setStyle({visibility:"hidden"});JS5.container.appendChild(aU.dom);while(aU&&L.String.len(aT)>0){var aQ=aT+aR;aU.html(aQ);var aS=parseInt(aU.dom.offsetWidth,10);if(aS<=aV){aU.empty();aU.remove();return aQ}else{var aX=Math.floor((aS-aV)/(aS/aQ.length))||1;aT=aT.substr(0,aT.length-aX);if(!(aR.indexOf("..")==0)){aR=".."}}}}}function s(ag,e,ai,aj){var ah="。",aj=aj||{};if(ag){L.Tips.show({text:e+"成功!",type:"suc"})}else{aj.dataErr=true;if(aj.content){ah="："+aj.content}L.Tips.show({text:e+"失败"+ah,type:"err"})}if(ai){ai(aj)}}function g(e){var aj=this;var ak=aj.data.extDataMap.group;var ah=e.GROUPING||e.Grouping||"";return ah;var ag=[];var ai=ah.split(";");L.Array.each(ai,function(an,ao){var am=ak[ao];if(am&&am.UID){var al=am.UID;ai[an]=al}});e.GROUPING=ah?ai.join(";"):""}})();(function(){var g=$.Object;var d=$.Array;var h=$.String;var j=$I("init.Folder");var a=$.createClass($N("support.Folder"));g.extend(a,{empty:c,remove:l,rename:i,add:k,keep:f,checkName:e,showMsg:b});function c(m){var q=this;var t=m.fid;var r=j.get(t);var n=r.name;var o=false;var p;var z="确定删除“"+n+"”的所有邮件到已删除文件夹吗?";if(d.has(gCommon.nolistids,t)){var u="";if($S("isVip")){if(!($S("cos").pref_mail_preserving_days>0)){var v="文件恢复";var s=new $.Link({text:v,click:function(){$I("util.CustomAppManager").goOutLink("recovery",v);p.close()}});u="&nbsp;[开启"+s.html()+"，邮件双重备份]"}}o=true;z="您确定要彻底删除“"+n+"”中的所有邮件吗？"+u}p=$.Msgbox.show({type:"confirm",content:z,title:"文件夹清空",ok:x});$.Component.setEvents();function x(){var A=new DataAction();var B={func:"mbox:emptyFolder",body:{id:t,permanently:o},call:y,error:w};A.wmsvr(B)}function w(B){var A=B.code;if(h.has(A,"FS_")){return"清空文件夹出错"}}function y(B){j.refresh(A);$.Tips.show({succ:true,text:"成功清空文件夹"});function A(){Listener.fire("folder:empty",t)}}}function l(m){var r=this;var t=m.fid;var s=j.get(t);var o=s.name;var w="";var n=undefined;if(s.flags.pop){w="要删除该文件夹，请先到邮箱设置的邮箱中心里删除该邮箱帐号。";n=function(){$E("interface.MailCenterInterface",function(x){x.entry()})}}else{if(j.getInfo(t)>0){w="请先清空文件夹"}}if(w){$.Msgbox.show({type:"confirm",content:w,title:"删除文件夹",ok:n});return}var q=new DataAction();var p={func:"mbox:deleteFolders",body:{ids:[t]},call:v,error:u};q.wmsvr(p);function u(z){var x=z.code;var y=null;switch(x){case"FA_HAS_CHILD":y="有子文件夹，无法删除此文件夹";break;case"FA_HAS_MAIL":y="文件夹中还有邮件，请先清空";break;case"FA_FORBIDDEN":y="不允许删除此文件夹";break}return y}function v(z){var A=$S("attrs").folders;for(var y=0,x=A.length;y<x;y++){if(s.id==A[y].id){A.splice(y,1);break}}j.sort(true);Listener.fire("folder:remove",t);$.Tips.show({succ:true,text:"成功删除文件夹"})}}function i(r){var s=this;var q=r.fid;var n=r.newFolderName;var p=j.get(q);var o=p.name;if(!n){s.showMsg({defaultValue:o,fid:q,callback:m})}else{m(n)}function m(w){n=w;var t=new DataAction();var v={func:"mbox:updateFolders",body:{items:[{id:q,name:n}]},call:x,error:u};t.wmsvr(v);function u(A){var y=A.code;var z=null;switch(y){case"FA_ID_NOT_FOUND":z="找不到指定文件夹";break;case"FA_PARENT_NOT_FOUND":z="找不到指定文件夹的父文件夹";break;case"FA_INVALID_PARENT":z="错误的父文件夹";break;case"FA_NAME_EXISTS":z="文件夹重名";break;case"FA_NAME_INVALID":z="非法的文件夹名称";break;case"FA_FORBIDDEN":z="不允许修改此文件夹";break;case"FA_NAME_RESERVED":z="文件夹名和系统保留名重复";break}return z}function x(y){p.name=n;j.sort(true);Listener.fire("folder:modify",q,n);$.Tips.show({succ:true,text:"成功修改文件夹"})}}}function k(q){var s=this;if(!q){q={}}var o=q.folderName;var r=q.callback;if(!o){s.showMsg({callback:p})}else{p(o)}function p(t,u){if(u){n(t)}else{m(t)}}function n(u){var y='<div class="nui-simpleForm nui-form oL"><table><tbody><tr><th class="nui-form-title">输入联系人名称：</th><td class="nui-form-cont"><div class="nui-ipt"><input class="nui-ipt-input" type="text"/></div></td></tr><tr id="addrErrTr" style="display:none;"><th class="nui-form-title"></th><td class="nui-form-cont">请输入正确的联系人</div></td></tr><tr><th class="nui-form-title"></th><td class="nui-form-cont" id="addrSelTd"></td></tr></tbody></table></div>';var x;x=$.Msgbox.show({type:"confirm",header:"设置来信分类",content:y,contentType:"normal",noIcon:true,ok:$.Function.bind(t,window,u)});var w=x.getEl().find("input");var v=w.dom;$E("support.AddressSupport",function(z){z.contactSelector({call:function(A){v.value=A.email||A.name},renderTo:$("#addrSelTd")})});function t(z){sEmail=$.String.trim(v.value);if(sEmail.length>0){m(z,sEmail)}else{$.fly("#addrErrTr").show();return true}}}function m(u,x){var t=new DataAction();var w={func:"mbox:createUserFolders",body:{items:[{name:u}]},call:y,error:v};t.wmsvr(w);function v(B){var z=B.code;var A=null;switch(z){case"FA_OVERFLOW":A="超过最大文件夹个数限制";break;case"FA_PARENT_NOT_FOUND":A="找不到指定文件夹的父文件夹";break;case"FA_NAME_EXISTS":A="文件夹重名";break;case"FA_NAME_INVALID":A="非法的文件夹名称";break;case"FA_NAME_RESERVED":A="文件夹名和系统保留名重复";break}return A}function y(A){var z=A["var"][0];$S("attrs").folders.push({id:z,name:u,stats:{messageCount:0,messageSize:0,unreadMessageCount:0,unreadMessageSize:0,threadCount:0,unreadThreadCount:0}});j.sort(true);Listener.fire("folder:add",z,u,x);if(r){r(z)}$.Tips.show({succ:true,text:"成功添加文件夹"});if(x){$E("support.OptionSupport",function(B){B.addMailFilter({name:x,fid:z,email:x})})}}}}function f(p){var t=this;var o=p.list,s=p.callback,q=p.error;var m=new DataAction();m.wmsvr({func:"mbox:updateFolders",body:{items:o},call:r,error:n});function r(){var v={};for(var x=0,u=o.length;x<u;x++){var A=o[x],y=A.id,z=A.keepPeriod;var w=j.get(y);if(w){if(!w.flags){w.flags={}}w.keepPeriod=z;v[y]=z}}Listener.fire("folder:keep",v);if(s){s()}}function n(){if(q){q()}}}function e(n,p){var q=this;if(!n||n==""){return"请输入文件夹名称"}if(h.len(n)>20){return"长度不能大于10个汉字(或20个字符)"}if(h.check(n)||h.check(n,/[\&\.\*]/)){return"请不要输入 ＂, % ' \" \\ / ；| &.*＂ 等特殊字符"}var m=false;var o=j.getByName(n);if(o&&o.id!=p){m=true}if(m){return"同名文件夹已存在"}}function b(m){var s=this;var u=m.defaultValue;var v=m.fid;var w=m.callback;var r=false;var x=v?"修改文件夹":"新建文件夹";var n={type:"prompt",inputLabel:"输入文件夹名称",inputValue:u,header:x,ok:p};if(!v){var t=new $.Checkbox({text:"收取指定联系人邮件到该文件夹",checkedchange:o});n.footer=t}var q=$.Msgbox.show(n);function p(y){y=h.trim(y).replace(/\s+/ig," ");var z=s.checkName(y,v);if(!z){w(y,r)}else{return z}}function o(){var y=q.find("button")[0];r=t.getChecked();if(r){sText="下一步"}else{sText="确 定"}y.update({text:sText})}}})();(function(){var f=$.Object;var e=$.Array;var c=$.Function;var i=$.String;var k=$I("init.Tag");var a=$.createClass($N("support.Tag"));f.extend(a,{getMenu:b,add:j,modify:g,remove:d,checkName:l,showMsg:h});function b(r){var q=$I("init.Tag");var n=r.tag;var p={reverse:true,groups:[]};var o=q.list();var t=p.groups;var m;if(f.count(o)>0){m=[];f.each(o,function(x,w){var y=n&&e.has(n,w.name);var v=w.name;var u=m.length;m.push({text:v,icon:{xtype:"icon",type:"tag",subtype:w.color,group:"tagitem"},checked:y,click:function(){s(v,u)}})});t.push({items:m,type:"scroll",checkType:"checkbox"})}if(f.count(n)>0){m=[];m.push({text:"取消所有标签",click:function(){Log.cache({from:"menu",remove:"all"});r.remove()}});t.push({items:m})}m=[];m.push({text:"新建标签并标记",click:function(){$E("support.Tag",function(u){u.add({from:"menu",callback:function(v){r.callback(false,v)}})})}});m.push({text:"管理标签",click:function(){$E("interface.MboxInterface",function(u){Log.cache({tagmenu:"gotomanage"});u.entry({module:"tag"})})}});t.push({items:m});return p;function s(v,u){var w=n&&e.has(n,v);r.callback(w,v)}}function j(o){var m=this;if(!o){o={}}var p=o.callback;m.showMsg({callback:n});function n(r){var u=r.name;var w=r.color;var q=new DataAction();var t={func:"mbox:manageTags",body:{add:[[u,{color:w}]]},log:{l:"tag",action:"add",from:o.from},call:v,error:s};q.wmsvr(t);function s(x){}function v(x){$S("attrs").tags.push([u,{color:w}]);k.init(true);a.menuConfig=null;Listener.fire("tag:add",u);if(p){p(u)}$.Tips.show({succ:true,text:"成功添加标签"})}}}function g(q){var o=this;var n=q.tid;var t=q.callback;var s=q.onlyName;var m;if(q.name&&q.color>-1){m=q.name;p({name:q.name,color:q.color})}else{var r=k.getById(n);m=r.name;o.showMsg({data:r,onlyName:s,callback:p})}function p(v){var y=v.name;var A=v.color;var u=new ($I("core.DataAction"))();var x={func:"mbox:manageTags",body:{update:[[m,{color:A},y]]},log:{l:"tag",action:"modify",from:q.from},call:z,error:w};u.wmsvr(x);function w(B){}function z(F){var G=$S("attrs").tags;var D;for(var E=0,C=G.length;E<C;E++){var B=G[E];if(m==B[0]){B[0]=y;B[1].color=A;D=E;break}}k.init(true);a.menuConfig=null;Listener.fire("tag:modify",D,m,y);if(t){t(n)}$.Tips.show({succ:true,text:"成功编辑标签"})}}}function d(m){var n=this;var t=m.tid;var u=m.callback;var q=k.getById(t);var o=q.name;var r=[];var s=k.getInfo(o);r[r.length]='<h4 class="g-dialogBox-title txt-impt">确定删除“'+o+"”这个标签？</h4>";if(s>0){r[r.length]='<p class="txt-12 txt-info">该标签将从 '+s+" 封邮件中删除，但是不会删除邮件</p>"}$.Msgbox.show({type:"confirm",content:r.join(""),title:"删除标签",ok:p});function p(){var v=new ($I("core.DataAction"))();var x={func:"mbox:manageTags",body:{"delete":[q.name]},log:{l:"tag",action:"remove"},call:y,error:w};v.wmsvr(x);function w(z){}function y(B){var C=$S("attrs").tags;for(var A=0,z=C.length;A<z;A++){if(o==C[A][0]){C.splice(A,1);break}}k.init(true);a.menuConfig=null;Listener.fire("tag:remove",o);if(u){u(B)}$.Tips.show({succ:true,text:"成功删除标签"})}}}function l(m,p){var o=this;if(!m||m==""){return"请输入标签名称"}if(i.len(m)>20){return"长度不能大于10个汉字(或20个字符)"}if(i.check(m)||i.check(m,/[\&\.\*]/)){return"请不要输入 ＂, % ' \" \\ / ；| &.*＂ 等特殊字符"}var n=false;var q=k.get(m);if(q&&q.id!=p){n=true}if(n){return"同名标签已存在"}}function h(m){var n=this;var w=m.tid;var r=m.data;var B=m.callback;var z=m.onlyName;var t=r?r.name:undefined;var y=r?r.color:A();var v=f.count(k.list())==0?'<h4 class="g-dialogBox-title">您还没有邮件标签，创建后可以更加方便管理邮件</h4><p class="txt-info txt-12" style="margin-bottom:20px">您可以给一封邮件设置多个标签，并为不同标签设置不同颜色...</p>':"";var o=null;if(!z){var u={groups:[{items:[],type:"inlineItemList"}],width:"142px"};for(var s=0;s<20;s++){u.groups[0].items.push({text:(new $.Tag({type:s,subclass:"iconTag"})).html(),click:c.bind(function(D){y=D;var C=x.find("icon")[0].update({subtype:y})},this,s)})}o=[{html:'<div class="nui-simpleForm nui-form"><table><tr><th class="nui-form-title">选择标签颜色</th><td class="nui-form-cont" id="tdTagMenuButton"></td></tr></table></div>'}]}var q=$.Msgbox.show({type:"prompt",extcls:"WB3-gOpt-mDdialogBox-creatTag",items:o,inputLabel:"输入标签名称",content:v,inputValue:t,header:r?"修改标签":"添加标签",ok:p});if(!z){var x=new $.Button({subclass:"dropdownBtn",text:"选择颜色",icon:{type:"tag",subtype:y},menu:u,renderTo:"tdTagMenuButton"})}function p(C){C=i.trim(C).replace(/\s+/ig," ");var D=n.checkName(C,r?r.id:undefined);if(!D){B({name:C,color:y})}else{return D}}function A(){var F=k.list();var H={};var I=0;var G=false;f.each(F,function(K,J){var L=J.color;if(!H[L]){H[L]=0}H[L]++;G=true});if(G){var D=-1;for(var E=0;E<k.colorCount;E++){var C=H[E]||0;if(C==0){I=E;break}else{if(D>C||D==-1){D=C;I=E}}}}return I}}})();(function(){var g=$.Object;var b=$.createClass($N("support.MailAssist"));g.extend(b,{factory:null,updater:null,init:j,create:i,has:d,hasNewVersion:k,getVersion:h,startUpdate:e,support:f,install:a,installMac:c});function j(){var l=null;var n=null;if(typeof MailAssistFactory!="undefined"){l=new MailAssistFactory()}else{try{l=new ActiveXObject("MailAssist.Factory");n=l.create("ntes.updateservice")}catch(m){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-mailassist"]){l=document.createElement("object");l.style.position="absolute";l.width=0;l.height=0;l.type="application/x-mailassist";document.body.appendChild(l);if(l&&(typeof l.create=="undefined")){l=null}}}}if(l){b.factory=l;if(n){b.updater=n}else{b.updater=false}}else{b.factory=false}}function i(m){if(b.has()){try{return b.factory.create(m)}catch(l){}}return null}function d(){if(b.factory===null){b.init()}if(b.factory){if(typeof b.factory.create=="undefined"){b.factory=null}else{return true}}return false}function k(){var l=b.getVersion();if((l[0]==2&&l[1]>=1)||l[0]>=3){return true}return false}function h(){var l=null;if(b.has()){var m=b.factory.version;if(m){l=m.split(".")}}return l}function e(m){if(b.has()){if(b.updater){try{b.updater.StartUpdate(m);return true}catch(l){}}}return false}function f(){var m=false;var l=$.Browser.getInfo();if(l.os=="windows"&&($.Browser.ie()||$.Browser.firefox()||$.Browser.chrome())){m=true;if(l.shell){if(l.shell=="360"||l.shell=="theworld"||l.shell=="sogou"){m=true}}else{m=true}}else{if(l.os=="macintosh"&&Ext.macPlugin&&($.Browser.safari()||$.Browser.firefox()||$.Browser.chrome())){m=true}}return m}function a(o,x){o=o||{};var m=o.close||$.EMPTYFUNC();var z=$.Browser.getInfo();if(z.os=="macintosh"){b.installMac(o,x);return}if($.Browser.ie()){var s=$I("util.Misc");s.redirect(Uri.getUrl("compose_attach_setup"))}else{if($.Browser.firefox()){try{var t="compose_attach_plugin";var w=$.Browser.getVersion()||[0,0];if(w[0]>=5){t="compose_attach_firefox"}if(typeof InstallTrigger!="undefined"){InstallTrigger.install({NetEaseMailPlugin:Uri.getUrl(t,true)})}else{m();var p=$.Msgbox.show({title:"邮箱插件提示",content:"请按照浏览器顶部安装栏提示，按“允许”安装插件。<br><br>安装成功后选择立即重启浏览器即可使用该功能！",ok:function(){b.install({close:function(){oMsgBox.close()}})}});if(!$("#ifrDownUrl")){var v=$.Element.create("IFRAME");v.setAttr({id:"ifrDownUrl"});v.setStyle({display:"none"});document.body.appendChild(v.dom)}$("ifrDownUrl").setAttr({src:Uri.getUrl(t,true)})}}catch(u){}}else{if($.Browser.chrome()){m();var w=$.Browser.getVersion()||[0,0];if(w[0]>=21&&!z.__shell){if($S("domain")=="163.com"){try{var n=Uri.getUrl("compose_attach_chrome21",true);var r=document.createElement("LINK");r.rel="chrome-webstore-item";r.href=n;var q=document.getElementsByTagName("HEAD")[0];q.appendChild(r);chrome.webstore.install(n,function(){window.setTimeout(l,1000)},function(){y(x)})}catch(u){y(x)}}else{y(x)}}else{$.Msgbox.show({title:"邮箱插件提示",content:"请按照浏览器底部下载栏提示，按“继续”安装插件。<br><br>安装成功后可马上使用新功能！",ok:function(){window.setTimeout(l,1000)}});if(!$("#ifrDownUrl")){var v=$.Element.create("IFRAME");v.setAttr({id:"ifrDownUrl"});v.setStyle({display:"none"});document.body.appendChild(v.dom)}$("#ifrDownUrl").setAttr({src:Uri.getUrl("compose_attach_chrome",true)})}}}}function l(){b.init();if(b.has()){var A=Context.getModule();if(A&&A.mtype&&A.mtype=="compose.ComposeModule"){A.attach.subInit("plugin")()}}else{b.factory===null}}function y(B){if(B){B.send({action:"force",call:function(){A()}})}else{A()}function A(){var C=$I("util.Misc");C.redirect(Uri.getUrl("compose_attach_chrome21_setup"))}}}function c(q){q=q||{};var l=q.close||$.EMPTYFUNC();l();if($.Browser.safari()||$.Browser.chrome()){var m=Uri.getUrl("compose_attach_mac_plugin");window.open(m)}else{if($.Browser.firefox()){try{var m=Uri.getUrl("compose_attach_mac_firefox");window.open(m);var p=$.Msgbox.show({title:"邮箱插件提示",content:"请按照浏览器顶部安装栏提示，按“允许”安装插件。<br><br>安装成功后选择立即重启浏览器即可使用该功能！",ok:function(){b.install({close:function(){oMsgBox.close()}})}});if(!$("#ifrDownUrl")){var o=$.Element.create("IFRAME");o.setAttr({id:"ifrDownUrl"});o.setStyle({display:"none"});document.body.appendChild(o.dom)}$("#ifrDownUrl").setAttr({src:m})}catch(n){}}}}})();(function(){var d=$I("core.DataAction");var c=$.createClass($N("support.MailCenterAction"));$.Object.mix(c,d,{},{sync:e,getStatus:b,update:a});function e(h){var g=h.param;var f={ids:g.ids};var i={func:"user:syncPOPAccount",body:f,call:function(j){h.callback(j)},error:h.error,wmsvrlog:{action:"syncPOPAccounts"}};this.wmsvr(i)}function b(h){var g=h.param;var f={ids:g.ids,stats:true};var i={func:"user:getPOPAccounts",body:f,call:function(j){h.callback(j)},error:h.error,wmsvrlog:{action:"getPOPAccounts"}};this.wmsvr(i)}function a(h){var g=h.param;var f={items:[g]};var i={func:"user:updatePOPAccounts",body:f,call:function(j){h.callback(j)}};this.wmsvr(i)}})();(function(){var l=$I("init.Nav");var e=$S("isCorp");var t=$.createClass($N("support.MailCenter"));$.Object.extend(t,{POP3_SERVER:{"163.com":"pop.163.com","126.com":"pop.126.com","188.com":"pop.188.com","netease.com":"pop.netease.com","yeah.net":"pop.yeah.net","vip.163.com":"pop.vip.163.com","vip.126.com":"pop.vip.126.com","sina.com":"pop3.sina.com","sina.cn":"pop3.sina.cn","vip.sina.com":"pop3.vip.sina.com","sohu.com":"pop3.sohu.com","vip.sohu.com":"pop3.vip.sohu.com","china.com":"pop.china.com","21cn.com":"pop.21cn.com","21cn.net":"pop.21cn.net","tom.com":"pop.tom.com","163.net":"pop.163.net","263.net":"263.net","domain.com":"pop.yourdomain.com","eyou.com":"pop3.eyou.com","qq.com":"pop.qq.com","vip.qq.com":"pop.qq.com","foxmail.com":"pop.foxmail.com","gmail.com":"pop.gmail.com","yahoo.com":"pop.mail.yahoo.com.cn","yahoo.com.cn":"pop.mail.yahoo.com.cn","yahoo.cn":"pop.mail.yahoo.com.cn","msn.com":"pop3.live.com","msn.cn":"pop3.live.com","live.cn":"pop3.live.com","live.com":"pop3.live.com","hotmail.com":"pop3.live.com","qiye.163.com":"pop.qiye.163.com"},SSL_SERVER:["pop.gmail.com","pop3.live.com","pop.mail.yahoo.cn","pop.mail.yahoo.com.cn"],syncIds:[],get:m,getAll:h,getSender:n,receive:f,receiveAll:r,syncStart:i,syncEnd:d,syncError:u,show:o,update:b,searchPop3:s,isNone:q,getId:k,sessionAdd:g,sessionUpdate:a,sessionDel:c,sessionHas:p,initAction:j});function m(w){var v=$S("attrs").popAccounts;var z,y;if(w.type){z=w.type;y=w.value}else{if(w.id){z="id";y=w.id}else{if(w.fid){z="fid";y=w.fid}else{if(w.username){z="username";y=w.username}}}}var x=null;$.Array.each(v,function(A,B){if(B[z]&&B[z]==y){x=B;throw $.BREAK}});return x}function h(){return $S("attrs").popAccounts}function n(){var w=$S("attrs").popAccounts;var v=[];var x;$.Array.each(w,function(y,z){if(z.authenticated&&z.delegatedSend){x=new Email(z.username,z.name);if(z.smtpHost){x.smtp=true;x.popId=z.id}v.push(x)}});return v.length>0?v:null}function f(w,v){var x=this;if(x.initAction()==Loader.LOADFAILED){return}var A=x.get(w);var z=A.id;if(!z||$.Array.has(x.syncIds,z)){return}else{x.syncIds.push(z)}var y={param:{ids:[z]},callback:function(){x.syncStart()},error:function(){x.syncError()}};x.action.sync(y);l.setReceiveIcon(A.fid,"receiving")}function r(w){var x=this;if(x.initAction()==Loader.LOADFAILED){return}var v=$S("attrs").popAccounts;var z=[];$.Array.each(v,function(A,B){if($.Array.has(x.syncIds,B.id)){throw $.CONTINUE}else{if(w&&w.auto&&!B.autoSync){throw $.CONTINUE}else{if(B.type=="none"){throw $.CONTINUE}}}z.push(B.id)});if(z.length==0){return}x.syncIds=x.syncIds.concat(z);var y={param:{ids:z},callback:function(){x.syncStart()},error:function(){return x.syncError()}};x.action.sync(y);l.setReceiveIcon(null,"receiving")}function i(){var v=this;if(v.initAction()==Loader.LOADFAILED){return}if(v.syncIds.length==0){return}v.show("begin");var w={param:{ids:v.syncIds},callback:$.Function.bind(v.syncEnd,v),error:function(){return v.syncError()}};v.action.getStatus(w)}function d(C){var B=this;var x=C["var"];var v=0;var A=0;var z=0;var y=0;var w=[];$.Array.each(x,function(E,F){var D=F.stats;if(!D||(D.endTime&&D.code!="PENDING")){$.Array.remove(B.syncIds,F.id);B.sessionUpdate(F);l.setReceiveIcon(F.fid,"receive");if(D&&D.receivedMessageCount>0){$I("init.Folder").checkMail()}if(D.code=="FA_BAD_PASSWORD"){w.push([F.username,F.id])}}if(!D){throw $.CONTINUE}if(D.messageCount>=0){v+=D.messageCount;A+=D.receivedMessageCount;z+=D.skippedMessageCount}if(D.spamMessageCount){y+=D.spamMessageCount}});B.show("run",{all:v,received:A,skip:z,spam:y});if(B.syncIds.length>0){window.setTimeout($.Function.bind(B.syncStart,B),3000)}else{B.show("end",{received:A,skip:z,error:w});l.setReceiveIcon(null,"receive")}}function u(){var v=this;if(v.syncIds.length>0){$.Array.each(v.syncIds,function(y,x){var w=t.get({id:x});if(w){l.setReceiveIcon(w.fid,"receive")}});v.syncIds=[]}l.setReceiveIcon(null,"receive");return true}function o(v,B){var A;switch(v){case"begin":A="邮件收取中..";$.Tips.loading(A);break;case"run":A="正在收取";if(B.all>0){A+=(B.received+B.skip+"/"+B.all+" 封邮件...")}else{A+="邮件..."}$.Tips.show(A);break;case"end":$.Tips.loading();A="收取完成！共收到"+B.received+"封邮件";if(B.skip){A+="，"+B.skip+"封邮件不在收取范围内，已跳过&nbsp;";A+=!e?('<a href="'+Uri.getUrl("pop3_skip_info",true)+'"  target="_blank">查看详情&gt;&gt;</a>'):""}var D=5000;var y=[];if(B.error&&B.error.length>0){var C=B.error.length;D=12000;A+="，部分帐号收取失败，";var z='<div class="nui-simpleTable nui-table nui-scroll">';var w;for(var x=0;x<C;x++){z+='<table><tbody class="nui-table-body"><tr class="nui-table-row"><td class="nui-table-cell">邮箱：<strong>'+B.error[x][0]+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;"+(Context.module.mtype=="mailcenter.MailCenterModule"?"":new $.Link({text:"编辑",cls:"nui-txt-link",click:$.Function.bind(function(E){w&&w.hide();JS5.go({module:"mailcenter.MailCenterModule"})},null,B.error[x][1])}).html())+'</td></tr></tbody></table><div class="nui-table-footerTips nui-normalTips nui-tips nui-normalTips-err">对方服务器拒绝、或用户名密码不正确，收取失败</div>';z+=(x==(C-1)?"":'<div class="nui-split nui-split-cDark nui-split-dotted"></div>')}z+="</div>";y=[{xtype:"link",text:"查看详情",click:function(){$.Tips.show({});if(w){w.show()}else{w=$.Msgbox.show({extcls:"px",header:"查看详情",contentType:"wide",content:z,listeners:[{name:"render",handler:function(){Component.setEvents()}}]})}}}]}$.Tips.show({succ:true,text:A,items:y,expires:D});break;default:break}}function b(w,v,B){var x=this;if(this.initAction()==Loader.LOADFAILED){return}var C=x.get(w);if(C){var A={id:C.id};$.Object.each(v,function(D,E){A[D]=E});var y={param:A,callback:z};x.action.update(y)}function z(E){var D=E.code;if(D==S_OK){$.Object.each(v,function(F,G){C[F]=G})}if(B){B(E)}}}function s(x,B){var z=this;var C=x;var y=B;if(!C||typeof y!="function"){return}var A=z.POP3_SERVER[C];var w=[];var E={};if(A){E.pop=A;if($.Array.has(z.SSL_SERVER,A)){E.port=995}else{E.port=110}w.push(E);y(w)}else{var v=Uri.getUrl("pop3_server",true)+"?email=abc@"+C;$.Ajax.jsonp(v,D)}function D(F){if(F&&F.length>0){y(F)}}}function q(v){var w=$S("attrs").popAccounts;return $.Array.has(w,function(x){if(x.username.toLowerCase()==v&&x.type=="none"){return true}})}function k(v){var x=$S("attrs").popAccounts;var w;$.Array.each(x,function(y,z){if(z.username.toLowerCase()==v){w=z.id}});return w}function g(w){var v=$S("attrs").popAccounts;v.push(w);this.dataChange=true}function a(z,x){var w=$S("attrs").popAccounts;var y=[];var v=false;$.Array.each(w,function(B,A){if(A.id==z.id){if(x){A=z}else{$.Object.each(z,function(C,D){A[C]=D})}v=true;throw $.BREAK}});this.dataChange=true;return v}function c(z){var w=$S("attrs").popAccounts;var y=[];var x=null;var v=-1;$.Array.each(w,function(B,A){if(A.id==z.id){v=B;x=z;throw $.BREAK}});if(v>=0){w.splice(v,1)}this.dataChange=true;return x}function p(v){var w=$S("attrs").popAccounts;return $.Array.has(w,function(x){if(x.username.toLowerCase()==v){return true}})}function j(){try{var v=$L("support.MailCenterAction",this,arguments.callee.caller,arguments.callee.caller.arguments)}catch(w){return w}if(!this.action){this.action=new v()}}})();(function(){var e=$I("core.DataAction"),b=$.createClass($N("support.OptionSupportAction"));$.Object.inherit(b,e);$.Object.extend(b.prototype,{getSignList:f,addMailFilter:d,getMailFilter:c,getAutoReply:a});function f(g){var h;if(Ext.signFilter){h={filterHtml:true}}else{h={}}this.wmsvr({func:"user:getSignatures",body:h,call:function(i){g(i["var"])},error:function(){g(false)}})}function d(h,j){var i=this;var g=function(l){if(l["var"].length>=h.limit){j({overflow:true});return}var k={items:[{name:h.name,disabled:false,"continue":true,condictions:[{field:"from",disabled:false,operator:"contains",operand:h.operand,ignoreCase:false},{field:"accounts",disabled:false,operator:"contains",operand:h.accounts}],actions:[{type:"move",disabled:false,target:h.fid}]}]};i.wmsvr({func:"user:addMailRules",body:k,call:j})};i.wmsvr({func:"user:getMailRules",body:{},call:g})}function c(h){var g=this;g.wmsvr({func:"user:getMailRules",body:{},call:function(i){if(h){h(i["var"])}}})}function a(g){this.wmsvr({func:"global:sequential",body:{items:[{func:"user:getAttrs","var":{attrIds:["autorepmode","autoreptext"]}},{func:"user:getMailRules","var":{category:"autoreply"}}]},call:g})}})();(function(){try{var l=$L("support.OptionSupportAction")}catch(i){return i}var g=$I("core.DataAction"),e=$.createClass($N("support.OptionSupport"));$.Object.extend(e,{action:new l(),setAttr:q,getSignList:b,addList:f,removeList:a,getDefinedSenders:j,setName:d,setDefSender:s,addMailFilter:c,getFliterLimit:m,getFliterData:o,searchFilter:k,isRefuse:h,getForwardAddr:n,getAutoReply:r,isLowAntiSpamLevel:p});function q(u){var v=$S("attrs").user,x=$.Object.clone(u),B=false,y=v[x.field],z;if(x&&x.flag){if(x.flag=="translate"){var z=y.substr(0,2)+x.value+y.substr(3);v.ntes_labs=z;if(($S("is126")||$S("is163"))&&v.ntes_labs!=undefined){Ext.readTran=((v.ntes_labs.charAt(2)-0)>0);$.Ajax.request({url:"http://lab.mail."+$S("domain")+"/labweb/lab.do?m=submit&id=2&act="+(Ext.readTran?"enable":"disable")+"&uid="+$S("uid")+"&sid="+$S("sid")+"&host="+$S("host"),requestType:Ajax.SCRIPT,paddingParam:"jsonp",paddingFunc:function(){}})}}else{z=Ud.set({field:x.field,flag:x.flag,value:x.value,notPost:true})}}else{z=x.value}if(z!=y){B=true}if(!B){return}var w={};w[x.field]=z;this.action.wmsvr({func:"user:setAttrs",body:{attrs:w},call:A,error:t});function A(){v[u.field]=z;if(u.callback){u.callback(u)}if(u.call){u.call(u)}var E=u.module;if(E&&!u.noFire){Listener.fire("options:"+E+"Modify",[u])}else{Listener.fire("options:modify",[u])}if(u.relModule&&u.relModule.length>0){for(var D=0,C=u.relModule.length;D<C;D++){Listener.fire("options:"+u.relModule[D]+"Modify",[u])}}}function t(){v[u.field]=y;if(u.err){u.err(u)}if(u.errcallback){u.errcallback(u)}}}function b(v,u){if(u||!e.signList){e.action.getSignList(t)}else{v(e.signList)}function t(w){if(w){e.signList=w;if(!Ext.signFilter){for(var x=0;x<e.signList.length;x++){e.signList[x].content=e.signList[x].content.replace(/<iframe.+?<\/iframe>/i,"")}}}v(w)}}function f(u,B){function D(J){return/^\S+\.\S+$/.test(J)||Uri.matchEmail(J)}function v(J){if(J.length>0){var K=J.split(","),N=[],M;for(var L=K.length-1;L>=0;L--){M=$.String.trim(K[L]);if(D(M)){N.push(M)}}return N}else{return[]}}var y=u.name,F=u.value,I=$S("attrs").user[y]||"",t;if(y=="refuselist"){t=$S("attrs").user.safelist}else{t=$S("attrs").user.refuselist}var C=v(I),E=v(t),x=v(F),G=true,A,H="添加失败。";for(var w=0;w<x.length;w++){A=x[w];if(!D(A)){H+=A+"不是合法的Email地址或域名。<br/>"}else{if($.Array.has(C,A)){H+=A+"已经存在。<br/>"}else{if((I+A).length>4000){var z=y=="safelist"?"白":"黑";H+=z+"名单超过限制。<br/>"}else{if(!(y=="refuselist"&&A==$S("uid"))){if($.Array.has(E,A)){if(u.forceAdd){e.removeList({name:(y=="refuselist"?"safelist":"refuselist"),value:A})}else{var z=y=="safelist"?"黑":"白";new $.Msgbox({title:$.String.escapeHTML(A)+"已经存在于"+z+"名单中，请先在"+z+"名单中删除后再添加。"});B&&B(false);return}}C.push(A);G=false}}}}}if(G){if(!u.noErr){new $.Msgbox({title:H})}if(typeof B=="function"){B(false)}return}I=C.join(",");Ud.set({field:y,value:I,call:function(J){if(J.code==g.S_OK){$S("attrs").user[y]=I;B(true,F)}else{B(false)}}})}function a(u,y){var x=u.name,v=u.value,t=$S("attrs").user[x];var w=function(C,D){D=$.String.trim(D);var z=t.length>0?t.split(","):[];for(var A=0,B=z.length;A<B;A++){if($.String.trim(z[A])==D){z.splice(A,1);break}}t=z.join(",")};if(t.length>0&&v.length>0){$.Array.each(v.split(","),w)}Ud.set({field:x,value:t,call:function(z){if(z.code==g.S_OK){$S("attrs").user[x]=t;y(true)}else{y(false)}}})}function j(v){function t(y){if(y&&y.length>0){var A=[];for(var z=0;z<y.length;z++){var B=Uri.getEmails(y[z],"Email").match[0];if(B){A.push(B)}else{A.push({address:y[z],name:""})}}return A}else{return null}}var u=$S("attrs").senders;if(u){var w=t(u.audited);if(v){var x={};x.audited=w;x.unaudited=t(u.unaudited);return x}return w}else{return null}}function d(t,u){$E(["module.options.CommonAction"],function(v){v.setAttrs({attrs:{true_name:t,displaysender:0},call:function(w){var x=$S("attrs").user;x.true_name=t;x.displaysender=0;u(true)},error:function(){u(false)}})})}function s(t,u){Ud.set({field:"ntes_defaultsender",value:t,call:function(v){if(v.code==g.S_OK){$S("attrs").user.ntes_defaultsender=t;u(true)}else{u(false)}}})}function c(u){var v=this;v.action.addMailFilter({name:u.name,fid:u.fid,operand:u.email,accounts:u.accounts||[$S("uid")],limit:v.getFliterLimit()},t);function t(w){if(w.overflow){new $.Msgbox({type:"confirm",title:"设置出错",content:"抱歉，来信分类规则条数达到上限，无法收取指定联系人邮件到此文件夹。<br/>建议您进行整理，删除可能无用的规则。",okText:"立即整理",ok:function(){$E(["interface.OptionInterface"],function(y){y.goFilter()})}});return}var x=JS.modules["options.MailFilterModule"];if(w.code==g.S_OK&&x&&x.isLoaded){x.getData(x.list.bind(x))}if(u.callback){u.callback({code:w.code})}}}function m(){if($S("isCorp")){return 80}var u=gUser.cosid||"";var t="";switch($S("domain")){case"vip.163.com":t=",72,6,73,7,91,90,";break;case"188.com":t=",93,34,94,35,";break;case"vip.126.com":t=",26,25,28,27,30,29,";break}return(t.length>0&&t.indexOf(","+(u+","))>-1)?60:30}function o(t){this.action.wmsvr({func:"user:getMailRules",body:{},call:t})}function k(w,v){var u=JS.modules["options.MailFilterModule"];var t=function(y){var z=[],x;$.Array.each(y,function(A,B){x=B.actions;switch(w.type){case"forward":$.Array.each(x,function(C,D){if(D.type==="forward"){z.push(B.id);throw $.$.BREAK}});break}});v(z)};if(u&&u.data){t(u.data)}else{this.action.getMailFilter(t)}}function h(v){var u=$S("attrs").user.refuselist;function x(y){return u.indexOf(y)}var w;var t;if(typeof v=="string"){w=v;t=w.substring(w.indexOf("@"))}else{w=v.address;t=v.domain}t="*"+t;return x(w)==0||x(","+w)>=0||x(" "+w)>=0||x(t)>=0}function n(){var t=$S("attrs").user;if(t.forwardactive!=1&&t.forwardactive!=2){return null}else{return t.forwarddes}}function r(u){var v={};e.action.getAutoReply(t);function t(x){var A=x["var"],I=A[0]["var"]||[],E=A[1]["var"]||[];var C=null,J=E.length;if(J==1){C=E[0]}else{if(J>1){var G=null;for(var B=0,J=E.length;B<J;B+=1){G=E[B];if(!G.disabled){C=G}}C=C?C:G}}var y=0,K,z;if(I.autorepmode==1||!C){y=I.autorepmode||0;var D=I.autoreptext;if(y==1&&D){v.autoReplayCont=D}}else{var w=C.condictions[0]||{};var H=C.actions[0]||{};y=typeof C.disabled!="boolean"?1:C.disabled?0:1;var F=H.content;if(y==1&&F){v.autoReplayCont=F}if(typeof w!=="undefined"&&typeof w.operand!=="undefined"){var L=w.operand;v.operator=w.operator;if(y==1){switch(w.operator){case"between":K=L[0];z=L[1];break;case">":K=L;break;case"<":z=L;break}}}}if(y==0){v.autoReplyActive=false}else{v.autoReplyActive=true;v.start=K;v.end=z}if(!!u&&typeof u.call==="function"){u.call(v)}}}function p(){var u=$S("attrs").user;var t=false;if(u.junkfilter==null){u.junkfilter=0}var x=u.keepspamdays;x=x>=-1?x:-1;var v=u.junkfilter;v=v>-1?v:1;if(x>0&&v==0){t=true}if(!t&&Ext.deliver){var w=Ud.get({field:"ntes_option",flag:"deliver"})-0;if($.Number.getBit(w,0)!=0||$.Number.getBit(w,1)!=0||$.Number.getBit(w,2)!=0){t=true}}return t}})();(function(){try{var j=$L("support.MailCenter");var m=$L("support.OptionSupport")}catch(f){return f}var g=$.createClass($N("support.SenderList"));$.Object.extend(g,{getAll:o,getList:p,getUid:h,getVip:b,getMobileVip:a,getPop3:q,getDefined:n,getMobile:i,getCorpAlias:d,getDefault:c,isSender:k,getAccount:l,getName:e});function o(){var r=this;var s={uid:r.getUid(),vip:r.getVip(),getMobileVip:r.getMobileVip(),pop3:r.getPop3(),defined:r.getDefined(),mobile:r.getMobile(),corpAlias:r.getCorpAlias(),"default":r.getDefault(true)};return s}function p(){var B=this;var F=[];var z=B.getName();F.push(B.getUid());var w=B.getVip();if(w){F.push(w)}var v=B.getMobile();if(v){F.push(v)}if(w&&v){var r=B.getMobileVip();if(r){F.push(r)}}var C=B.getPop3();if(C){F=F.concat(C)}var D=B.getDefined();if(D){F=F.concat(D)}if($S("isCorp")){var x=B.getCorpAlias();if(x){F=F.concat(x)}}var t={};var s=[];for(var y=0,u=F.length;y<u;y++){var A=F[y];if(A&&A.address){var E=A.address.toLowerCase();if(!t[E]){t[E]=true;s.push(A)}}}return s}function h(){var r=$S("showMobileAccountOnly")?$S("uid"):$S("orgUid");return new Email(r,this.getName())}function b(){if($S("is188")&&$S("member").is188vip){var r=$S("user")+"@vip.188.com";var s=this.getName();return new Email(r,s)}return null}function a(){if($S("is188")&&$S("member").is188vip){var s=this.getMobile();if(s){var r=s.address.split("@")[0]+"@vip.188.com";var t=s.name;return new Email(r,t)}}return null}function q(){return j.getSender()}function n(){return m.getDefinedSenders()}function i(){var r=$I("util.Misc").getMobile();if(r){return new Email(r,this.getName())}else{return null}}function d(){if($S("isCorp")){var r=gAttrs.alias;if(r&&r[0]&&r[0].aliases){var t=[];var s=r[0].aliases;var v=this.getName();for(var u=0;u<s.length;u++){var w=new Email(s[u].id,v);t.push(w)}return t}}return null}function c(){var v=$S("attrs").user.ntes_defaultsender;if(v){v=v.toLowerCase();var t=this.getList();for(var u=0,s=t.length;u<s;u++){if(t[u].address.toLowerCase()==v){return t[u]}}}v=$S("mobile_sender")||$S("uid");if($S("is188")&&$S("member").is188vip){var r=Ud.get({field:"ntes_defaultaccount"});if(r&&r!="0"){v=$S("user")+"@vip.188.com"}}return new Email(v,this.getName())}function k(t){var s=this;t=t.toLowerCase();var u=null;var r=s.getList();$.Array.each(r,function(v,w){if(t==w.address.toLowerCase()){u=w}});return u}function l(){return new Email($S("uid"),this.getName())}function e(){var s=$S("attrs").user;var w=s.displaysender;var v=s.true_name;var r=s.nick_name;var u;if(w==1&&r){u=r}else{u=v||$S("uid").split("@")[0]}var t=[String.fromCharCode(92)+String.fromCharCode(92)];u=u.replace((new RegExp('["/'+t[0]+"]","g")),"");return u}})();(function(){var b=$.Object;var e=$.createClass($N("support.CloudSupport"));b.extend(e,{init:h,response:d,active:c,setUser:g,getUrl:f,getProduct:a});function h(j){if($S("cloud")&&!j){return}var i=e.getUrl();i+="?sid="+$S("sid");i+="&uid="+$S("orgUid");i+="&op=fs_b_g_a";i+="&p="+e.getProduct();$.Ajax.request({url:i,paddingParam:"ev",paddingFunc:e.response,requestType:$.Ajax.SCRIPT})}function d(i,j){if(i==200){if(j&&j.account){e.setUser(j)}}else{if(i==402){e.active()}}}function c(){if($S("cloudActive")){return}else{$S("cloudActive",true)}var i=Uri.getUrl("compose_club");i=$.String.addParam(i,"op=fs_active");$.Ajax.request({url:i,paddingParam:"callback",requestType:$.Ajax.SCRIPT,paddingFunc:function(k){var j=k.code;if(j==200){e.init()}}})}function g(j){$S("cloud",j);try{var i=Context.getModule();if(i&&i.mtype=="compose.ComposeModule"){i.attach.cloudShowSize()}}catch(k){}}function f(){var j=$S("domain");var i="fs.163.com";if(j=="163.com"){i="fs.mail.163.com"}else{if(j=="126.com"){i="fs.mail.126.com"}else{if(j=="yeah.net"){i="fs.mail.yeah.net"}else{if(j=="vip.163.com"){i="fs.vip.163.com"}else{if(j=="vip.126.com"){i="fs.vip.126.com"}else{if(j=="188.com"){i="fs.vip.188.com"}}}}}}var k="http://"+i+"/fs/service/";return k}function a(){var i=$S("domain");var j="";if(i=="163.com"){j="163mail"}else{if(i=="126.com"){j="126mail"}else{if(i=="yeah.net"){j="yeahmail"}else{if(i=="vip.163.com"){j="163vipmail"}else{if(i=="vip.126.com"){j="126vipmail"}else{if(i=="188.com"){j="188vipmail"}}}}}}return j}})();(function(){var d=window.$,b=window.Uri,a=netease.mail.base,c,i;var g=a.Object;var k=a.createClass($N("interface.AddressInterface"));g.extend(k,{entry:e,directEntry:j,search:l,contactModify:m,contactRefresh:h,mergeCall:f});function e(o){var p=Context.getModule();if(p&&p.name.indexOf("contact.ContactModule")>=0){p.cache("welcome",o)}else{var n=JS5.find("contact.ContactModule_0");if(n){JS5.go({module:"contact.ContactModule",param:{}});n.cache("welcome",o)}else{JS5.go({module:"contact.ContactModule",param:{},__other:o})}}}function j(n){if(n){this.entry({action:n})}}function l(p){if(!p){return}var n=Context.getModule()||{};var o={action:"Search",key:p};if(n.name.indexOf("contact.ContactModule")>=0){n.entryCall(o);return}this.entry(o)}function m(o){var n=Context.getModule()||{};var p={action:o.id?"Modify":"Add",id:o.id,data:o?{FN:o.name||"",N:";"+(o.name||"")+";;;",NICKNAME:o.nickname||"","EMAIL;PREF":o.email||"","TEL;type=CELL;type=VOICE;type=pref":o.phone||"",GROUPING:o.grouping||""}:null};if(n.name=="contact.ContactModule"){n.entryCall(p);return}this.entry(p)}function h(p,o){if(p){var n=JS5.find("contact.ContactModule_0");if(n){n.action.reflash({call:function(){Nav.update();Nav.getModule(n)}})}}}function f(n){try{Context.getModule().response.mergeResponse(n)}catch(o){}}})();(function(c,b,e){var a=c.createClass($N("interface.AppCenterInterface"));c.Object.extend(a,{entry:d});function d(f){var g=c.Array.findObject(b.gTabConf,"tabid","t2")||{};$E("interface.OutlinkInterface",function(h){h.goOutlink({key:g.name,title:g.text,fullScreen:g.fullScreen,group:g.group})})}})($,window);(function(){var b=$.createClass($N("interface.AppInterface"));$.Object.extend(b,{meitu:{compose:a}});function a(c){$E("interface.ComposeInterface",function(d){d.entry(c)})}})();(function(){var h=$.Object;var f=$.createClass($N("interface.ComposeInterface"));h.extend(f,{refreshAddress:c,connectBreak:j,quickReply:b,quickForward:d,draft:k,edit:e,reply:a,forward:g,compose:i,entry:i});function c(){var l=Context.getModule();if(l&&l.mtype&&l.mtype=="compose.ComposeModule"){l.address.refresh()}}function j(){var l=Context.getModule();if(l&&l.mtype&&l.mtype=="compose.ComposeModule"){l.base.connectBreak()}}function b(l){try{var m=$L("module.compose.ComposeManager")}catch(n){return n}m.quickReply(l)}function d(l){try{var m=$L("module.compose.ComposeManager")}catch(n){return n}m.quickForward(l)}function k(l){var m=this;m.entry({type:"draft",param:l})}function e(l,n){var m=this;m.entry({type:"edit",param:l,history:n})}function a(l,n){var m=this;m.entry({type:"reply",param:l,history:n})}function g(l,n){var m=this;m.entry({type:"forward",param:l,history:n})}function i(n){try{var l=$L("module.compose.ComposeManager")}catch(m){return m}l.entry(n)}})();(function(){var c=$.createClass($N("interface.MailCenterInterface"));$.Object.extend(c,{entry:a,related:b});function a(d){if(typeof d=="string"){d={type:d}}JS5.go({module:"mailcenter.MailCenterModule",param:d})}function b(d){if(typeof d=="string"){d={type:d}}var e=JS5.get("options.AccountCenterModule",{});if(e){try{e._var["extra"]=d}catch(f){}}JS5.go({module:"options.AccountCenterModule",param:{},extra:d,reset:false})}})();(function(){var w=$.Object;var s=$.Array;var o=$.createClass($N("interface.MboxInterface"));w.extend(o,{getList:t,getPosition:v,getLetterData:c,getSendInfo:d,setRead:i,setFlag:j,setTag:b,setTop:r,setMemo:n,setFilter:e,setAllRead:a,move:p,setSpam:k,search:m,related:h,title:f,setReFw:u,brandLoad:q,syncData:l,entry:g});function t(y){try{var x=$L("module.mbox.ListAction",this)}catch(z){return z}if(!y.fid){y.fid=0}(new x()).getList(y)}function v(y){try{var C=$L("module.mbox.ListModule",this)}catch(B){return B}var I=y.moduleName;var D=JS5.find(I);var A=y.data,J=y.callback;if(!D){J();return}var E=D.fid;var G=A.id;var z=D.index;var F=D.limit;if(E==-1){H()}else{x()}function x(){var P=D;if(P&&P.data){var R=P.data;var U=-1;var N=P.getTotal();for(var S=0,O=R.length;S<O;S++){var Q=R[S];if(Q&&Q.id==G){U=S;break}}if(U>-1){var M,K;if(U>0&&z>0&&!R[U-1]){M=true}if(U<N-1&&!R[U+1]){K=true}if(M||K){L()}else{T()}}else{J()}}else{J()}function L(){var Y,X,W;var X=(F-(U+1)%F)%F;if(M){Y=z-1;W=Y*F}if(K){Y=z+1;W=Y*F-X}var V=w.clone(P._var.param);w.extend(V,{limit:F+X,start:W,callback:T});P.getList(V)}function T(){var W={pos:U};var V,X;if(U>0){V={moduleName:P.name,folderData:R[U-1]}}if(U<N-1){X={moduleName:P.name,folderData:R[U+1]}}W.pre=V;W.next=X;J(W)}}function H(){var M=D;var Q=M.result;if(M&&Q){var V=Q["var"];var S=-1;var U=V.length;for(var P=0,O=U;P<O;P++){var L=V[P];if(L==G||L.id==G){S=P;break}}if(S>-1){var N,K;if(S>0&&typeof V[S-1]=="string"){N=true}if(S<U-1&&typeof V[S+1]=="string"){K=true}if(N||K){R()}else{T()}}else{J()}}else{J()}function R(){var ab,ac;var ad=M.limit;if(N){var Y=S-1;var ab=Math.floor(Y/ad)*ad}if(K){var W=S+1;var ac=Math.floor(W/ad+1)*ad}if(!ab){ab=ac-ad}if(!ac){ac=ab+ad}var aa=[];for(var X=0;X<U;X++){if(X<ab){continue}if(X>=ac){break}var Z=V[X];aa.push(Z.id||Z)}M.action.searchList({ids:aa,start:ab,callback:T})}function T(){var W={pos:S};if(S>0){W.pre={moduleName:M.name,folderData:V[S-1]}}if(S<U-1){W.next={moduleName:M.name,folderData:V[S+1]}}J(W)}}}function c(A){try{var x=$L("module.mbox.ListModule",this)}catch(E){return E}var z=A.mid,D=A.isThread,C=A.callback;x.action.getLetterInfo({id:z,isThread:D,callback:B,error:y});function B(F){C(F)}function y(F){C(null,F);return true}}function d(A){try{var x=$L("module.mbox.Letter",this)}catch(z){return z}var y=new x(null,A);return y.getSendInfo(A)}function i(y){try{var x=$L("module.mbox.ListModule",this)}catch(z){return z}var A=y.data;if(A.flags.read^y.isRead){y.data=[A];x.setRead(y)}else{}$S("lastRead",A.id)}function j(y){try{var x=$L("module.mbox.ListModule",this)}catch(z){return z}if(y.data.label0^y.flag){y.data=[y.data];x.setFlag(y)}else{}}function b(B){try{var A=$L("module.mbox.ListModule",this)}catch(C){return C}var x=B.data.tag;var z=B.tag;var y=false;if(B.isAdd){y=!(x&&s.has(x,z))}else{y=!z||(x&&s.has(x,z))}if(y){B.data=[B.data];A.setTag(B)}}function r(z){try{var y=$L("module.mbox.ListModule",this)}catch(A){return A}var x=z.isTop,B=z.data;if(!!x^!!B.flags.top){z.data=[B];y.setTop(z)}else{}}function n(z){try{var x=$L("module.mbox.ListModule",this)}catch(A){return A}var y=z.memo,B=z.data;if(B.memo!=y){x.setMemo({memo:y,data:[B]})}else{}}function e(A){try{var z=$L("module.mbox.ListAction",this);var y=$L("module.mbox.ListModule",this)}catch(C){return C}var x=A.ruleConditions,B=A.callback;y.setFilter({ruleConditions:x,callback:B})}function a(A){try{var y=$L("module.mbox.ListModule",this)}catch(C){return C}var x=$I("init.Folder");var z=A.fid;var B=x.isThread(z);y.setAllRead({fid:z,isThread:B})}function p(A){try{var x=$L("module.mbox.ListModule",this)}catch(C){return C}var z=this;var D=A.data;var y=A.moveToId;var B=($I("init.Folder").isThread()&&(D.threadMessageCount>1||D.fid==3))||A.isThread;if(D.fid!=y){A.data=[D];x.move(A)}else{}}function k(z){try{var x=$L("module.mbox.ListModule",this)}catch(A){return A}var y=z.isSpam;var B=z.data;z.data=[B];x.setSpam(z)}function m(y){try{var B=$L("module.mbox.SearchModule",this);var F=$L("module.mbox.SearchView",this)}catch(C){return C}var z=$I("init.Folder");var G=y.isFullSearch;var E=y.keyword;var D={};if(G){var A=$I("init.Folder").total.messageCount;var x=$S("searchIndexed");if(x>=0){try{if((x/A)<0.9){G=false}}catch(C){}}}if(G){D.pattern=E;D["fts.ext"]=true;D["fts.fields"]=F.getSearchFields(),D.groupings={fromAddress:"",fid:"",sentDate:"","flags.attached":"","flags.read":""}}else{D.operator="or";D.condictions=[{field:"subject",operator:"contains",ignoreCase:true,operand:E},{field:"from",operator:"contains",ignoreCase:true,operand:E},{field:"to",operator:"contains",ignoreCase:true,operand:E}]}this.entry({searchVars:D})}function h(F){try{var C=$L("support.SenderList",this)}catch(B){return B}var y=$I("init.Folder");var E={};var x=E.fid=[];s.each(y.list(),function(I,J){if(J.id!=4){x.push(J.id)}});E.operator="or";var z=E.condictions=[];var H=C.getList();for(var D=0,A=H.length;D<A;D++){G(H[D].address)}this.entry({searchVars:E});function G(I){z.push({operator:"and",condictions:[{field:"from",operator:"contains",operand:F,ignoreCase:true}]});z.push({operator:"and",condictions:[{field:"to",operator:"contains",operand:F,ignoreCase:true},{field:"from",operator:"contains",operand:I,ignoreCase:true}]})}}function f(y){var z=$I("init.Folder");var A={};var x=A.fid=[];s.each(z.list(),function(B,C){x.push(C.id)});A.condictions={field:"subject",operator:"contains",operand:y,ignoreCase:true};this.entry({searchVars:A})}function u(z,y){if(!$S("refw")){$S("refw",{})}var x={};if($S("refw")[z]){x=$S("refw")[z]}else{$S("refw")[z]=x}x[y]=true}function q(y,x){if(!(y&&x)){y=$S("brandAd");x=$S("brandData")}else{$S("brandAd",y);$S("brandData",x)}if(!(y&&x)){$.Ajax.jsonp("http://mimg.127.net/m/subs/brands_"+gEnvironment.domain.split(".")[0]+".js")}else{try{setTimeout(function(){Context.getModule().initBrand()},0)}catch(z){}}}function l(y,A){var x=y.type,D=y.value;switch(x){case"read":A.flags.read=D;break;case"flag":A.label0=D;break;case"tag":var F=y.isAdd,z=D;var E=A.tag;if(F){if(!E){A.tag=E=[]}if(!$.Array.has(E,z)){E.push(z)}}else{if(z){for(var C=0,B=E.length;C<B;C++){if(E[C]==z){E.splice(C,1);break}}}else{A.tag=E=[]}}break;case"memo":A.memo=D;break;case"top":A.flags.top=D;break;case"move":A.fid=D;break}}function g(y,A,J){if(J&&!w.isFunction(J)){J=undefined}if(y){if(typeof y=="string"){y={module:y}}var I=y.module;if(I=="folder"){JS5.go({module:"options.FolderTagModule"})}else{if(I=="tag"){JS5.go({module:"options.FolderTagModule"})}else{var G;try{G=JS5.find(y.moduleName)}catch(E){}if(G){G._var.call=J;G._var.useCache=true;JS5.go(G)}else{try{var F=$L("module.mbox.ListModule",this);var C=$L("module.mbox.SearchModule",this)}catch(E){return E}if(!y.fid){y.fid=y.searchVars?-1:0}if(!y.order){y.order="date"}if(typeof y.desc=="undefined"){y.desc=true}if(!!y.desc){y.desc=true}else{y.desc=false}if(w.count(y.filterFlags)==0){y.filterFlags=undefined}if(w.count(y.filter)==0){y.filter=undefined}if(w.count(y.tag)==0){y.tag=undefined}if(!A){A={}}if(!A.index){A.index=0}var H=y.fid;if(y.fid<1){var D;if(H==0){D=y.fids}else{D=y.searchVars.fid}if(!D){var x=y.exceptFids;D=[];var z=$I("init.Folder");var B=z.list();s.each(B,function(K,M){var L=M.id;if(L!=4&&L!=6){if(!x||!s.has(x,L)){D.push(L)}}});if(H==0){y.fids=D}else{y.searchVars.fid=D}}}if(y.fid==-1){C.entry(y,A,J)}else{Log.cache({mboxentry:y.fid});F.entry(y,A,J);if(A.receive){var z=$I("init.Folder");z.checkMail();$E("support.MailCenter",function(K){K.receiveAll()})}}}}}}else{JS5.go({module:"options.FolderTagModule"})}}})();(function(){var c=$I("core.DataAction");var j=$.createClass($N("interface.OptionInterface"));$.Object.extend(j,{entry:k,showSignList:h,changeStyle:b,goOutlink:e,goFilter:f,refreshFilter:i,goSearch:d,checkFilterLimit:a,changePassword:g});function a(l){$E(["module.options.MailFilterModule"],function(m){m.checkOverLimit(l)})}function k(o){try{var v=$L("module.options.NavConf",this)}catch(q){return q}var x,n=typeof o;var u=v.oldModConfig.subModules;if(n=="string"){if(o.indexOf("optionOutLink.")>=0||o.indexOf("LinkModule.")>=0){var z=o.replace("optionOutLink.","").replace("LinkModule.","");o={linkName:z}}else{x=o;if(x=="options.MainModule"||x=="MainModule"){x="BaseSetModule"}else{if(x=="options.AccountManage"||x=="AccountManage"){x="AccountManageModule"}}if(arguments.length>1){o=arguments[1]}else{o={}}if(x.indexOf("#")>=0){var t=x.split("#");x=t[0];if(t.length>1){t=t[1].split("&");var y;for(var s=0,r=t.length;s<r;s++){y=t[s].split("=");o[y[0]]=y[1]}}}}}else{if(n=="undefined"){x="BaseSetModule"}else{x=o.module;delete o.module}}if(o&&o.link){o.subModName=x;x="LinkModule"}if(o&&o.linkName){var w=o.linkName;delete o.linkName;var m=w.split("#");o.subModName=m[0];if(m.length>1){o.linkext=m[1]}if(!u[o.subModName]){for(var p in u){if(u[p].link&&u[p].link==o.subModName){o.subModName=p;break}}}if(u[o.subModName]){o.link=u[o.subModName].link}x="LinkModule"}if(x.indexOf(".")<0){x="options."+x}if(o&&o.exit){delete o.exit;JS5.go({module:x,param:o,exit:true})}else{JS5.go({module:x,param:o})}}function h(l){$E(["module.options.RecommendSignlist"],function(m){m.show(l)})}function b(m){var l=21;if(m=="jy5"||m=="jy5s"){l=3}if(m=="jy3"){l=10}if(m=="js4"){l=8}var n=function(r){if(m=="jy3"){var p=top.location.href+"&rnd="+Math.random();p=p.replace("js5/main.jsp","jy3/main.jsp");top.location.href=p.replace(/rnd=.+/,"rnd="+Math.random())}else{if(m=="js4"){var p=top.location.href+"&rnd="+Math.random();p=p.replace("js5/main.jsp","js4/main.jsp");top.location.href=p.replace(/rnd=.+/,"rnd="+Math.random())}else{if(m=="jy5"||m=="jy5s"){var q=m=="jy5s"?top.location.href.replace("http://","https://"):top.location.href;var p=q+"&rnd="+Math.random();p=p.replace("js5/main.jsp","jy5/main.jsp");top.location.href=p.replace(/rnd=.+/,"rnd="+Math.random())}}}};new c().wmsvr({func:"user:changeStyle",body:{style:l,language:(parseInt($S("attrs").user.langauge,0)||0)},call:n})}function e(m){var l={link:m};JS5.go({module:"options.LinkModule",param:l})}function f(l){if(l){l.type="edit";if(l.id){l.type="modify"}}else{l={type:"list"}}var m=Context.getModule();if(m&&m.name=="options.MailFilterModule"){m.nav(l)}else{JS5.go({module:"options.MailFilterModule",param:l})}}function i(){var l=Context.getModule();if(l&&l.name=="options.MailFilterModule"){l.resetDependPart()}}function d(l){JS5.go({module:"options.SearchModule",param:{type:l}})}function g(){window.open("https://reg.163.com/setinfo/ChangePwd_1.jsp","_blank")}})();(function(){var a=$.createClass($N("interface.OutlinkInterface"));$.Object.extend(a,{entry:d,goOutlink:c,getFrame:e,getModule:b});function d(f){if(f.key=="apps_blog"){window.open(f.url);return}if(f.key=="apps_shop"){window.open(f.url);return}if(f.key=="nf_center"&&(!f.group||f.group=="nf_center")){$E("product.FileCenter",function(g){g.entry("nf_center")});if(f.url){f.url+="&redirect=false&retype=0";Ajax.request({requestType:Ajax.IFRAME,url:f.url})}return}$E("module.outlink.OutlinkModule",function(){if(f.url&&f.url.indexOf("$")>-1){f.url=Uri.getUrl(f.url,true)}JS5.go({module:"outlink.OutlinkModule",param:f,useParam:{key:true,url:true,cross:true}});var k=Context.getModule();if(f._call){f._call(k)}if(f.key=="weibo"){try{var i=$("#spnDockNew");var g=$("#dvDock").find("#dvNew_22");if(i){i.hide()}if(g){g.hide()}var h=($.Component.find("$title$邮箱应用")||[])[0];if(h){h.getEl().find(".nui-tabs-item-status").hide()}$.Cookie.set("checkWeibo","1","/",$S("fullDomain"),new Date(new Date().valueOf()+(1000*60*5)).toGMTString())}catch(j){}}})}function c(k){if(k.lockid){oAdvLock=$S("advLock");if(oAdvLock[k.lockid]&&!oAdvLock.authenticated2){var m={};$.Object.extend(m,k);delete m.lockid;AdvLock.show($.Function.bind(a.goOutlink,a,m));return}}var q=(k.key+"")||"outlink",p=(window.gTitlesFix&&gTitlesFix[q])||k.title||(Uri.getUrlObj(q)||{}).title||"其它",n=k.listen,g=k.param;if(k.url&&k.url.indexOf("$")>-1){k.url=Uri.getUrl(k.url,true)}var h=k.url||Uri.getUrl(q);if(h.indexOf("http")===-1){h=Uri.getUrl(h)}if(k.isAppCenter&&h.indexOf("appgo.do?")===-1){if(!h){var j=$I("util.CustomAppManager").getAppsList();var l=$.Array.findObject(j,"id",k.appId);if(l){h=l.url}if(!h||h.indexOf("http")===-1){h=""}}h="http://appcenter.mail."+$S("domain")+"/appgo.do?sid="+$S("sid")+"&func=mapp:appgo&appId="+k.appId+"&url="+encodeURIComponent(h);if(!g||!g.log){g=g||{};g.log=JSON.stringify({AppCenter_AppId:k.appId,uid:$S("uid")})}}if(g){for(var i in g){h+=((h.indexOf("?")>-1?"&":"?")+i+"="+g[i])}}var f=a.entry({url:h,key:q,title:p,group:k.group,cross:k.cross,fullScreen:k.fullScreen,isAppCenter:k.isAppCenter,appId:k.appId,showDefTree:k.showDefTree,_call:function(o){if(k.call){k.call(o)}}})}function e(h){if(h){var g=h.substr(3);var f=JS5.find(g);if(f){return f.frame}}}function b(f){try{return $I("module.outlink.OutlinkModule").modules[f]}catch(g){return false}}})();(function(){var b=$.createClass($N("interface.ThreadInterface"));$.Object.extend(b,{entry:a});function a(d,c){if(d.viewType){SMM.go({parent:d.moduleName,module:"thread.ThreadModule",param:d,folderData:c,viewType:d.viewType})}else{JS5.go({module:"thread.ThreadModule",param:d,folderData:c})}}})();(function(){var i=$.createClass($N("interface.WelcomeInterface"));$.Object.extend(i,{entry:o,getModule:b,initIframe:k,entryModule:f,entryOutlink:e,unread:j,greet:q,mobile:c,weather:n,trueName:h,login:l,gift:m,game:d,msgbox:a,tabSetting:p,birthMusic:g});function g(r){var s=this.getModule();if(s){s["{}"].birthMusic("set",r)}}function p(){var r=this.getModule();if(r){r["{}"].goSetting("tab",r["{}"],"tabset")}}function o(r){var s=Context.getModule();if(r&&r.auto&&s&&s.name!="welcome.WelcomeModule"){$("#dvWelcome").hide();return}JS5.go({module:"welcome.WelcomeModule",param:{}})}function b(){return JS5.modules["welcome.WelcomeModule"]}function k(){var r=this.getModule();if(r){r["{}"].init()}}function f(u,r){try{var s=$L(u)}catch(w){return w}if(r){try{if(typeof r=="object"){for(var v in r){if(Object.isArray(r[v])){r[v]=[].concat(r[v])}}}}catch(t){}}s.entry(r)}function e(s){try{var r=$L("interface.OutlinkInterface")}catch(t){return t}r.goOutlink(s)}function j(s){var r=this.getModule();if(r){return r["{}"].unread(s)}}function q(s){var r=this.getModule();if(r){return r["{}"].greet(s)}}function c(t,s){var r=this.getModule();if(r){return r["{}"].mobile(t,s)}}function n(t,s){var r=this.getModule();if(r){return r["{}"].weather(t,s)}}function h(t,s){var r=this.getModule();if(r){return r["{}"].trueName(t,s)}}function l(s){var r=this.getModule();if(r){return r["{}"].login(s)}}function m(r){var s=this.getModule();if(s){return s["{}"].gift(r)}}function d(s){var r=this.getModule();if(r){r["{}"].game(s)}}function a(r){$.Msgbox.show(r);return}})();(function(){var c=window.$,a;a=c.createClass($N("interface.ReadInterface"));c.Object.extend(a,{entry:d,goCacheModule:b});function d(g){var h=this,e,f,k,i;if(typeof g=="string"){g={id:g}}if(g.mid){g.id=g.mid;delete g.mid}if(g.call){k=g.call;delete g.call}if(g.hidden){i=g.hidden;delete g.hidden}e=g.group,f=g.folderData;delete g.folderData;if(f){if(!g.id){g.id=f.id}if(!g.fid){g.fid=f.fid}}if(g.isThread||(f&&f.threadMessageCount>1)){if(g.viewType){SMM.go({parent:g.moduleName,module:"thread.ThreadModule",param:g,folderData:f,viewType:g.viewType,group:e,hidden:i})}else{var j=h.goCacheModule({id:g.id,group:e,isThread:true,count:f.threadMessageCount,unread:!f.flags.read});if(j===true){return}if(typeof j=="string"){e=j}JS5.go({module:"thread.ThreadModule",param:g,folderData:f,group:e,hidden:i,hiddenCall:k})}}else{if(g.viewType){SMM.go({parent:g.moduleName,module:"read.ReadModule",param:g,folderData:f,viewType:g.viewType,group:e,hidden:i})}else{if(g.part){JS5.go({module:"read.ReadModule",param:g,folderData:f,group:e})}else{if(h.goCacheModule({id:g.id,group:e},i)){return}}JS5.go({module:"read.ReadModule",param:g,folderData:f,group:e,hidden:i,hiddenCall:k})}}if(!i){$S("lastRead",f?f.id:g.id)}}function b(g,n){var h=g.id,p=g.group,q=!!g.isThread,l,o,f,j;if(q){l="thread.ThreadModule";o="tid"}else{l="read.ReadModule";o="mid"}f=JS5.modules[l];if(f){for(var i in f){j=f[i];if(j[o]===h){if(!n){if(!p||p==j.group){if(q&&(g.unread||g.count!=j.folderData.threadMessageCount)){var k=j._var.group||j.group;JS5.cleanCache(j);JS5.remove(j);return k}else{try{if(j._var.hidden){delete j._var.hidden;delete j._var.hiddenCall}}catch(m){}JS5.go(j)}}else{return false}}return true}}}}})();(function(){try{var s=$L("support.Tag");var G=$L("support.AddressSupport");var m=$L("support.SenderList")}catch(Q){return Q}var h=$.Object;var L=$.Array;var C=$.String;var r=$.Function;var B=$.Event;var F=$.Date;var S=$.Browser;var l=$L("init.Folder");var A=S.ie()-0<7;var f=!!S.chrome();var y=$.createClass($N("module.mbox.Letter"));h.extend(y,{attribute:{className:"oe",tabIndex:0},checkboxTitle:["选中此邮件","取消选中"],sizeShow:false,sendStatus:["部分成功","发送成功","发送不成功","邮件发送中"],rclStatus:["部分成功","撤回成功","撤回不成功","邮件撤回中"],systemUrl:"http://mimg.127.net/p/images/ibx/cx/",createDiv:J,getDivId:O});h.extend(y.prototype,{isNormalLogo:true,initDiv:i,getDiv:q,getDivAttribute:p,getLogoInfo:v,getSendInfo:E,getReadLogo:D,getReFwLogo:w,getPriorityInfo:g,init:n,initMemo:N,mouseover:R,click:d,keypress:u,contextmenu:b,checkedchange:a,setChecked:e,setLastRead:c,setReFw:j,setClass:P,setMemo:t,setRead:z,setFlag:K,setTag:x,tagManage:I,gotoRead:M,remove:k,modifyMemo:o,initialize:H});function J(){var T=A?"A":"DIV";var U=document.createElement(T);this.div=U}function O(U,T){return U.createId(T+"Div"+(new window.Date()).getTime())}function i(U){var Z=this;var T=y.div.tagName;var X=h.clone(y.attribute);h.extend(X,Z.getDivAttribute());X.sign="letter";if(A){X.href="#"}Z.id=X.id;if(U){var Y=[];var W="";for(sKey in X){var aa=X[sKey];switch(sKey){case"className":Y.push('class="'+aa+'"');break;case"tabIndex":Y.push('tabindex="'+aa+'"');break;case"innerHTML":W=aa;break;case"title":case"aria-label":aa=C.encodeHTML(aa);default:Y.push(sKey+'="'+aa+'"')}}Z.html=["<",T," ",Y.join(" "),' href="javascript:void(0)">',W,"</",T,">"].join("")}else{var V=Z.div=y.div.cloneNode(true);for(sKey in X){var aa=X[sKey];if(sKey=="aria-label"||sKey=="sign"){V.setAttribute(sKey,X[sKey])}else{V[sKey]=aa}}}}function q(T){var U=this;if(!U.div){if(T){U.div=T}else{U.div=document.getElementById(U.id)}}return U.div}function p(){var aA=this;var af={};var aL=aA.components;var a2=aA.view;var ad=a2.module;var aU=ad.fid;var aB=aA.data;var ab=aB.fid;var aR=aB.flags;var V=aB.id;var ao=this.nodes;var a1=aB.threadMessageCount;var aI=aA.isThread;var a5=[y.attribute.className];var al=typeof aB.summary!="undefined";var ag=ad.fid==-1&&al;var aK=al&&!ag;var ai=al?aB.summary.replace(/\n|\|/g,"").replace(/(\s|　)+/g," "):"";var a7=y.getDivId(ad,V);af.id=a7;if(!aR.read){a5.push("ib")}if(!!aR.top){a5.push("lt")}var aD=ao.drag=ad.createId(V+"DragDiv");var am=ao.dragitem=ad.createId(V+"DragB");var av=ao.checkbox=ad.createId(V+"CheckboxB");var ax=ao.logo=ad.createId(V+"LogoB");var W=ao.flag=ad.createId(V+"FlagB");var a3=ao.tag=ad.createId(V+"TagDiv");var aM=ao.mid=ad.createId(V+"MidDiv");var bb=ao.end=ad.createId(V+"EndDiv");var aY=[];aY[aY.length]='<div class="kd fF'+((!ai||aU==-1)?" bH":"")+'">';var a9=['<SPAN aria-checked="false"  sign="checkbox" class="nui-chk cs" title="选中此邮件" role="checkbox" tabIndex="0" aria-label="选中此邮件"><SPAN class="nui-chk-symbol"><B class="nui-ico nui-ico-checkbox" id="',av,'"></B></SPAN></SPAN>'].join("");aY[aY.length]=['<div class="eT" sign="start">','<div class="cP" id="',aD,'"><b class="nui-ico nui-ico-drag" id="',am,'"></b></div>',a9].join("");var aO=aA.getLogoInfo();var bh=aO.config;if(bh.sub){aY[aY.length]=['<B class="cQ nui-ico nui-ico-hasSub nui-ico-',bh.type,'" title="',bh.title,'" sign="logo" id="',ax,'"><b class="nui-ico-sub nui-ico-sub-',bh.sub,'"></b></B>'].join("")}else{aY[aY.length]=['<B class="cQ nui-ico nui-ico-',bh.type,'" title="',bh.title,'"',(bh.url?' style="background-image:url('+bh.url+')"':""),' sign="logo" id="',ax,'"></B>'].join("")}var bg=aA.getPriorityInfo();if(bg){aY[aY.length]=['<b class="cr nui-ico nui-ico-mailLv nui-ico-',bg[0],'" title="',bg[1],'"></b>'].join("")}aY[aY.length]='<div class="cM" sign="start-from">';var aQ=(aU==2||aU==3)?aB.to:aB.from;if(C.has(aQ,"@netease>")){aQ=aQ.replace(/@netease>/ig,"@netease.com>")}var T=Uri.getEmails(aQ,undefined,true);var ae=T.match;if(ae.length==0){var aS=T.wrong;if(aS.length>0){ae.push({name:aQ,address:null})}else{ae.push({name:"(未填写)",address:null})}}var aN=[];var ap=[];var a0=aL.userlabel=[];for(var ay=0,at=ae.length;ay<at;ay++){try{var aG=ae[ay];var aa=G.getName(aG);var aX=aG.address;var bc=(aa?aa:aX?aX:"(未填写)");aN.push(bc);bc=C.encodeHTML(bc);var ah=new $.UserLabel({name:bc,address:aX,extcls:"bE",popupRenderTo:ad.scroller,lazyListen:true,noListen:true});a0.push(ah);ap[ap.length]=ah.html()}catch(a4){}}aY[aY.length]=ap.join("，");aY[aY.length]="</div>";var ar=aB.label0;aY[aY.length]=['<B class="cR nui-ico nui-ico-flag  nui-ico-flag-',ar,' " title=',(ar>0?"点击取消旗帜":"设为红旗"),' id="',W,'" sign="flag"></B>'].join("");a5.push("nui-txt-flag"+ar);aY[aY.length]="</div>";var be="";try{if(Ext.memo&&aB.memo){var aV=aL.memo=new $.Memo({content:C.encodeHTML(aB.memo),modify:r.bind(aA.modifyMemo,aA),extcls:"gs",lazyListen:true,noListen:true});be=aV.html()}}catch(a4){}var Z="";try{if(Ext.scheduleMbox&&$S("schedule")&&$S("schedule")[V]){var ac=aL.schedule=new $.Schedule({mid:V,extcls:"gs",lazyListen:true,noListen:true});Z=ac.html()}}catch(a4){}if(f){aB.subject=aB.subject.replace(/　/g," ")}aB.subject=C.trim(aB.subject);var aJ=aB.subject?a6(C.encodeHTML(aB.subject)):"(无主题)";aJ=aE(aJ);var bi=ag?C.encodeHTML(C.stripTags(ai)):C.stripTags(aJ);if(aB.fid==4&&ad.fid!=4){aJ="<del>"+aJ+"</del>"}var X=ad.fid<1?'<span class="nui-txt-tips nui-txt-s12 nui-fIBlock be">['+l.get(aB.fid).name+"]</span>":"";var aW=aI&&a1>1?['<div class="bq" title="共 '+a1+' 封会话">'+a1+"</div>"].join(""):"";var aH=aK?'<span class="ct">'+C.encodeHTML(ai)+"</span>":"";aY[aY.length]=['<div class="gp" id="',aM,'">',be,Z,'<div class="cq">',X,aJ,"</div>",aW,aH,"</div>"].join("");aY[aY.length]=['<div class="gq" id="',bb,'">'].join("");if(aA.sizeShow){var ba=$.Number.convert(aB.size,1);aY[aY.length]=['<div class="dv" title="邮件大小为',ba,'">',ba,"</div>"].join("")}var a8=$I("util.Misc").getTime(0);var az=aB.sentDate;var aj=F.format(az,"yyyy年M月d日 HH:mm (星期w)");var aq;var aF=F.addDate(a8,-1);if(az.getYear()==a8.getYear()&&az.getMonth()==aF.getMonth()&&az.getDate()==aF.getDate()){aq="昨日"}else{if(az.getYear()==a8.getYear()){if(az.getMonth()==a8.getMonth()&&az.getDate()==a8.getDate()){aq=F.format(az,"HH:mm")}else{aq=F.format(az,"M月d日")}}else{aq=F.format(az,"yyyy-MM-dd")}}aY[aY.length]=['<div class="dw" title="',aj,'">',aq,"</div>"].join("");var aP="",bf="",ak="";if(aR.linkAttached||(Ext.newAttach?(aR.realAttached):aR.attached)){if(aR.linkAttached){aP="nui-ico-bigAtt";bf="此邮件包含云附件"}else{aP="nui-ico-att";bf="此邮件包含附件"}}else{ak=' style="visibility:hidden"'}aY[aY.length]=['<div class="nui-ico ',aP,' cN" title="',bf,'"',ak,"></div>"].join("");aY[aY.length]="</div>";var an="";try{if(Ext.tag){var aC=$I("init.Tag");var U=[];var aT=aB.tag;var aw="";if(aT){var au=aL.tag=[];for(var ay=0,at=aT.length;ay<at;ay++){try{var Y=C.trim(aT[ay]);var bd=aC.get(Y);if(bd){var bj=new $.Tag({text:bd.name,type:bd.color,attrs:"hasClose",click:(function(bk){return function(){$E("interface.MboxInterface",function(bl){bl.entry({fid:0,showTag:true,tag:[bk]})});B.stop()}})(Y),closeclick:(function(bk,bl){return function(){a2.setTag(false,bk,[bl]);B.stop()}})(Y,aA),lazyListen:true,noListen:true});U[U.length]=bj.html();au.push(bj)}}catch(a4){}}}else{aw=' style="display:none"'}U.unshift(['<div class="gr" id="',a3,'"',aw,">"].join(""));U.push("</div>");an=U.join("")}}catch(a4){}aY[aY.length]=an;aY[aY.length]="</div>";if(ag){aY[aY.length]=['<div title="搜索内容" class="kd el"><div class="eT" sign="start"></div>','<div class="gp">',ai?ai.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/&lt;b&gt;/ig,'<b class="bG">').replace(/&lt;\/b&gt;/ig,"</b>"):"&nbsp;","</div>",'<div class="gq">&nbsp;</div></div>'].join("")}af.className=a5.join(" ");af.innerHTML=aY.join("");var aZ=(ab==2||ab==3)?"接收":"发来";af["aria-label"]=C.decodeHTML(([aj,aN.join(),aZ,"一封邮件，主题为：",bi]).join(" "));return af;function aE(bk){var bm=ad.searchVars;if(bm&&bm.pattern){try{var bl=new RegExp("("+bm.pattern+")","ig");bk=bk.replace(bl,'<b class="bG">$1</b>')}catch(bn){}}return bk}function a6(br){if(!aA.isThread){return br}try{var bo={type:"Re"};var bl={type:"Fw"};var bs,bk,bt,bq;bs=/(re|reply|回复|答复)[:|：]/ig;bk=/(fw|forward|转发)[:|：]/ig;bt=/^(re|reply|回复|答复)[:|：]/ig;bq=/^(fw|forward|转发)[:|：]/ig;bo.isFirst=bt.test(br);bl.isFirst=bq.test(br);if(!bo.isFirst&&!bl.isFirst){return br}var bu=[];var bn=bFw=false;bp(bs,bo);bp(bk,bl);if(bo.count>1||bl.count>1){bv(bs,bo);bv(bk,bl);if(bl.isFirst){bu.reverse()}br=bu.join(":")+":"+C.trim(br).replace(/^(&nbsp;|_)+/ig,"")}}catch(bm){}return br;function bp(bA,by){var bx=0;var bz=false;var bw=[];bw=br.match(bA);if(bw){by.count=bw.length}}function bv(bw,bx){if(bx.count>0){bx.handle=true;bu[bu.length]=bx.type+(bx.count>1?"("+bx.count+")":"");br=br.replace(bw,"")}}}}function v(){var Z=this;var X=Z.data;var T=X.flags;var ad=X.fid;var ab=Z.isTop&&T.top;var ah=ab?["top","置顶"]:null;var aa=Z.getReadLogo();var Y=T.system?["ntes","网易系统邮件"]:null;if(X.ctrls&&X.ctrls.RulesType&&!L.has([5,7,18],X.fid)){var ae=X.ctrls.RulesType.split(";")[0];if(ae.indexOf("_")>-1){ae=ae.split("_")[1]}else{if(ae!="ntessys"){X.ctrls.RulesType=null}}if(ae){if(ae=="ntessys"){Y=["ntes","网易诚信邮件联盟认证邮件"]}else{Y=["integrity","网易诚信邮件联盟认证邮件",y.systemUrl+ae+".gif"]}}}var ag=T.encrypted?["encrypt","加密邮件"]:null;var ac=Z.getReFwLogo();var af=Z.getSendInfo();var W=ad==2&&T.draft?["draft","草稿"]:null;var V=T.scheduleDelivery?["regular","定时发信"]:null;var U=ah?ah:af?af:Y?Y:ag?ag:V?V:W?W:ac?ac:aa;Z.isNormalLogo=U==aa;U.config={type:U[0],title:U[1],url:U[2],sub:U[3]};return U}function E(){var ag=this;var Y=ag.data;var V=Y.flags;if(Y.fid!=3||ag.isThread){return null}var ae,aj,ab,U,ah;if((Ext.letterRecall||Ext.letterRecall_vip)&&Y.recallable){ae="recall";var aa=Y.rclStatus;var ai=y.rclStatus;if(aa&&aa>0){if(aa<3){aj=ai[3];ab=0}else{if(aa==3){aj=ai[1];ab=1;ah="suc"}else{if(aa==4){aj=ai[2];ab=2;ah="err"}else{if(aa==5){aj=ai[0];ab=3;ah="pause"}}}}}}if(!aj||!ae){ae="mail";var W=Y.sndStatus;if(typeof W!="number"){var T=V.rcptQueued;var af=V.rcptSucceed;var Z=V.rcptFailed;if(T||af||Z){if(af){if(Z){W=5}else{W=3}}else{if(Z){W=4}else{try{if($I("util.Misc").getTime()-Y.sentDate<15000){W=1}}catch(ad){}}}Y.sndStatus=W}}if(typeof W=="number"){var ac=y.sendStatus;if(W<3){aj=ac[3];ah="ing";ab=0}else{if(W==3){aj=ac[1];ah="suc";ab=1}else{if(W==4){aj=ac[2];ah="err";ab=2}else{if(W==5){aj=ac[0];ah="part";ab=3}}}}}U="send"}else{U="recall"}var X=null;if(aj&&ae){X=[ae,aj,null,ah];X.ext={status:ab,type:U}}return X}function D(){var X=this;var V=X.data.flags;var W=X.isThread;var T=V.popRead;var U=V.read;return U?["read","已读"]:W?["unreadThread","未读"]:T?["unreadPop","已被邮件客户端，其他邮箱代收或手机等通过POP3协议收取"]:["unread","未读"]}function w(){var X=this;if(X.isThread){return null}var W=X.data.flags;var V=W.replied&&W.forwarded?["refw","回复且转发"]:null;var T=W.replied?["re","已回复"]:null;var U=W.forwarded?["fw","已转发"]:null;return V?V:T?T:U?U:null}function g(){var W=this;var V=W.data.priority;var T,U;if(V<3){T="mailLv-1";U="紧急"}else{if(V>3){T="mailLv-3";U="缓慢"}}if(T&&U){return[T,U]}}function n(W){var ad=this,ah=ad.nodes;var ae=ad.view,aa=ae.module;if(!ad.inited){W=ad.getDiv(W);var T=W.getElementsByTagName("*");var aj=h.count(ah),U=0;for(var ab=0,Y=T.length;ab<Y;ab++){var ac=T[ab],X=ac.id;h.each(ah,function(ak,al){if(al==X){ah[ak]=ac;U++;throw $.BREAK}});if(U==aj){break}}var Z=ad.components;if(Ext.tag){var af=Z.tagmanage=new $.Button({renderTo:ah.end,title:"选择邮件标签",simple:true,subclass:"miniBtn",extcls:"cO",menu:ad.tagManage(),popupRenderTo:aa.scroller,click:function(){B.stop()},lazyListen:true,noListen:true})}var ai=$I("util.DragDrop");new ai({drag:ae.dragDiv,trigger:ah.drag,listeners:[{name:"mousedown",handler:r.bind(ae.drag,ae,ad,"mousedown")},{name:"start",handler:r.bind(ae.drag,ae,ad,"start")},{name:"drag",handler:r.bind(ae.drag,ae,ad,"drag")},{name:"end",handler:r.bind(ae.drag,ae,ad,"end")}]});for(sKey in Z){var V=Z[sKey];if(h.isArray(V)){for(var ab=0,Y=V.length;ab<Y;ab++){ag(V[ab])}}else{ag(V)}}ad.inited=true}function ag(ak){ak.setEventListeners();ak.fireRender()}}function N(){var U=this;var T=U.components.memo;if(!T){T=U.components.memo=new $.Memo({renderTo:U.nodes.mid,renderBy:"previous",content:C.encodeHTML(U.data.memo||""),modify:r.bind(U.modifyMemo,U),extcls:"gs"})}}function R(T){var U=this;U.init(T.div)}function d(V){var W=this,Z=W.view;var U=V.div;var X=V.sign;var T=W.data;W.init(U);var Z=W.view;switch(X){case"checkbox":W.setChecked(!W.checked);break;case"logo":Log.cache({from:"letter"});var aa=T.flags.read;if(!aa){W.setChecked(true);Z.setRead(!aa,[W])}break;case"flag":Log.cache({from:"letter"});W.setChecked(true);Z.setFlag(T.label0==0?1:0,[W]);break;default:var Y=false,ab=false;Y=Y||X=="start-from";ab=ab||X=="start";if(!(ab&&!Y)){W.gotoRead()}}}function u(T){var V=this;V.init(T.div);var U=B.get();if(U.target.tagName=="DIV"&&U.which=="13"){V.gotoRead()}}function b(U){try{var ag=$L("module.mbox.ListModule")}catch(Z){return Z}var Y=this;var aj=Y.data;var ae=Y.view;var an=ae.module;var ab=$I("util.Contextmenu");var ak=an.fid;var ao=aj.fid;Y.init(U.div);var ad=ae.letters;var am=aj.id;var af=true;for(var al=0,ai=ad.length;al<ai;al++){var ap=ad[al];if(ap.checked){if(ap.data.id!=am){af=false;break}}}var X={groups:[]};var W=X.groups;var ah=[];if(aj.flags.read){ah.push({text:"设为未读",click:V(r.bind(ae.setRead,ae,false))})}else{ah.push({text:"设为已读",click:V(r.bind(ae.setRead,ae,true))})}if((ak>0||af)&&ag.isTop(ao)&&!ae.folderSelected){if(aj.flags.top){ah.push({text:"取消置顶",click:V(r.bind(ae.setTop,ae,false,null,ao))})}else{ah.push({text:"置顶邮件",click:V(r.bind(ae.setTop,ae,true,null,ao))})}}if(af&&Ext.memo){var T=aj.memo?"修改备注":"添加备注";ah.push({text:T,click:V(function(){Y.initMemo();$.Memo.modify(Y.components.memo)})})}W.push({items:ah});ah=[];if(L.has([4,5,7,18],ak)){ah.push({text:"彻底删除",click:V(r.bind(ae.remove,ae,true))})}else{ah.push({text:"删除邮件",click:V(r.bind(ae.remove,ae))})}if(!L.has([2,3],ak)){var aa="举报垃圾邮件";var ac=true;ah.push({text:aa,click:V(r.bind(ae.setSpam,ae,ac))})}if(L.has([5,7,18],ak)){var aa="信任选中邮件";var ac=false;ah.push({text:aa,click:V(r.bind(ae.setSpam,ae,ac))})}W.push({items:ah});ab.show(X);function V(aq){return function(){if(!Y.checked){Y.setChecked(true)}Y.view.selectAll();aq()}}}function a(Z){var Y=this,V=Y.view,X=V.module;Y.setClass();V.selectAll(Z===false?false:undefined);var U=[];var T=Y.view.letters;L.each(T,function(aa,ab){U.push(ab)});try{$I("util.Shift").handle(Y,U,function(){Y.setClass()});B.stop()}catch(W){}try{X.layoutModule.view.changeSelect()}catch(W){}}function e(V){var T=this;T.init();if(!!T.checked!=V){T.checked=V;var U=$.fly(T.nodes.checkbox);if(V){U.addClass("nui-ico-checkbox-checked")}else{U.removeClass("nui-ico-checkbox-checked")}U.dom.parentNode.parentNode.setAttribute("aria-checked",!!V);T.checkedchange(V)}}function c(ad){var X=this;X.init();var ab=X.nodes;var U=ab.drag;var Z=ab.dragitem;var V=$(X.div);var aa=$(U);var ac=$(Z);var T="nui-ico-drag",W="nui-ico-drag2",Y="gt";if(ad){ac.replaceClass(T,W);V.addClass(Y);U.title="最近阅读邮件"}else{ac.replaceClass(W,T);V.removeClass(Y);U.title=""}V.destroy();aa.destroy();ac.destroy()}function j(){var V=this;V.init();if(V.isNormalLogo){var T=V.nodes.logo;var U=V.getLogoInfo();T.className="cQ nui-ico nui-ico-"+U[0];T.title=U[1]}}function P(){var W=this;W.init();var V=W.div;var T=$.fly(V);var X=W.nodes.checkbox;if(W.checked){T.addClass("gu")}else{T.removeClass("gu")}var U=y.checkboxTitle;X.title=(W.checked?U[1]:U[0])}function t(){var V=this;V.init();V.initMemo();var U=V.data.memo||"";var T=V.components.memo;T.show();T.updateContent(C.encodeHTML(U))}function z(){var X=this;X.init();var W=X.data.flags.read;if(X.isNormalLogo){var T=X.nodes.logo;var V=X.getLogoInfo();T.className="cQ nui-ico nui-ico-"+V[0];T.title=V[1]}if(X.checked){X.setChecked(false)}var U=$.fly(X.div);if(W){U.removeClass("ib")}else{U.addClass("ib")}}function K(){var W=this;W.init();var U=W.nodes.flag;var V=W.data.label0;U.className="cR nui-ico nui-ico-flag  nui-ico-flag-"+V;U.title=(V>0?"点击取消旗帜":"设为红旗");if(W.checked){W.setChecked(false)}var T=W.div;T.className=T.className.replace(/nui-txt\-flag\d{1,2}/gi,"nui-txt-flag"+V)}function x(){var ad=this;ad.init();var af=ad.view;var ai=$I("init.Tag");var Z=ad.view.module;var ah=ad.nodes.tag;var W=ad.data;var ag=W.tag;var U=ad.components;var ab=U.tag=[];var ae=[];for(var ac=0,X=ag.length;ac<X;ac++){try{var T=ag[ac];var Y=ai.get(T);var V=new $.Tag({text:Y.name,type:Y.color,attrs:"hasClose",click:(function(aj){return function(){$E("interface.MboxInterface",function(ak){ak.entry({fid:0,showTag:true,tag:[aj]})});B.stop()}})(T),closeclick:(function(aj,ak){return function(){af.setTag(false,aj,[ak]);B.stop()}})(T,ad)});ae[ae.length]=V.html();ab.push(V)}catch(aa){}}ah.innerHTML=ae.join("");ah.style.display="";try{U.tagmanage.update({menu:ad.tagManage()})}catch(aa){}$.Component.setEvents();if(ad.checked){ad.setChecked(false)}}function I(){var W=this;var U=W.view;var X=W.data;var T=X.tag||[];var V={};V.tag=T;V.callback=function(Z,Y){Log.cache({from:"letter"});U.setTag(!Z,Y,[W])};V.remove=function(){U.setTag(false,null,[W])};return s.getMenu(V)}function M(U){try{var ad=$L("interface.ReadInterface",this);var aa=$L("interface.ComposeInterface",this)}catch(X){return X}var Z=this,ab=Z.view,W=ab.module;var V=Z.data;if(!U){U={}}var ac=U.hidden,Y=U.call;if(V.fid!=2){try{if(!ac){Log.cache({read_fid:W.fid.toString(),read_cached:(!!Z.cached).toString(),read_read:(!!V.flags.read).toString(),read_page:W.index.toString(),read_index:(function(){var ag=ab.letters;var af=-1;for(var ah=0,ae=ag.length;ah<ae;ah++){if(ag[ah]==Z){af=ah;break}}return af})()})}else{Z.cached=true}}catch(X){}var T=ab.getLayout();ad.entry({fid:W.fid,moduleName:W.name,folderData:V,isThread:Z.isThread,viewType:T,hidden:ac,call:Y});if(ab.module.layout-0>0&&!ac){try{ab.markReaded()}catch(X){}}}else{aa.draft({id:V.id,info:{subject:V.subject,priority:V.priority},date:(V.flags.scheduleDelivery?V.sentDate:null)});$E("interface.MboxInterface",function(ae){ae.setRead({fid:W.fid,isRead:true,data:V})})}}function k(Z){var aa=this;try{if(Z){var U=aa.getDiv();B.unlistenAll(U);var W=aa.components;for(var ab in W){try{var T=W[ab];if(h.isArray(T)){for(var Y=0,V=T.length;Y<V;Y++){T[Y].destroy()}}else{T.destroy()}}catch(X){}}$.fly(U).remove()}}catch(X){}aa.div=null;aa.nodes=null;aa.components=null;aa.data=null;aa.view=null}function o(T){var U=this;U.view.setMemo(T,[U])}function H(af,T,V){var ac=this;ac.data=T;var ae=0;if(!y.sender){var Y=y.sender=[];try{var U=m.getList();for(var ab=0,W=U.length;ab<W;ab++){var ad=U[ab];Y.push(ad.address.toLowerCase())}}catch(aa){}}if(ac.isThread&&ae>0&&T.fid!=ae){T.fid=ae}try{if(!T.flags){T.flags={}}if(!T.tag){T.tag=[]}}catch(aa){}if(af){var X=af.module;var ag=X.filterFlags;if(ag&&ag.label0>0){T.label0=X.filterFlags.label0}ae=X.fid;if(!y.div){y.createDiv()}var Z=T.threadMessageCount;ac.view=af;ac.sizeShow=af.sizeShow;ac.nodes={};ac.components={};ac.isThread=Z&&Z>1;ac.isTop=X.isTopFirst();ac.initDiv(V)}}})();(function(){try{var q=$L("support.Folder");var k=$L("interface.MboxInterface")}catch(g){return g}var t=$.Object;var e=$.Function;var l=$.Array;var d=$.createClass($N("module.mbox.Title"));t.extend(d.prototype,{get:h,update:r,destroy:m,getConfig:c,getNormal:n,getSort:a,getFilter:o,getTag:j,getSearch:b,getFullSearch:i,getExt:p,getFlagLink:s,initialize:f});function h(){var u=this;var y=u.view.module;var v=u.config={};u.getConfig();var x="";u.title=new $.Title(v);var w=t.count(v)>0?"":"display:none;";x='<div class="pL" id="'+y.createId("TitleDiv")+'" style="'+w+'">'+u.title.html()+"</div>";return x}function r(){var w=this;var x=w.config={};var u=w.title;w.getConfig();var v=$(u.getEl().dom.parentNode);if(t.count(x)>0){u.update(x);u.show();v.show();$.Component.setEvents(10)}else{u.hide();v.hide()}}function m(){var u=this;try{u.title.destroy();u.title=null}catch(v){}}function c(){var u=this;var v=u.view.module;if(v.fid==-1){if(v.searchVars.pattern){u.getFullSearch()}else{u.getSearch()}}else{if(v.tag){u.getTag()}else{if(v.filterFlags&&t.count(v.filterFlags)>0){u.getSort()}else{if(v.filter&&t.count(v.filter)>0){u.getFilter()}else{u.getNormal()}}}}u.getExt()}function n(){var C=this;var F=C.view;var y=F.module;var E=y.fid;var B=C.config;var A=y.getFolder();var z=$I("init.Folder").checkFolder(E);var w=y.getTotal();var v=y.getInfo("unread");if(v<1||E==2){return}var u=[],D=[];if(v>0){var G=new $.Link({title:"点击查看未读邮件",text:"有 <strong>"+v+"</strong> 封未读邮件",extcls:"nui-txt-link",click:function(){Log.cache({from:"title",type:"unread"});k.entry({fid:E,filterFlags:{read:false}})}});var x=new $.Link({title:"全部设置为已读邮件",text:"全部设为已读",extcls:"nui-txt-link",click:function(){Log.cache({from:"title"});F.setAllRead()}});D.push(G.html());D.push(x.html())}u[u.length]=D.join(" ");B.tips=u.join("")}function a(){var S=this;var x=S.config;var E=S.view;var R=E.module;var v=R.filterFlags;var L=R.tag;var T=R.fids;var K=R.fid;var H=R.getFolder();var M=R.getTotal();var B="";if(!R.showTag&&!R.showFlag&&v&&v.read===false&&M>0){B=" "+new $.Link({title:"全部设置为已读邮件",text:"全部设为已读",extcls:"nui-txt-link",click:e.bind(E.setAllRead,E)}).html()}var F=E.getCondition();if(T&&!l.has(T,1)){var I="其他";try{if(T.length==1){I=$I("init.Folder").get(T[0]).name}else{var D=T.length>1,y=gCommon.nolistids;for(var N=0,J=T.length;N<J;N++){var C=T[N];if(!l.has(y,C)){D=false;break}}if(D){var Q=$I("init.Folder");var u=[];for(var N=0,J=y.length;N<J;N++){u.push(Q.get(nSpamId).name)}I=u.join("，")}}}catch(z){}F=I+F}else{var G=R.filterFlags&&R.filterFlags.read===false;var w=H.name;var A=e.bind(k.entry,k,{fid:K});if(R.showFlag){w="旗帜邮件";var U=$I("init.Folder");var P=U.list();var O=[];for(var N=0,J=P.length;N<J;N++){var C=P[N].id;if(C!=4){O.push(C)}}A=e.bind(k.entry,k,{showFlag:true,searchVars:{fid:O,condictions:[{field:"label0",operator:">",operand:0}]}});S.getFlagLink()}x.path={items:[{xtype:"link",text:w,extcls:"nui-txt-link",click:A}]}}x.text=F;x.tips=B}function o(){var B=this;var A=B.config;var D=B.view;var w=D.module;var z=w.filter;var x=w.fids;var C=w.fid;var y=w.getFolder();var v=w.getTotal();if(w.fid>0){var u=e.bind(k.entry,k,{fid:C});A.path={items:[{xtype:"link",text:y.name,extcls:"nui-txt-link",click:u}]}}var E=D.getCondition();A.text=E}function j(){var y=$I("init.Tag");var N=this;var x=N.config;var D=N.view;var L=D.module;var w=L.filterFlags;var J=L.tag;var H=L.fid;var E=D.getCondition();var K=L.getTotal();var u="";var C=J[0];var M=y.get(J[0],"tags");var I=M.type=="brand"?y.getBrand(C):undefined;var v=I?I.name:J.join();var A=v;var F=w&&w.read===false;if(!F){var z=$I("init.Tag").getInfo(C,"unread");if(z>0&&K>$S("attrs").user.maxlist){u=(new $.Link({title:"未读邮件",text:"共有  <strong>"+z+"</strong> 封未读邮件",extcls:"nui-txt-link",click:function(){Log.cache({from:"title",type:"unread"});k.entry({fid:0,showTag:true,tag:L.tag,filterFlags:{read:false}})}})).html();x.tips=u}}else{var B=e.bind(k.entry,k,{fid:0,showTag:true,tag:J});x.path={items:[{xtype:"link",text:v,extcls:"nui-txt-link",click:B}]};A=E;x.text=A}var G;if(H>0){var G=L.getFolder()}if(I){G=$I("init.Folder").get(18)}if(G){x.path={items:[{xtype:"link",extcls:"nui-txt-link",text:G.name,click:e.bind(k.entry,k,{fid:G.id})}]};x.text=A}}function b(){var B=this;var y=B.config;var z=B.view;var u=z.module;var w=u.searchVars;var v=u.getTotal();var C=u.getRealFid();var A=$I("init.Folder").get(C);var E=z.getCondition();if(E){E="已搜索到 "+v+" 封"+E+"的邮件"}if(u.showFlag){}else{var x="";if(v>0){var D=new $.Link({title:"删除所有邮件",text:"删除所有邮件",click:e.bind(z.removeAll,z)});x="&nbsp;"+D.html()}y.path={items:[{xtype:"link",text:A.name,click:e.bind(k.entry,k,{fid:A.id})}]};y.text="搜索结果";y.tips=E+x}}function i(){var E=this;var C=E.config;var D=E.view;var u=D.module;var z=u.searchVars;var w=u.getTotal();var F=u.getRealFid();var H=D.getCondition();if(H){H="已搜索到 "+w+" 封"+H+"的邮件"}var B="";if(u.hasAdditional()){var I=new $.Link({title:"取消所有附加条件",text:"取消所有附加条件",bracket:true,click:e.bind(D.additionalSearch,D)});B="&nbsp;"+I.html()}var A="";if(w>0){var G=new $.Link({title:"删除所有邮件",text:"删除所有邮件",click:e.bind(D.removeAll,D)});A="&nbsp;"+G.html()}C.text="搜索结果";C.tips=H+B+A;var y=Ud.get({field:"ntes_global",flag:"secondSearch"})-0==1;var x=C.extItems=[];var v=y?'完整信息<b class="nui-ico hd">j</b>':'精简信息<b class="nui-ico hd">k</b>';x[x.length]={xtype:"link",extcls:"nui-txt-link",text:v,click:function(){D.toggleControl()}}}function p(){}function s(){var y=this;var z=y.config;var v=z.extItems=[];var A=LETTERFLAG;var w=[];for(var x=1,u=A.length;x<u;x++){if(A[x]){w[w.length]={text:A[x],icon:"flag-"+x,extcls:"nui-txt-flag"+x,click:e.bind(k.entry,k,{fid:0,showFlag:true,filterFlags:{label0:x}})}}}v[v.length]={xtype:"link",extcls:"nui-txt-link",text:'<b class="nui-ico nui-ico-flag nui-ico-flag-0"></b>其他旗帜&nbsp;<b class="nui-ico nui-ico-dArr">d</b>',listeners:[{name:"render",handler:function(){var B=new $.Menu({groups:[{items:w}],reverse:true});B.attachTo({clickFrom:this.getEl()})}}]}}function f(u){this.view=u}})();(function(){var g=$.Object;var d=$.Function;var h=$.Date;var i=$.createClass($N("module.mbox.Footer"));g.extend(i.prototype,{get:j,getNoneContainer:f,getPageContainer:k,getNone:b,getPage:m,update:a,destroy:c,init:e,initialize:l});function j(){var o=this;o.init();var n=[];n[n.length]=o.getNoneContainer(o.getNone());n[n.length]=o.getPageContainer(o.getPage());return n.join("")}function f(n){var q=this;var r=q.view.module;var p=r.fid==-1;var o=r._var.param.showFlag;var s="";if(p||o){s=" jv"}return'<div id="'+r.createId("NoneInfoDiv")+'" class="nui-infoBlock nui-block pb'+s+'"'+(q.empty?"":' style="display:none"')+">"+n+"</div>"}function k(o){var n=this;return'<div id="'+n.view.module.createId("PageDiv")+'" class="pY"'+(n.empty||n.onepage?' style="display:none;"':"")+">"+o+"</div>"}function b(){var H=this;var v=H.view;var F=v.module;var n=F.fid==-1;var t=F._var.param.showFlag;var w=v.getCondition();var B=F.getFolder();var y=[];if(n){y[y.length]='<p class="kK">抱歉，找不到'+(w?('和 <span class="nui-txt nui-txt-mark">'+w+"</span>"):"")+' 相匹配的邮件。</p><p class="of">网易邮箱建议：</p><p class="of">检查输入字词有无错误</p><p class="of">去掉特殊符号重新查询</p><p class="of">换用另外的查询字词</p>'}else{if(t){var A=0;var G="您暂时没有设置旗帜邮件";try{A=F.filterFlags.label0;var u=LETTERFLAG[A];G="您暂时没有设置“"+u+"”邮件"}catch(s){}y[y.length]='<p class="kK">'+G+'</p><p class="of">一键标记！您可以在邮件列表中设置邮件旗帜，方便查找重要邮件。</p><p class="of"><img src="http://mimg.127.net/p/js5/lib/img/noflagmail.png" alt="如何设置红旗邮件" /></p>'}else{if(w){y[y.length]='<p class="kK">没有找到 '+w+" 邮件";try{sSentDate=F.filter.sentDate;var x=F.constructor;var r=sSentDate.split(":");var E=r[0],D=r[1];var p=x.parseSentDate(E),q=x.parseSentDate(D);if(p-q==0){var I=new $.Link({title:"查看近期邮件",text:"查看近期邮件",click:function(){F._toolbar.find("calendar")[0].fire("select",h.addDate(p,-3),h.addDate(p,3))}})}y[y.length]="&nbsp;"+I.html()}catch(s){}y[y.length]="</p>"}else{var G="此文件夹没有邮件";if(B){var C=B.flags;if(!C.system){if(C.custom){var o=new $.Link({title:"来信分类",text:"来信分类",click:function(){$E("interface.OptionInterface",function(J){J.goFilter({folder:F.fid})})}});G+="。&nbsp;您可以通过设置 "+o.html()+" ，将指定联系人的邮件收取到此文件夹。"}else{if(C.pop){var z=new $.Link({title:"立即收取邮件",text:"立即收取邮件",click:function(){$E(["support.MailCenter"],function(J){J.receive({type:"fid",value:B.id})})}});G+="。&nbsp;"+z.html()}}}}y[y.length]='<p class="kK">'+G+"</p>"}}}return y.join("")}function m(){var n=this;var v=n.view;var s=n.page;var o=n.index;var t=s<=1;var r=[];if(!t){var u=s-1;var q=o>0?function(){Log.cache({from:"footer",type:"previous"});v.goPage(o-1)}:undefined;var p=!q;var x=o<u?function(){Log.cache({from:"footer",type:"next"});v.goPage(o+1)}:undefined;var w=!x;r[r.length]=new $.Button({xtype:"button",icon:"prev",subclass:"roundBtn",extcls:"lQ",disabled:p,click:q,title:"上一页",lazyListen:false}).html();r[r.length]=new $.Button({xtype:"button",icon:"next",subclass:"roundBtn",extcls:"lR",disabled:w,click:x,title:"下一页",lazyListen:false}).html()}return r.join("")}function a(){var o=this;var r=o.view.module;if(o.page!=r.getPage()||o.index!=r.index){o.init();var n=r.getEl("NoneInfoDiv");var q=r.getEl("ContentDiv");var p=r.getEl("PageDiv");if(o.empty){n.html(o.getNone());n.show();q.hide();p.hide()}else{p.html(o.getPage());q.show();p.show();n.hide()}n.destroy();q.destroy();p.destroy();$.Component.setEvents()}}function c(){var n=this;var o=n.view.module}function e(){var n=this;var o=n.view.module;n.page=o.getPage();n.index=o.index;n.empty=n.page==0;n.onepage=n.page==1}function l(o){var n=this;n.view=o}})();(function(){try{var t=$L("interface.MboxInterface");var l=$L("interface.OptionInterface")}catch(i){return i}var B=$.Object;var g=$.Function;var v=$.Array;var c=$.Date;var A=$I("init.Folder");var b=$.createClass($N("module.mbox.Toolbar"));B.extend(b.prototype,{getConfig:q,initCurrent:r,isCurrent:h,select:m,remove:z,report:p,control:y,_mark:n,_move:x,_view:u,_more:k,refresh:o,extend:w,update:d,destroy:f,selectAll:s,getBaseCondiction:a,extendBaseCondiction:j,initialize:e});function q(){var D=this;var E=D.view.module;var C=D.config={groups:[]};D.initCurrent();D.select();D.remove();D.report();D.control();D.refresh();D.extend();return C}function r(){var D=this;var G=D.view.module;var E=D.current={};try{var C=G.filterFlags;E.flag=C.label0;E.read=C.read}catch(F){}try{E.tag=G.tag}catch(F){}}function h(H,D){var E=this;var C=false;var F=E.current;switch(H){case"read":case"flag":try{C=F[H]===D}catch(G){}break;case"tag":try{C=v.has(F[H],D)}catch(G){}break}return C}function m(){var E=this;var C=E.view;var D=E.config;var F=D.groups;F[F.length]={items:[{xtype:"button",subclass:"dropdownBtn",checkbox:{checkedchange:function(G){Log.cache({toolbarselect:"allornone"});C.select(G?"all":"none")},checked:C.allSelected},menu:{groups:[{items:[{text:"全选",click:function(){Log.cache({toolbarselect:"all"});C.select("all")}},{text:"不选",click:function(){Log.cache({toolbarselect:"none"});C.select("none")}},{text:"附件",click:function(){Log.cache({toolbarselect:"attached"});C.select("attached")}},{text:"反选",click:function(){Log.cache({toolbarselect:"toggle"});C.select("toggle")}}]},{items:[{text:"未读",click:function(){Log.cache({toolbarselect:"unread"});C.select("unread")}},{text:"已读",click:function(){Log.cache({toolbarselect:"read"});C.select("read")}}]}]}}]}}function z(){var H=this;var L=H.view;var D=L.module;var G=H.config;var F=G.groups;var J=D.fid;var K="删 除",I=false;var E,C=false;if(J==0){E=D.fids}else{if(J==-1){E=D.searchVars.fid}}if(E){C=v.has(E,4)&&E.length==1}if(v.has([4,5,7,15,18],J)||C){K="彻底删除";I=true}else{if(J==2){K="删除草稿"}}F[F.length]={items:[{xtype:"button",text:K,click:g.bind(L.remove,L,I)}]}}function p(){var H=this;var D=H.view;var G=H.config;var I=G.groups;var E=D.module.fid;var F=D.folderSelected;if(!v.has([2,3],E)){var C=[];if(v.has([5,7,18],E)){C.push({xtype:"button",text:"信 任",click:g.bind(D.setSpam,D,false),disabled:F})}C.push({xtype:"button",text:"举 报",click:g.bind(D.setSpam,D,true),disabled:F});I[I.length]={items:C}}}function y(){var F=this;var D=F.view;var E=F.config;var G=E.groups;var C=G[G.length]={items:[]};F._mark(C);F._move(C);F._view(C);F._more(C)}function n(Q){var N=this;var R=N.view;var I=R.module;var O={xtype:"button",subclass:"dropdownBtn",text:"标记为",menu:{groups:[]}};Q.items.push(O);var L=O.menu.groups;var S=[{text:"已读",click:function(){Log.cache({from:"toolbar"});R.setRead(true)},disabled:N.isCurrent("read",true)},{text:"未读",icon:"unread",click:function(){Log.cache({from:"toolbar"});R.setRead(false)},disabled:N.isCurrent("read",false)}];if(I.fid>0){S.push({text:"全部设为已读",click:function(){Log.cache({from:"toolbar"});R.setAllRead()}})}L[L.length]={items:S};var G=LETTERFLAG;var F=[];for(var K=2,H=G.length;K<H;K++){if(G[K]){F[F.length]={text:G[K],icon:"flag-"+K,extcls:"txt-flag"+K,click:(function(T){return function(){Log.cache({from:"toolbar",type:"other",flagindex:T});R.setFlag(T)}})(K),disabled:N.isCurrent("flag",K)}}}L[L.length]={items:[{text:"红旗",icon:"flag-1",extcls:"txt-flag1",click:function(){Log.cache({from:"toolbar",type:"red"});R.setFlag(1)},disabled:N.isCurrent("flag",1)},{text:"其他旗帜",icon:"flag-0",menu:{groups:[{items:F}]}},{text:"取消旗帜",click:function(){Log.cache({from:"toolbar",type:"cancel"});R.setFlag(0)}}]};if(Ext.tag){var D=$I("init.Tag");var P=D.list();var J=[];for(sKey in P){var E=P[sKey];J[J.length]={text:E.name,icon:{type:"tag",subtype:E.color,xtype:"icon"},click:(function(T){return function(){Log.cache({from:"toolbar"});R.setTag(true,T)}})(E.name),dieabled:(function(T){return N.isCurrent("tag",T)})(E.name)}}var M=L[L.length]={items:[{text:"标签",menu:{groups:[]}}]};if(J.length>0){M.items[0].menu.groups.push({items:J,type:"scroll"});M.items.push({text:"取消所有标签",click:function(){Log.cache({from:"toolbar",remove:"all"});R.setTag()}})}M.items[0].menu.groups.push({items:[{text:"新建标签并标记",click:function(){$E("support.Tag",function(T){T.add({callback:function(U){Log.cache({from:"toolbar"});R.setTag(true,U)},from:"toolbar"})})}}]})}var C=R.folderSelected;if(I.isTopFirst()){L[L.length]={items:[{text:"置顶邮件",click:function(){Log.cache({from:"toolbar",action:"settop"});R.setTop(true)},disabled:C},{text:"取消置顶",click:function(){Log.cache({from:"toolbar"});R.setTop(false)},disabled:C}]}}}function x(J){var G=this;var K=G.view;var E=K.module;var I={xtype:"button",subclass:"dropdownBtn",text:"移动到",menu:{groups:[]}};J.items.push(I);var F=I.menu.groups;var L=A.list();var D={system:[],custom:[],pop:[]};v.each(L,function(N,Q){if(E.canMoveTo(Q.id)){var O;var P=Q.flags;if(P.custom){O="custom"}else{if(P.pop){O="pop"}else{O="system"}}var M=D[O];M[M.length]={text:Q.name,click:function(){Log.cache({from:"toolbar"});K.move(Q.id)},icon:P.pop?{type:"folder",subtype:Q.flags.iconSubtype,xtype:"icon"}:undefined}}});var C=[];var H=false;B.each(D,function(P,N){var Q=N.length>0;if(H&&Q){C.push({type:"split"})}H=H||Q;for(var O=0,M=N.length;O<M;O++){C.push(N[O])}});F[F.length]={items:C,type:"scroll"};F[F.length]={items:[{text:"新建文件夹并移动",click:function(){$E("support.Folder",function(M){M.add({callback:function(N){Log.cache({from:"toolbar",pre:"new"});K.move(N)}})})}}]}}function u(X){var ax=this;var G=ax.view;var aq=G.module;var F={xtype:"button",subclass:"dropdownBtn",text:"查看",menu:{groups:[]}};X.items.push(F);var N=F.menu.groups;var am=aq.fid,M=aq._var.param;if(am>-1){var S=ax.getBaseCondiction();var R=[];R[R.length]={text:"全部",click:function(){Log.cache({from:"toolbar",type:"all"});t.entry(ax.extendBaseCondiction(S,"all"))}};if(am!=3){var ac=ax.extendBaseCondiction(S,"unread");ac.filterFlags.read=false;R[R.length]={text:"未读邮件",icon:"unread",click:function(){Log.cache({from:"toolbar",type:"unread"});t.entry(ac)},disabled:ax.isCurrent("read",false)}}if(am!=2&&am!=3){var ae=[];var ag=ax.extendBaseCondiction(S,"read");ag.filterFlags.read=true;ae[ae.length]={text:"已读",click:function(){Log.cache({from:"toolbar",type:"read"});t.entry(ag)},disabled:ax.isCurrent("read",true)};var Q=ax.extendBaseCondiction(S,"re");Q.filterFlags.replied=true;ae[ae.length]={text:"已回复",icon:"re",click:function(){Log.cache({from:"toolbar",type:"re"});t.entry(Q)}};var al=ax.extendBaseCondiction(S,"fw");al.filterFlags.forwarded=true;ae[ae.length]={text:"已转发",icon:"fw",click:function(){Log.cache({from:"toolbar",type:"fw"});t.entry(al)}};R[R.length]={text:"其他状态",menu:{groups:[{items:ae}]}}}N.push({items:R});var D=[],C=[];var av=ax.extendBaseCondiction(S,"att");if(Ext.newAttach){av.filterFlags.realAttached=true}else{av.filterFlags.attached=true}av.filterFlags.linkAttached=false;C[C.length]={text:"普通附件",icon:"att",click:function(){Log.cache({from:"toolbar",type:"att"});t.entry(av)}};var aj=ax.extendBaseCondiction(S,"bigAtt");aj.filterFlags.linkAttached=true;C[C.length]={text:"云附件",icon:"bigAtt",click:function(){Log.cache({from:"toolbar",type:"bigatt"});t.entry(aj)}};var ah=ax.extendBaseCondiction(S,"noAtt");if(Ext.newAttach){ah.filterFlags.realAttached=false}else{ah.filterFlags.attached=false}ah.filterFlags.linkAttached=false;C[C.length]={text:"无附件",click:function(){Log.cache({from:"toolbar",type:"noatt"});t.entry(ah)}};D[D.length]={text:"附件",menu:{groups:[{items:C}]}};var Z=Ud.get({field:"ntes_option",flag:"sizeshow"})-0;var U=(!$S("isFree")||Z==1);var W="发件人";var P="from";if(am==2||am==3){W="收件人";P="to"}var af=[];var af=[["按时间从新到旧","date",true],["按时间从旧到新","date",false],["按"+W+"降序",P,true],["按"+W+"升序",P,false],["按主题降序","subject",true],["按主题升序","subject",false]];if(U){af.push(["按邮件从大到小","size",true]);af.push(["按邮件从小到大","size",false])}var au=0;var ao=aq.order,ap=aq.desc;switch(ao){case"date":au=ap?0:1;break;case"to":case"from":au=ap?2:3;break;case"subject":au=ap?4:5;break;case"size":au=ap?6:7;break;default:}var O=[],aA=[];for(var at=0,ar=af.length;at<ar;at++){var ab=ax.extendBaseCondiction(S,"sort");var az=af[at];ab.order=az[1];ab.desc=az[2];aA[aA.length]={text:az[0],click:(function(aC,aB){return function(){Log.cache({from:"toolbar",type:"sort",order:aB[1],desc:aB[2]});t.entry(aC)}})(ab,az),checked:at==au}}O[O.length]={text:"排序",menu:{groups:[{items:aA,checkType:"radio"}]}};N.push({items:D.concat(O)});var V=LETTERFLAG;var aw=[],an=[];for(var at=2,ar=V.length;at<ar;at++){if(V[at]){var K=ax.extendBaseCondiction(S,"flag");K.filterFlags.label0=at;an[an.length]={text:V[at],icon:"flag-"+at,extcls:"txt-flag"+at,click:(function(aB,aC){return function(){Log.cache({from:"toolbar",type:"other",flagindex:aC});t.entry(aB)}})(K,at),disabled:ax.isCurrent("flag",at)}}}var K=ax.extendBaseCondiction(S,"flag");K.filterFlags.label0=1;aw[aw.length]={text:"红旗",icon:"flag-1",extcls:"txt-flag1",click:function(){Log.cache({from:"toolbar",type:"red"});t.entry(K)},disabled:ax.isCurrent("flag",1)};aw[aw.length]={text:"其他旗帜",menu:{groups:[{items:an}]}};N.push({items:aw});var T=[];if(Ext.tag&&!M.showTag){var aa=$I("init.Tag");var E=aa.list();var Y=[];for(sKey in E){var J=E[sKey];Y[Y.length]={text:J.name,icon:{type:"tag",subtype:J.color,xtype:"icon"},click:(function(aB){return function(){Log.cache({from:"toolbar",type:"tag"});t.entry({fid:am,tag:[aB]})}})(J.name),dieabled:(function(aB){return ax.isCurrent("tag",aB)})(J.name)}}if(Y.length>0){T[T.length]={text:"标签",menu:{groups:[{items:Y,type:"scroll"}]}}}}var L=[],ai;var ak=ax.extendBaseCondiction(S,"priority");ak.filterFlags.priority=1;var ad=ax.extendBaseCondiction(S,"priority");ad.filterFlags.priority=3;var ay=ax.extendBaseCondiction(S,"priority");ay.filterFlags.priority=5;ai=[{text:"紧急",click:function(){Log.cache({from:"toolbar",type:"priority",priorityvalue:"1"});t.entry(ak)}},{text:"普通",click:function(){Log.cache({from:"toolbar",type:"priority",priorityvalue:"3"});t.entry(ad)}},{text:"缓慢",click:function(){Log.cache({from:"toolbar",type:"priority",priorityvalue:"5"});t.entry(ay)}}];L[L.length]={text:"优先级",menu:{groups:[{items:ai}]}};N.push({items:T.concat(L)})}else{var S={field:"flags",operand:{}};var H={field:"priority",operand:3};var R=[];R[R.length]={text:"全部",click:function(){Log.cache({from:"toolbar",type:"all"});I()}};var ac=B.clone(S);ac.operand.read=false;R[R.length]={text:"未读邮件",icon:"unread",click:function(){Log.cache({from:"toolbar",type:"unread"});I(ac)}};var ae=[];var ag=B.clone(S);ag.operand.read=true;ae[ae.length]={text:"已读",click:function(){Log.cache({from:"toolbar",type:"read"});I(ag)}};var Q=B.clone(S);Q.operand.replied=true;ae[ae.length]={text:"已回复",icon:"re",click:function(){Log.cache({from:"toolbar",type:"re"});I(Q)}};var al=B.clone(S);al.operand.forwarded=true;ae[ae.length]={text:"已转发",icon:"fw",click:function(){Log.cache({from:"toolbar",type:"fw"});I(al)}};R[R.length]={text:"其他状态",menu:{groups:[{items:ae}]}};N.push({items:R});var D=[],C=[];var av=B.clone(S);if(Ext.newAttach){av.operand.realAttached=true}else{av.operand.attached=true}C[C.length]={text:"普通附件",icon:"att",click:function(){Log.cache({from:"toolbar",type:"att"});I(av)}};var aj=B.clone(S);aj.operand.linkAttached=true;C[C.length]={text:"云附件",icon:"bigAtt",click:function(){Log.cache({from:"toolbar",type:"bigatt"});I(aj)}};var ah=B.clone(S);if(Ext.newAttach){av.operand.realAttached=false}else{av.operand.attached=false}ah.operand.linkAttached=false;C[C.length]={text:"无附件",click:function(){Log.cache({from:"toolbar",type:"noatt"});I(ah)}};D[D.length]={text:"附件",menu:{groups:[{items:C}]}};N.push({items:D});var L=[],ai;var ak=B.clone(H);ak.operator="<";var ad=B.clone(H);ad.operator="=";var ay=B.clone(S);ay.operator=">";ai=[{text:"紧急",click:function(){Log.cache({from:"toolbar",type:"priority"});I(ak)}},{text:"普通",click:function(){Log.cache({from:"toolbar",type:"priority"});I(ad)}},{text:"缓慢",click:function(){Log.cache({from:"toolbar",type:"priority"});I(ay)}}];L[L.length]={text:"优先级",menu:{groups:[{items:ai}]}};N.push({items:L})}function I(aB){var aG=B.clone(M);var aF=aG.searchVars;var aC=["flags","priority"];var aE=aF.condictions;if(!aE){aE=aF.condictions=[]}aD(aE);t.entry(aG);function aD(aJ){var aI=false;for(var aH=aJ.length-1;aH>-1;aH--){var aK=aJ[aH];if(B.isArray(aK)){aI=true}else{if(v.has(aC,aK.field)){aJ.splice(aH,1)}}}if(!aI&&aB){aJ.push(aB)}}}}function k(J){var F=this;var K=F.view;var D=K.module;var C=K.folderSelected;var I={xtype:"button",subclass:"dropdownBtn",text:"更多",menu:{groups:[]},disabled:C};J.items.push(I);var E=I.menu.groups;var G=[{text:"导出选中邮件",click:function(){Log.cache({from:"toolbar",type:"export"});K.exportLetter()},disabled:C},{text:"转发选中邮件",click:function(){Log.cache({from:"toolbar",type:"fw"});K.forwardLetter()},disabled:C}];var H=D.fid;if((H==4||H==15)&&Ext.recovery){G.push({text:"删信恢复",click:function(){$E("interface.OutlinkInterface",function(L){L.goOutlink({key:"recovery",title:"删信恢复"})})}})}E.push({items:G})}function o(){var F=this;var C=F.view;var E=F.config;var G=E.groups;var D=C.module.fid;G[G.length]={items:[{xtype:"button",text:"刷 新",click:function(){Log.cache({from:"toolbar",type:"refresh"});C.refresh()}}]}}function w(){var aN=this;var F=aN.view;var aH=F.module;var ah=aN.config;var P=ah.groups;var az=F.module.fid;var aE=aH.getPage();var K=aH.index;if(az>0){var ai;try{sSentDate=aH.filter.sentDate;var W=aH.constructor;var aJ=sSentDate.split(":");var ab=aJ[0],U=aJ[1];var an=W.parseSentDate(ab),E=W.parseSentDate(U);if(an-E==0){ai=an}else{ai=[an,E]}}catch(aR){}P[P.length]={items:[{xtype:"calendar",onselect:function(aS,aV){if(!aV){aV=new window.Date(aS)}var aT=c.format(aS,"yyyyMMdd");var aU=c.format(aV,"yyyyMMdd");var aW=B.clone(aN.getBaseCondiction());aW.filter={sentDate:aT+":"+aU};Log.cache({from:"toolbar",type:"calendar"});t.entry(aW)},focus:ai}],type:"ext"}}var C=P[P.length]={items:[],type:"ext"};var Q=C.items;if(aE>0){var H=aE-1;var aw=K>0?function(){Log.cache({from:"toolbar",type:"previous"});F.goPage(K-1)}:undefined;var ax=!aw;var D=K<H?function(){Log.cache({from:"toolbar",type:"next"});F.goPage(K+1)}:undefined;var M=!D;var Y=[];for(var aL=0;aL<aE;aL++){Y.push({text:(aL+1)+"/"+aE,value:aL,checked:aL==K})}Q.push({xtype:"select",subclass:"simpleSelect",options:Y,title:"当前第"+K+"页",selectedchange:function(){Log.cache({from:"toolbar",type:"select"});F.goPage(this.value)}});Q.push({xtype:"button",icon:"prev",subclass:"roundBtn",disabled:ax,click:aw,title:"上一页",lazyListen:false},{xtype:"button",icon:"next",subclass:"roundBtn",disabled:M,click:D,title:"下一页",lazyListen:false})}var aM={groups:[],reverse:true};Q.push({xtype:"button",icon:"setting",subclass:"roundBtn",menu:aM,title:"设置"});var aK=aM.groups;var ag;ag=[];if(!($.Browser.ie()-0<9)){var V=Ud.get({field:"ntes_inbox",flag:"layout"})-0;if(V==0){V=1}var S=[["默认",1],["上下分栏",2],["左右分栏",3]];var at=[];for(var aL=0,aI=S.length;aL<aI;aL++){var aq=S[aL];var T=aq[1];at[at.length]={text:aq[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"layout"});F.setLayout(aS)}})(T),checked:V==T}}ag.push({text:"分栏布局",menu:{groups:[{items:at,checkType:"radio"}]}})}var aO=Ud.get({field:"ntes_letter",flag:"line_height"})-0;if(aO==0){aO=3}var av=Ud.get({field:"ntes_letter",flag:"font_size"})-0;if(av==0){av=1}var ac=-1;if((aO==1||aO==2)&&av==2){ac=1}else{if((aO==3||aO==0)&&(av==1||av==0)){ac=2}else{if(aO==4&&av==3){ac=3}}}var X=[["宽松",1],["适中",2],["紧凑",3]];var aA=[];for(var aL=0,aI=X.length;aL<aI;aL++){var ay=X[aL];var ae=ay[1];aA[aA.length]={text:ay[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"space"});F.setSpace(aS)}})(ae),checked:ac==ae}}ag.push({text:"显示设置",menu:{groups:[{items:aA,checkType:"radio"}]}});aK.push({items:ag});ag=[];var J=[];var aC=[["每页10封",10],["每页15封",15],["每页20封(推荐)",20],["每页30封",30],["每页50封",50],["每页100封",100]];var aQ=aH.limit;for(var aL=0,aI=aC.length;aL<aI;aL++){var G=aC[aL];var aF=G[1];J[J.length]={text:G[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"maxlist"});F.setMaxList(aS)}})(aF),checked:aQ==aF}}ag.push({text:"每页显示",menu:{groups:[{items:J,checkType:"radio"}]}});if($S("isFree")){if(aH.layout!="3"){var ap=[];var R=[["不显示",0],["显示",1]];var af=Ud.get({field:"ntes_option",flag:"sizeshow"})-0;for(var aL=0,aI=R.length;aL<aI;aL++){var ao=R[aL];var I=ao[1];ap[ap.length]={text:ao[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"sizeshow"});F.setSize(aS)}})(I),checked:af==I}}ag.push({text:"邮件大小",menu:{groups:[{items:ap,checkType:"radio"}]}})}}var au=Ud.get({field:"ntes_option",flag:"sendershow"})-0;var aG=[["发邮件时填写的姓名",1],["通讯录中对应的姓名",2]];var O=[];for(var aL=0,aI=aG.length;aL<aI;aL++){var N=aG[aL];var ar=N[1];O[O.length]={text:N[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"sendershow"});F.setSenderShow(aS)}})(ar),checked:(au==2)^(ar!=2)}}ag.push({text:"发/收件人显示",menu:{groups:[{items:O,checkType:"radio"}]}});aK.push({items:ag});ag=[];if(aH.isThread(true)){var aD=[];var aP=$S("isFree");var aa=[["开启",aP?0:1],["关闭",aP?1:0]];var am=Ud.get({field:"ntes_option",flag:"thread"})-0;for(var aL=0,aI=aa.length;aL<aI;aL++){var aB=aa[aL];var ad=aB[1];aD[aD.length]={text:aB[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"thread"});F.setThread(aS)}})(ad),checked:am==ad}}ag.push({text:"邮件会话",menu:{groups:[{items:aD,checkType:"radio"}]}})}if(Ext.summary&&az>-1){var Z=Ud.get({field:"ntes_option",flag:"summary"})-0;var L=[["开启",1],["关闭",0]];var al=[];for(var aL=0,aI=L.length;aL<aI;aL++){var ak=L[aL];var aj=ak[1];al[al.length]={text:ak[0],click:(function(aS){return function(){Log.cache({from:"toolbar",type:"summary"});F.setSummary(aS)}})(aj),checked:Z==aj}}ag.push({text:"邮件摘要",menu:{groups:[{items:al,checkType:"radio"}]}})}if(az==3&&!$S("isCorp")&&Ext.letterRecall){ag.push({text:"邮件撤回",click:function(){$E("interface.OptionInterface",function(aS){Log.cache({toolbaroption:"mailback"});aS.entry({module:"mailback",link:"backout"})})}})}if(ag.length>0){aK.push({items:ag})}ag=[];ag.push({text:"邮箱中心",click:function(){Log.cache({toolbaroption:"mailcenter"});l.entry({module:"mailcenter.MailCenterModule"})}});ag.push({text:"来信分类",click:function(){Log.cache({toolbaroption:"mailfilter"});l.entry({module:"MailFilterModule"})}});ag.push({text:"文件夹管理",click:function(){Log.cache({toolbaroption:"foldermanage"});t.entry()}});if(v.has([5,7,18],az)){ag.push({text:"智能分类设置",click:function(){Log.cache({toolbaroption:"antispam"});l.entry("options.AntiSpamModule")}})}aK.push({items:ag});ag=[];ag.push({text:"更多设置",click:function(){Log.cache({toolbaroption:"moreoptions"});l.entry({module:"BaseSetModule"})}});aK.push({items:ag})}function d(){var D=this;var E=D.view.module;var C=D.getConfig();E._toolbar.update(C);$.Component.setEvents(10)}function f(){var C=this,E=C.view.module;try{E._toolbar.destroy();E._toolbar=null}catch(D){}}function s(D){try{this.view.module._toolbar.find("checkbox")[0].setChecked(D,true)}catch(C){}}function a(){var F=this,H=F.view.module;if(!F.baseCondiction){var E=H.fid,D=H._var.param;var C=E==0;var I=!!H.filterFlags;var G=F.baseCondiction={fid:E,showTag:D.showTag,showFlag:D.showFlag,tag:C?D.tag:undefined,filterFlags:I&&C?{label0:H.filterFlags.label0}:{},filter:C?H.filter:undefined}}return F.baseCondiction}function j(I,C){var J=this,G=J.view.module;var M=G.filterFlags,D=!!M;var E=B.clone(I);if(D){var L=E.filterFlags;var K=[];switch(C){case"all":case"flag":case"read":case"unread":break;case"re":case"fw":case"att":case"bigAtt":case"noAtt":case"priority":K.push("read");K.push("label0");break;case"sort":K=true;break}if(K===true){B.extend(L,M,true)}else{for(var H=0,F=K.length;H<F;H++){var N=K[H];L[N]=M[N]}}}return E}function e(C){this.view=C}})();(function(){try{var g=$L("support.OptionSupport")}catch(m){return m}var x=$.Object;var j=$.Function;var s=$.Array;var y=$.String;var b=$.Date;var i=$.createClass($N("module.mbox.Tips"));x.extend(i.prototype,{getConfig:d,selectFolder:r,popDeleteInfo:h,popDeleteFolder:n,advLock:c,spamFolder:q,deleteFolder:p,systemDelete:f,forward:u,antiSpam:w,popInfo:v,recovery:e,hide:t,get:l,update:k,destroy:a,initialize:o});function d(){var z=this;var A=null;A=z.selectFolder(A);A=z.popDeleteInfo(A);A=z.popDeleteFolder(A);A=z.advLock(A);A=z.spamFolder(A);A=z.deleteFolder(A);A=z.systemDelete(A);A=z.forward(A);A=z.antiSpam(A);A=z.popInfo(A);A=z.recovery(A);A=z.hide(A);A.subclass="tipsBlock";if(!A.closeclick){A.closeclick=null}z.config=A;return A}function r(F){var C=this;var I=C.view;if(I.module.isSelectFolder()&&I.allSelected){var A=$I("init.Folder");var E,G,z=!!I.folderSelected;var H=I.module.fid;var D=A.get(H),B=A.getInfo(H);if(!z){E=new $.Link({text:"选择所有",click:function(){setTimeout(function(){I.setFolderSelect(true)},0)}});G="您已选中当前页所有邮件，您也可以 "+E.html()+" "+D.name+" "+B+" 封邮件"}else{E=new $.Link({text:"清除选中",click:function(){setTimeout(function(){I.setFolderSelect(false)},0)}});G="您已选中 "+D.name+" "+B+" 封邮件，您也可以 "+E.html()}F={content:G}}return F}function h(F){var C=this;var J=C.view;var B=J.module;var I=B.fid;if(F||I!=1){return F}var L=$I("init.Folder").get(15);if(!L){return F}var H="popDeleteInfo";if(!$S(H)){$S(H,true);$.Ajax.jsonp(Uri.getUrl("popDelQuery"),function(M){$S(H,M);C.update()})}else{try{var z=$S(H).data;var A=z.lastDelTime;if(A>z.lastCloseTipsTime){var E,G,K=new window.Date(A);E=new $.Link({text:L.name,click:function(){$E("interface.MboxInterface",function(M){M.entry({fid:15})})}});G="部分邮件在 "+$.Date.format(K,"yyyy-MM-dd HH:mm")+" 被客户端收取并删除，被删邮件已备份到 "+E.html()+" 文件夹";F={content:G,closeclick:function(){$.Ajax.jsonp(Uri.getUrl("popDelSet"),function(M){$S(H,M)});z.lastCloseTipsTime=(new window.Date()).getTime();C.update()}}}}catch(D){}}return F}function n(H){var D=this;var K=D.view;var C=K.module;var J=C.fid;try{if(!H){if(J==15){var L=$I("init.Folder").get(15);var G,I,F,z;var B={click:function(){$E("interface.OptionInterface",function(M){M.entry({module:"options.AntiSpamModule",inputName:"keepPeriod4"})});C.cleanCache()}};var A=L.keepPeriod;if(A>0){B.text="修改";F=new $.Link(B);z="自动删除"+A+"天"+($S("isCorp")?"":("("+F.html()+")"))+"以上邮件"}else{B.text="点击设置自动清理";F=new $.Link(B);z=F.html()}G=new $.Link({text:"禁止客户端收信",click:function(){Nav.entry("OptionInterface",{module:"options.OptionOutLinkModule",linkName:"smtp"})}});I="被客户端收取并删除的邮件备份在此，"+z+"，"+G.html();H={content:I}}}}catch(E){}return H}function c(E){var A=this;var H=A.view;var z=H.module;var G=z.fid;try{if(!E){var J=$S("advLock");var B=!J.disabled&&!J.authenticated2&&(J.pop||J.folders);var I=true;if(G>0){I=J[G]}if(B&&I){var D=new $.Link({text:"输入安全锁密码",click:function(){AdvLock.show(function(){H.refresh()})}});var F=D.html()+" 查看全部邮件";E={content:F}}}}catch(C){}return E}function q(E){var N=$I("init.Folder");var M=this;var I=M.view;var O=I.module;var J=O.fid;try{if(!E&&J==0&&O.filterFlags.read===false){var P=O.fids;var F=gCommon.nolistids;var Q=false;for(var L=F.length-1;L>-1;L--){if(s.has(P,F[L])){Q=true;break}}var B=0;var C=[];for(var L=F.length-1;L>-1;L--){var z=F[L];var H=N.getInfo(z,"unread");B+=H;if(H>0){C.push(N.get(z).name)}}var D=C.join("，");if(!Q){if(B>0){var A,K;A=new $.Link({text:"点击此处查看",click:function(){var R={fids:F,filterFlags:{read:false}};var S=O._var.extend;$E("interface.MboxInterface",function(T){T.entry(R,S)})}});K="不包含 "+D+" 的未读邮件，"+A.html();E={content:K}}}else{var A,K;A=new $.Link({text:"点击此处查看",click:function(){var R={exceptFids:gCommon.unnormalids.concat(1),filterFlags:{read:false}};var S=O._var.extend;$E("interface.MboxInterface",function(T){T.entry(R,S)})}});K=A.html()+"普通文件夹未读邮件";E={content:K}}}}catch(G){}return E}function p(E){var A=this;var C=A.view;var G=C.module;var D=G.fid;if(!E){if(D<1){var z;if(D==0){z=G.fids}else{z=G.searchVars.fid}if(z){var F,B;if(!s.has(z,4)){if($I("init.Folder").getInfo(4)>0){F=new $.Link({text:"点击此处查看",click:function(){var H=x.clone(G._var.param);var I=G._var.extend;if(D==0){H.fids=[4]}else{H.searchVars.fid=[4]}$E("interface.MboxInterface",function(J){J.entry(H,I)})}});B="不包含 已删除 文件夹的邮件， "+F.html()}}else{F=new $.Link({text:"点击此处查看",click:function(){var H=x.clone(G._var.param);var I=G._var.extend;if(D==0){delete H.fids}else{delete H.searchVars.fid}$E("interface.MboxInterface",function(J){J.entry(H,I)})}});B=F.html()+" 普通文件夹邮件"}if(B){E={content:B}}}}}return E}function f(E){var A=this;var I=A.view;var z=I.module;var G=z.fid;try{if(!E){var H=$S("isCorp");var C=z.getFolder();if(C.keepPeriod){var F="";if(G!=4){var D=new $.Link({text:"修改",click:function(){$E("interface.OptionInterface",function(J){J.entry({module:"options.AntiSpamModule",inputName:"keepPeriod2"})});z.cleanCache()}});F="("+D.html()+")"}E={content:"“"+C.name+"” 自动删除 "+C.keepPeriod+" 天"+F+"以上的邮件 ("+(H?"":"网易")+"强大的反垃圾系统已帮您拦截99.8%的垃圾邮件)"}}}}catch(B){}return E}function u(E){var B=this;var H=B.view;var A=H.module;var G=A.fid;try{if(!E&&!$S("closeForwardTips")){var J=g.getForwardAddr();if(J){var I="";var z=new $.Link({text:"自动转发设置",click:function(){D();$E("interface.OptionInterface",function(K){K.entry({module:"BaseSetModule",inputName:"autoForward"})})}});var F="目前您的邮件已设置自动转发到 "+J+"。如需修改请点击 "+z.html();E={content:F,closeclick:D}}}}catch(C){}return E;function D(){$S("closeForwardTips",true);setTimeout(function(){B.update()},10)}}function w(E){var C=this;var I=C.view;var B=I.module;var H=B.fid;var A=B.getInfo("unread");if(!E&&!$S("closeAntiSpamTips")){var G=g.isLowAntiSpamLevel();if(H<20&&A>0&&G){var z=new $.Link({text:"重新设置",click:function(){D();$E("interface.OptionInterface",function(J){J.entry({module:"AntiSpamModule"})})}});var F="垃圾邮件过多？可能是由于反垃圾级别设置过低或关闭了邮件智能分类，建议您 检查 或 "+z.html();E={content:F,closeclick:D}}}return E;function D(){$S("closeAntiSpamTips",true);setTimeout(function(){C.update()},10)}}function v(F){var C=this;var K=C.view;var A=K.module;var I=A.fid;if(!F&&!$S("closePopInfoTips")){var B=$I("init.Folder").checkFolder(I);if(B.isPop&&B.stats){var J=y.encodeHTML(new Email(B.username,B.name).toString());var L=B.stats.endTime||$I("util.Misc").getTime(0);var H=b.format(L,"yyyy-M-d HH:mm");var z=B.stats;var E=new $.Link({link:"pop3_skip_info",text:"查看详情",target:"_blank"});var G=[B.username,"&nbsp;于&nbsp;",H,"&nbsp;收取到 <strong>",(z.receivedMessageCount?z.receivedMessageCount:0),"</strong> 封新邮件",(z.skippedMessageCount?("，跳过了 <strong>"+z.skippedMessageCount+"</strong> 封邮件"+($S("isCorp")?"":("("+E.html()+")"))):""),(z.spamMessageCount?("，其中  <strong>"+z.spamMessageCount+"</strong> 封被移到垃圾邮件箱"):""),(z.errorMessageCount?("，收取  <strong>"+z.errorMessageCount+"</strong> 封出错"):""),(z.rejectedMessageCount?("，  <strong>"+z.rejectedMessageCount+"</strong> 封被拒收"):""),(z.excessMessageCount?("，  <strong>"+z.excessMessageCount+"</strong> 封超过单封邮件容量"):"")].join("");F={content:G,closeclick:D}}}return F;function D(){$S("closePopInfoTips",true);setTimeout(function(){C.update()},10)}}function e(E){var z=this;try{if(!E){if($S("isVip")&&!$S("closeRecoveryTips")){if(!($S("cos").pref_mail_preserving_days>0)){var D=1;if(D>0){var C=new $.Link({text:"立即开启&gt;&gt;",click:function(){A();$I("util.CustomAppManager").goOutLink("recovery","文件恢复")}});var B="开启文件恢复，防止邮件丢失！ "+C.html();E={content:B,closeclick:A}}}}}}catch(F){}return E;function A(){$S("closeRecoveryTips",true);setTimeout(function(){z.update()},10)}}function t(z){if(!z){z={hidden:true}}else{z.hidden=false}return z}function l(){var z=this;var B=z.getConfig();var A=z.block=new $.Block(B);return A.html()}function k(){var z=this;var A=z.block;var B=z.getConfig();A.update(B);$.Component.setEvents()}function a(){var z=this;try{z.block.destroy();z.block=null}catch(A){}}function o(A){var z=this;z.view=A}})();(function(){var w=$I("module.BaseAction");var y=$I("init.Folder");var C=$.Object;var q=$.Array;var x=$.createClass($N("module.mbox.ListAction"));C.mix(x,w,{funcs:{"mbox:updateMessageInfos":["ntes:mbox:updateThreadInfos","ntes:mbox:updateFolderMessageInfos"],"mbox:updateMessageTags":["ntes:mbox:updateThreadTags","ntes:mbox:updateFolderMessageTags"],"mbox:deleteMessages":[null,"mbox:emptyFolder",function(E,D){E.body={id:D,permanently:true}}]}},{setFunc:A,getIds:d,getList:v,getLetterInfo:e,getThreadInfo:z,getThreadIds:c,getTop:b,setRead:f,setFlag:g,setTag:a,setTop:u,setMemo:m,setFilter:r,rollback:t,move:i,moveAll:s,setAllRead:p,setSpam:h,setFilterRule:B,searchList:k,exportLetter:l,getLogModule:o,getRollbackData:n,initialize:j});function A(H,I,F,G){var K=this;var J=x.funcs[H.func];if(I){var D=J[0];if(D){H.func=D;H.thread=true;H.sent=F}}if(G>0){var D=J[1];H.func=D;var E=H.body;E.fid=G;delete E.ids;if(J[2]){J[2](H,G)}}}function d(G,E){var I=[],J={};for(var H=0,D=G.length;H<D;H++){var K=G[H];var F=K.id||(E?K:null);if(F){I.push(F);J[F]=true}}return[I,J]}function v(R){var D=this;var Y=D.module;var S=R.fid;var Z=R.fids;var H=R.order||"date";var O=R.desc||false;var J=R.filterFlags;var V=R.filter;var G=R.ruleConditions;var T=R.tag;var F=R.sync||false;var aa=R.start||0;var P=R.limit||$S("attrs").user.maxlist;var E=R.index>=0?R.index:Y?Y.index:0;var X=R.callback;var L=R.hideWait;var U=Y&&Y.isThread();var W=S==0;if(aa==0&&E>0){aa=E*P}var K=R.topFirst===true?true:Y?Y.isTopFirst():false;var N;if(Ext.summary){if(Ud.get({field:"ntes_option",flag:"summary"})-0==1){N=P}}var Q={func:U?"mbox:listThreads":"mbox:listMessages",body:{fid:Z?undefined:S,fids:Z,skipLockedFolders:W,order:H,desc:O,start:aa,limit:P,topFirst:K,filterFlags:J,filter:V,ruleConditions:G,tag:T,returnTotal:true,returnTag:Ext.tag,summaryWindowSize:N},sync:F,call:I,hideWait:L};try{if(T){Q.log={l:D.getLogModule(),action:"listtag",from:Y.param.from}}}catch(M){}D.wmsvr(Q);function I(ab){try{if(Y){Y.setTotal(ab.total)}}catch(ac){}X(ab)}}function e(D){var F=this;var K=D.isThread,H=D.id,N=D.callback;var L,G;var I=Ext.tag;if(!K){var J;if(Ext.summary){if(Ud.get({field:"ntes_option",flag:"summary"})-0==1){J=1}}L="mbox:getMessageInfos";G={ids:[H],"summaryWindowSize ":J,returnTag:I}}else{L="mbox:getThreadMessageInfos";G={id:H,returnTag:I}}var E={func:L,body:G,call:M};if(D.error){E.error=D.error}F.wmsvr(E);function M(O){var P=O["var"];N(K?P:P.length>0?P[0]:null)}}function z(H){var J=H.id;var G={func:"global:sequential",body:{items:[]},call:I};var E=G.body.items;for(var F=0,D=J.length;F<D;F++){E.push({func:"mbox:getThreadMessageInfos","var":{id:J[F]}})}this.wmsvr(G);function I(K){H.callback(K)}}function c(E){var F=this;F.getThreadInfo({id:E.id,callback:D});function D(N){var I=$I("core.DataAction").S_OK;var K=N["var"];var P=[];for(var M=0,J=K.length;M<J;M++){var G=K[M];if(G.code==I){var O=G["var"];for(var L=0,H=O.length;L<H;L++){P.push(O[L].id)}}}E.callback(P)}}function b(F){var H=this;var E=F.fid;if(!E){E=H.module.fid}var D={top:true};H.getList({fid:E,filterFlags:D,topFirst:true,sync:true,callback:G});function G(I){F.callback(I)}}function f(D){var H=this;var K=D.allFid;var Q=D.isRead;var J=D.data;var I=!!D.voidRequest;var P=D.callback;var F=D.hasThread;var G=D.hasSent;var L={flags:{read:Q}};var N=H.getIds(J);var M=H.getRollbackData(null,J,"read");if(I){O()}else{var E={func:"mbox:updateMessageInfos",body:{ids:N[0],attrs:L},log:{l:H.getLogModule(),action:"status",kind:Q?"read":"unread",count:N[0].length},call:O};H.setFunc(E,F,undefined,K);H.wmsvr(E)}function O(S){if(!y.isThread()||(F===false&&G===false)){R(false)}else{y.refresh(function(){R(true)},false,true)}function R(T){Listener.fire("letter:update",{list:N[1],type:"read",value:Q,data:J,isRefresh:T,isThread:F||G,all:K});var V;if(S){if(Ext.rollback&&!K&&(S.uk||M)){V=U}}P(S,V);function U(W){Log.cache({rollback:"read"});H.rollback({uk:S.uk,data:{ids:M.ids,attrs:{flags:{read:!Q}}},callback:W})}}}}function g(D){var H=this;var J=D.allFid;var K=D.flag;var I=D.data;var F=D.hasThread;var G=D.hasSent;var P=D.callback;var L={label0:K};if(K!=1){L.flags={flagged:false}}var N=H.getIds(I);var M=H.getRollbackData(null,I,"flag");var E={func:"mbox:updateMessageInfos",body:{ids:N[0],attrs:L},log:{l:H.getLogModule(),action:"mark",count:N[0].length},call:O};H.setFunc(E,F,undefined,J);H.wmsvr(E);function O(Q){Listener.fire("letter:update",{list:N[1],type:"flag",value:K,data:I,isThread:F||G,all:J});var S;if(Q){if(Ext.rollback&&!J&&(Q.uk||M)){S=R}}P(Q,S);function R(V){var U=[];for(var T in M.items){U.push({ids:M.items[T],attrs:{label0:T-0}})}Log.cache({rollback:"flag"});H.rollback({uk:Q.uk,data:{items:U},callback:V})}}}function a(E){var J=this;var L=E.allFid;var O=E.isAdd;var F=E.tag;var K=E.data;var H=E.hasThread;var I=E.hasSent;var S=E.callback;var D=$I("init.Tag");var P=J.getIds(K);var M=O&&F?[F]:undefined;var Q=O?undefined:(F?[F]:(function(){var ab=[];if(!L){for(var Y=0,W=K.length;Y<W;Y++){var U=K[Y].tag;if(U){for(var X=0,V=U.length;X<V;X++){var Z=U[X];if(D.get(Z)&&!q.has(ab,Z)){ab.push(Z)}}}}}else{var aa=D.list();for(sKey in aa){var T=aa[sKey];ab.push(T.name)}}return ab})());var N=J.getRollbackData(null,K,"tag");var G={func:"mbox:updateMessageTags",body:{ids:P[0],add:M,"delete":Q},log:{l:J.getLogModule(),action:"settag",count:P[0].length},call:R};J.setFunc(G,H,undefined,L);J.wmsvr(G);function R(T){Listener.fire("letter:update",{list:P[1],type:"tag",value:F,data:K,isAdd:O,isThread:H||I,all:L});var V;if(T){if(Ext.rollback&&!L&&(T.uk||N)){V=U}}S(T,V);function U(aa){var W=[];for(var Z in N.items){var X=Z=="%default%"?[]:Z.split(",");var Y={ids:N.items[Z]};if(O){Y["delete"]=[F]}else{if(!F){Y.add=X}else{Y.add=[F]}}W.push(Y)}Log.cache({rollback:"tag"});J.rollback({type:"tag",uk:T.uk,data:{items:W},callback:aa})}}}function u(D){var H=this;var M=D.fidInfo;var J=D.isTop;var I=D.data;var F=D.hasThread;var G=D.hasSent;var P=D.callback;var K={flags:{top:J}};var N=H.getIds(I);var L=H.getRollbackData(null,I,"top");var E={func:"mbox:updateMessageInfos",body:{ids:N[0],attrs:K},log:{l:H.getLogModule(),action:"top",count:N[0].length},call:O};H.wmsvr(E);function O(Q){Listener.fire("letter:update",{fid:M[1],list:N[1],type:"top",value:J,data:I,isThread:F||G});var S;if(Q){if(Ext.rollback&&(Q.uk||L)){S=R}}P(Q,S);function R(T){Log.cache({rollback:"top"});H.rollback({uk:Q.uk,data:{ids:L.ids,attrs:{flags:{top:!J}}},callback:T})}}}function m(D){var I=this;var G=D.memo;var J=D.data;var F=D.hasThread;var H=D.hasSent;var O=D.callback;var K={memo:G?G:""};var M=I.getIds(J);var L=I.getRollbackData(null,J,"memo");var E={func:"mbox:updateMessageInfos",body:{ids:M[0],attrs:K},log:{l:I.getLogModule(),action:"memo",count:M[0].length},call:N};I.wmsvr(E);function N(P){Listener.fire("letter:update",{list:M[1],type:"memo",value:G,data:J,isThread:F||H});var R;if(P){if(Ext.rollback&&(P.uk||L)){R=Q}}O(P,R);function Q(V){var S=[];for(var U in L.items){var T=U;if(U=="undefined"){T=""}S.push({ids:L.items[U],attrs:{memo:T}})}Log.cache({rollback:"memo"});I.rollback({uk:P.uk,data:{items:S},callback:V})}}}function r(F){var I=this;var D=F.ruleConditions,H=F.callback;var E={func:"mbox:updateMessageInfos",body:{rule:D},call:G};I.wmsvr(E);function G(J){Listener.fire("letter:setfilter");if(H){H()}}}function t(E){var K=this;var J=E.type,H=E.uk,I=E.data,G=E.callback;I.type=I.items?"multi":"single";var D={func:H?"ntes:mbox:messageUndo":J=="tag"?"ntes:mbox:updateMessageTags":"ntes:mbox:updateMessageInfos",body:H?{uk:H}:I,call:F};K.wmsvr(D);function F(L){Listener.fire("letter:rollback",{data:I});G(L)}}function i(D){var H=this;var J=D.allFid;var L=D.fidInfo;var N=D.moveToId;var I=D.data;var F=D.hasThread;var G=D.hasSent;var P=D.callback;var M=H.getIds(I);var K=H.getRollbackData(null,I,"move");var E={body:{ids:M[0]},log:{l:H.getLogModule(),count:M[0].length},call:O};if(N){E.func="mbox:updateMessageInfos";E.body.attrs={fid:N};E.log.action="move"}else{E.func="mbox:deleteMessages";E.log.action="delete"}H.setFunc(E,F,true,J);H.wmsvr(E);function O(R){if(!y.isThread()||(F===false&&G===false)){Q(false)}else{y.refresh(function(){Q(true)},false,true)}function Q(S){Listener.fire("letter:update",{fid:L[1],list:M[1],type:"move",value:N,data:I,isRefresh:S,isThread:F||G,all:J});var U;if(R){if(Ext.rollback&&!J&&N&&(R.uk||K)){U=T}}P(R,U);function T(X){var V=[];for(var W in K.items){V.push({ids:K.items[W],attrs:{fid:W-0}})}Log.cache({rollback:"move"});H.rollback({uk:R.uk,data:{items:V},callback:X})}}}}function s(D){var F=this;var G=F.module;var H=D.data;var J=D.moveToId;var L=D.callback;var I=F.getIds(H,true);var E={func:"mbox:updateMessageInfos",body:{ids:I[0],attrs:{fid:J}},call:K};F.wmsvr(E);function K(M){Listener.fire("search:removeall");L(M)}}function p(D){var F=this;var K=D.fid;var H=D.fids;var J=D.isThread;var I=D.other;var M=D.callback;var G=false;if(typeof K!="undefined"){if(K<1){if(!H){H=[];$I("init.Folder").each(function(N,P){var O=P.id;H.push(O)})}if($.Array.has(H,1)){G=true}}else{H=[K]}}var E={func:"ntes:mbox:setAllMessages",body:{thread:J,fids:H,all:G,other:I,read:true},call:L};F.wmsvr(E);function L(N){Listener.fire("letter:allread",K,J);var P;if(N){if(Ext.rollback&&!nAllFid&&(N.uk||oRollbackData)){P=O}}M(N,P);Log.cache({rollback:"allread"});function O(Q){F.rollback({uk:N.uk,callback:Q})}}}function h(L){var D=this;var E=L.data;var I=L.isSpam;var Q=L.addList;var P=L.deleteLetter;var G=L.hasThread;var S=L.hasSent;var R=L.callback;var H=L.ids;var O=L.email;var U=L.reportType;var J=L.spamType;if(!O||O.length==0){Q=false;P=false}var K={func:"ntes:mbox:reportSpam",body:{ids:H,emails:O,reportType:U,spamType:J,attrs:{deleteHistory:P,addList:Q,thread:G}},log:{l:D.getLogModule()},call:F,error:N};D.wmsvr(K);function F(V){M(V);if(Q){Listener.fire("rslist:add",I?"refuse":"safe",O);$E("support.OptionSupport",function(W){W.addList({name:I?"refuselist":"safelist",value:O.join(),noErr:true,forceAdd:true})})}R(T(V))}function N(W){var V=W.code;if(V=="FA_LIST_FULL"||V=="FA_LIST_NOT_UPDATE"){M(W,true);R(T(W,true));return true}}function M(aa,X){var Z,W;try{Z=aa["var"].updateMessageInfos["var"].mid;W={};for(var Y=0,V=Z.length;Y<V;Y++){W[Z[Y]]=true}}catch(ab){}Listener.fire("letter:setspam",I,P,G||S,!!X,W)}function T(X,W){var V={};var Y=X["var"];V.lettercount=Y.updateMessageInfos["var"]["count"];try{V.historycount=Y.deleteHistory["var"]["count"]}catch(Z){}try{V.listcount=Q?O.length:0}catch(Z){}V.listerror=!!W;return V}}function B(D){var F=this;var H=D.fid,I=D.email,G=D.history,L=D.callback;var E={func:"ntes:mbox:addHistoryFilter",body:{fid:H,email:I,history:G},call:K,error:J};F.wmsvr(E);function K(M){Listener.fire("letter:setfilterrule",G);if(L){L(M)}}function J(N){var M=N.code;if(M=="FA_ATTR_SIZE_EXCEEDED"){if(L){L()}return true}}}function k(D){var G=this;var H=G.module;var L=H.searchVars;var I=D.order||"date";var K=D.desc||false;var O=D.limit||$S("attrs").user.maxlist;var N=D.ids;var J=D.fids;var M=D.start>=0?D.start:H.index*H.limit;var Q=D.callback;var E={call:P};var F;if(N){E.func="mbox:getMessageInfos";F=E.body={ids:N};F.pattern=L.pattern}else{E.func="mbox:searchMessages";F=E.body=C.clone(L);F.order=I;F.desc=K}F.windowSize=O;F.summaryWindowSize=O;F.returnTag=Ext.tag;G.wmsvr(E);function P(V){if(N){var U=H.result["var"];var W=V["var"];for(var T=0,S=W.length;T<S;T++){var R=M+T;if(typeof U[R]=="string"){U[R]=W[T]}}}else{H.result=V}Q(V)}}function l(F){var I=this;var E=F.ids;var H=F.isThread;var G=F.callback;if(H){I.getThreadIds({id:E,callback:D})}else{D(E)}function D(M){var K=$.Ajax.IFRAME;var J=$S("sid");var L={requestType:K,method:$.Ajax.POST};if(M.length>1){L.url="./s?sid="+J+"&func=mbox:packMessages&l=inbox&action=pack&count="+M.length;L.body="mid="+M.join("&mid=")}else{L.url=Uri.getUrl("read_data",true)+"&mode=download&mid="+M.join("")+"&l=inbox&action=export"}I.request(L);G()}}function o(){return $.String.has((Context.getModule()||{name:""}).name,("mbox"))?"inbox":"read"}function n(J,N,G){if(!Ext.rollback){return}if(!J){J={}}if(N){for(var H=0,F=N.length;H<F;H++){var E=N[H];var D,M,L=E.id;switch(G){case"read":case"top":D="single";break;case"flag":M=E.label0;D="multi";break;case"memo":M=E.memo;D="multi";break;case"move":M=E.fid;D="multi";break;case"tag":M=(E.tag||[]).join()||"%default%";D="multi";break}if(D=="single"){var K=J.ids;if(!K){K=J.ids=[]}K.push(L)}else{var I=J.items;if(!I){I=J.items={}}var K=I[M];if(!K){K=I[M]=[]}K.push(L)}}}if(!J.ids&&!J.items){J=null}return J}function j(D){}})();(function(){var x=$.Object;var f=$I("module.BaseListener");var D=$.createClass($N("module.mbox.ListListener"));x.mix(D,f,null,{_listeners:{"compose:send":{handler:E},"folder:add":{handler:a},"folder:refresh":{handler:i},"folder:update":{handler:g},"folder:check":{handler:v},"folder:modify":{handler:c},"folder:remove":{handler:e},"folder:empty":{handler:u},"folder:keep":{handler:G},"tag:add":{handler:t},"tag:modify":{handler:y},"tag:remove":{handler:C},"tag:refresh":{handler:z},"letter:update":{handler:p},"letter:rollback":{handler:q},"letter:allread":{handler:w},"letter:setspam":{handler:j},"letter:setfilter":{handler:o},"letter:setfilterrule":{handler:n},"letter:schedule":{handler:F},"letter:closead":{handler:B},"search:removeall":{handler:m},"options:inboxModify":{handler:k},"options:contactModify":{handler:b},"addr:dataInit":{handler:r},"addr:dataReset":{handler:h},"read:recall":{handler:l},"read:wmsvrDelete":{handler:A},"global:resize":{handler:d}},__clean:s});function s(I,J){try{I.getDom("MainDiv").style.display="none"}catch(H){}I.cleanCache(J)}function E(){var I=this,K=I.module;var J=K.fid;if(J==2||J==3){var H=Context.getModule();if(K==H){K.view.refresh(K.index,true)}else{I.__clean(K)}}}function a(){var H=this;var J=H.module;var I=J.view;I.toolbar.update();if(J.fid==-1){J.searchVars.fid.push(nFid)}}function i(T){var N=this,J=N.module,R=J.view;var Q=J.fid;var P=Context.getModule();var K=J.order,M=J.desc;var S=J.filterFlags;var O=J==P;if(J.justRequest){try{R.update()}catch(L){}J.justRequest=false;return}if(T){var I=T[Q];if(I){if(K!="date"||!M){H()}else{if(Q>0){if(!S&&!J.filter&&!J.tag){J.setTotal(J.getInfo());R.update()}else{H()}}else{if(S&&typeof S.read=="boolean"){H()}}}}}function H(){if(O){J.view.refresh(J.index,true)}else{N.__clean(J)}}}function g(K){var J=this.module;var I=J.fid;if(K[I]&&J.isNormal()){J.setTotal(J.getInfo())}var H=J.view;H.update()}function v(V){try{var N=$L("module.mbox.Letter")}catch(L){return L}var O=this,K=O.module;var P=Context.getModule();var Q=K.fid,H=K.index,S=K.limit,J=K.order,M=K.desc;if(V){var I=V[Q];if(I){if(K!=P){O.__clean(K);return}if(Q>0){var U=K.isThread();if(!(I[U?"unreadThreadCount":"unreadMessageCount"]||I[U?"threadCount":"messageCount"])){return}if(J!="date"||!M){return}var R=K.filterFlags;if(R&&R.read===false){return}K.action.getList({fid:Q,order:J,desc:M,filterFlags:K.filterFlags,index:H,limit:S,callback:T})}else{K.view.refresh(K.index)}}}function T(aa){var ad=aa["var"],ah=K.data;if(ad.length==0){K.goPage(K.nIndex-1)}else{var aj=K.view;var al=aj.letters,X=aj.ids,ai=H*S;for(var af=0,ac=ai;af<ac;af++){ah[af]=undefined}var ab=K.getEl("ContentDiv");ab.show();for(var af=0,ac=ad.length;af<ac;af++){var ak=ad[af],Z=ah[ai+af],ag=al[af];if(Z&&ak.id==Z.id){var ae=ak.flags,W=Z.flags;if(ae.read!=W.read){W.read=ae.read;ag.setRead()}}else{var ag=new N(aj,ak);var Y=ag.getDiv();X[ag.id]=ag;if(!Z){ab.append(Y);ah.push(ak);al.push(ag)}else{if(af==0){ab.previous(Y)}else{$.fly(al[af-1].getDiv()).after(Y)}ah.splice(ai+af,0,ak);al.splice(af,0,ag)}}}$.Component.setEvents();if(al.length>ad.length){for(var af=al.length-1,ac=ad.length;af>=ac;af--){var ag=al[af];ag.remove(true);al.splice(af,1)}}ah.length=(H+1)*S;if(ah.length>K.getTotal()){ah.length=K.getTotal()}aj.showPeriod();ab.destroy()}}}function c(K){var I=this,L=I.module;var K=L.fid;if(K==L.fid){var J=L.view;J.update()}if(L.fid<1){var H=Context.getModule();if(L==H){L.view.goPage(L.index,true)}else{I.__clean(L)}}}function e(J){var I=this,K=I.module;var H=Context.getModule();if(J==K.fid){if(K==H){JS5.go({module:"mbox.ListModule",param:{fid:1}})}I.__clean(K,true);Tab.remove(K)}else{K.view.title.update()}}function u(K){var I=this;var L=I.module;var J=L.view;var H=Context.getModule();if(K==L.fid||K==4||K<1){if(H==L){J.refresh()}else{I.__clean(L)}}}function G(H){var I=this,K=I.module,J=K.view;if(H[K.fid]){J.tips.update()}}function t(H){var I=this;var K=I.module;var J=K.view;J.toolbar.update();x.each(J.letters,function(L,N){try{N.components.tagmanage.menu.update(N.tagManage())}catch(M){}})}function y(J,I,N){var L=this;var K=L.module;var P=K.view;var O=K.fid;var M=Context.getModule();var H=false;if(K.showTag){if(I!=N){if($.Array.has(K.tag,I)){Tab.remove(K);JS5.remove(K);H=true}}}if(M==K){if(!H){P.refresh(K.index)}}else{L.__clean(K)}}function C(I){var J=this;var O=J.module;var K=O.view;var H=Context.getModule();var M=O.fid;var L=O.showTag;var N=false;if(O.showTag){if($.Array.has(O.tag,I)){Tab.remove(O);JS5.remove(O);N=true}}if(O==H){if(!N){K.refresh(O.index)}}else{J.__clean(O)}}function z(I){var J=this;var N=J.module;var K=N.view;var M=N.fid;var L=N.showTag;var H=Context.getModule();if(I&&L){if(N==H){K.refresh(N.index)}else{J.__clean(N)}}}function p(ab){try{var V=$L("interface.MboxInterface",this)}catch(Q){return Q}var K=this,ai=K.module,T=ai.view,ac=ai.fid;var aj=ab.fid,W=ab.list,R=ab.type,U=ab.value,J=ab.data,M=ai._var.param,ah=ab.isThread,H=ab.all;var L=Context.getModule();if(ai!=L&&ah&&(ai.isThread()||ac==3)){af();return}if(ai==L&&H){af();return}if(R!="top"&&R!="move"){try{var N=ai.getCacheData();for(var ag=0,ae=0,Y=N.length,X=J.length;ag<Y&&ae<X;ag++){var aa=N[ag];if(W[aa.id]){O(aa);ae++}}}catch(Q){}try{var S=T.letters;for(var ag=0,ae=0,Y=S.length,X=J.length;ag<Y&&ae<X;ag++){var P=S[ag];if(W[P.data.id]){Z(P);ae++}}}catch(Q){}}if(!ai.isNormal()){ai.forceRequest=true}if(aj&&(aj[ac]||ai.isThread())&&ai.isTopFirst()&&R=="top"){af()}if(R=="move"){var al=U;var am=ac>0;if(!am||aj[ac]||ac==al||ai.isThread()){if(ai==L){if(!am){T.refresh(ai.index)}else{var I=J.length;if(!ai.isNormal()){var ad=ai.getTotal()-I;ai.setTotal(ad)}ai.insert(I,W);var ak=T.getLayout();if(ak){SMM.go({parent:ai,module:"mbox.PreviewModule",param:ai._var.param,viewType:ak,call:function(an){ai.layoutModule=an}})}}}else{if(aj[ai.fid]){var J=ai.data;for(var ag=J.length-1;ag>-1;ag--){try{if(J[ag]&&W[J[ag].id]){J.splice(ag,1)}}catch(Q){}}}K.__clean(ai)}}}if(R=="flag"){if(M.showFlag){af()}}if(R=="tag"){if(M.showTag){af()}}function O(an){V.syncData(ab,an)}function Z(an){switch(R){case"read":an.setRead();break;case"flag":an.setFlag();break;case"tag":an.setTag();break;case"memo":an.setMemo();break}}function af(){if(ai==L){T.refresh(ai.index)}else{K.__clean(ai)}}}function q(L){var I=this;var K=I.module;var J=K.view;var H=Context.getModule();if(K==H){J.refresh(K.index)}else{I.__clean(K)}}function w(K,M){var I=this;var L=I.module;var J=L.view;var H=Context.getModule();if(L==H){J.refresh(L.index)}else{if(K==L.fid||K<1||M){I.__clean(L)}}}function j(M,J,O,I){var K=this;var N=K.module;var L=N.view;var H=Context.getModule();if(N==H){N.view.refresh(N.index)}else{K.__clean(N)}}function o(){var H=this;var I=H.module;H.__clean(I)}function n(I){if(I){var J=this;var L=J.module;var K=L.view;var H=Context.getModule();if(L==H){L.view.refresh(L.index)}else{J.__clean(L)}}}function F(){var H=this;var I=H.module;H.__clean(I)}function B(){var H=this;var K=H.module,I=K.view;try{K.getDom("adDiv").style.display="none";I.showAd=false}catch(J){}}function m(){var H=this;var I=H.module;H.__clean(I)}function k(R){var N=this,K=N.module,P=K.view;var O=Context.getModule();var H={};for(var M=0,J=R.length;M<J;M++){var I=R[M];var Q=I.field,S=I.flag,L=I.value;if(Q=="ntes_letter"){if(S=="font_size"||S=="line_height"){H.setClass=true}}else{if(Q=="ntes_option"){if(S=="sizeshow"){H.forceRequest=true}else{if(S=="sendershow"||S=="summary"){H.forceRequest=true}}}else{if(Q=="ntes_inbox"){if(S=="layout"){K.layout=L;K.forceRequest=true;H.forceRequest=true}}else{if(Q=="maxlist"){K.limit=L;H.forceRequest=true}}}}}if(H.setClass){P.setClass();if(K!=O){P.toolbar.update()}}if(H.forceRequest){if(K==O){K.view.refresh(K.index,true,false,true)}else{N.__clean(K)}}if($.Object.count(H)>0){if(K==O){P.toolbar.update()}}}function b(Q){var M=this,J=M.module,O=J.view;var N=Context.getModule();for(var L=0,I=Q.length;L<I;L++){var H=Q[L];var P=H.field,R=H.flag,K=H.value;if(P=="ntes_option"&&R=="sendershow"){if(J==N){J.view.refresh(J.index,true)}else{M.__clean(J)}}}}function r(){var I=Ud.get({field:"ntes_option",flag:"sendershow"})-0;if(I==2){var J=this,L=J.module,K=L.view;var H=Context.getModule();if(L==H){L.view.refresh(L.index)}else{J.__clean(L)}}}function h(L){var I=Ud.get({field:"ntes_option",flag:"sendershow"})-0;if(I==2){if(L.contact){var J=this,M=J.module,K=M.view;var H=Context.getModule();if(M==H){M.view.refresh(M.index)}else{J.__clean(M)}}}}function l(K){var I=this;var L=I.module;var J=L.view;var H=Context.getModule();if(L.fid==3){if(L==H){L.view.refresh(L.index)}else{I.__clean(L)}}}function A(){var I=this;var K=I.module;var J=K.view;var H=Context.getModule();if(K.fid==3){if(K==H){K.view.refresh(K.index)}else{I.__clean(K)}}}function d(){try{var I=this.module;I.brandModule.setWidth()}catch(H){}}})();(function(){try{var u=$L("module.mbox.Letter");var an=$L("module.mbox.Toolbar");var o=$L("module.mbox.Tips");var v=$L("module.mbox.Title");var H=$L("module.mbox.Footer")}catch(al){return al}var ai=$.Object;var O=$.Function;var N=$.Event;var am=$.Array;var J=$.Date;var aa=$.Browser;var S=$I("util.Misc");var x=$I("module.BaseView");var R=$S("attrs").user.maxlist-0;var ah=aa.isIE();var ak=$.createClass($N("module.mbox.ListView"));ai.mix(ak,x,{fontSize:["","","nui-txt-s16","nui-txt-s12"],lineHeight:["","qb","mO","","qc"],addCss:P},{inserting:false,inserted:0,insertLimit:ah?20:100,succExpires:30000,getHtml:p,setClass:W,getToolbar:r,initPeriod:L,initPeriodFlag:a,getPeriodDiv:f,showPeriod:j,markReaded:at,markReFw:d,deleteInterval:I,createInterval:af,insertLetter:i,getAd:X,getLayout:z,drag:Z,bindEvent:C,getTargetInfo:ae,mouseover:e,click:F,keypress:n,contextmenu:ab,setRead:ag,setFlag:q,setTag:av,setTop:ac,setMemo:V,rollback:aj,move:U,remove:K,setSpam:G,setAllRead:y,exportLetter:t,forwardLetter:b,setLayout:au,setSpace:D,setSenderShow:h,setSize:T,setMaxList:aq,setThread:B,setSummary:w,setAdvLock:E,select:ap,selectAll:ad,selectFolder:Y,setFolderSelect:M,goPage:ar,refresh:Q,getSelected:k,filterSelected:ao,checkLetters:s,getSelectedData:l,getSelectedId:m,getCondition:g,update:A,initialize:c});function P(){if(!ak.addedCss){$.Ajax.request({requestType:$.Ajax.CSS,url:gEnvironment.cacheCssPath+"gibx_custom.css"});ak.addedCss=true}}function p(){var aA=this;var aC=aA.module;var aB=aC.getFolder();var ay=aC.getTotal();var az=ay==0;aA.completed=false;var ax=aA.setClass(true);var aw=[];aw[aw.length]='<div id="'+aC.createId("MainDiv")+'" class="'+ax[0]+'">';if(aA.showAd){aw[aw.length]='<div class="qi" id="'+aC.createId("adDiv")+'"></div>'}aw[aw.length]=aA.tips.get();aw[aw.length]=aA.title.get();if(aA.getControl){aw[aw.length]=aA.getControl()}aw[aw.length]='<div id="'+aC.createId("ContentDiv")+'" class="'+ax[1]+'" style="display:'+(az?"none":"")+'"></div>';aw[aw.length]=aA.footer.get();aw[aw.length]="</div>";return aA.addHeader(aA.getToolbar(),aw.join(""),"frame-main-cont-body-first")}function W(aC){var aH=this,aB=this.module,aG=aB.fid;var aK=aG==-1;var aF=aB.isThread()||aK||Ud.get({field:"ntes_option",flag:"summary"})-0==1;var ax=aH.getLayout();var aJ=["qu"];var aA=Ud.get({field:"ntes_letter",flag:"font_size"})-0;aJ.push(ak.fontSize[aA]);if(aA!=0&&aA!=1){aF=true}var aL=Ud.get({field:"ntes_letter",flag:"line_height"})-0;if(ax=="l-r"){aL=1}if(aL!=0&&aL!=3){aF=true}var aE=" "+ak.lineHeight[aL];aJ.push(ak.lineHeight[aL]);var aI=["pX","sv"];var aD=Ud.get({field:"ntes_option",flag:"sizeshow"})-0;var az=this.sizeShow=(!$S("isFree")||aD==1);if(az){aI.push("lT");aF=true}if(aK&&aB.searchVars.pattern){aI.push("kh")}if(ax=="l-r"){aI.push("kQ");bNeedReqeust=true}if(aB.showBrand){bNeedReqeust=true}if(aF){ak.addCss()}if(aC){return[aJ.join(" "),aI.join(" ")]}else{var ay=aB.getEl("MainDiv"),aw=aB.getEl("ContentDiv");ay.setClass(aJ.join(" "));aw.setClass(aI.join(" "));ay.destroy();aw.destroy()}}function r(){var aw=this,ay=aw.module;var ax=new $.Toolbar(aw.toolbar.getConfig());ay._toolbar=ax;return ax.html()}function L(){var aJ=this,aB=aJ.module;if(aB.order!="date"){return}var aH=[];if(!aJ.period){var aw=1,aI=true;var aF;var az=S.getTime(0);var aG=new window.Date(az.getFullYear(),az.getMonth(),az.getDate()+1);var aL,aE,ay;if(aB.isTopFirst()){aH[aH.length]={name:"置顶"}}if(!aI){aH[aH.length]={name:"未来",start:new window.Date(aG.getTime()),end:new window.Date(10000,0,1)}}for(var aD=0,aA=az.getDay();aD<=aA;aD++){if(aw>-1&&aD>aw){break}if(aD==0){aF="今日";ay=aH.length}else{if(aD==1){aF="昨日"}else{aF="周"+J.getWeek(az,-aD)}}aH[aH.length]={name:aF,start:new window.Date(J.addDate(aG,-1)),end:new window.Date(aG.getTime()-1)};aG=new window.Date(J.addDate(aG,-1))}aL=new window.Date(-10000,0,1);aE=(new window.Date(aG));aH[aH.length]={name:"更早",start:aL,end:aE};if(aI){aH[ay].end=new window.Date(10000,0,1)}aJ.period=aH}else{aH=aJ.period;if(aH){for(var aD=0,aA=aH.length;aD<aA;aD++){var aK=aH[aD];var ax=aK.div||document.getElementById(aK.id);try{if(ax){ax.parentNode.removeChild(ax)}}catch(aC){}delete aK.div}}}}function a(){this.periodFlag=false}function f(aK,aw){var aE=this,aN=aE.module;if(aN.order!="date"){return}var aA=aK.flags.top;var az=aN.isTopFirst();var aC=aE.period;var aH=aK.sentDate;for(var aL=0,aJ=aC.length;aL<aJ;aL++){var ay=aC[aL];if(az&&aA&&aL==0){break}else{if(aH>=ay.start&&aH<=ay.end){break}}}var ay=aC[aL];if(ay.div||ay.id){if(!ay.count){ay.count=1}else{ay.count++}}else{ay.count=1;var aG={};var aF="kg";if(!aE.periodFlag){if($S("isFree")&&aN.fid!=2&&aN.getInfo("unread")>0){aF="eS"}aE.periodFlag=true}aG.id=aN.createId((ay.start?ay.start.getTime().toString():"top")+(new window.Date()).getTime().toString());aG.className="pL "+aF;aG.innerHTML='<span class="hc">'+ay.name+'</span><span class="nui-title-tips nui-txt-tips"></span>';aG.title=ay.name;aG["aria-label"]=aG.title;aG.tabIndex=0;if(aw){var aM=[];var aD="";for(sKey in aG){var ax=aG[sKey];switch(sKey){case"className":aM.push('class="'+ax+'"');break;case"tabIndex":aM.push('tabindex="'+ax+'"');break;case"innerHTML":aD=ax;break;default:aM.push(sKey+'="'+ax+'"')}}var aI=["<div ",aM.join(" "),">",aD,"</div>"].join("");ay.id=aG.id;return aI}else{var aB=ay.div=document.createElement("DIV");for(sKey in aG){var ax=aG[sKey];if(sKey=="aria-label"){aB.setAttribute(sKey,ax)}else{aB[sKey]=ax}}return aB}}}function j(ax){var aF=this,az=aF.module;if(az.order!="date"){return}var aH=aF.letters;var aE=aF.period;var aI=az.getDom("ContentDiv");if(!ax){try{aF.initPeriod();aF.initPeriodFlag()}catch(aA){}for(var aB=0,ay=aH.length;aB<ay;aB++){try{var aC=aH[aB];var aw=aF.getPeriodDiv(aC.data);if(aw){aI.insertBefore(aw,aC.getDiv())}}catch(aA){}}}for(var aB=0,ay=aE.length;aB<ay;aB++){var aJ=aE[aB];var aw=aJ.div;if(!aw){aw=aJ.div=document.getElementById(aJ.id);aJ.id=null}if(aw){try{var aG=aw.getElementsByTagName("SPAN"),aD=aG[aG.length-1];aD.innerHTML="("+aJ.count+")"}catch(aA){}}}}function at(){try{var aE=this;var aD=aE.readedMid;var aC=$S("lastRead");if(aC&&aC!=aD){var aF=aE.letters;var az,aw;for(var aA=0,ax=aF.length;aA<ax;aA++){var aB=aF[aA];if(aB.data.id==aC){aB.setLastRead(true);az=true}if(aB.data.id==aD){aB.setLastRead(false);aw=true}if(az&&aw){break}}aE.readedMid=aC}}catch(ay){}}function d(){try{var az=this;var aB=$S("refw");var aE=az.letters;if(aB){for(var aF in aB){var aG=aB[aF];for(var aC=0,ay=aE.length;aC<ay;aC++){var aD=aE[aC];var ax=aD.data;if(ax.id==aF){var aw=ax.flags;if(!aw){ax.flags=aw={}}if(!aw.replied){aw.replied=aG.replied}if(!aw.forwarded){aw.forwarded=aG.forwarded}aD.setReFw();delete aB[aF];break}}}}}catch(aA){}}function I(){var aw=this;try{clearTimeout(aw.interval);aw.inserted=0;aw.inserting=false;$I("init.Support").initIE6()}catch(ax){}}function af(){var ax=this;var aw=!ah||$S("attrs").user.maxlist<=ax.insertLimit;ax.deleteInterval();ax.module.removeCache();ax.initPeriod();if(aw){ay()}else{ax.interval=setTimeout(ay,0)}function ay(){ax.insertLetter(null,null,aw)}}function i(az,ay,ax){var aH=this;var aQ=aH.module;if(aH.inserting){aB();return}else{aH.inserting=true;try{if(!az){az=aQ.getCacheData()}var aE=$S("attrs").user.maxlist;var aR=aH.insertLimit;var aL=aH.inserted;var aG=aH.letters;var aI=aH.ids;var aw=aQ.getDom("ContentDiv");var aJ=document.createDocumentFragment();var aK=[];if(az&&aL<az.length&&aL<aE){if(aL>0){aR=40}else{aH.initPeriodFlag()}for(var aP=0,aN=az.length,aM=ax?aE:aR;aL<aN&&aP<aM;aL++,aP++){var aO=az[aL];if(!ay){try{if(aO.sentDate.getTime()<=0){aO.sentDate=new window.Date(S.getTime(0))}}catch(aC){}if(ax){aK.push(aH.getPeriodDiv(aO,ax))}else{var aD=aH.getPeriodDiv(aO,ax);if(aD){aJ.appendChild(aD)}}}try{var aA=new u(aH,aO,ax);if(ax){aK.push(aA.html)}else{aJ.appendChild(aA.div)}aG.push(aA);aI[aA.id]=aA}catch(aC){}}aH.inserted=aL;if(ax){aw.innerHTML=aK.join("")}else{aw.appendChild(aJ)}if(aL<aN){aB()}else{aF(true)}}else{aF(true)}}catch(aC){aH.deleteInterval();if(!aQ._var.retry){setTimeout(function(){aH.refresh(aQ.index,true,true)},0)}}aH.inserting=false}function aB(){aH.interval=setTimeout(function(){aH.insertLetter(az,ay,ax)},0)}function aF(aS){aH.inserting=false;aH.completed=aS;aH.showPeriod(!ay);setTimeout(function(){aH.deleteInterval();if(aS){aH.markReaded();aH.markReFw();aH.getAd();aQ.lazyLoad();$.Component.setEvents(10)}},0)}}function X(ay){var aG=this;var aA=aG.module;var aH=aA.name;var ax;try{if(aG.showAd&&!aA.showBrand){switch(typeof ay){case"object":aA.adData=ay;ax=aA.adIndex=0;case"number":aData=aA.adData;if(typeof ax=="undefined"){aA.adIndex=ax=(aData.length+aA.adIndex+ay)%aData.length}var az=aData[ax];var aC=[];var aF=new $.Link({title:"上一条",cls:"kL nui-fIBlock",icon:"lArr",click:function(){Log.cache({adfrom:"inbox",adaction:"previous"});aG.getAd(-1)}});var aw=new $.Link({title:"下一条",cls:"kL nui-fIBlock",icon:"rArr",click:function(){Log.cache({adfrom:"inbox",adaction:"next"});aG.getAd(1)}});var aE=new $.Link({title:"关闭",cls:"kL nui-fIBlock",icon:"close",click:function(){Log.cache({adfrom:"inbox",adaction:"close"});$S("closeAd",true);Listener.fire("letter:closead")}});aC[aC.length]='<div class="oI">'+aF.html()+aw.html()+aE.html()+"</div>";aC[aC.length]='<span class="oi">[<a href="'+az.type_link+'" class="mK nui-txt-tips" target="_blank">'+az.type+'</a>]</span><a href="'+az.link+'" class="mK mn" target="_blank">'+az.title+'</a> - <a href="'+az.link+'" class="mK lS" target="_blank">'+az.url+"</a> - "+az.line1+" "+az.line2;var aD=aA.getDom("adDiv");if(aD){aD.innerHTML=aC.join("");aD.style.display="";$.Component.setEvents(10)}break;default:$E("support.Ad",function(aI){aI.request("&action=el",O.bind(aG.getAd,aG))})}}else{try{aA.getEl("adDiv").hide()}catch(aB){}}}catch(aB){}}function z(){var aw=this,ay=aw.module;var ax=ay.layout-0;var az;switch(ax){case 3:az="l-r";break;case 2:az="t-b";break;default:az=""}return az}function Z(aC,aw){var aG=this;var aA=aG.module;var az=$(document.body);var aF=aG.dragDiv;var ay=$.Event.get();switch(aw){case"mousedown":aC.setChecked(true);var aI=aG.getSelected();var aJ=aI.length;var aD='移动<span class="ng">'+aJ+"</span>封邮件";aF.innerHTML=aD;aF.style.left=ay.pageX+2+"px";aF.style.top=ay.pageY+2+"px";break;case"start":aF.style.display="";break;case"drag":var aE;var ax=$.Event.getTarget();var aH=$.fly(ax).findParent("LI",true);if(aH){aE=Nav.getFid(aH.dom.id)}if(aE>0&&aE!=(Context.getModule()||{}).fid){aG.dragToFid=aE;az.removeClass("oG");az.addClass("oh")}else{aG.dragToFid=null;az.addClass("oG");az.removeClass("oh")}break;case"end":az.removeClass("oG");az.removeClass("oh");aF.style.display="none";var aB=aG.dragToFid;if(aB>0){aG.move(aB);aG.dragToFid=null}break}az.destroy()}function C(){var aw=this,ay=aw.module;var ax=$.fly(ay.getDom("ContentDiv"));ax.listen("mouseover",O.bind(aw.mouseover,aw));ax.listen("click",O.bind(aw.click,aw));ax.listen("touchend",O.bind(aw.click,aw));ax.listen("keypress",O.bind(aw.keypress,aw));ax.listen("contextmenu",O.bind(aw.contextmenu,aw))}function ae(){var az=this,aB=az.module;var ax=N.getTarget();var ay=aB.getDom("ContentDiv");var aw={};while(ax){if(ax==ay){break}var aA=ax.getAttribute("sign");if(aA){if(aA=="letter"){aw.div=ax;break}else{if(!aw.sign){aw.sign=aA;aw.target=ax}}}ax=ax.parentNode}if(!aw.div){aw=null}return aw}function e(){var ay=this;try{var aw=ay.getTargetInfo();if(aw){var ax=aw.div;var aA=ay.ids[ax.id];aA.mouseover(aw)}}catch(az){}}function F(){var ay=this;try{var aw=ay.getTargetInfo();if(aw){var ax=aw.div;var aA=ay.ids[ax.id];aA.click(aw)}}catch(az){}}function n(){var ay=this;try{var aw=ay.getTargetInfo();if(aw){var ax=aw.div;var aA=ay.ids[ax.id];aA.keypress(aw)}}catch(az){}}function ab(){var ay=this;try{var aw=ay.getTargetInfo();if(aw){var ax=aw.div;var aA=ay.ids[ax.id];aA.contextmenu(aw)}}catch(az){}}function ag(aB,ax,aA){var az=this;var ay=az.allSelected&&az.folderSelected;ax=az.getSelected(ax,function(aD){return aD.data.flags.read^aB});if(!ay&&!az.checkLetters(ax,aA)){return false}var aw=az.getSelectedData(ax);$E("module.mbox.ListModule",function(aD){aD.setRead({allFid:ay?az.module.fid:undefined,isRead:aB,data:aw,callback:aC})});function aC(aE,aG){if(!aA){var aD="";if(aG){aD="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aF})).html()}$.Tips.show({succ:true,text:"成功设置邮件为"+(aB?"已读":"未读")+aD,expires:aD?az.succExpires:undefined});$.Component.setEvents()}function aF(){az.rollback(aG)}}}function q(aB,ax){var az=this;var ay=az.allSelected&&az.folderSelected;ax=az.getSelected(ax,function(aC){return aC.data.label0!=aB});if(!ay&&!az.checkLetters(ax)){return false}var aw=az.getSelectedData(ax);$E("module.mbox.ListModule",function(aC){aC.setFlag({allFid:ay?az.module.fid:undefined,flag:aB,data:aw,callback:aA})});function aA(aD,aF){var aC="";if(aF){aC="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aE})).html()}$.Tips.show({succ:true,text:"成功"+(aB>0?"设置":"取消")+"邮件旗帜"+aC,expires:aC?az.succExpires:undefined});$.Component.setEvents();function aE(){az.rollback(aF)}}}function av(aw,az,ay,aC){var aB=this;var aA=aB.allSelected&&aB.folderSelected;ay=aB.getSelected(ay,function(aG){var aE=aG.data.tag;var aF=false;if(aw){aF=!(aE&&am.has(aE,az))}else{aF=!az||(az&&am.has(aE,az))}return aF});if(!aA&&!aB.checkLetters(ay)){return false}var ax=aB.getSelectedData(ay);$E("module.mbox.ListModule",function(aE){aE.setTag({allFid:aA?aB.module.fid:undefined,isAdd:aw,tag:az,data:ax,callback:aD})});if(aC){N.stop()}function aD(aF,aH){var aE="";if(aH){aE="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aG})).html()}$.Tips.show({succ:true,text:"成功"+(aw?"设置":("取消"+(az?"":"所有")))+"邮件标签"+aE,expires:aE?aB.succExpires:undefined});$.Component.setEvents();function aG(){aB.rollback(aH)}}}function ac(az,aD,aA){var aB=this;var aw=aB.module;var ax=false;var aC=null;if(!aA){aA=aw.fid}aD=aB.getSelected(aD,function(aF){return !!aF.data.flags.top!=az});if(!aB.checkLetters(aD)){return false}var ay=aB.getSelectedData(aD);$E("module.mbox.ListModule",function(aF){aF.setTop({fid:aA,isTop:az,data:ay,callback:aE})});function aE(aG,aI){var aF="";if(aI){aF="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aH})).html()}if(aG){$.Tips.show({succ:true,text:"成功"+(az?"设置":"取消")+"邮件置顶"+aF,expires:aF?aB.succExpires:undefined});$.Component.setEvents()}function aH(){aB.rollback(aI)}}}function V(az,ax){var ay=this;var aB=ay.module;ax=ay.getSelected(ax,function(aC){return aC.data.memo!=az});if(!ay.checkLetters(ax,true)){return false}var aw=ay.getSelectedData(ax);$E("module.mbox.ListModule",function(aC){aC.setMemo({memo:az,data:aw,callback:aA})});function aA(aD,aF){var aC="";if(aF){aC="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aE})).html()}$.Tips.show({succ:true,text:"成功"+(az?"设置":"取消")+"邮件备注"+aC,expires:aC?ay.succExpires:undefined});$.Component.setEvents();function aE(){ay.rollback(aF)}}}function aj(az){var aw=this,ay=aw.module;$E("module.mbox.ListModule",function(aA){aA.rollback({rollback:az,callback:ax})});function ax(aA){$.Tips.show({succ:true,text:"成功取消操作"})}}function U(aE,aD){var aC=this;var ay=aC.module;var aB=ay.fid;var ax=$I("init.Folder");var az=aC.allSelected&&aC.folderSelected;aD=aC.getSelected(aD,function(aG){return aG.data.fid!=aE||(aB>0&&aB!=aE)});if(!az&&!aC.checkLetters(aD)){return false}var aA=aC.getSelectedData(aD);$E("module.mbox.ListModule",function(aG){aG.move({allFid:az?aC.module.fid:undefined,moveToId:aE,data:aA,callback:aF})});function aF(aI,aM){try{var aJ=$L("interface.MboxInterface")}catch(aK){return aK}if(!aE){$.Tips.show({succ:true,text:"成功删除邮件"})}else{var aG="";if(aM){aG="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aL})).html()}var aH=new $.Link({text:ax.get(aE).name,click:O.bind(aJ.entry,aJ,{fid:aE})});$.Tips.show({succ:true,text:"成功移动邮件到 "+aH.html()+aG,expires:aG?aC.succExpires:undefined});$.Component.setEvents()}if(aB==1&&aE>20){aw()}function aL(){aC.rollback(aM)}}function aw(){if(aA.length<2){return}var aJ;for(var aI=0,aG=aA.length;aI<aG;aI++){if(aA[aI].threadMessageCount>1){return}var aH=Uri.getAddress(aA[aI].from).toLowerCase();if(!aJ){aJ=aH}else{if(aJ!=aH){return}}}if(!aJ){return}$E("interface.OptionInterface",function(aL){aL.checkFilterLimit(aK);function aK(aT){if(!aT){var aO="对来自 "+aJ+" 的邮件执行以下规则：";var aN=new $.Checkbox({text:"以后自动移动到&nbsp;<strong>"+ax.get(aE).name+"</strong>&nbsp;文件夹",checkedchange:function(){if(!this.checked){aM.setChecked(false,true)}}});var aM=new $.Checkbox({text:"对已收到邮件执行相同操作",checkedchange:function(){if(this.checked){aN.setChecked(true,true)}}});var aS=aN.html()+"<br/>"+aM.html();var aQ=$.Msgbox.show({type:"confirm",header:"新建来信分类规则",content:aS,title:aO,ok:aP});$.Component.setEvents()}function aP(){if(aN.checked){ay.action.setFilterRule({fid:aE,email:aJ,history:aM.checked,callback:aR})}}function aR(aU){if(aU){$.Tips.show({succ:true,text:"成功设置来信分类"})}else{var aV=$.Msgbox.show({content:"无法添加来信分类，请先清理已存在来信分类规则。",title:"设置来信分类失败"})}}}})}}function K(aw){var ax=this;var ay=aw?null:4;Log.cache({from:"del"});ax.move(ay)}function G(aA,ax){var ay=this;var aC=ay.module;ax=ay.getSelected(ax);if(!ay.checkLetters(ax)){return false}var az=aC.fid;var aw=ay.getSelectedData(ax);$E("module.mbox.ListModule",function(aD){aD.setSpam({fid:az,data:aw,isSpam:aA,callback:aB})});function aB(aF,aE){var aD=[];aD[aD.length]="成功"+(aA?"举报":"信任")+"邮件";if(aF.historycount){aD[aD.length]="删除历史来信"+aF.historycount+"封"}if(aF.listcount){aD[aD.length]="将"+aF.listcount+"个发件人加入"+(aA?"黑":"白")+"名单"}else{if(aF.listerror){aD[aD.length]="发件人没有加入"+(aA?"黑":"白")+"名单，请进入设置清理名单"}}$.Tips.show({succ:true,text:aD.join("，")})}}function y(){var ay=this;var aB=ay.module;var az=aB.fid;var ax=aB.fids;if(ax&&ax.length==1){az=ax[0]}var aw={};$E("module.mbox.ListModule",function(aD){aD.setAllRead({fid:az,fids:ax,isThread:aB.isThread(),other:az==0,callback:aA})});function aA(aE,aF){var aD="";if(aF){aD="&nbsp;"+(new $.Link({text:"撤销",bracket:true,click:aC})).html()}$.Tips.show({succ:true,text:"成功设置全部已读"+aD,expires:aD?ay.succExpires:undefined})}function aC(){ay.rollback(fRollback)}}function t(aw){var ax=this;var aA=ax.module;aw=ax.getSelected(aw);if(!ax.checkLetters(aw)){return false}var ay=ax.getSelectedData(aw,true);$E("module.mbox.ListModule",function(aB){aB.exportLetter({ids:ay,isThread:aA.isThread(),callback:az})});function az(){am.each(aw,function(aB,aC){aC.setChecked(false)})}}function b(){var ax=this;var aB=ax.module;var aA=aB.isThread();var aw=ax.getSelected();if(!ax.checkLetters(aw)){return false}var ay=ax.getSelectedData(aw,true);$E("module.mbox.ListModule",function(aC){aC.forwardLetter({ids:ay,isThread:aB.isThread(),callback:az})});function az(){am.each(aw,function(aC,aD){aD.setChecked(false)})}}function au(ax){var aw=this;if(ax==0){ax=1}$E("support.OptionSupport",function(az){az.setAttr({field:"ntes_inbox",flag:"layout",value:ax,relModule:["inbox","read"],callback:ay})});function ay(){$.Tips.show({succ:true,text:"成功设置列表分栏布局"})}}function D(ay){var ax=this;var aw=0,aA=0;if(ay==1){aw=2;aA=2}else{if(ay==2){aw=3;aA=1}else{if(ay==3){aw=4;aA=3}}}$E("support.OptionSupport",function(aB){aB.setAttr({field:"ntes_letter",flag:"font_size",value:aA,module:"inbox",noFire:true,callback:function(){aB.setAttr({field:"ntes_letter",flag:"line_height",value:aw,module:"inbox",callback:az})}})});function az(){$.Tips.show({succ:true,text:"成功设置列表显示"})}}function h(aw){var ax=this;$E("support.OptionSupport",function(az){az.setAttr({field:"ntes_option",flag:"sendershow",value:aw,module:"contact",callback:ay})});function ay(){$.Tips.show({succ:true,text:"成功设置发件人显示"})}}function T(aw){var ax=this;$E("support.OptionSupport",function(az){az.setAttr({field:"ntes_option",flag:"sizeshow",value:aw,module:"inbox",callback:ay})});function ay(){$.Tips.show({succ:true,text:"成功设置邮件显示"})}}function aq(aw){var ax=this;$E("support.OptionSupport",function(az){az.setAttr({field:"maxlist",value:aw,module:"inbox",callback:ay})});function ay(){$.Tips.show({succ:true,text:"成功设置每页显示邮件数"})}}function B(aw){var ay=this;$E("support.OptionSupport",function(aA){aA.setAttr({field:"ntes_option",flag:"thread",value:aw,module:"inbox",callback:ax})});function ax(){$.Msgbox.show({title:"会话设置成功，点击确定刷新邮箱",ok:az,close:az})}function az(){top.location.reload()}}function w(aw){var ay=this;$E("support.OptionSupport",function(az){az.setAttr({field:"ntes_option",flag:"summary",value:aw,module:"inbox",callback:ax})});function ax(){$.Tips.show({succ:true,text:"成功设置邮件摘要"})}}function E(){var aw=this,aC=aw.module;var az=aC.fid;var aB=aC.getFolder();var ay=$S("advLock");var ax,aA;if(aB.pop){ax="pop";aA=ay.pop}else{ax="folder";aA=ay[az]}$I("init.AdvLock").setProduct({product:ax,fid:az,cancel:aA})}function ap(ay){var aF=this,aB=aF.module;var aG=aF.letters;var aI=0;for(var aD=0,aA=aG.length;aD<aA;aD++){var aE=aG[aD];var az=aE.data;var ax=az.flags;var aH=!!aE.checked;var aw=true;switch(ay){case"all":if(aH){aw=false}break;case"attached":if(!!(ax.linkAttached||(Ext.newAttach?ax.realAttached:ax.attached))==aH){aw=false}break;case"none":if(!aH){aw=false}break;case"toggle":break;case"unread":if(!ax.read==aH){aw=false}break;case"read":if(!!ax.read==aH){aw=false}break;default:}if(aw){aE.setChecked(!aE.checked,true)}if(aE.checked){aI++}}aF.selectAll(aI==aG.length&&aI>0);try{aB.layoutModule.view.changeSelect()}catch(aC){}}function ad(aB){var az=this;var aA=az.toolbar;if(typeof aB=="undefined"){aB=true;var ax=az.letters;for(var ay=0,aw=ax.length;ay<aw;ay++){if(!ax[ay].checked){aB=false;break}}}if(az.allSelected^aB){aA.selectAll(aB);az.allSelected=aB;az.folderSelected=false;az.selectFolder()}}function Y(){var aw=this,ax=aw.module;if(ax.isSelectFolder()){aw.tips.update();aw.toolbar.update()}}function M(aw){var ax=this;ax.folderSelected=!!aw;if(aw){ax.selectFolder()}else{ax.select("none")}ax.toolbar.update()}function ar(ay,aG,aF){try{var aD=$L("interface.MboxInterface")}catch(aB){return aB}var aA=this.module,aE=aA.view;var ax=aA._var.param;var aC=aA.getPage();if(ay>=aC){ay=aC-1}if(!(ay>0)){ay=0}if(aG||ay!=aA.index||aA._cacheCleaned){aE.deleteInterval();var aw=ai.clone(ax);var az={index:ay,voidSetLayout:!aF};aD.entry(aw,az)}}function Q(ay,aE,aA,aI){try{var aG=$L("interface.MboxInterface")}catch(aD){return aD}var aH=this;var az=$I("init.Folder");var aC=aH.module;var ax=aC._var.param;var aw=ai.clone(ax);var aB={index:aC.index,forceRequest:true,retry:aA,voidSetLayout:!aI};aH.deleteInterval();var aF=aC.getPage();if(ay>=aF){ay=aF-1}if(!(ay>0)){ay=0}aB.index=ay;if(aE){aG.entry(aw,aB)}else{az.refresh(function(){aG.entry(aw,aB)})}}function k(ax,aB){if(!ax){var aA=this;ax=[];var az=aA.letters;for(var ay=0,aw=az.length;ay<aw;ay++){var aC=az[ay];if(aC.checked){ax.push(aC)}}}if(ax.length==0){ax.empty=true}else{if(!aB){aB=function(){return true}}this.filterSelected(ax,aB);if(ax.length==0){ax["void"]=true}}return ax}function ao(aw,ay){for(var ax=aw.length-1;ax>-1;ax--){var az=aw[ax];if(!ay(az)){az.setChecked(false);aw.splice(ax,1)}}}function s(aw,az){var ay=this;var ax="";if(aw.empty){ax="没有选中任何邮件，请重新选择"}if(aw["void"]){ax="选择的邮件已是需要设置的状态，无需再设置"}if(ax){if(!az){$.Tips.show({text:ax})}ay.selectAll(false);return false}else{return true}}function l(ay,aA){var ax=[];for(var az=0,aw=ay.length;az<aw;az++){var aB=ay[az];var aC=aB.data;ax.push(aA?aC.id:aC);aB.setChecked(false)}return ax}function m(ax){var az=[];for(var ay=0,aw=ax.length;ay<aw;ay++){az.push(ax[ay].id)}return az}function g(){var aE=this;var ay=aE.module;var aI=ay.filterFlags;var aA=ay.filter;var aG=ay.tag;var ax=[];if(aI){for(var aJ in aI){var aD=aI[aJ];switch(aJ){case"read":ax.push(aD?"已读":"未读");break;case"attached":ax.push((aD?"普通":"无")+"附件");break;case"linkAttached":ax.push(aD?"云附件":"");break;case"replied":ax.push((aD?"已":"未")+"回复");break;case"forwarded":ax.push((aD?"已":"未")+"转发");break;case"label0":if(!aD){aD=0}var aL=LETTERFLAG[aD];if(aL){ax.push(aL)}break;case"priority":ax.push(aD==1?"紧急":aD==5?"缓慢":"普通");break;default:}}}if(aA){if(aA.fromAddress&&aA.toAddress){ax.push("和 "+aA.fromAddress+" 邮件往来")}else{if(aA.sentDate){var az=ay.constructor;var aK=aA.sentDate.split(":");var aC=aK[0],aB=aK[1];var aF=az.parseSentDate(aC),aw=az.parseSentDate(aB);var aH;if(aF-aw==0){aH=J.format(aF,"yyyy年M月d日")}else{aH=J.format(aF,"yyyy年M月d日")+"-"+J.format(aw,"yyyy年M月d日")}ax.push(aH)}}}if(ax.length==0){if(aG){ax.push(aG.join())}}return ax.join("")}function A(){var aw=this;aw.title.update();aw.toolbar.update();aw.footer.update()}function c(ax){var aw=this;aw.letters=[];aw.ids={};aw.toolbar=new an(aw);aw.tips=new o(aw);aw.title=new v(aw);aw.footer=new H(aw);aw.showAd=($S("ad").show||window.fIphoneAd)&&!$S("closeAd")&&ax.fid>=0}})();(function(){try{var C=$L("module.mbox.ListListener");var N=$L("module.mbox.ListView");var r=$L("module.mbox.ListAction")}catch(Z){return Z}var n=$.Object;var B=$.Number;var ac=$.Browser;var q=$I("init.Folder");var T=$I("module.BaseModule");var t=$.createClass($N("module.mbox.ListModule"));n.mix(t,T,{View:N,Listener:C,Action:r,action:new r(),setRead:X,setFlag:l,setTag:A,setTop:S,setMemo:U,setFilter:H,rollback:m,move:K,setSpam:aa,setAllRead:k,exportLetter:f,forwardLetter:V,isTop:i,parseFid:I,hasThreadAndSent:j,parseSentDate:ab,entry:u},{lazySetEvent:true,limit:20,index:0,getData:w,getList:Y,init:p,exit:z,getText:g,getGroup:F,cleanCache:h,switchIn:G,switchOut:R,cache:b,clean:D,insert:P,initBrand:s,lazyLoad:y,autoGetData:e,getCacheData:O,setTotal:M,getTotal:Q,getPage:E,getInfo:v,getFolder:L,isThread:d,isSelectFolder:x,isTopFirst:c,isNormal:a,canMoveTo:W,removeCache:o,initialize:J});function X(ad){var al=this;var ak=ad.allFid,ao=ad.isRead,aj=ad.data,ai=ad.voidRequest,an=ad.callback;var ag=al.hasThreadAndSent(aj);var ae=ag[0];var af=ag[1];var ah=al.action;ah.setRead({allFid:ak,isRead:ao,data:aj,voidRequest:ai,hasThread:ae,hasSent:af,callback:am});function am(ap,aq){if(an){an(ap,aq)}}}function l(ad){var am=this;var ak=ad.allFid,al=ad.flag,aj=ad.data,ag=ad.single,ao=ad.callback;var ah=am.hasThreadAndSent(aj);var ae=!ag&&ah[0];var af=!ag&&ah[1];var ai=am.action;ai.setFlag({allFid:ak,flag:al,data:aj,hasThread:ae,hasSent:af,callback:an});function an(ap,aq){if(ao){ao(ap,aq)}}}function A(ad){var al=this;var ak=ad.allFid,am=ad.isAdd,ae=ad.tag,aj=ad.data,ao=ad.callback;var ah=al.hasThreadAndSent(aj);var af=ah[0];var ag=ah[1];var ai=al.action;ai.setTag({allFid:ak,isAdd:am,tag:ae,data:aj,hasThread:af,hasSent:ag,callback:an});function an(ap,aq){if(ao){ao(ap,aq)}}}function S(ao){var aj=this;var ah;var ap=ao.fid,aw=ao.isTop,ag=ao.data,ar=ao.callback;var ae=aj.hasThreadAndSent(ag);var ak=ae[0];var at=ae[1];var ad=aj.action;var af=aj.parseFid(ag);var av=af[0],al=af[1];for(var aq=0,an=av.length;aq<an;aq++){var au=av[aq];if(!t.isTop(au)){ah=q.get(au).name+" 文件夹无法设置置顶";break}}if(aw){for(var aq=0,an=av.length;aq<an;aq++){if(!ah){ad.getTop({fid:av[aq],callback:am})}}}if(ah){$.Msgbox.show({title:ah});if(ar){ar(false)}}else{ad.setTop({fidInfo:af,isTop:aw,data:ag,hasThread:ak,hasSent:at,callback:ai})}function ai(ax,ay){if(ar){ar(ax,ay)}}function am(aA){var az=gUser.topMailCount-0;var ay=aA.total;var ax=ag.length;var aB=ax+ay;if(aB>az){ah="每个文件夹最多可以设置 "+az+" 封置顶邮件(您设置后为 "+aB+' 封)<div style="padding-top:15px" class="txt-12 txt-info">提示：您可以取消部分已置顶邮件的置顶状态，再进行设置</div>'}}}function U(ad){var ak=this;var af=ad.memo,aj=ad.data,am=ad.callback;var ag=ak.hasThreadAndSent(aj);var ae=ag[0];var ah=ag[1];var ai=ak.action;ai.setMemo({memo:af,hasThread:ae,hasSent:ah,data:aj,callback:al});function al(an,ao){if(am){am(an,ao)}}}function H(af){var ae=this;var ad=af.ruleConditions,ah=af.callback;var ai=ae.action;ai.setFilter({ruleConditions:ad,callback:ag});function ag(aj){if(ah){ah(aj)}}}function m(ae){var ad=this;var ah=ae.rollback,ag=ae.callback;ah(af);function af(ai){if(ag){ag(ai)}}}function K(at){var am=this;var al=at.allFid,ah=at.moveToId,aw=at.reportType,ax=at.pos,ag=at.data,ap=at.saveSafeList,au=at.callback;var ad=am.action;var af=am.parseFid(ag);var ae=am.hasThreadAndSent(ag);var an=ae[0];var av=ae[1];if(ah>0){ar()}else{var aq,ak="";if($S("isVip")){if(!($S("cos").pref_mail_preserving_days>0)){var ao="文件恢复";var aj=new $.Link({text:ao,click:function(){$I("util.CustomAppManager").goOutLink("recovery",ao);aq.close()}});ak="&nbsp;[开启"+aj.html()+"，邮件双重备份]"}}aq=$.Msgbox.show({type:"confirm",content:"邮件彻底删除后不可恢复"+ak,title:"确定彻底删除邮件吗？",ok:ar});$.Component.setEvents()}function ar(){ad.move({allFid:al,fidInfo:af,moveToId:ah,data:ag,hasThread:an,hasSent:av,callback:ai})}function ai(ay,az){if(au){au(ay,az)}}}function aa(ar){try{var aj=$L("support.SenderList");var ai=$L("support.OptionSupport")}catch(ak){return ak}var am=this;var ap=ar.isSpam,af=ar.data,ao=[],au=ar.callback;var ad=am.action;var ae=am.hasThreadAndSent(af);var an=ae[0];var av=ae[1];if(!ap){aq()}else{ah()}function aq(){var ay=new $.Checkbox({text:"把发件人加入白名单"});var ax=$.Msgbox.show({type:"confirm",content:ay.html(),title:"所选邮件将被移动到收件箱",ok:aw});$.Component.setEvents();function aw(){var az=at();al(ay.checked,false,ao,az)}}function ah(){var az=new $.Select({options:[{text:"垃圾邮件",value:"1",checked:true},{text:"违法邮件",value:"2"},{text:"其他邮件",value:"0"}]});var aC=new $.Checkbox({extcls:"nui-item",text:"把发件人加入黑名单",checkedchange:aA});var ax=new $.Checkbox({extcls:"nui-item",text:"将发件人的历史来信移到垃圾邮件",checkedchange:aA});var aE="<strong>您举报的垃圾邮件类型为：</strong>"+az.html();var aD=""+aC.html()+"<br/>"+ax.html()+'<span class="nui-txt-impt">(谨慎)</span></label>';var aB=ai.isLowAntiSpamLevel();var ay;if(aB){aD+='<br/><br/><span class="nui-txt-impt">小提示：反垃圾级别设置过低或关闭了智能分类，建议重新</span> '+((new $.Link({text:"设置",click:function(){$E("interface.OptionInterface",function(aF){aF.entry({module:"AntiSpamModule"})});ay.close()}})).html())}ay=$.Msgbox.show({type:"confirm",header:"举报垃圾邮件",content:aD,title:aE,ok:aw});$.Component.setEvents();function aA(){var aF="确 定";if(aC.checked||ax.checked){aF="下一步"}ay.buttons.ok.setText(aF)}function aw(){var aP=aC.checked;var aR=ax.checked;var aU=az.value;var aN;var aG=at();if(aP||aR){if(aG.length>0){var aM=[],aH=[];for(var aO=0,aI=aG.length;aO<aI;aO++){try{var aJ=new Uri(aG[aO]);var aF=aJ.getNameWithoutPrefix();var aS=aJ.address;if(aS){aH.push({value:aS,text:'<strong class="nui-txt-normal">'+aF+'</strong><em class="nui-txt-tips">&lt;'+aS+"&gt;</em>",title:aS,checked:true})}}catch(aL){}}aN=new $.CheckGroup({type:"vertical",items:aH,checkType:"checkbox"});var aK=[];if(aP){aK[aK.length]='<p class="nui-item"><strong class="nui-txt-impt">确定要把下列选中的发件人加入黑名单？</strong></p>'}if(aR){aK[aK.length]='<p class="nui-item"><strong class="nui-txt-impt">确定要删除该发件人的历史来信（谨慎）？</strong></p>'}aM[aM.length]='<div class="nui-scroll mJ" style="height:180px;">'+aN.html()+"</div>";var aT=$.Msgbox.show({type:"confirm",header:"禁止发件人",content:aM.join(""),title:aK.join(""),ok:aQ});$.Component.setEvents()}else{aQ()}}else{aQ()}function aQ(){var aV;if(aN){aV=[];var aW=aN.getValue();n.each(aW,function(aX,aY){aV.push(aY)})}al(aP,aR,ao,aV,aU)}}}function at(){var ay=[],aC={};for(var aB=0,az=af.length;aB<az;aB++){var aw=af[aB];ao.push(aw.id);var aE=aw.from.split(",");for(var aA=0,ax=aE.length;aA<ax;aA++){var aD=$.String.trim(Uri.getAddress($.String.trim(aE[aA]).replace("+",""))).toLowerCase();if(!aC[aD]&&!aj.isSender(aD)){aC[aD]=true;ay.push(aD)}}}return ay}function al(ay,aw,az,ax,aA){ad.setSpam({reportType:ap?"spam":"notspam",spamType:aA,isSpam:ap,addList:ay,deleteLetter:aw,data:af,ids:az,email:ax,hasThread:an,hasSent:av,callback:ag})}function ag(aw){if(au){au(aw)}}}function k(ad){var ai=this;var ae=ai.action;var aj=ad.fid,af=ad.fids,ah=ad.isThread,ag=ad.other,al=ad.callback;ae.setAllRead({fid:aj,fids:af,isThread:ah,other:ag,callback:ak});function ak(am,an){if(al){al(am,an)}}}function f(af){var ad=this;var aj=ad.action;var ae=af.ids,ai=af.isThread,ah=af.callback;aj.exportLetter({ids:ae,isThread:ai,callback:ag});function ag(ak){if(ah){ah()}}}function V(af){var ad=this;var aj=ad.action;var ae=af.ids;var ai=af.isThread;var ah=af.callback;if(ai){aj.getThreadIds({id:ae,callback:ag})}else{ag(ae)}function ag(ak){$E(["interface.ComposeInterface"],function(al){al.forward({id:ak});if(ah){ah()}})}}function i(ad){return gUser.topMailCount&&Ext.letterTop&&ad>0&&(!$.Array.has([4,5,7,15,18],ad))}function I(ag){var af=[],ai={};for(var ah=0,ad=ag.length;ah<ad;ah++){var ae=ag[ah].fid;if(!ai[ae]){af.push(ae);ai[ae]=true}}return[af,ai]}function j(af){var ai=false;var ae=false;var ah=$I("init.Folder").isThread();if(ah){for(var ag=0,ad=af.length;ag<ad;ag++){var aj=af[ag];if(aj.fid==3){ae=true}if(aj.threadMessageCount>1){ai=true}if(ai&&ae){break}}}return[ai,ae]}function ab(af){var ad=af.substring(0,4),ae=parseInt(af.substring(4,6),10)-1,ag=af.substring(6,8);return new window.Date(ad,ae,ag)}function u(ag,ak,aj){var af=false;var ae=false;var ai=JS5.get("mbox.ListModule",ag);if(ai){if(ai._cacheCleaned){ae=true}else{var ad=ak.index;if(ai.index==ad){af=true}else{ai.index=ad}}if(ai.fid==2){ae=true;af=false}if(ak.forceRequest){ae=true;af=false}if(ai.forceRequest){ae=true;af=false;delete ai.forceRequest}if(!ai.view.completed){af=false}try{ai.layoutModule.view.changeSelect()}catch(ah){}if(ai==Context.getModule()){ai.scrollTop=0}if(ae){ai.data=[]}ai._var.retry=ak.retry;ai._var.voidSetLayout=ak.voidSetLayout}JS5.go({module:"mbox.ListModule",param:ag,extend:ak,call:aj,useCache:af,reset:false,exit:false})}function w(al,ae,ai){var af=this;af._var.useCache=true;if(!(ae>=0)){ae=af.index}var aj=af.limit,ah=ae*aj;if(!ai){try{af.view.deleteInterval()}catch(ag){}af.removeCache()}if(af.forceRequest){af.data=[];delete af.forceRequest}if(af.getCacheData(ae)){al()}else{var ad=n.clone(af._var.param);n.extend(ad,{limit:aj,index:ae,callback:ak,hideWait:ai});af.getList(ad)}function ak(ao){if(ao["var"].length==0&&ae>0){var am=af.getPage()-1;af.index=am<0?0:am;af.getData(al)}else{try{var an=af.filterFlags;if(af.fid>0){var ar,aq;if(an&&an.read===false){ar="unread";aq=true}if(af.isNormal()){ar="";aq=true}if(aq){if(ao.total!=af.getInfo(ar)){af.justRequest=true;q.refresh()}}}}catch(ap){}al()}}}function Y(ad){var ag=this;var af=ad.callback;ad.callback=ae;ag.action.getList(ad);function ae(ak){var al=ad.start||ad.index*ad.limit;var ai=ak["var"],am=ag.data;for(var aj=0,ah=ai.length;aj<ah;aj++){am[al+aj]=ai[aj]}af(ak)}}function p(){var ah=this,al=ah.view,am=ah.getDom("ScrollDiv");delete ah.scrollTop;ah.scroll(undefined,ac.isIE()?ai:undefined);var ad=al.getLayout();if(ad){if(!ah._var.voidSetLayout){SMM.go({parent:ah,module:"mbox.PreviewModule",param:ah._var.param,viewType:ad,call:function(ao){ah.layoutModule=ao}})}}else{if(Ext.brand){var aj=ah.fid;var ag=false;if(aj==0&&ah.tag){var af=$I("init.Tag").get(ah.tag[0],"brand");if(af){ag=true}}ah.showBrand=ag||aj==18}if(ah.showBrand){$E("interface.MboxInterface",function(ao){ao.brandLoad()})}else{JS5.setViewType(ah,null,"normal")}}var ae="mboxDragDiv";var an=$.fly("#"+ae);var ak;if(!an){ak=document.createElement("DIV");ak.id=ae;ak.style.display="none";ak.className="nui-layer pZ oG";document.body.appendChild(ak)}else{ak=an.dom}al.dragDiv=ak;al.bindEvent();$.Component.setEvents(10);al.createInterval();function ai(){ah.scrollTop=am.scrollTop}}function z(){var af=this,ad=af.view;ad.select("none");try{af.layoutModule.exit()}catch(ae){}return true}function g(){var ah=this;var aj=ah.fids;var ak=ah.getFolder();var af=ak?ak.name:"邮件列表";var ad=ah._var.param;var al=ah.filter;if(aj&&!$.Array.has(aj,1)){af="其他邮件"}else{if(ad.showFlag){af="旗帜邮件";try{var am=ah.filterFlags;var ag=am.label0;if(ag>=0){af=TERFLAG[ag]+"邮件"}else{af="所有邮件"}}catch(ai){}}else{if(ad.showTag){af=ah.tag.join();if(af.indexOf("%")>-1){var ae=$I("init.Tag").getBrand(ah.tag[0]);if(ae){af=ae.name}}}else{if(al){if(al.fromAddress&&al.toAddress){af="邮件往来"}else{if(al.sentDate){af="查看邮件"}}}}}}return af}function F(){var af=this,ae=af.filter;var ad="";if(ae&&ae.sentDate){ad="date"}return af.mtype+ad}function h(ae){var ad=this;if(!ae){ad.forceRequest=true}else{ad.removeCache();JS5.cleanCache(ad)}}function G(){var af=this,ad=af.view;try{af.layoutModule.switchIn()}catch(ae){}}function R(){var ae=this;try{ae.layoutModule.switchOut()}catch(ad){}}function b(){var ag=this,ae=ag.view;var ad=ag.getDom("MainDiv");if(!ae.completed||ag.forceRequest||ad.style.display=="none"){ae.refresh(ag.index)}else{ae.markReaded();ae.markReFw();var ah=ag.scrollTop;if(typeof ah!="undefined"){if(!ah){ah=0}ag.getDom("ScrollDiv").scrollTop=ah;delete ag.scrollTop}ae.markReaded();ae.markReFw();try{ag.layoutModule.cache()}catch(af){}}}function D(){var ad=this;oListView.dragDiv=null;ad.removeCache()}function P(ad,am){var ai=this,ao=ai.view;var ae=ai.index,ap=ai.limit,ah=ai.getTotal();var ak=ai.data;for(var al=ak.length-1,aj=0;al>-1&&aj<ad;){var ag=ak[al];if(ag&&am[ag.id]){ak.splice(al,1);aj++}al--}var af=ai.getCacheData();if(af){aq(af)}else{if(ah<=ae*ap){if(ae>0){ai.view.goPage(ae-1,true)}else{ai.view.refresh(0,true)}}else{var an=(ae+1)*ap-ad;var ap=(an+ad)>=ah?ah-an:ad;ai.action.getList({fid:ai.fid,order:ai.order,desc:ai.desc,filterFlags:ai.filterFlags,filter:ai.filter,start:an,limit:ap,callback:function(av){var at=av["var"];for(var au=0,ar=at.length;au<ar;au++){ak[au+an]=at[au]}ak.length=[au+an];aq(ai.getCacheData())}})}}function aq(at){var ar=ai.view.letters;for(var av=ar.length-1;av>-1;av--){var ax=ar[av];if(am[ax.data.id]){ax.remove(true);ar.splice(av,1)}}var au=at.length-ar.length;if(au>0){var aw=at.splice(at.length-au,au);ao.insertLetter(aw,true)}else{ao.showPeriod()}ao.update()}}function s(){var ai=this;var am=ai.view;var ad=$I("init.Tag");var aj=$S("brandData");var ae=[];for(var ak=0,ah=aj.length;ak<ah;ak++){var ag=aj[ak];var af=ad.get(ag.id,"brand",true);if(af&&af.messageCount>0){ae.push(ag)}}if(ae.length>0){ae.sort(function(ao,an){if(ao.logo1&&!an.logo1){return -1}if(!ao.logo1&&an.logo1){return 1}return an.weight-ao.weight});$S("matchBrandData",ae);SMM.go({parent:ai,module:"mbox.BrandModule",param:ai._var.param,viewType:"l-r",setIEViewType:true,hideSplit:true,call:function(an){ai.brandModule=an}});var al=am.constructor;al.addCss();am.tips.block.hide()}}function y(){var ah=this,am=ah.view;if(ah!=Context.getModule()){return}var ae=ah.index;ah.autoGetData(ae-1);ah.autoGetData(ae+1);if(ae==0){var an=am.letters;var ai=[],ad=[];for(var aj=0,ag=an.length;aj<ag;aj++){var ak=an[aj];var af=ak.data;if(af.fid==2||af.flags.top||ak.isThread){continue}if(af.flags.read){}else{ai.push(ak)}}var al=ai.concat(ad);setTimeout(function(){ao(al)},1000)}function ao(aq,ap){if(ap>=0){ap++}else{ap=0}if(ap<2&&ap<aq.length&&ah==Context.getModule()){var at=aq[ap];try{at.gotoRead({hidden:true,call:function(){setTimeout(function(){ao(aq,ap)},1000)}})}catch(ar){}}}}function e(ad){var ag=this;var af=ag.fid,ae=ag.getPage();if(ad>ae-1||!(ad>=0)||af==-1){return}if(ag.getCacheData(ad)){return}ag.getData(function(){},ad,true)}function O(ad){var ah=this;if(!(ad>=0)){ad=ah.index}var am=ah.limit,ag=ah.getTotal(),al=ad*am;var an=ah.data;if(an.length>0){var ai=[];for(var ak=0,aj=al,af=an.length;ak<am&&aj<af;ak++,aj++){var ae=an[al+ak];if(ae){ai.push(ae)}}if(ai.length>0&&(ai.length==am||(ak+al)==ag)){return ai}else{return null}}else{return null}}function M(ad){var ae=this;ae.total=ad}function Q(){var ad=this;return ad.total}function E(){var af=this;var ad=af.getTotal(),ae=af.limit;return Math.ceil(ad/ae)}function v(ae,ad){return q.getInfo(this.fid,ae,ad)}function L(){var ad=this;return q.get(ad.fid)}function d(ad){var ae=this;return q.isThread(ae.fid,ad)&&!ae.filter}function x(){var ad=this;return Ext.selectFolder&&ad.isNormal()&&ad.fid>1&&ad.getPage()>1&&!ad.isThread()}function c(){var ae=this;var ad=ae.fid;return t.isTop(ad)&&ae.order=="date"&&ae.desc==true&&!ae.filterFlags&&!ae.filter}function a(){var ae=this;var ad=ae._var.param;return ae.fid>0&&!ad.fids&&!ad.filterFlags&&!ad.filter&&!ad.tag}function W(af){var ah=this;var ag=ah.getFolder();var ad=true;if(ag){var ae=ag.id;if(ae==af){ad=false}}return ad}function o(){var ag=this,ae=ag.view;try{var ad=ae.letters;if(ad.length>0){setTimeout(function(){for(var ah=ad.length-1;ah>-1;ah--){try{var aj=ad[ah];aj.remove()}catch(ai){}}},0)}ae.letters=[];ae.ids={};delete ae.allSelected;delete ae.folderSelected}catch(af){}}function J(ad){var ae=this;n.extend(ae,ad);ae.data=[];ae.limit=$S("attrs").user.maxlist;ae.layout=Ud.get({field:"ntes_inbox",flag:"layout"});if(ac.ie()-0<9){ae.layout="0"}}})();(function(){try{var j=$L("module.mbox.ListView")}catch(e){return e}var l=$.Object;var h=$.Array;var m=$.String;var b=$.Function;var k=$.createClass($N("module.mbox.SearchView"));l.mix(k,j,{searchFields:{title:{key:"subj",title:"主题",value:2},sender:{key:"from,to",title:"发件人+收件人",value:1},sendtitle:{key:"from,subj",title:"发件人+主题",value:4},"default":{key:"from,to,subj,cont,aname",title:"主题+正文",value:0},all:{key:"from,to,subj,cont,aname,acont",title:"主题+正文+附件",value:3}},getSearchFields:a},{getControl:o,toggleControl:i,additionalSearch:d,setDefaultFileds:g,removeAll:f,getCondition:n,initialize:c});function a(p){if(typeof p=="undefined"){p=Ud.get({field:"ntes_inbox",flag:"search_type"})-0}var r="";var q=k.searchFields;l.each(q,function(s,t){if(p==t.value){r=t.key;throw $.BREAK}});return r}function o(){try{var aj=$L("support.AddressSupport",this)}catch(aD){return aD}var w=this;var ay=w.module;var aA=ay.searchVars;var u=ay.result;var z=$I("init.Folder");if(!aA.pattern){return""}var aB=aA.pattern;var C=aA.fid;var aG=aA.condictions;var an=aA["fts.fields"];var am=u.groupings;var aE=Ud.get({field:"ntes_global",flag:"secondSearch"})-0==1;var ab=Ud.get({field:"ntes_inbox",flag:"search_type"})-0;var N,aH,q,aF;if(aE){N="mN"}else{N="kM"}var aa=ay.hasAdditional();var av=[];av[av.length]='<div class="pt '+N+'" id="'+ay.createId("ControlDiv")+'">';var ai=new $.Link({title:"设置默认搜索范围",bracket:true,text:"设置默认",click:b.bind(w.setDefaultFileds,w)});av[av.length]='<div class="lV"><div class="lU">搜索范围'+ai.html()+'</div><div class="jx"><ul>';var D=[];l.each(k.searchFields,function(aI,aJ){var aM=an==aJ.key;var aL=aM?" cu":"";var aK=new $.Radio({text:aJ.title,value:aI,checked:aM,checkedchange:function(aN){w.additionalSearch("scope",this.value);return false}});av[av.length]='<li class="eV'+aL+'">'+aK.html()+"</li>";D.push(aK)});$.Radio.group(D);av[av.length]="</ul></div></div>";av[av.length]='<div class="kP"><div class="lU">文件夹</div><div class="jx"><ul>';if(C&&C.length==1){var aC=new $.Link({title:"取消此附加条件",text:"取消",bracket:true,click:b.bind(w.additionalSearch,w,"fid",undefined)});av[av.length]='<li class="eV">'+aC.html()+new $.Label({text:z.get(C[0]).name}).html()+"</li>"}else{var W=[];if(am){W=am.fid}for(var az=0,au=W.length;az<au;az++){var v=W[az];var Y=v.val;var t=v.cnt;var at=z.get(Y).name;var aC=new $.Link({title:"在搜索结果中精确文件夹为"+at,text:at,click:b.bind(w.additionalSearch,w,"fid",Y)});av[av.length]='<li class="eV">'+aC.html()+new $.Label({text:"("+t+")",type:"tips"}).html()+"</li>"}}av[av.length]="</ul></div></div>";av[av.length]='<div class="mM"><div class="lU">发件人+收件人</div><div class="jx"><ul>';var J=ag("from");if(J){var Q=new $.Link({title:"取消此附加条件",text:"取消",bracket:true,click:b.bind(w.additionalSearch,w,"from",undefined)});var R=J.operand;var ad=aj.getName(Uri.matchEmail(R));var S=m.encodeHTML(ad?ad:R);av[av.length]='<li class="eV">'+Q.html()+new $.Label({text:S}).html()+"</li>"}else{var af=[];if(am){af=am.fromAddress}var B,al=[],M=[];for(var az=0,au=af.length;az<au;az++){var L=af[az];var R=L.val.toLowerCase();if(aj.getAddrObj(R)||R==$S("uid")){al.push(L)}else{M.push(L)}}B=al.concat(M);for(var az=0,au=B.length;az<au;az++){var y=B[az];var G=m.trim(y.val);if(G){try{var x=aj.getName(Uri.matchEmail(G))}catch(aD){}var t=y.cnt;var A=m.encodeHTML(x?x:G);var Q=new $.Link({title:"在搜索结果中精确发件人为"+G,text:A,click:b.bind(w.additionalSearch,w,"from",G)});av[av.length]='<li class="eV">'+Q.html()+new $.Label({text:"("+t+")",type:"tips"}).html()+"</li>"}}}av[av.length]="</ul></div></div>";av[av.length]='<div class="mL"><div class="lU">时间范围</div><div class="jx"><ul>';var s=ag("sentDate");var P=w.dateDiff;if(s){var ar=s.operand;var O=P[4].name;for(var az=0,au=P.length;az<au;az++){var I=P[az];if(I.date<=ar){if(s.operator=="<="){az++;I=P[az]}O=I.name;break}}var ah=new $.Link({title:"取消此附加条件",text:"取消",bracket:true,click:b.bind(w.additionalSearch,w,"sentDate",undefined)});av[av.length]='<li class="eV">'+ah.html()+new $.Label({text:O}).html()+"</li>"}else{var aq=[];if(am){aq=am.sentDate}for(var az=0,au=aq.length;az<au;az++){for(var ax=0,ap=P.length;ax<ap;ax++){var aw=aq[az];var I=P[ax];if(I.date<=aw.val){I.count+=aw.cnt;if(ax==ap-2){break}else{continue}}}}for(var az=0,au=P.length;az<au;az++){var I=P[az];if(I.count>0){var X=I.name;var H=I.count;var ah=new $.Link({title:"在搜索结果中精确时间范围为"+X,text:X,click:b.bind(w.additionalSearch,w,"sentDate",az)});av[av.length]='<li class="eV">'+ah.html()+new $.Label({text:"("+H+")",type:"tips"}).html()+"</li>"}I.count=0}}av[av.length]="</ul></div></div>";av[av.length]='<div class="kO"><div class="lU">邮件状态</div><div class="jx"><ul>';var F=ag("flags");if(F){var p=F.operand.attached;var E=F.operand.read;if(typeof p=="boolean"){var ae=new $.Link({title:"取消此附加条件",text:"取消",bracket:true,click:b.bind(w.additionalSearch,w,"attached",undefined)});av[av.length]='<li class="eV">'+ae.html()+new $.Label({text:"("+(p?"有附件":"无附件")+")",type:"tips"}).html()+"</li>"}else{if(typeof E=="boolean"){var ac=new $.Link({title:"取消此附加条件",text:"取消",bracket:true,click:b.bind(w.additionalSearch,w,"read",undefined)});av[av.length]='<li class="eV">'+ac.html()+new $.Label({text:"("+(E?"已读":"未读")+")",type:"tips"}).html()+"</li>"}}}else{var U=[];if(am){U=am["flags.attached"]}for(var az=0,au=U.length;az<au;az++){var Z=U[az];var V=Z.val?"有附件":"无附件";var ao=Z.cnt;var ae=new $.Link({title:"在搜索结果中精确邮件状态为"+V,text:V,click:b.bind(w.additionalSearch,w,"attached",Z.val)});av[av.length]='<li class="eV">'+ae.html()+new $.Label({text:"("+ao+")",type:"tips"}).html()+"</li>"}var ak=[];if(am){ak=am["flags.read"]}for(var az=0,au=ak.length;az<au;az++){var T=ak[az];var K=T.val?"已读":"未读";var r=T.cnt;var ac=new $.Link({title:"在搜索结果中精确邮件状态为"+K,text:K,click:b.bind(w.additionalSearch,w,"read",T.val)});av[av.length]='<li class="eV">'+ac.html()+new $.Label({text:"("+r+")",type:"tips"}).html()+"</li>"}}av[av.length]="</ul></div></div></div>";return av.join("");function ag(aJ){var aL=null;if(aG){for(var aK=0,aI=aG.length;aK<aI;aK++){var aM=aG[aK];if(aM.field==aJ){aL=aM}}}return aL}}function i(){var p=this;var v=p.module;var r=Ud.get({field:"ntes_global",flag:"secondSearch"})-0==1;var q=v.getEl("ControlDiv");var s,t,u;if(r){s="mN";t="kM";u=0}else{s="kM";t="mN";u=1}q.removeClass(s);q.addClass(t);Ud.set({field:"ntes_global",flag:"secondSearch",value:u});p.title.update();q.destroy()}function d(p,z){var x=this;var r=x.module;var q=l.clone(r._var.param);var s=r._var.extend;var v=q.searchVars;q.index=0;if(typeof z=="undefined"){switch(p){case"from":case"sentDate":w(p);break;case"attached":case"read":w("flags");break;case"fid":v.fid=x.fidbak;delete x.fidbak;break;default:if(!v.fid&&x.fidbak){v.fid=x.fidbak}else{delete v.fid}delete x.fidbak;if(v.condictions){delete v.condictions}}}else{var y=k.searchFields;var u=x.dateDiff;switch(p){case"scope":if(v["fts.fields"]==y[z].key){return}v["fts.fields"]=y[z].key;break;case"from":t(p,{field:p,operator:"contains",operand:z});break;case"fid":x.fidbak=v.fid;v.fid=[z];break;case"sentDate":if(z==u.length-1){t(p,{field:p,operator:"<=",operand:u[z-1].date})}else{t(p,{field:p,operator:">",operand:u[z].date})}break;case"attached":t("flags",{field:"flags",operator:"=",operand:{attached:z}});break;case"read":t("flags",{field:"flags",operator:"=",operand:{read:z}});break;default:}}$E("interface.MboxInterface",function(B){B.entry(q,s)});function w(E){var D=v.condictions;if(D){for(var C=0,B=D.length;C<B;C++){if(D[C].field==E){D.splice(C,1);break}}}}function t(D,B){var C=v.condictions;if(!C){C=v.condictions=[]}if(!A(D)){C[C.length]=B}}function A(F){var C=false;var E=v.condictions;if(E){for(var D=0,B=E.length;D<B;D++){if(E[D].field==F){C=true;break}}}return C}}function g(){var q=this;var p=q.module;var v=p.createId("searchFiledRadio");var r=[];nValue=Ud.get({field:"ntes_inbox",flag:"search_type"})-0;var u="					"+t(2,"title","主题")+"					"+t(1,"sender","发件人+收件人")+"					"+t(4,"sendtitle","发件人+主题")+"					"+t(0,"default","主题+正文",true)+"					"+t(3,"all","主题+正文+附件",false,true)+"		";$.Msgbox.show({type:"confirm",content:u,title:"请选择默认搜索范围",header:"设置默认搜索范围",ok:s});$.Radio.group(r);$.Component.setEvents();function s(){var z=k.searchFields;var x,B;for(var y=0,w=r.length;y<w;y++){var A=r[y];if(A.checked){B=A.value;x=z[B];break}}Ud.set({field:"ntes_inbox",flag:"search_type",value:x.value});q.additionalSearch("scope",B)}function t(w,D,z,x,B){var A=w==nValue;var y=(A?"<strong>"+z+"</strong>":z)+(x?'<span class="nui-txt-mark">(推荐)</span>':"");var C=(new $.Radio({text:y,value:D,name:v,checked:A}));r.push(C);return C.html()+"<br/>"}}function f(){var r=this,q=r.module;$.Msgbox.show({type:"confirm",content:"确定将所有搜索出来的邮件都移动到 已删除 文件夹吗？",title:"删除确认",ok:p});function p(){$E("module.mbox.SearchModule",function(t){t.removeAll({data:q.result["var"],callback:s})})}function s(){r.refresh()}}function n(){var p=this;var r=p.module.searchVars;if(r.pattern){return s()}else{return q()}function s(){var E=r.pattern;var D=[];var u=r.fid;if(u&&u.length==1){var v=$I("init.Folder");D.push(v.get(u[0]).name)}var w=r.condictions;if(w){for(var C=0,y=w.length;C<y;C++){var F=w[C];switch(F.field){case"from":D.push(F.operand);break;case"sentDate":var B=p.dateDiff;for(var z=0,x=B.length;z<x;z++){var A=B[z];if(A.date==F.operand){if(F.operator=="<="){z=z+1;A=B[z]}D.push(A.name);break}}break;case"flags":var t=F.operand.attached;if(typeof t=="boolean"){D.push(t?"有附件":"无附件")}var G=F.operand.read;if(typeof G=="boolean"){D.push(G?"已读":"未读")}break}}}return'关键字为“<strong class="txt-keyword">'+m.encodeHTML(E)+"</strong>”"+(D.length>0?('，附加条件为“<strong class="txt-keyword">'+D.join('</strong>，<strong class="txt-keyword">')+"</strong>”"):"")}function q(){var v=[];try{var w=r.condictions;if(l.isArray(w)){w=w[0]}if(w){var t=w.field;var u=w.operand;var x=w.operator;switch(t){case"flags":if(u.replied){v.push("已回复")}if(u.forwarded){v.push("已转发")}var z=Ext.newAttach?u.realAttached:u.attached;if(z){v.push("有附件")}else{if(z===false){v.push("无附件")}}if(u.linkAttached){v.push("有云附件")}else{if(u.linkAttached===false){v.push("无云附件")}}if(u.read){v.push("已读")}else{if(v.length==0){v.push("未读")}}break;case"label0":v.push(u==0?"所有旗帜":LETTERFLAG[u]);break;case"priority":switch(x){case">":v.push("缓慢");break;case"<":v.push("紧急");break;default:v.push("普通")}break;case"subject":v.push('关键字为“<strong class="txt-keyword">'+m.encodeHTML(u)+"</strong>”");break;case"from":case"to":v.push("与 "+m.encodeHTML(u)+" 往来");break}if(!t){var u=r.condictions[0].condictions[0].operand;if(u){if(typeof u=="string"){if(Uri.matchEmail(u)){v.push("与 "+m.encodeHTML(u)+" 往来")}else{v.push('关键字为“<strong class="txt-keyword">'+m.encodeHTML(u)+"</strong>”")}}if(typeof u=="object"){var z=Ext.newAttach?u.realAttached:u.attached;if(z){v.push("有附件")}if(z===false){v.push("无附件")}if(u.linkAttached){v.push("有云附件")}if(u.linkAttached===true){v.push("无云附件")}}}}}}catch(y){}return v.length==0?"":v.join()}}function c(q){var p=this;k.superClass.initialize.call(p,q);var s=$I("util.Misc").getTime(0);var r=p.dateDiff=[{name:"三天内",diff:3},{name:"一周内",diff:7},{name:"一月内",diff:30},{name:"三月内",diff:90},{name:"三月前",diff:100000}];h.each(r,function(t,v){var u=$.Date.addDate(s,-v.diff);u.setHours(23);u.setMinutes(59);u.setSeconds(59);v.date=new Date(Math.floor(u.getTime()/1000)*1000+999);v.count=0})}})();(function(){try{var b=$I("module.mbox.ListListener")}catch(d){return d}var a=$.Object;var c=$.createClass($N("module.mbox.SearchListener"));a.mix(c,b,null,{});a.extend(c.prototype._listeners,{})})();(function(){try{var i=$L("module.mbox.ListModule");var p=$L("module.mbox.SearchListener");var c=$L("module.mbox.SearchView");var n=$L("module.mbox.ListAction")}catch(f){return f}var q=$.Object;var j=$.Array;var r=$.String;var o=$I("init.Folder");var a=$.createClass($N("module.mbox.SearchModule"));q.mix(a,i,{View:c,Listener:p,removeAll:h,entry:s},{getData:l,getCacheData:d,checkCacheData:e,getTotal:m,getRealFid:g,hasAdditional:k,initialize:b});function h(w){var v=this;var t=w.data;var y=w.callback;var u=v.action;u.moveAll({data:t,moveToId:4,callback:x});function x(z){if(y){y(true)}}}function s(x,A,z){var y=x.searchVars;var w=false;var v=false;var u=JS5.get("mbox.SearchModule",x);if(u){if(u._cacheCleaned){w=true}else{var t=A.index;if(u.index!=t){u.index=t}else{v=true}}if(A.forceRequest){v=false;w=true}if(u.forceRequest){v=false;w=true;delete u.forceRequest}if(w){delete u.result}u._var.retry=A.retry}JS5.go({module:"mbox.SearchModule",param:x,extend:A,call:z,useCache:v,reset:false,exit:false})}function l(z){var t=this;var w=false;try{t.view.deleteInterval()}catch(y){}t.removeCache();if(t.forceRequest){delete t.result;delete t.forceRequest}if(t.result){var u=t.checkCacheData();if(u.cached){z()}else{var v=u.ids;t.action.searchList({ids:v,callback:x})}}else{w=true;t.action.searchList({fids:t.fids,searchVars:t.searchVars,order:t.order,desc:t.desc,limit:t.limit,callback:x})}function x(B){var A=false;if(w){if(t.index>0){if(t.index>=t.page){t.index=0}else{A=true}}}if(A){t.getData(z)}else{z()}}}function d(t){var u=this;if(!t){t=u.index}var B=[];try{var A=u.result["var"];if(A){var z=u.limit;var y=t*z;for(var x=0,v=A.length;x+y<v&&x<z;x++){B.push(A[x+y])}}}catch(w){}return B.length>0?B:null}function e(u){var v=this;if(!u){u=v.index}var w=v.getCacheData(u);var A=[];var z=true;for(var y=0,t=w.length;y<t;y++){var x=w[y];if(typeof x=="string"){z=false;A.push(x)}else{A.push(x.id)}}return{cached:z,ids:A,cacheData:w}}function m(){var t=this;try{var u=t.result["var"];if(u){return u.length}}catch(v){}return 0}function g(){var u=this;var w=u.searchVars;var t=w.fid;var v=0;if(typeof t=="number"){v=t}else{if(q.isArray(t)&&t.length==1){v=t[0]}}return v}function k(){var u=this;var w=u.searchVars;var t=w.fid;var v=w.condictions;return(t&&t.length==1)||(v&&v.length>0)}function b(u){var t=this;a.superClass.initialize.call(t,u)}})();(function(){var c=$I("module.BaseView");var b=$.createClass($N("module.mbox.PreviewView"));$.Object.mix(b,c,{},{getHtml:d,getNone:f,getSelected:g,changeSelect:e,initialize:a});function d(){var h=this;return h.addHeader(null,h.getNone(),"frame-main-cont-body-second")}function f(){var h='<div class="nui-infoBlock nui-block oP"><div class="nui-block-title">未选中邮件</div></div>';return h}function g(v){var j=this,u=j.module,l=u._parent;var p=new $.Link({text:"取消选择",click:function(){l.view.select("none");j.changeSelect()}});var o=[];o[o.length]='<div class="oo">已选择 <strong>'+v.length+'</strong> 封邮件<span class="lg">'+p.html()+"</span></div>";o[o.length]='<div class="ma">';for(var q=0,k=v.length;q<k;q++){var r=v[q];var h=r.getDiv();var w="",t="",s="";try{w=$.fly(h).find(".cM").dom.innerHTML}catch(n){}try{t=$.fly(h).find(".dw").dom.innerHTML}catch(n){}try{s=$.fly(h).find(".ct").dom.innerHTML}catch(n){}o[o.length]='<div class="nui-infoBlock nui-block mb"><div class="nui-block-text">';o[o.length]='<div class="hk">'+w+"</div>";o[o.length]='<div class="hl"><span class="nui-txt-tips">'+t+"</span></div>";if(s){o[o.length]='<div class="hm">'+s+"</div>"}o[o.length]="</div></div>"}o[o.length]="</div>";return o.join("")}function e(){var j=this,q=j.module,l=q._parent;var r=l.view.letters,p=l.index*l.limit,h=[];for(var n=p,k=r.length;n<k;n++){var o=r[n];if(o.checked){h.push(o)}}var s=h.length==0?j.getNone():j.getSelected(h);q.getDom("ScrollDiv").innerHTML=s;$.Component.setEvents()}function a(h){}})();(function(){try{var b=$L("module.mbox.PreviewView")}catch(f){return f}var a=$I("module.BaseModule");var e=$.createClass($N("module.mbox.PreviewModule"));$.Object.mix(e,a,{View:b},{init:d,initialize:c});function d(){}function c(g){}})();(function(){var h,f,g;try{h=$L("module.BaseModule");f=$L("interface.MboxInterface")}catch(i){return i}g=$.createClass($N("module.read.BaseReadModule"));$.Object.mix(g,h,{modules:{},updateTag:b},{getGroup:d,exit:l,setRead:j,getHistoryParam:a,moduleRemove:k,clean:c});window.DoFSCommand=function(p,m){try{if(p=="quit"){var o=$(".oQ");if(o){$.Array.each(o.doms,function(q,e){e=$(e);e.empty();$(e.dom.parentNode).removeClass("mc");e.remove()})}if(Ext.useNewAd){Ud.set({field:"ntes_letter",flag:"read_ad",value:1})}}}catch(n){}};function b(){Object.each(g.modules,function(e,m){try{m.head.updateTag();m.head.updateToolbar()}catch(n){}})}function d(){return this.group||this.name}function l(){return true}function j(e){var m=this;if(m.folderData&&m.folderData.flags&&!m.folderData.flags.read&&!m.hiddenMod&&!m.part){f.setRead({moduleName:m.listModule,isRead:true,data:m.folderData,voidRequest:e});m.markRead=true}}function a(){try{var m={},n=this["_var"].param;if(n&&n.hidden){$.Object.extend(m,n);delete m.hidden;return m}return n}catch(o){}}function k(){var e=this;if(e.mtype==="read.ReadModule"){e.content.destroy()}Tab.remove(e);if(e.viewType){SMM.remove(e)}else{JS5.remove(e)}}function c(){var p=this,m=$.Element,q=window.HTMLElement,o;for(var n in p){o=p[n]||n;try{if(n=="container"){continue}if(o instanceof $.Component){continue}if(o.module===p){arguments.callee.call(o)}else{if(o instanceof m){o.destroy()}else{if(o instanceof q){o=p[n]=null}}}}catch(r){}}}})();(function(){var f=window.$,i,k,c,a,g,b;try{i=$L("interface.MboxInterface");k=$L("support.OptionSupport");a=$L("support.Tag")}catch(j){return j}g=$I("module.BaseView");c=$I("init.Folder");b=f.createClass($N("module.read.BaseReadView"));f.Object.mix(b,g,null,{initialize:d,getSubjectHref:h,getSimpleToolbar:l,getSubMenu:m});function d(n){var e=this;e.module=n;if(n.viewType){e.getToolbar=null}}function l(){var n=this;var o=n.module;var p=o.action;var e={groups:[{items:[{xtype:"button",text:"回复全部",click:function(){Log.cache({rkey:"thread_letter_toolbar_replyAll"});p.replyAll()}},{xtype:"button",subclass:"dropdownBtn",text:"更多",menu:{reverse:true,groups:[{items:[{text:"删除",click:function(){Log.cache({rkey:"thread_letter_menu_del"});o.head.move({del:true,isThread:true},function(){var q=o.threadModule;q.delLetter(o);if(!q.removedMail){q.removedMail=[]}q.removedMail.push(o.mid)})}},{text:"回复",click:function(){Log.cache({rkey:"thread_letter_menu_reply"});p.reply()}},{text:"回复全部",click:function(){Log.cache({rkey:"thread_letter_menu_replyall"});p.replyAll()}},{text:"回复全部(带附件)",click:function(){Log.cache({rkey:"thread_letter_menu_replyall_attach"});p.replyAll(true)}},{text:"回复全部(新邮件)",click:function(){Log.cache({rkey:"thread_letter_menu_replyall_new"});p.newReply()}},{text:"转发",click:function(){Log.cache({rkey:"thread_letter_menu_forward"});p.forward()}},{text:"原信转发...",click:function(){Log.cache({rkey:"thread_letter_menu_forwardtransmit"});o.head.forwardTransmit()}},{text:"作为附件转发",click:function(){Log.cache({rkey:"thread_letter_menu_forwardattach"});p.forward(true)}}]},{items:[{text:"查看信头",click:function(){Log.cache({rkey:"thread_letter_menu_viewhead"});p.setReadMode({type:"head"})}},{text:"查看邮件",click:function(){Log.cache({rkey:"thread_letter_menu_viewmail"});p.setReadMode({type:"normal"})}},{text:"导出邮件",click:function(){Log.cache({rkey:"thread_letter_menu_download"});p.setReadMode({type:"download"})}},{text:"翻译邮件",click:function(){Log.cache({rkey:"thread_letter_menu_trans"});o.trans.showCall(0)}},{text:"选择编码",menu:n.getSubMenu("charset")}]},{items:[{text:"新窗口打开",click:function(){Log.cache({rkey:"thread_letter_menu_newwin"});p.newWin()}},{text:"保存联系人...",click:function(){Log.cache({rkey:"thread_letter_menu_reply"});o.head.saveContact()}}]}]}}]}]};return f.Toolbar.html(e)}function m(s){var q=this;var r=q.module;var e=r.action;var C=r.folderData;var D=C.fid;var w;switch(s){case"tag":w=a.getMenu({tag:C.tag,callback:function(U,T){if(U){Log.cache({rkey:(r.mtype=="thread.ThreadModule"?"thread":"read")+"_menu_tagremove"});r.head.setTag("remove",T)}else{Log.cache({rkey:(r.mtype=="thread.ThreadModule"?"thread":"read")+"_menu_tagadd"});r.head.setTag("add",T)}},remove:function(){Log.cache({rkey:(r.mtype=="thread.ThreadModule"?"thread":"read")+"_menu_tagremoveall"});r.head.setTag("remove",null)}});break;case"replyAll":w={width:140,groups:[{items:[{text:"回复全部",click:function(){Log.cache({rkey:"read_menu_replyall"});e.replyAll()},extText:"Shift + A"},{text:"回复全部(带附件)",click:function(){Log.cache({rkey:"read_menu_replyall_attach"});e.replyAll(true)}},{text:"回复全部(新邮件)",click:function(){Log.cache({rkey:"read_menu_replyall_new"});e.newReply()}}]}]};break;case"forward":w={width:120,groups:[{items:[{text:"转发",click:function(){Log.cache({rkey:"read_menu_forward"});e.forward()},extText:"Shift + F"},{text:"原信转发...",click:function(){Log.cache({rkey:"read_menu_forwardtransmit"});r.head.forwardTransmit()}},{text:"作为附件转发",click:function(){Log.cache({rkey:"read_menu_forwardattach"});e.forward(true)}}]}]};break;case"mark":w={width:120,groups:[{items:[{id:r.createId("toolbarSetTop"),text:((C.flags&&C.flags.top)?"取消置顶":"置顶邮件"),click:function(){Log.cache({rkey:(r.mtype=="thread.ThreadModule"?"thread":"read")+"_menu_top"});r.head.setTop()},listeners:[{name:"render",handler:function(){this.el.find(".nui-menu-item-text").html((r.folderData.flags&&r.folderData.flags.top)?"取消置顶":"置顶邮件")}}]}]}]};if(r.mtype=="read.ReadModule"){w.groups.unshift({items:[{text:"旗帜",menu:q.getSubMenu("flag")}]})}if(Ext.tag){var J=q.getSubMenu("tag");J.id=r.createId("toolBarTagMenu");J.listeners=[{name:"render",handler:function(){try{this.unlisten("render");this.update(q.getSubMenu("tag"))}catch(T){}}}];w.groups.splice(1,0,{items:[{text:"标签",menu:J}]})}break;case"more":var u=C.flags;w={width:120,groups:[]};var Q=[{text:"打印邮件",click:function(){Log.cache({rkey:"read_menu_printmail"});e.newWin(1)}},{text:"查看信头",click:function(){Log.cache({rkey:"read_menu_viewhead"});e.setReadMode({type:"head"})}},{text:"查看邮件",click:function(){Log.cache({rkey:"read_menu_viewmail"});e.setReadMode({type:"normal"})}},{text:"导出邮件",click:function(){Log.cache({rkey:"read_menu_download"});e.setReadMode({type:"download"})}}];Q=Q.concat([{text:"选择编码",menu:q.getSubMenu("charset")},{text:"选择字体",menu:q.getSubMenu("font")}]);w.groups.push({items:Q});Q=[{text:"新窗口打开",click:function(){Log.cache({rkey:"read_menu_newwin"});e.newWin()}}];if(Ext.scheduleRead){Q.push({text:"设置日程"+($S("isFree")?"管理":"提醒"),click:function(){Log.cache({rkey:"read_menu_schedule"});r.head.schedule()}})}var L=Ud.get({field:"huodong_option",flag:"nf_status"});var K=(L!="0");if(K){Q.push({text:"保存到网盘...",click:function(){Log.cache({rkey:"read_menu_savetonf"});r.head.saveToNf()}})}Q=Q.concat([{text:"同主题查看",click:function(){Log.cache({rkey:"read_menu_samesubject"});r.head.viewSameSubject()}},{text:"保存联系人...",click:function(){Log.cache({rkey:"read_menu_savecontact"});r.head.saveContact()}},{text:"邮件备注",click:function(){Log.cache({rkey:"read_menu_memo"});r.head.setMemo()}}]);w.groups.push({items:Q});Q=[],oDic={text:"查词典...",click:function(){Log.cache({rkey:"read_toolbar_dict"});$E(["product.Translate"],function(T){T.change()})}};if(D!=3){if(Ext.readTran_enable){Q=[{text:"全文翻译",click:function(){Log.cache({rkey:"read_menu_trans"});r.trans.showCall(0)}},oDic]}}if($S("isFree")){Q.push({text:"人工翻译",click:function(){Log.cache({rkey:"read_menu_trans_service"});var T=Uri.getUrl("trans_ad1",true);window.open(T)}})}w.groups.push({items:Q});break;case"flag":var R=[];for(var H=1,t=LETTERFLAG.length,P,z;H<t;H+=1){P=LETTERFLAG[H],z=H+"";if(P){R.push({text:P,icon:"flag-"+z,extcls:"txt-flag"+z,click:f.Function.bind(function(T){Log.cache({rkey:"read_menu_flag"});r.head.setFlag(T)},null,H)})}}w={width:100,groups:[{items:R},{items:[{text:"取消旗帜",icon:"flag-0",click:function(){Log.cache({rkey:"read_menu_flag0"});r.head.setFlag(0)}}]}]};break;case"charset":var O=q.module.constructor.ENCODE;var I=[];var n=r.head.encode||"Default";for(var H=0,t=O.length,N;H<t;H+=1){N=O[H];I.push({text:N[0],checked:(N[1]==n),click:f.Function.bind(function(T){Log.cache((r.threadModule?"thread":"read")+"_menu_charset");e.setReadMode({type:"encode",encode:T})},null,N[1])})}w={width:160,groups:[{items:I,checkType:"radio"}]};break;case"move":var p=[],v=[];var S=c.list();var M,y;f.Array.each(S,function(T,V){if(V.id!=C.fid){var U={text:V.name,click:function(){Log.cache({rkey:(r.threadModule?"thread":"read")+"_menu_move"});r.head.move({toFid:V.id})}};if(!M&&V.flags.custom){if(p.length>0){v.push({items:p});p=[]}M=true}if(V.flags.pop){if(!y){if(p.length>0){v.push({items:p});p=[]}y=true}U.icon="folder-"+V.flags.iconSubtype}p.push(U)}});if(p.length>0){v.push({items:p})}w={id:r.createId("folderMenu"),groups:v,type:"scroll"};break;case"font":var F=["默认","宋体","黑体","楷体","隶书 ","幼圆","微软雅黑","Arial","Arial Black","Comic Sans MS","Courier","System","Times New Roman","Verdana","Georgia"];var o=["","simsun","simhei","KaiTi_GB2312,KaiTi","隶书","幼圆","Microsoft Yahei","Arial","Arial Black","Comic Sans MS","Courier","System","Times New Roman","Verdana","Georgia"];var A=[],v=[];var B=r.head.font||0;for(var H=0,t=F.length,G,E,x;H<t;H+=1){G=F[H];E=o[H];if(E){G='<span style="font-family:'+E+'">'+G+"</span>"}x={text:G,checked:(H==B),click:f.Function.bind(function(T){Log.cache({rkey:"read_menu_font"});e.setReadMode({type:"font",font:T})},null,H)};if(H==0){x.split=true}A.push(x)}v.push({items:A,checkType:"radio"});w={width:160,groups:v};break;case"option":w={reverse:true,groups:[{items:(r.isThread?[]:[{text:"默认显示完整/精简信息",menu:{getGroups:function(){var T=(Ud.get({field:"ntes_letter",flag:"read_head"})==1);return[{items:[{id:r.createId("opt_fullInfo"),text:"完整信息",checked:!T,click:function(){Log.cache({rkey:"read_menu_compact"});if(r.head.getUdConf("read_head")!==0){k.setAttr({field:"ntes_letter",flag:"read_head",value:0,module:"read"});if(!r.isThread){r.view.toggle("head")}}}},{id:r.createId("opt_compactInfo"),text:"精简信息",checked:T,click:function(){Log.cache({rkey:"read_menu_compelete"});if(r.head.getUdConf("read_head")!==1){k.setAttr({field:"ntes_letter",flag:"read_head",value:1,module:"read"});if(!r.isThread){r.view.toggle("head")}}}}],checkType:"radio"}]}}}]).concat([{text:"发/收件人显示",menu:{getGroups:function(){var T=(Ud.get({field:"ntes_option",flag:"sendershow"})=="2");return[{items:[{id:r.createId("opt_send"),text:"发邮件时填写的姓名",click:function(){Log.cache({rkey:"read_menu_setdisplay1"});k.setAttr({field:"ntes_option",flag:"sendershow",value:1,module:"contact"})},checked:!T},{id:r.createId("opt_contact"),text:"通讯录中对应的姓名",click:function(){Log.cache({rkey:"read_menu_setdisplay2"});k.setAttr({field:"ntes_option",flag:"sendershow",value:2,module:"contact"})},checked:T}],checkType:"radio"}]}}},{text:"对选中内容进行转发或回复",menu:{getGroups:function(){var T=(Ud.get({field:"ntes_option",flag:"readRange"})==1);return[{items:[{id:r.createId("opt_repOpen"),text:"开启",click:function(){Log.cache({rkey:"read_menu_range1"});k.setAttr({field:"ntes_option",flag:"readRange",value:1,module:"read"})},checked:T},{id:r.createId("opt_repClose"),text:"关闭",click:function(){Log.cache({rkey:"read_menu_range0"});k.setAttr({field:"ntes_option",flag:"readRange",value:0,module:"read"})},checked:!T}],checkType:"radio"}]}}},{text:"隐藏回复邮件的原文",menu:{getGroups:function(){var T=(Ud.get({field:"ntes_option",flag:"readreplystatus"})=="1");return[{items:[{id:r.createId("opt_showContent"),text:"默认显示",click:function(){Log.cache({rkey:"read_menu_showcontent1"});k.setAttr({field:"ntes_option",flag:"readreplystatus",value:1,module:"read"})},checked:T},{id:r.createId("opt_hideContent"),text:"默认隐藏",click:function(){Log.cache({rkey:"read_menu_showcontent0"});k.setAttr({field:"ntes_option",flag:"readreplystatus",value:0,module:"read"})},checked:!T}],checkType:"radio"}]}}},{text:"进行移动或删除邮件后",menu:{getGroups:function(){var T=($S("attrs").user.afterdel==0);return[{items:[{id:r.createId("opt_next"),text:"继续阅读下一封邮件",click:function(){Log.cache({rkey:"read_menu_moveback1"});k.setAttr({field:"afterdel",value:1,module:"read"})},checked:!T},{id:r.createId("opt_back"),text:"回到所在文件夹首页",click:function(){Log.cache({rkey:"read_menu_moveback0"});k.setAttr({field:"afterdel",value:0,module:"read"})},checked:T}],checkType:"radio"}]}}}])},{items:[{text:"更多设置",click:function(){Log.cache({rkey:"read_menu_options"});$E("interface.OptionInterface",function(T){T.entry({module:"options.BaseSetModule"})})}}]}]};if($S("is126")||$S("is163")){w.groups[0].items.splice(3,0,{text:"邮件全文翻译提示",menu:{getGroups:function(){var T,U=$S("attrs").user.ntes_labs;if(typeof U=="string"){T=((U.charAt(2)-0)==1)}else{T=false}return[{items:[{id:r.createId("opt_transOpen"),text:"开启",click:function(){Log.cache({rkey:"read_menu_trans1"});k.setAttr({field:"ntes_labs",flag:"translate",value:1,module:"read"})},checked:T},{id:r.createId("opt_transClose"),text:"关闭",click:function(){Log.cache({rkey:"read_menu_trans0"});k.setAttr({field:"ntes_labs",flag:"translate",value:0,module:"read"})},checked:!T}],checkType:"radio"}]},hidden:($S("is126")||$S("is163"))}})}break}return w}function h(z){var u=this;var s=u.module;var q=s.folderData;var v=s.action;var r;switch(z){case"flag":var e={type:q.label0?undefined:"blankFlag",extcls:(q.label0?"nui-ico-flag nui-ico-flag-"+q.label0:" fn-bg")};var w={id:s.createId("subjFlag"),title:"设为红旗",cls:"gD gE",icon:e,click:function(){Log.cache({rkey:"read_icon_flag"});s.head.setFlag(-1)}};r=new f.Link(w);break;case"memo":r=new f.Link({title:"邮件备注",cls:"gD fc",icon:{type:"editRemark",extcls:"fn-bg"},click:function(){Log.cache({rkey:"read_icon_memo"});s.head.setMemo()}});break;case"top":var o=q.flags;u.top=o.top;var t=o.top?"取消置顶":"置顶邮件";var n="ico ico-btn "+(o.top?"ico-btn-noTop":"ico-btn-top");r=new f.Link({title:t,cls:n,click:function(){Log.cache({rkey:"read_icon_top"});u.setTop()}});break;case"newwin":r=f.Link.html({title:"新窗口打开",cls:"gD fl",icon:{type:"newWin"},click:function(){Log.cache({rkey:"read_icon_newwin"});v.newWin()}});break;case"print":r=f.Link.html({title:"打印",cls:"gD fM",icon:{type:"print",extcls:"fn-bg"},click:function(){Log.cache({rkey:"read_icon_print"});v.newWin(1)}});break;case"schedule":var p=$S("schedule");var x="加为日程";var y="gD dT";if(p&&p[s.mid]){x="管理日程"}r=new f.Link({title:x,icon:{type:"editSchedule",extcls:"fn-bg"},cls:y,click:function(){Log.cache({rkey:"read_icon_schedule"});s.head.schedule()}});break;case"tag":r=new f.Link({title:"邮件标签",icon:{type:"addTag",extcls:"fn-bg"},cls:"gD nui-fIBlock ho",listeners:[{name:"click",handler:function(){Log.cache({rkey:"read_icon_tag"})}},{name:"render",handler:function(){var A=u.getSubMenu("tag");A.id=s.createId("subjectTagMenu");A.reverse=false;(new f.Menu(A)).attachTo({clickFrom:this.getEl()})}}]});break;case"ynote":r=new f.Link({title:"保存到有道云笔记",icon:{type:"yunnote",extcls:"fn-bg"},cls:"gD sK",click:function(){Log.cache({rkey:"read_menu_ynote"});s.head.saveToYNote()}}).html();break;default:break}if(typeof r=="object"){u[z+"Href"]=r}return r}})();(function(){var i=window.$,p,s,h,a,n;try{p=$L("module.read.BaseReadView");h=$L("support.OptionSupport");a=$L("support.AddressSupport");n=$L("interface.MboxInterface")}catch(u){return u}s=i.createClass($N("module.read.ReadView"));i.Object.inherit(s,p,{getHtml:t,getToolbar:g,getRowHtml:o,getCompactHtml:r,getFullHtml:x,getDateStr:d,getLoadTips:q,getUnSavedInfo:w,fill:v,fillAddr:k,flashAd:m,youdaoAd:l,toggle:b,getTips:j,getReply:c,zoom:f});function t(){var C=this,D=C.module,z=D.baseUrl,B=$S("attrs").user.junkpic||0,y=300,F;C.removeCaseExit=false;if(B==2||(B==1&&D.fid==5)){z+="&filterImages=on";C.junkPic=true}if(D.hiddenMod){z+="&preventSetRead=on"}if(D.part){z+=("&part="+D.part)}var A=i.Browser.getInfo();if(document.body.className.indexOf("ua-noYaHei")<0){z+="&font=15"}D.contentUrl=z;if(!!i.Browser.chrome()){y=240}else{try{y=(document.documentElement.clientHeight||document.body.clientHeight)-414;y=window.Math.max(y,300)}catch(E){y=300}}return C.addHeader(D.viewType?"":i.Toolbar.html(C.getToolbar()),['<div class="qm">','<div id="'+D.createId("dvReadHeadInfo")+'" class="pk nui-bg-light'+(D.viewType?" hn":"")+'">','<div class="ny">',C.getRowHtml("subject"),"</div>",'<div class="kz">',C.getCompactHtml(true),C.getFullHtml(),"</div>",'<div class="lh">',C.getRowHtml("compactHref"),(D.viewType?C.getSimpleToolbar():""),"</div>","</div>",'<div class="nui-split nui-split-cDark pl jL"></div>','<div id="'+D.createId("dvPopup")+'">',C.getLoadTips(),"</div>",'<div class="ko">','<div id="'+D.createId("dvContent")+'" class="nui-fClear pm">','<iframe id="'+D.createId("ifrmContent")+'" name="'+D.name+'" class="kA"  frameborder="0" src="'+z+'" style="height:'+y+'px" ></iframe>',"</div>","</div>",($S("ad").show?C.youdaoAd("get"):""),'<div id="'+D.createId("dvAttach_reply")+'" class="pf nui-bg-light nui-bdr-light">',D.attach.getHtml(),C.getReply(true),"</div>",C.zoom("get"),'</div><div class="frame-main-cont-body-mask"></div>'].join(""),"frame-main-cont-body-second")}function g(){var C=this,z=C.module,E=z.action,y=z.folderData,F=y.fid,A={groups:[]},e=A.groups,G,D,B="button";e.push({items:[{xtype:B,text:'<span style="font-family:simsun"><< </span>返回',listeners:[{name:"mousedown",handler:function(){Log.cache({rkey:"read_toolbar_back"});i.Menu.hideAllMenu();z.head.back()},type:"dom"}]}]});G=[{xtype:B,subclass:"splitBtn",extcls:"nui-imptBtn",text:"回复全部",menu:C.getSubMenu("replyAll"),click:function(){Log.cache({rkey:"read_toolbar_replyall"});E.replyAll()}},{xtype:B,subclass:"splitBtn",text:"转 发",menu:C.getSubMenu("forward"),click:function(){Log.cache({rkey:"read_toolbar_forward"});E.forward()}}];if(F==3){G.unshift({xtype:B,text:"再次发送",click:function(){Log.cache({rkey:"read_toolbar_sendagagin"});E.sendAgain()}})}else{G.unshift({xtype:B,extcls:"nui-imptBtn",text:"回 复",click:function(){Log.cache({rkey:"read_toolbar_reply"});E.reply()}})}e.push({items:G});if(z.part){return A}G=[{xtype:B,text:((F==4||F==15)?"彻底删除":"删 除"),click:function(){Log.cache({rkey:"read_toolbar_del"});z.head.move({del:true})}},{xtype:B,subclass:"dropdownBtn",text:"标记为",menu:C.getSubMenu("mark")},{xtype:B,subclass:"dropdownBtn",text:"移动到",menu:C.getSubMenu("move")},{xtype:B,subclass:"dropdownBtn",text:"更 多",menu:C.getSubMenu("more")}];if(F==3){G.splice(3,0,{xtype:B,id:z.createId("recallBt"),text:"撤回邮件",hidden:!(Ext.letterRecall||Ext.letterRecall_vip),click:function(){Log.cache({rkey:"read_toolbar_recall"});z.status.recall()}})}else{G.splice(1,0,{xtype:B,text:"举 报",click:function(){Log.cache({rkey:"read_toolbar_report1"});z.head.move({report:true,type:"spam"})}});if(",5,6,7,18,".indexOf(","+y.fid+",")>-1){G.splice(1,0,{xtype:B,text:"信 任",click:function(){Log.cache({rkey:"read_toolbar_report0"});z.head.move({report:true,type:"noSpam"})}})}}e.push({items:G});G=[{xtype:B,id:z.createId("pre"),subclass:"roundBtn",icon:"prev",disabled:true},{xtype:B,id:z.createId("next"),subclass:"roundBtn",icon:"next",disabled:true},{xtype:B,subclass:"roundBtn",icon:"setting",title:"快捷设置",menu:C.getSubMenu("option"),click:function(){Log.cache({rkey:"read_toolbar_option"})}}];e.push({items:G,type:"ext"});return A}function o(Q){var C=this;var D=C.module;var L=D.folderData;var M=L.fid;var J="";try{switch(Q){case"subject":var B=i.String.escapeHTML(L[Q]||"无主题");var J='<h1 id="'+D.createId("h1Subject")+'" class="nui-fIBlock lv'+(L.label0?(" nui-txt-flag"+L.label0):"")+'" tabindex="0" title="邮件标题" hidefocus="hidefocus">'+B+"</h1>";if(D.part){J+=C.getSubjectHref("newwin")+C.getSubjectHref("print")}else{var I="";if(Ext.tag&&D.mtype!="thread"){J+='<div id="'+D.createId("divTag")+'" class="nui-fIBlock jE"></div>';I=C.getSubjectHref("tag").html()}J+=['<div class="nui-fIBlock lj" role="toolbar">',I,C.getSubjectHref("flag").html(),$S("isCorp")?"":C.getSubjectHref("schedule").html(),C.getSubjectHref("memo").html(),C.getSubjectHref("print"),(Ext.ynote?C.getSubjectHref("ynote"):""),"</div>"].join("")}break;case"date":J=['<li class="fS dk">','<div class="fT">时&nbsp;&nbsp;&nbsp;间：</div>','<div class="fU">'+(C.getDateStr()||"(无)")+"</div>","</li>"].join("");break;case"from":var H=L[Q];if(!H){return['<li class="fS dj">','<div class="fT">发件人：</div>','<div class="fU">(无)</div>',"</li>"].join("")}var K=Uri.getEmails(H,"Email",true);var S=K.match;var F;if(S.length>0){F=S[0]}else{F={name:"",address:H}}var E=(Ud.get({field:"ntes_option",flag:"sendershow"})=="2");if(F.name.substr(0,1)=="-"||F.name.substr(0,1)=="+"){F.defaultName=F.name=F.name.substr(1)}if(E||!F.name){var A=a.getName(F);if(A){F.defaultName=F.name=A}}D.fromEmail=F;var z={email:F,popupRenderTo:D.container};if(a.getAddrObj(F.address)){z.type="user";z.subtype="contact"}C.fromItem=new i.Addr(z);J=['<li class="fS dj">','<div class="fT">发件人：</div>','<div class="fU">',C.fromItem.html(),"</div>","</li>"].join("");break;case"to":case"cc":case"bcc":var N={to:"收件人",cc:"抄送人",bcc:"密送人"};var H=L[Q];var R=Q!="to"?' style="display:none"':"";J=['<li id="'+D.createId("liReadOut"+Q)+'" class="fS dZ"'+R+">",'<div class="fT">',N[Q],"：</div>",'<div id="'+D.createId("dvRead"+Q)+'" class="fU">',i.String.escapeHTML(H||"(无)"),"</div>","</li>"].join("");break;case"attach":J='<li id="'+D.createId("liAttach")+'" class="fS dD" style="display:none"></li>';break;case"memo":if(Ext.memo){var y=L.memo||"";var P=' style="display:none"';C.btnMemoSave=new i.Button({text:"确定",extcls:"bf",subclass:"mainBtn",click:function(){D.head.setMemo(4)}});C.btnMemoCancel=new i.Button({text:"取消",extcls:"bf",click:function(){D.head.setMemo(5)}});J=['<li id="'+D.createId("liMemo")+'" class="fS cS"'+(y?"":P)+">",'<div class="fT">备&nbsp;&nbsp;&nbsp;注：</div>','<div id="'+D.createId("dvMemoShow")+'" class="fU">','<div id="'+D.createId("dvMemoContent")+'" class="bI">'+i.String.escapeHTML(y||"")+"</div>",'<div class="bA">',i.Link.html({text:"编辑",cls:"bb nui-txt-link",click:function(){D.head.setMemo(3)}}),i.Link.html({text:"删除",cls:"bb nui-txt-link",click:function(){D.head.setMemo(2)}}),"</div>","</div>",'<div id="'+D.createId("dvMemoEdit")+'" class="fU"'+P+">",i.Input.html({id:D.createId("textMemo"),subclass:"multiLineIpt",extcls:"bz",inputClass:"F"}),'<div class="bA">','<span id="'+D.createId("spanMemoErr")+'" class="bg"></span>',C.btnMemoSave.html(),C.btnMemoCancel.html(),"</div>","</div>","</li>"].join("")}break;case"compactHref":var G=(D.head.getUdConf("read_head")==1);C.compactLinkId=D.createId("compactLink");C.fullLinkId=D.createId("fullLink");if(D.threadModule){G=true}J=[i.Link.html({id:C.compactLinkId,cls:"nui-txt-link",text:'精简信息<b class="nui-ico hp">k</b>',hidden:G,click:function(){Log.cache({rkey:"read_head_compact"});C.toggle("head",0);if(!D.threadModule&&D.head.getUdConf("read_head")!==1){h.setAttr({field:"ntes_letter",flag:"read_head",value:1,module:"read"})}}}),i.Link.html({id:C.fullLinkId,cls:"nui-txt-link",text:'完整信息<b class="nui-ico hp">j</b>',hidden:!G,click:function(){Log.cache({rkey:"read_head_compelete"});C.toggle("head",1);if(!D.threadModule&&D.head.getUdConf("read_head")!==0){h.setAttr({field:"ntes_letter",flag:"read_head",value:0,module:"read"})}}})].join("");break}}catch(O){return""}return J}function r(F){var C=this;var E=C.module;var O=!!E.threadModule;if(F){var U=(O||E.head.getUdConf("read_head")==1)?"":' style="display:none"';var L='<ul id="'+E.createId("ulCompact")+'"'+U+"></ul>";return L}var M=E.data;var S=M.to||[],D=M.cc||[];S=typeof S=="string"?[S]:S,typeof D=="string"?[D]:D;var H=S.concat(D),N={},z=0;for(var P=0,G=H.length;P<G;P+=1){if(z>4){break}var A;try{A=a.getName({name:Uri.getName(H[P]),address:Uri.getAddress(H[P].toString())})}catch(R){}if(A&&!N[A]){N[A]=A;z+=1}}var K=[];for(var A in N){K.push(i.String.escapeHTML(A||""))}var Q=M.from||[],J=[];Q=(Q instanceof window.Array)?Q:[Q];for(var P=0,G=Q.length;P<G;P+=1){try{var T=Q[P].toString(),A=Uri.getName(T),B=Uri.getAddress(T);J.push((A||B)?a.getName({name:A,address:B}):T)}catch(R){}}var I=C.getDateStr()||"未知时间";var y=[("&nbsp;于 "+I+" 发给 "+K.join("，")+(H.length>K.length?"...等 "+H.length+" 人":"")+"。&nbsp;&nbsp;&nbsp;"),((E.hasAttach||E.hasBigAttach)?i.Link.html({id:E.createId("compactAttachLink"),text:"",cls:"nui-txt-link",click:function(){E.attach.flash()}}):""),"&nbsp;"+C.getUnSavedInfo(true)].join("");if(O){y="<p>"+y+"</p>"}var L=['<li class="fS rK">','<div class="fU">','<strong class="nui-txt-suc">'+i.String.escapeHTML(J.join("、"))+"</strong>",y,"</div>","</li>"].join("");E.getDom("ulCompact").innerHTML=L}function x(){var y=this;var A=y.module;var e=y.module.fid;var z=(A.threadModule||A.head.getUdConf("read_head")==1)?' style="display:none"':"";return['<ul id="'+A.createId("ulFull")+'"'+z+">",y.getRowHtml("from"),y.getRowHtml("to"),y.getRowHtml("cc"),((e==3||y.module.folderData.fid==3)?y.getRowHtml("bcc"):""),y.getRowHtml("date"),y.getRowHtml("attach"),y.getRowHtml("memo"),"</ul>"].join("")}function d(A,e,B){var z=this.module.folderData;var C=this.module.data||[];var A=A||z.sentDate||C.sentDate;var y="";if(B){return A}if(A){y=i.Date.format(A,e||"yyyy年MM月dd日 HH:mm (星期w)")}return y}function q(){var E=this;var D=E.module;var C=D.folderData;var G=[];if(D.hasAttach||D.part){}else{if(C.flags&&C.flags.attached&&!D.part){G.push(E.getTips("attachWrong"))}}if(D.fid==18&&C.flags&&!C.flags.read){G.push(E.getTips("subscibe"))}if(D.fid==3||(D.fid==-1&&C.fid==3)){try{var H=n.getSendInfo(D.folderData);if(H){G.push(E.getTips("sendStatus",null,{info:H}))}}catch(F){}}else{var B=C.flags;if(B.replied||B.forwarded){var A="邮件已被",z;if(B.replied&&B.forwarded){A+="回复且转发";z="refw"}else{if(B.replied){A+="回复";z="re"}else{A+="转发";z="fw"}}var y={msg:A+"&nbsp;&nbsp;",icon:z};G.push(E.getTips("mailStatus",null,y))}}if(D.fid==3&&C.flags.encrypted&&C.encpwd){G.push(E.getTips("decryptPwd",null,{pwd:C.encpwd}))}return G.join("")}function w(A){var D=this,B=D.module,G="",y=B.folderData,E,z,C;if(y.fid!=3){return G}if(y.fullSaveId){G+=(i.Icon.html({type:"alert"})+i.Label.html({text:"邮件大小超过1M，未保存普通附件",type:"info"})+"&nbsp;");E=H();if(E){G+=("("+i.Link.html({id:B.createId("attachSaveLink"+(A?"_full":"_comp")),text:"马上保存",cls:"nui-txt-link",click:function(){if(!H()){e();return}B.action.saveSentAttachMail({fullSaveId:y.fullSaveId,mid:y.id,call:function(I){switch(I.code){case"S_OK":i.Tips.show({text:"附件保存成功",type:"suc"});window.Listener.fire("read:wmsvrDelete",y);n.entry({fid:y.fid});B.moduleRemove();break;case"FA_MAIL_NOT_FOUND":e();break;case"FS_MS0259":e();break;default:i.Msgbox.html({content:"附件保存失败，错误码："+I.code,icon:"err"});break}}})}}));G+=('<span id="'+B.createId("attachSaveLinkSplit"+(A?"_full":"_comp"))+'">&nbsp;|&nbsp;</span>')}G+=((E?"":"(")+i.Link.html({text:"设置自动保存",cls:"nui-txt-link",click:function(){$E("interface.OptionInterface",function(I){I.entry({module:"BaseSetModule",inputName:"afterSendRule"})})}})+")")}if(A){return G}else{if(G.length>0){z=i(B.getDom("liAttach"));var F=z.find(".fU");if(F){i.fly(F.doms[0]).append(G)}else{z.html('<div class="fT">附&nbsp;&nbsp;&nbsp;件：</div><div class="fU">'+G+"</div>")}i.Component.setEvents();z.show();z.destroy()}}function H(){return Misc.getTime().getTime()-y.sentDate.getTime()<1800000}function e(){i.Msgbox.html({content:"抱歉，距邮件发出时间大于30分钟，附件无法保存。",icon:"err"});$C(B.createId("attachSaveLink_full")).destroy();i.fly(B.getDom("attachSaveLinkSplit_full")).remove();$C(B.createId("attachSaveLink_comp")).destroy();i.fly(B.getDom("attachSaveLinkSplit_comp")).remove()}}function v(){var F=this;var D=F.module;var z=D.data;var C=D.folderData;var I=C.fid;F.getCompactHtml();if(z.antispamInfo&&z.antispamInfo.RulesType&&(I!=5&&I!=7)){var B=i.String.trim((z.antispamInfo.RulesType+"").toLowerCase());if(B&&B.indexOf("fake")!=0&&B.indexOf("ntesfake")!=0){var K=D.getDom("h1Subject");if(K){K.innerHTML=('<img src="http://mimg.127.net/p/js4/lib/img/integrity/cx_0.gif" class="in" alt="网易诚信邮件联盟认证邮件" title="网易诚信邮件联盟认证邮件"/>'+K.innerHTML)}}}F.fillAddr("to");F.fillAddr("cc");if(I==3){F.fillAddr("bcc")}if(Ext.tag){D.head.updateTag()}var L="";var J=z.headers;if(J){if(J["Resent-From"]){L="由 "+i.String.encodeHTML(J["Resent-From"].join(","))+" 转发"}else{if(J.Sender){var y=z.from;if(y&&y.length>0){var A=Uri.getAddress(y[0]);var E=Uri.getAddress(J.Sender[0]);if(A!=E){L="由 "+i.String.encodeHTML(J.Sender[0])+" 代发&nbsp;,&nbsp;"+i.Link.html({link:"sender_help",text:"帮助",target:"_blank",cls:"txt-info"})}}}}if(L){try{F.fromItem.getEl().after('<span class="cb">('+L+")</span>")}catch(H){}}}var G=false;if(z.antispamInfo){var B=i.String.trim((z.antispamInfo.RulesType+"").toLowerCase());if(B.indexOf("fake")==0||B.indexOf("ntesfake")==0){F.getTips("systemWarn","dvPopup");G=true}}if(I==5&&!G){F.getTips("spamFolder","dvPopup")}F.getReply();i.Component.setEvents(10)}function k(Z){var I=this;var J=I.module;var T=J.data;var Q=J.constructor.displayCount;var C=T[Z]||[];var M=C.join?C:[C+""];if(M.length==0){return}var V=[];try{for(var W=0,L=M.length;W<L;W+=1){var S=Uri.getEmails(M[W],null,true);var ab=S.match;var P;if(ab.length>0){P=ab[0];V.push(P)}}}catch(X){}var K=(Ud.get({field:"ntes_option",flag:"sendershow"})=="2");var F=a.mappingEmails(V,K);var Y=[];var O=F.data;I["fix"+Z]=O;for(var W=0,L=O.length,T;W<L;W+=1){T=O[W];T.symbol=";";Y.push(i.Addr.html({email:new Email(T.address,T.name),popupRenderTo:J.container}))}var H;var z=Y.length-Q;var y=J.createId("dvHideAddress"+Z);var U="(无)";var G="";if(Y.length>0){if(z>0){H=Y.splice(0,Q);U=H.join("");G='<span id="'+y+'" style="display:none">'+Y.join("")+"</span>"}else{U=Y.join("")}}var A=J.getDom("dvRead"+Z);var R=U+G;if(Z=="bcc"){R+=i.Label.html({text:"(密送人仅在已发送文件夹显示，对发件人可见。)",type:"info"})}if(A){A.innerHTML=R}var D=(Z=="cc"?"抄送人":"收件人");if(z>0){var N="cE",B=new i.Link({id:J.createId("addrMoreLink"+Z),text:("&darr;还有"+z+"个联系人"),cls:"nui-txt-link",renderTo:A,click:i.Function.bind(I.toggle,I,"addr",Z),spancls:N}),E=new i.Link({id:J.createId("addrLessLink"+Z),text:"&uarr;隐藏信息",cls:"nui-txt-link",renderTo:A,click:i.Function.bind(I.toggle,I,"addr",Z),spancls:N,hidden:true}),aa=new i.Link({text:"保存所有"+D,cls:"nui-txt-link",renderTo:A,click:function(){J.head.saveContact(Z)},spancls:N})}if(Z!="to"){try{J.getDom("liReadOut"+Z).style.display=""}catch(X){}}}function m(){var G=this,C=G.module;if(!(C.head.getUdConf("read_head")==0&&C.head.getUdConf("read_ad")!=1&&window.fAdReadFlash)){return}var z="135",D="98";var J=C.head.constructor;if(!J.dvFlash){J.dvFlash=[];var F=fAdReadFlash().data,H=i.Browser.isIE();for(var E=0,K=F.length,B;E<K;E+=1){B=F[E];if(B){var L=J.dvFlash.length,A;if(H){A='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="adRead'+L+'" style="width:'+z+"px;height:"+D+'px;" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0"><param name="movie" id="pBanner'+L+'" value="'+B+'" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /><param name="wmode" value="opaque" /></object>'}else{A='<embed id="adRead'+L+'" name="adRead'+L+'" src="'+B+'" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="'+z+'" height="'+D+'" swLiveConnect=true  allowScriptAccess="always" wmode="opaque" ></embed>'}var y=i.Element.create("div");y.setAttr({id:"dvReadFlashAd",className:"oQ"});y.setStyle({width:z+"px",height:D+"px",background:"#eee"});y.html(A);J.dvFlash.push(y)}}}if(J.dvFlash&&J.dvFlash.length>0){var I=C.getDom("dvReadHeadInfo");if(I){var e=Math.round(Math.random()*(J.dvFlash.length-1));window["adRead"+e+"_DoFSCommand"]=DoFSCommand;i.fly("#scriptReadAd").dom.htmlFor="adRead"+e;i.fly(I).addClass("mc");I.appendChild(J.dvFlash[e].dom)}}}function l(A){var e=this;var y=e.module;if(A=="get"){return'<div id="'+y.createId("dvReadAd")+'" class="qh txt-info" style="display:none;"></div>'}if(A=="init"){fReadLetterAd({mid:y.mid,call:z})}function z(D){var B=y.getDom("dvReadAd");if(D&&B){B=i(B);var C=['<div class="nui-split nui-split-cDark"></div>','<div class="oq">','<span class="nq">','[<a href="'+D.type_link+'" class="me txt-info" target="_blank">'+(D.type||"今日新闻")+"</a>]","</span>",'<a href="'+D.link+'" class="me lu" target="_blank">'+i.String.encodeHTML(D.title)+"</a>",'- <a href="'+D.link+'" class="me ln" target="_blank">'+D.url+"</a> - "+D.line1+" "+D.line2,"</div>",'<div class="nui-split nui-split-cDark"></div>'].join("");B.html(C);B.show();B.destroy()}}}function b(y,G){var C=this,z=C.module;try{switch(y){case"head":var A=i(z.getDom("ulFull")),F=$C(C.fullLinkId).getEl(),E=i(z.getDom("ulCompact")),B=$C(C.compactLinkId).getEl();if(G==="0"){E.hide();F.hide();A.show();B.show()}else{if(G==="1"){A.hide();B.hide();E.show();F.show()}else{A.toggle();E.toggle();F.toggle();B.toggle()}}A.destroy();E.destroy();break;case"addr":i.fly(z.getDom("dvHideAddress"+G)).toggle();$C(z.createId("addrMoreLink"+G)).getEl().toggle();$C(z.createId("addrLessLink"+G)).getEl().toggle();break;default:break}}catch(D){}}function j(e,C,y){var G=this,D=G.module,J=D.trans,H,E,I,B,A,z="",F="py";if(C){H=D.getDom(C)}switch(e){case"transCheck":var z=(y&&y.text)?y.text:"翻译成中文";B={id:D.createId("transTip"),renderTo:H,params:"hasClose",extcls:F,subclass:"assistBlock",icon:"translate",content:['<div class="nn">','<p class="nui-txt-impt">',i.Link.html({text:z,cls:"nui-txt-link",click:function(){J.showCall(1);this.link.html("正在翻译，请稍候...")}}),"</p>","</div>"].join("")};A=new i.Block(B);break;case"transShow":B={renderTo:H,extcls:F,subclass:"assistBlock",icon:"translate",content:['<div class="nn">',"<p>",i.Link.html({id:D.createId("transShowSource"),cls:"nui-txt-link",text:"只显示原文","right-bracket":'<span class="lk nui-txt-aside">|</span>',click:function(){J.change(0)}}),i.Link.html({id:D.createId("transShowResult"),cls:"nui-txt-link",text:"只显示译文","right-bracket":'<span class="lk nui-txt-aside">|</span>',click:function(){J.change(1)}}),i.Link.html({id:D.createId("transShowBoth"),cls:"nui-txt-link",text:"对照显示",disabled:true,click:function(){J.change(2)}}),"</p>","</div>"].join(""),ext:($S("isFree")?i.Link.html({text:"最快的人工翻译，有道专业翻译",target:"_blank",noParam:true,link:"trans_ad2"}):i.Link.html({text:"有道翻译",target:"_blank",noParam:true,link:"read_trans_provide","left-bracket":"本服务由  ","right-bracket":" 提供"}))};A=new i.Block(B);break;case"transRetry":B={id:D.createId("translateRetry"),renderTo:H,extcls:F,subclass:"assistBlock",icon:"translate",content:['<div class="nn">',"<p>",i.Link.html({text:"重试","left-bracket":"在线翻译服务异常，请稍候 ","right-bracket":"...",click:function(){J.showCall(2);$C(D.createId("translateRetry")).destroy()}}),"</p>","</div>"].join("")};A=new i.Block(B);break;case"attachWrong":B={renderTo:H,params:"hasClose",extcls:F,subclass:"assistBlock",icon:"alert",content:['<div class="nn">','<p class="nui-txt-impt">该邮件的附件格式不正确</p>',"</div>"].join("")};A=new i.Block(B);break;case"systemWarn":B={renderTo:H,params:"hasClose",extcls:F,subclass:"assistBlock",icon:"alert",content:['<div class="nn">','<p class="nui-txt-impt">',"请注意：此邮件非系统邮件，请不要轻易透露个人重要信息，提高警惕，谨防网络欺诈！",i.Link.html({text:"查看详情",link:"read_yjzp",target:"_blank"}),"</p>","</div>"].join("")};A=new i.Block(B);break;case"junkPic":E=[{xtype:"link",text:"点击这里显示图片","left-bracket":"该邮件中包含了图片，",click:function(){D.action.setReadMode({type:"normal",showImg:true});this.ownerCt.destroy()}}];B={id:D.createId("junkPicTips"),renderTo:H,params:"hasClose",extcls:F,subclass:"assistBlock",icon:"alert",content:['<div class="nn">','<p class="nui-txt-impt">',"该邮件中包含了图片，",i.Link.html({text:"点击这里显示图片",cls:"nui-txt-link",click:function(){D.action.setReadMode({type:"normal",showImg:true});D.view.junkPic=false;$C(D.createId("junkPicTips")).destroy()}}),"</p>","</div>"].join("")};A=new i.Block(B);break;case"decryptCheck":B={id:D.createId("decryptBlock"),renderTo:H,icon:"encrypt32",extcls:F+" km",subclass:"assistBlock",content:['<div class="nn">','<p class="nui-txt-normal">这是一封由 <strong class="nui-txt-suc">'+D.fromEmail.defaultName+"</strong> 从网易邮箱发出的加密邮件。",i.Link.html({link:"read_decrypt_help",title:"查看使用说明",text:"查看使用说明",target:"_blank"}),'</p><p class="nui-txt-normal">输入发件人提供给您的密码，即可查阅完整邮件<span class="nui-txt-tips">(您可以通过电话、短信或其他方式向发件人索取密码)</span></p>','<div class="gF nui-txt-normal">输入密码：',i.Input.html({id:D.createId("decryptInput"),inputType:"password",placeholder:"在此输入密码",maxLength:6,listeners:[{name:"enter",handler:function(){D.decrypt.decryptMessage()}},{name:"keydown",handler:function(){try{$C(D.createId("decryptTips")).hide()}catch(L){}},dom:true}]}),i.Button.html({text:"确定",title:"提交密码进行解密",subclass:"inputBtn",click:function(){D.decrypt.decryptMessage()}}),i.Tips.html({id:D.createId("decryptTips"),text:" ",subclass:"normalTips",type:"err",hidden:true}),"</div>","</div>"].join("")};A=new i.Block(B);break;case"decryptSuc":B={renderTo:H,params:"hasClose",extcls:F,subclass:"assistBlock",icon:"decrypt32",content:['<div class="nn">','<p class="nui-txt-suc">邮件已解密，以下是解密后的邮件内容：</p>',"</div>"].join("")};A=new i.Block(B);break;case"decryptPwd":B={renderTo:H,params:"hasClose",extcls:F+" km kn",subclass:"assistBlock",icon:"encrypt",content:'<div class="nn"><span class="nui-txt-normal">加密邮件的密码为：'+i.String.escapeHTML(y.pwd)+"</span></div>"};A=new i.Block(B);break;case"sendStatus":if(y.info){var e=y.info.ext.type,K=["","nui-txt-suc","nui-txt-err","nui-txt-impt"];B={renderTo:H,extcls:F+" mU",subclass:"assistBlock",icon:e+"State",content:['<div class="nn">',"<p>",(e=="recall"?"撤回状态":"发送状态")+'：<strong class="'+K[y.info.ext.status]+'">'+y.info[1]+"</strong>",i.Link.html({id:D.createId("readCheckStatus"),text:"查看详情",cls:"nui-txt-link",click:function(){D.status.query(e)}}),i.Link.html({id:D.createId("readRefreshStatus"),text:"刷新",cls:"nui-txt-link",hidden:true,click:function(){D.status.query(e,true);this.hide();this.show()}}),"</p>","</div>"].join("")};A=new i.Block(B);D.status.setTips(e,A)}break;case"mailStatus":B={renderTo:H,extcls:F,subclass:"assistBlock",icon:y.icon,content:['<div class="nn">','<p  class="nui-txt-normal">',y.msg,i.Link.html({id:D.createId("readCheckStatus"),text:"查看详情",cls:"nui-txt-link",click:function(){D.status.query("mail")}}),i.Link.html({id:D.createId("readRefreshStatus"),text:"刷新",cls:"nui-txt-link",hidden:true,click:function(){D.status.query("mail",true)}}),"</p>","</div>"].join("")};A=new i.Block(B);D.status.setTips("mail",A);break;case"subscibe":B={renderTo:H,extcls:F,subclass:"assistBlock",content:['<div class="nn">','<p id="'+D.createId("subscibe")+'" class="nui-txt-normal">',"如果这封邮件不是您订阅的，请 ",i.Link.html({text:"举报",cls:"nui-txt-link",click:function(){D.head.move({report:true,type:"spam"})}}),"；如果是分类错误的邮件，可以 ",i.Link.html({text:"添加到白名单",cls:"nui-txt-link",click:function(){var L=D.folderData.from;if(!L){new i.Tips({type:"err",text:"发件人地址错误"});return}var M=Uri.getAddress(L);$E("support.OptionSupport",function(N){N.addList({name:"safelist",value:M},function(O){if(O){D.getDom("subscibe").innerHTML='<span class="nui-txt-suc">发件人已被加入白名单，该发件人今后发送的邮件将会进入收件箱</span>'}})})}}),"</p>","</div>"].join("")};A=new i.Block(B);break;case"spamFolder":B={renderTo:H,extcls:F,icon:"alert",subclass:"assistBlock",params:"hasClose",content:['<div class="nn">','<p class="nui-txt-normal">','<span class="nui-txt-impt">请留意：此邮件在垃圾文件夹，如有提示您填写邮箱信息、中奖需汇款转账等信息，请谨防网络欺诈！</span>',i.Link.html({text:"查看详情",target:"_blank",noParam:true,link:"read_yjzp"}),"</p>","</div>"].join("")};A=new i.Block(B);break}if(C){if(e!="junkPic"){i.Component.setEvents(10)}return A}else{return A.html()}}function c(y){var C=this;var B=C.module;var F=B.action;var I="jI",D="kq";if(y){return'<div class="pe" id="'+B.createId("dvReply")+'"></div>'}var E=B.head.replyContent(),e=E+"（按Ctrl+Enter键发送）",L={renderTo:B.createId("dvReplyBts"),id:B.createId("sendBt"),text:"&nbsp;&nbsp;发&nbsp;送&nbsp;&nbsp;",subclass:"mainBtn",click:function(){Log.cache({rkey:(B.threadModule?"thread":"read")+"_bottom_quickreply"});$C(B.createId("cancelBt")).setDisabled();B.head.quickReply()}},H={renderTo:B.createId("dvReplyBts"),id:B.createId("cancelBt"),text:"&nbsp;&nbsp;取&nbsp;消&nbsp;&nbsp;",click:function(){Log.cache({rkey:(B.threadModule?"thread":"read")+"_bottom_quickreply_cancel"});var N=$C(B.createId("replyInput")),M=N.getInputEl();N.setValue("");M.dom.setAttribute("style","");N.getEl().removeClass("ev");N.showPlaceholder();B.getDom("dvReplyBts").style.display="none";C.replyUnfold=false}},A={id:B.createId("replyInput"),subclass:"multiLineIpt",extcls:D,placeholder:E,ariaLabel:e,title:e,listeners:[{name:"focus",handler:function(){if(C.replyUnfold){return}var P=this;var M=(B.threadModule||B).getDom("ScrollDiv");B.getDom("dvReplyBts").style.display="";B.getDom("fullReplyLink").style.display="";if(!B.threadModule){B.getDom("dvAttach_reply").style.marginBottom="50px";M.scrollTop+=200;window.setTimeout(function(){B.getDom("dvAttach_reply").style.marginBottom=""},500)}P.getEl().addClass("ev");var N=$C(B.createId("sendBt")),O=$C(B.createId("cancelBt"));if(N){N.show();O.show()}else{new i.Button(L);i.fly(B.getDom("dvReplyBts")).append('<span id="'+B.createId("spanReplyNbsp")+'">&nbsp;&nbsp;<span>');new i.Button(H)}P.hidePlaceholder();C.replyUnfold=true;Log.cache({rkey:(B.threadModule?"thread":"read")+"_bottom_activereply"})}},{name:"enter",handler:function(){var N=i.Event.getEvent(),M;if(N&&N.ctrlKey){M=$C(B.createId("sendBt"));if(M){M.fire("click")}}}},{name:"keyup",handler:function(){var N=this.getInputEl().dom,P=N.scrollHeight,O=N.offsetHeight;if(P>O){if(P<=400){N.style.overflow="hidden";N.style.height=P+"px";var M=B.getDom("ScrollDiv");M.scrollTop+=P}else{N.style.overflow="auto"}}}}]};C.replyBtConf=i.Object.clone(L);C.cancleReplyBtConf=i.Object.clone(H);var K=F.getSender(true);var J="";if(K){J=K.name?(K.name+"<"+K.address+">"):K.address}var z="nb cT fn-ib";var G=['<div id="'+B.createId("dvReplyInputs")+'" class="nv">',i.Input.html(A),"</div>",'<div id="'+B.createId("dvReplyBts")+'" class="ns" style="display:none">','<div id="'+B.createId("fullReplyLink")+'" class="jH">','<div class="fN">',i.Link.html({text:"完整模式回复",cls:"nui-txt-link",click:function(){Log.cache({rkey:(B.threadModule?"thread":"read")+"_bottom_fullreply"});F.replyAll(false,false,i.String.escapeHTML($C(B.createId("replyInput")).getValue()))}}),"</div>","</div>","</div>"].join("");B.getDom("dvReply").innerHTML=G;i.Component.setEvents()}function f(B){var z=this,A=z.module;switch(B){case"get":return['<div id="'+A.createId("dvReadZoom")+'" class="pz">','<div id="'+A.createId("backToTop")+'" class="mW nw" style="display:none;">',i.Button.html({subclass:"roundBtn",icon:{type:"backToTop"},extcls:"lo",title:"返回顶部",tabindex:"-1",click:function(){Log.cache({rkey:"read_backtotop"});A.getDom("ScrollDiv").scrollTop=0;A.getDom("backToTop").style.display="none"}}),"</div>",'<div class="mW rH">',i.Button.html({subclass:"roundBtn",icon:{extcls:"nui-ico-readMod-default"},extcls:"rI",title:"使用最佳阅读模式",tabindex:"-1",click:function(){A.content.frameHeight=A.content.frameHeight||A.contentFrame.style.height;A.content.frameWidth=A.content.frameWidth||A.contentFrame.offsetWidth+"px";try{A.content.removeStyleTag()}catch(C){}try{A.content.clearStyle(A.contentFrame.contentWindow.document.body)}catch(C){}A.content.setHeight({zoom:true});this.hide();this.getEl().dom.nextSibling.style.display=""}}),i.Button.html({subclass:"roundBtn",icon:{extcls:"nui-ico-readMod"},extcls:"rI",title:"使用默认阅读模式",tabindex:"-1",hidden:true,click:function(){A.contentFrame.contentWindow.location.reload();this.hide();this.getEl().dom.previousSibling.style.display=""}}),"</div>",'<div id="'+A.createId("showZoomBt")+'" class="mW jN">',i.Button.html({subclass:"roundBtn",icon:{type:"zoomIn"},extcls:"kr",title:"展开缩放工具",tabindex:"-1",click:function(){Log.cache({rkey:"read_zoom"});z.zoom("toggle")}}),"</div>",'<div id="'+A.createId("zoomBts")+'" class="mW ky" style="display:none;">',i.Button.html({subclass:"roundBtn",icon:{type:"bigPlus"},extcls:"ip",title:"放大显示正文文字",tabindex:"-1",click:function(){A.content.frameHeight=A.content.frameHeight||A.contentFrame.style.height;A.content.frameWidth=A.content.frameWidth||A.contentFrame.offsetWidth+"px";A.content.setFont(A.contentFrame.contentWindow.document.body,true)}}),i.Button.html({subclass:"roundBtn",icon:{type:"original"},extcls:"jJ",title:"还原显示正文文字",tabindex:"-1",click:function(){A.contentFrame.contentWindow.location.reload()}}),i.Button.html({subclass:"roundBtn",icon:{type:"bigMinus"},extcls:"hs",title:"缩小显示正文文字",tabindex:"-1",click:function(){A.content.frameHeight=A.content.frameHeight||A.contentFrame.style.height;A.content.frameWidth=A.content.frameWidth||A.contentFrame.offsetWidth+"px";A.content.setFont(A.contentFrame.contentWindow.document.body)}}),i.Button.html({subclass:"roundBtn",icon:{type:"bigClose"},extcls:"jK",title:"隐藏缩放工具",tabindex:"-1",click:function(){z.zoom("toggle")}}),"</div>","</div>"].join("");case"fix":if(i.Browser.ie()==6){var e=A.getDom("dvReadZoom");if(e){var y=A.getDom("ScrollDiv").scrollTop;e.style.top=document.documentElement.offsetHeight-i.fly(A.container).position().y+y-(y?104:76)-70+"px"}}break;case"toggle":i.fly(A.getDom("showZoomBt")).toggle();i.fly(A.getDom("zoomBts")).toggle();break;case"showTop":i.fly(A.getDom("backToTop")).show();z.zoom("fix");break;case"hideTop":i.fly(A.getDom("backToTop")).hide();z.zoom("fix");break}}})();(function(){var h=window.$,d,m,n,g,s;try{m=$L("interface.MboxInterface")}catch(r){return r}d=$I("module.BaseListener");n=h.createClass($N("module.read.ReadListener"));g=!!(h.Browser.chrome());s=!!(h.Browser.safari());h.Object.inherit(n,d,{_listeners:{"global:resize":{handler:a},"folder:add":{handler:o},"folder:modify":{handler:o},"folder:remove":{handler:o},"tag:add":{handler:b},"tag:modify":{handler:b},"tag:remove":{handler:c},"letter:update":{handler:i},"letter:setspam":{handler:p},"letter:allread":{handler:f},"letter:rollback":{handler:j},"options:readModify":{handler:l},"addr:dataReset":{handler:q},"options:contactModify":{handler:q},"options:inboxModify":{handler:q},"options:skinChange":{handler:k}}});function a(){var e=this,t=this.module,u=t.contentFrame;if(g||s){u.style.height="auto"}if(!g){u.style.width=t.trans.type===2?"":"100%"}t.content.setHeight()}function o(){var t=this.module;if(t.part){return}try{t.head.upadteFolder()}catch(u){}}function b(t,u,A){var x=this.module,z=x.folderData.tag||[];if(x.part){return}if(u!==A){for(var v=0,w=z.length;v<w;v+=1){if(z[v]===u){z[v]=A;break}}}try{this.module.head.updateLocalUi({type:"tagMenu"})}catch(y){}}function c(t){var w=this.module,y=w.folderData.tag||[];if(w.part){return}if(t){for(var u=0,v=y.length;u<v;u+=1){if(y[u]===t){y.splice(u,1);break}}}try{this.module.head.updateLocalUi({type:"tagMenu"})}catch(x){}}function i(v){var w=this.module,u=w.folderData,z=v.list;if(w.part){return}if(!z[w.mid]){if(v.type!=="move"){return}}else{m.syncData(v,u)}try{switch(v.type){case"flag":w.head.updateLocalUi({type:"flag"});break;case"tag":if(u.tag){w.head.updateLocalUi({type:"tagMenu"})}else{w.head.updateTag(u)}break;case"top":w.head.updateLocalUi({type:"top"});break;case"memo":w.head.setMemo(6);break;case"move":if(w.mtype=="read.ReadModule"){var t=w.preData,y=w.nextData;if((t&&z[t.id])||(y&&z[y.id])){w.head.setPreAndNext()}else{if(z[w.mid]){w.head.moveBack()}}}else{if(w.mtype=="thread.ThreadLetterModule"){if(z[w.mid]){w.head.moveBack()}}}break}}catch(x){}}function p(x,v,z,u,t){var w=this.module;if(w.part){return}if(!t[w.mid]){return}if(w.mtype=="read.ReadModule"){try{w.head.moveBack()}catch(y){}}}function f(t,v){var u=this.module,e=u.folderData;if(u.hiddenMod&&u.fid===t){m.syncData({type:"read",value:1},e)}}function l(y){var w=this.module;if(!y instanceof window.Array){y=[y]}for(var t=0,v=y.length,u;t<v;t+=1){u=y[t];try{w.head.updateLocalUi({type:u.flag||u.field,value:u.value})}catch(x){}}}function j(e){var w=this,u=w.module,z=u.mid;if(u.threadModule){return}var t=e.data.items;for(var v=0,A=t.length;v<A;v+=1){var x=t[v];var y=x.ids;if(h.Array.has(y,z)){u.moduleRemove();break}}}function q(A){var x=this.module,z=A.contact,v;if(!z&&A instanceof Array){for(var u=0,w=A.length,t;u<w;u+=1){t=A[u];if(t.flag==="sendershow"){z=true;v=t.value;break}}}if(z){try{x.head.updateLocalUi({type:"sendershow",value:v})}catch(y){}}}function k(){var v=this.module;try{var u=v.contentFrame.contentDocument;var t=u.getElementById("ntes_link_color");if(t){t.innerText="a:{color:#"+window.gUser.color+"}"}}catch(w){}}})();(function(){var h=window.$,w=$I("module.BaseAction"),z,j,i;try{z=$L("interface.ComposeInterface");j=$L("support.SenderList");AddressSupport=$L("support.AddressSupport")}catch(m){return m}i=h.createClass($N("module.read.ReadAction"));h.Object.mix(i,w,null,{module:null,initialize:u,readMessage:r,sendReceipt:l,saveToNf:a,decryptMessage:s,recallMessage:n,setReadMode:b,newWin:A,reply:x,replyAll:q,quickReply:p,forward:e,forwardTransmit:y,sendAgain:k,newReply:v,checkLanguage:g,getSender:o,listDeliveryHistory:f,saveSentAttachMail:d,saveToYNote:t,__getHistoryParam:c});function u(B){this.module=B}function r(E){var D=this;var C=E.param;var B={id:C.mid,header:true,returnImageInfo:true,returnAntispamInfo:true,autoName:true,returnHeaders:{"Resent-From":"A",Sender:"A","List-Unsubscribe":"A"},supportTNEF:true};if(C.part){B.part=C.part}if(C.folderData&&C.folderData.flags&&!C.folderData.flags.read&&!D.module.hiddenMod){B.markRead=true}var F={func:"mbox:readMessage",body:B,call:function(G){E.call(G)},log:{l:"read",action:"read"},cacheFlag:E.cacheFlag,hideWait:D.module.hiddenMod};D.wmsvr(F)}function l(){var C={func:"mbox:sendMDN",body:{id:this.module.mid,dispositionInfo:{mode:"manual",type:"displayed"}},call:B,error:B};this.wmsvr(C);function B(D){if(D.code==S_OK){h.Tips.show({text:"回执发送成功",type:"suc"})}else{return true}}}function a(C){var B=C.body;var D=C.callback;var E={func:"mbox:saveMessageToNF",body:B,call:D,error:D,log:{l:"read",action:"saveMessageToNF"}};this.wmsvr(E)}function s(C){var D=this;var C=C.param;var B={id:C.mid,password:C.pwd,mode:"both",filterImages:false,wmsvrlog:{action:"decryptMessage"}};var E={func:"mbox:decryptMessage",body:B,ignoreError:true,call:function(F){D.module.decrypt.decryptBack(F)},log:{l:"read",action:"decrypt"}};this.wmsvr(E)}function n(C){var B={mid:C.mid};var D={func:"mbox:recallMessage",body:B,call:C.callback,log:{l:"read",action:"recallMessage"}};this.wmsvr(D)}function b(C){var E=this;var G=E.module;var H=G.action;var F=G.head;var B=G.decrypt;var D=G.baseUrl;switch(C.type){case"download":D=Uri.getUrl("read_data",true)+"&mid="+G.mid+"&mode=download&l=read&action=download_eml";break;case"head":D=Uri.getUrl("read_head",true)+"&mid="+G.mid+"&l=read&action=read_head";E.contentHeight=window.parseInt(G.contentFrame.style.height);break;case"encode":F.encode=C.encode;H.setReadMode({type:"normal"});return;break;case"font":F.font=C.font;H.setReadMode({type:"normal"});return;break;case"normal":if(F.encode&&F.encode!="Default"){D+="&encoding="+F.encode}if(F.font){D+="&font="+F.font}if(C.showImg){G.junkPic=false}if(G.junkPic){D+="&filterImages=on"}G.contentFrame.style.height=(E.contentHeight||200)+"px";delete E.contentHeight;break}if(G.part){D+="&part="+G.part}if(C.type=="normal"&&B.decryptMsg){h.Event.one(G.contentFrame,"load",h.Function.bind(B.updateContent,B,true))}G.contentFrame.src=D}function A(B){var E=this;var F=E.module;var D=Uri.getUrl("read_mail",true)+"&mid="+F.mid;if(F.decrypt.decryptMsg){D+="&decryptMsg=true"}if(F.part){D+="&part="+F.part}if(B){D+="&type="+B}var C=F.view.getDateStr(null,null,true);if(C){D+="&t="+C.getTime()}window.open(D)}function x(R,S,J,K,U){var E=this;var G=E.module;var P=G.data;var O=G.folderData;var F=["Re:","Reply:","回复:","答复:"];var N=F[$S("attrs").user.replyf]||"Re:";var D=N+P.subject;var C={id:G.mid,attrs:{subject:D},decryptPassword:G.decrypt.pwd};if(R){C.toAll=true;C.dontCcDelegatedAddress=true}if(S){C.withAttachments=true}if(G.part){C.part=parseInt(G.part)}var Q="";var X=G.head;if(K&&U){Q=U.replace(/\n/g,"<br/>")}var V=(P.from+"");var B=h.Date.format(O.sentDate||P.sentDate);var M=[["在 "," 写道：","，"],["At "," wrote:",","]];var W=M[E.checkLanguage()];var I=W[0]+B+W[2]+V+W[1]+"\n";var L=W[0]+B+W[2]+h.String.encodeHTML(V)+W[1]+'<br/> <blockquote id="isReplyContent" style="PADDING-LEFT: 1ex; MARGIN: 0px 0px 0px 0.8ex; BORDER-LEFT: #ccc 1px solid">';var H="</blockquote>";if(P.html){if(K===false){U=(U||"").replace(/\n/g,"<br/>");C.attrs.content=L+"<br/>"+U+H;C.attrs.isHtml=true}C.quoteHTMLStart=L;C.quoteHTMLEnd=H;C.defaultContent=Q}else{if(K===false){C.attrs.content=I+"\n"+U;C.attrs.isHtm=false}C.quoteTextStart=I;C.quoteTextEnd="";C.quoteTextLinePrefix=">";C.defaultContent=Q}var T=E.getSender();if(T){C.attrs.account=T.toString()}if(J){return C}z.reply({id:G.mid,body:C},E.__getHistoryParam())}function q(F,I,H){var D=this;var E=D.module;var B=E.head.accountIsBcc;if(E.mtype=="thread"){try{B=E.letters[E.mid].module.head.accountIsBcc}catch(G){}}if(B){h.Msgbox.show({title:"温馨提示",content:"您不在此邮件的收件人名单中，如回复全部，则其他收件人会知道您收到了此邮件！是否要回复全部收件人？",buttons:[{xtype:"button",text:"回复发件人",subclass:"mainBtn",click:function(){D.reply(false,F,I,true,H);C()}},{xtype:"button",text:"回复全部",click:function(){D.reply(true,F,I,true,H);C()}},{xtype:"button",text:"取消",click:function(){C()}}]})}else{D.reply(true,F,I,true,H)}var C=function(){if(h.Msgbox.msgbox){h.Msgbox.msgbox.close()}}}function p(D,G){var E=this;var F=E.module;var H=F.data;var C=E.reply(true,false,true,true,D);if(H.html){var B=D.replace(/\n/g,"<br/>");C.quoteHTMLStart=B+"<br/><br/>"+C.quoteHTMLStart}else{C.quoteTextStart=D+"\n"+C.quoteTextStart}z.quickReply({id:F.mid,body:C,callback:G})}function e(B,H){var K=this;var G=K.module;var C=G.data;var O=["Fw:","Forward:","转发:"];var I=O[Ud.get({field:"ntes_option",flag:"forward"})]||"Fw:";var L=I+C.subject;var D={mode:(B?"attach":"quote"),attrs:{subject:L},decryptPassword:G.decrypt.pwd};if(G.part){D.part=parseInt(G.part)}var J=B?"":M();var F='<DIV id="isForwardContent">';var E="</DIV>";if(C.html){if(B){D.attrs.content="";D.attrs.isHtml=true}else{if(H){H=H.replace(/\n/g,"<br/>");D.attrs.content=F+J+"<br/>"+H+E;D.attrs.isHtml=true}else{D.quoteHTMLStart=F+J;D.quoteHTMLEnd=E}}}else{if(B){D.attrs.content=""}else{if(H){D.attrs.content=J+"\n"+H}else{D.quoteTextStart="\n"+J.replace(/(\<br\>)|(\<DIV\>\&nbsp;\<\/DIV\>)/g,"\n");D.quoteTextEnd=""}}}var N=K.getSender();if(N){D.attrs.account=N.toString()}z.forward({id:G.mid,body:D},K.__getHistoryParam());function M(){var T="<br/>";var S;var P=[["发件人：","发送日期：","收件人：","抄送人：","主题：","-------- 转发邮件信息 --------"],["From: ","Date: ","To:  ","Cc:  ","Subject: ","-------- Forwarding messages --------"]];var Q=P[K.checkLanguage()];if(C.html){S=Q[5]+T+Q[0]+h.String.escapeHTML((C.from.join(",")))+T+Q[1]+h.Date.format(C.sentDate||new Date())+T+Q[2]+h.String.escapeHTML(C.to.join(","))+T+(C.cc?(Q[3]+h.String.escapeHTML(C.cc.join(","))+T):"")+Q[4]+h.String.encodeHTML(C.subject)+T}else{var R="\n";S=Q[5]+R+Q[0]+(C.from.join(","))+R+Q[1]+h.Date.format(C.sentDate||new Date())+R+Q[2]+(C.to.join(","))+R+(C.cc?(Q[3]+(C.cc.join(","))+R):"")+Q[4]+C.subject+R}return S}}function y(F,E){var C=this;var D=C.module;var B={mode:"transmit",attrs:{bcc:F.toString()},decryptPassword:D.decrypt.pwd};z.quickForward({id:D.mid,body:B,callback:E})}function k(){var C=this;var D=C.module;var B={decryptPassword:D.decrypt.pwd};z.edit({id:D.mid,body:B},C.__getHistoryParam())}function v(){var D=this;var E=D.module;var F=E.data;var B={info:{to:C(F.from.concat(F.to)),cc:C(F.cc),bcc:C(F.bcc)}};z.entry(B);function C(G){if(!G){return G}if(typeof G=="string"){G=[G]}var H=[];if(Ud.get({field:"ntes_option",flag:"sendershow"})=="2"){h.Array.each(G,function(J,K){var L=Uri.getAddress(K);var I=AddressSupport.getAddrObj(L);if(I){H.push(AddressSupport.toAddrString(I,L,true))}else{H.push(K)}})}else{H=G}return H}}function g(){if(this.module.contentFrame){var C=this.module.contentFrame.contentWindow.document.body.innerHTML||"";var B=C.replace(/<[^>]+>/g,"");B=h.String.trim(B.substr(0,100));if(!B||B.indexOf("try")==0||B.match(/[^\x00-\x80]/g)){return 0}return 1}return 0}function o(F){var C=this;var D=C.module;var E;if(D.fid>19){var B=$I("init.Folder").checkFolder(D.fid);if(B.isPop&&B.username){E=j.isSender(B.username)}}if(!E&&F){E=j.getDefault()}return E}function f(C){var D=this;switch(C.type){case"send":case"recall":var B={mid:C.mid};break;case"mail":var B={pid:C.mid};break}var E={func:"user:listDeliveryHistory",body:B,call:function(F){C.callback(C.type,F)}};this.wmsvr(E)}function d(B){var C=this;var D={func:"global:sequential",body:{items:[{func:"mbox:saveSent","var":{id:B.fullSaveId}},{func:"mbox:deleteMessages","var":{id:B.mid}}]},ignoreError:true,call:B.call};C.wmsvr(D)}function t(C){var D=this,E=D.module;var F={func:"ntes:mbox:ynote",body:{action:"saveEmail",mid:C.mid},call:C.call,error:C.error},B=E.decrypt.pwd;if(B){F.body["password"]=B}D.wmsvr(F)}function c(){var B=this.module;if(B.threadModule){return B.threadModule.getHistoryParam()}else{return B.getHistoryParam()}}})();(function(){var b=window.$,d,i,k,g;try{d=$L("support.Tag");i=$L("interface.MboxInterface")}catch(m){return m}k=$I("init.Folder");g=b.createClass($N("module.read.BaseReadHead"));b.Object.extend(g.prototype,{initialize:f,init:s,getUdConf:j,setPreAndNext:p,goPreAndNext:o,back:t,setTag:r,updateTag:l,upadteFolder:c,setTop:h,move:n,moveBack:q,updateLocalUi:a});function f(e){this.module=e}function s(){var e=this;var u=e.module;e.name=u.name}function j(u){var e;switch(u){case"read_head":e=Ud.get({field:"ntes_letter",flag:"read_head"});break;case"read_ad":e=Ud.get({field:"ntes_letter",flag:"read_ad"});break;default:e="0"}return parseInt(e)}function p(){var u=this;var v=u.module;if(v.viewType){return}i.getPosition({moduleName:v.listModule,data:v.folderData,callback:e});function e(w){var A,x,B=$C(v.createId("pre")),D=$C(v.createId("next"));if(w){A=w.pre;x=w.next;if(A){u.hasPre=true;var A={moduleName:A.moduleName,folderData:A.folderData,group:v.group};var z="上一封："+A.folderData.subject;v.preData=A.folderData;B.setDisabled(false);B.unlisten("click");B.listen("click",E);B.getEl().dom.title=z}else{B.setDisabled(true)}if(x){u.hasNext=true;var x={moduleName:x.moduleName,folderData:x.folderData,group:v.group};var y="下一封："+x.folderData.subject;v.nextData=x.folderData;D.setDisabled(false);D.unlisten("click");D.listen("click",C);D.getEl().dom.title=y}else{D.setDisabled(true)}u.pos=w.pos}function E(){Log.cache({rkey:(v.mtype=="thread.ThreadModule"?"thread":"read")+"_pre"});$I("interface.ReadInterface").entry(b.Object.clone(A));try{v.switchOut()}catch(F){}}function C(){Log.cache({rkey:(v.mtype=="thread.ThreadModule"?"thread":"read")+"_next"});$I("interface.ReadInterface").entry(b.Object.clone(x));try{v.switchOut()}catch(F){}}}}function o(x){var v=this,w=v.module,u,e;if(x){u=$C(w.createId("pre"));if(u&&u.getEl().dom.style.display!="none"){u.fire("click")}}else{e=$C(w.createId("next"));if(e&&e.getEl().dom.style.display!="none"){e.fire("click")}}}function t(){var e=this;var u=e.module;if(u.part){history.back()}else{if(u.fid>=-1){i.entry({moduleName:u.listModule,fid:u.fid})}else{$E(["interface.WelcomeInterface"],function(v){v.entry()})}}}function r(y,e){var w=this;var x=w.module;var u=x.folderData;var v={moduleName:x.listModule,tag:e,data:u};if(x.mtype=="threadletter"||x.mtype=="thread"){v.single=true}if(y=="add"){v.isAdd=true}i.setTag(v)}function l(y){var w=this;var x=w.module;var u=y||x.folderData;var e=u.tag;if(!e||(e&&e.toString()!=w.orgTags)){var v=x.getDom("divTag");if(v){v.innerHTML=z()}b.Component.setEvents()}function z(){var B=$I("init.Tag"),A=u.tag,C=[];if(A){b.Array.each(A,function(F,E){var G=B.get(E),D;if(G){D=new b.Tag({text:G.name,type:G.color,attrs:"hasClose",click:function(){Log.cache({rkey:(x.mtype=="thread.ThreadModule"?"thread":"read")+"_icon_tag"});i.entry({fid:0,showTag:true,tag:[G.name]})},closeclick:b.Function.bind(w.setTag,w,"remove",G.name,y)});C.push(D.html())}})}return C.join("")}}function c(){var e=this,u=e.module;$C(u.createId("folderMenu")).update(u.view.getSubMenu("move"))}function h(y){var w=this;var x=w.module;var u=x.folderData;var e=u.flags;var y=!e.top;var v={moduleName:x.listModule,isTop:y,data:x.folderData,callback:function(A){if(A){var z=y?"成功设置邮件置顶":"成功取消邮件置顶";b.Tips.show({text:z,type:"suc"})}else{b.Tips.show({text:"置顶设置失败",type:"err"})}i.entry({moduleName:x.listModule,fid:x.fid})}};i.setTop(v)}function n(z,y){var v=this;var w=v.module;var e=w.folderData;if(z.report){var x=(z.type==="spam");i.setSpam({isSpam:x,data:w.folderData,callback:function(){b.Tips.show({text:"成功"+(x?"举报":"信任")+"邮件",type:"suc"})}})}else{var u={moduleName:w.listModule,pos:v.pos,data:w.folderData,isThread:z.isThread,callback:y};if(z.isThread&&w.threadModule){w.threadModule.moveLock=true}if(z.del){if(e.fid!=4&&e.fid!=15){u.moveToId=4}}else{u.moveToId=z.toFid}i.move(u)}}function q(){var v=this,w=v.module,u=w.mtype,e=(JS5.reqModule==w.name);if(u=="thread.ThreadLetterModule"){w.threadModule.delLetter(w);return}else{if(w.mtype==="thread.ThreadModule"){w.delAllLetter()}}if($S("attrs").user.afterdel!=0&&v.hasNext&&e){$C(w.createId("next")).fire("click");w.moduleRemove()}else{if(e){i.entry({moduleName:w.listModule},null,function(){w.moduleRemove()})}else{w.moduleRemove()}}}function a(u){var y=this,x=y.module,w=x.folderData;switch(u.type){case"flag":var F=(w.label0||"")+"";if(x.threadModule){return}x.getDom("h1Subject").className="nui-fIBlock lv nui-txt-flag"+F;$C(x.createId("subjFlag")).update({icon:{type:F?undefined:"blankFlag",extcls:(F?"nui-ico-flag nui-ico-flag-"+F:"fn-bg")}});break;case"tagMenu":var z=x.view.getSubMenu("tag"),C=$C(x.createId("toolBarTagMenu")),B=$C(x.createId("subjectTagMenu"));z.hidden=true;if(C){C.update(z)}if(B){B.update(z)}y.updateTag();break;case"top":var D=$C(x.createId("toolbarSetTop"));if(D){D.update({text:w.flags.top?"取消置顶":"置顶邮件"})}break;case"read_head":if(x.threadModule){break}x.view.toggle("head",u.value+"");try{$C(x.createId(u.value==1?"opt_compactInfo":"opt_fullInfo")).setChecked(true)}catch(A){}break;case"sendershow":y.updateAddress();y.replyContent(true);try{$C(x.createId(u.value==2?"opt_contact":"opt_send")).setChecked(true)}catch(A){}break;case"translate":var E=$C(x.createId("transTip"));if(u.value===1){if(E){E.show()}else{if((Ext.readTran||Ext.readTran188vip)){x.content.isTrans=true;x.trans.checkCall()}}}else{if(E){E.hide()}}try{$C(x.createId(u.value==1?"opt_transOpen":"opt_transClose")).setChecked(true)}catch(A){}break;case"readRange":x.content.range("init");try{x.content.rangeTime=null;$C(x.createId(u.value==1?"opt_repOpen":"opt_repClose")).setChecked(true)}catch(A){}break;case"afterdel":try{$C(x.createId(u.value==1?"opt_next":"opt_back")).setChecked(true)}catch(A){}break;case"readreplystatus":try{$C(x.createId(u.value==1?"opt_showContent":"opt_hideContent")).setChecked(true)}catch(A){}break;case"layout":x.moduleRemove();break;case"recall":if(x.fid===3){var v=$C(x.createId("recallBt"));if(v){v[(u.value)?"show":"hide"]()}}break}}})();(function(){var h=window.$,o,a,j,l,y,m;try{o=$L("interface.MboxInterface");a=$L("support.AddressSupport");j=$L("support.SenderList");l=$L("module.read.BaseReadHead")}catch(z){return z}y=$I("init.Folder");m=h.createClass($N("module.read.ReadHead"));h.Object.mix(m,l,null,{initialize:u,init:b,setFlag:s,showFlagMenu:p,updateFolder:x,updateAddress:g,viewSameSubject:d,schedule:w,saveToNf:t,saveToYNote:i,saveContact:r,replyContent:n,quickReply:q,forwardTransmit:k,setMemo:v,cache:c,destroy:f});function u(e){this.module=e}function b(){var e=this;var A=e.module;e.name=A.name}function x(){var C=this;var D=C.module;var E=D.name;if(D.part){return}var A=h.Component.find("$name$menufolder"+E);var B=C.getSubMenu("move");if(A){A.each(function(G,F){F.update(B)})}if(!A){var e=h.Component.find("$name$movebutton"+E);if(e){e.each(function(F,G){G.rawConfig.menu=B})}}}function s(D,E,e){var B=this;var C=B.module;var A=C.folderData;if(D==-1){D=A.label0?0:1}o.setFlag({moduleName:C.listModule,flag:D,data:C.folderData})}function p(){var B=this;if(B.flagHref.find("menu")){B.flagHref.find("menu")[0].show()}else{var A=B.getSubMenu("flag");var e=B.flagHref.add(A,true);e.render(B.flagHref);e.show()}}function g(){var e=this;var B=e.module;var A=Ud.get({field:"ntes_option",flag:"sendershow"});var D=new Uri(B.data.from[0]);if(A=="2"||!D.name){var C=a.getName(D);if(C){D.name=C}}B.fromEmail=D;B.view.fromItem.update({email:D});B.view.fillAddr("to");B.view.fillAddr("cc");B.view.getCompactHtml()}function d(){var e=this.module.data.subject;var B=/(re|reply|回复|答复|fw|forward|转发)[:|：]/ig;e=e.replace(B,"Re:");var A=e.lastIndexOf("Re:");if(A!=-1){e=h.String.trim(e.substr(A+3))}o.title(e)}function w(){var C=this;try{var E=$L("product.Schedule",C)}catch(D){return D}var B=this.module.mid;var A=this.module.data.subject;var e=$S("schedule");if(e&&e[B]){E.edit(B)}else{E.add(B,A)}}function t(D){var A=this;var B=A.module;var e=$S("advLock");if(!e.authenticated2&&!e.disabled&&e.nf){AdvLock.show(function(){C()})}else{C()}function C(){var F=Uri.getUrl("savetonf_new");if($S("lastNetfolderFid")){F+=("&fid="+$S("lastNetfolderFid"))}var G='<div style="padding:10px"><div style="zoom:1;padding:10px;height:230px;border-width:1px;border-style:solid" class="bdr-light"><iframe id="ifrSaveToNf" src="'+F+'" height="228px" width="380px" frameborder="0"></iframe></div></div>';h.Msgbox.show({contentType:"normal",title:"保存到网盘",content:G,type:"confirm",ok:function(){var I=h.fly("#ifrSaveToNf").dom.contentWindow.fid;$S("lastNetfolderFid",I);if(I){var H=Uri.getUrl("savetonf_sub");H+=("&mid="+encodeURIComponent(B.mid)+"&dirId="+I);if(D){H+=("&part="+D)}h.Ajax.jsonp(H,E)}}})}function E(I){var F=I.code;if(F==200||F==S_OK){h.Tips.show({text:"成功保存到网盘",type:"suc"})}else{var H={800:"网盘容量超出限制",801:"网盘文件总数超出限制",802:"流量超出限制",803:"登录超时，重新登录",500:"未知错误"};var G=I.msg||H[F]||("错误码"+F);G="保存到网盘失败，"+G;h.Tips.show({text:G,type:"err"})}}}function i(){var e=this,A=e.module;if(A.decrypt.check()){h.Msgbox.html({title:"本邮件是加密邮件，请解密后重试。",icon:"err",ok:function(){$C(A.createId("decryptInput")).focus()}});return}A.action.saveToYNote({mid:A.mid,call:function(B){h.Msgbox.html({title:"邮件已成功保存到有道云笔记",icon:"suc"})},error:function(D){if(D.code=="S_PARTIAL_OK"){try{var C=[],B=D["var"].fails;h.Array.each(B,function(F,G){C.push(h.String.escapeHTML(G.resource))});h.Msgbox.html({title:"邮件部分保存成功！以下附件因类型受限，无法保存",content:C.join("<br />")+D.code,icon:"err"})}catch(E){}}else{h.Msgbox.html({title:"保存失败，错误码："+D.code,icon:"err"})}}})}function r(B){var A=this;var C=A.module;var E=C.data;var e=[];if(!B){e=(E.from||[]).concat(E.to||[]).concat(E.cc||[])}else{e=E[B]||[]}a.contactListDialog({data:e,callback:D});function D(F){if(F.code==S_OK){h.Tips.show({text:"联系人保存成功",succ:true});A.updateAddress()}else{h.Tips.show({text:"联系人保存失败",err:true})}}}function n(H){var D=this;var A=D.module;var E="快捷回复给：";D.accountIsBcc=true;if(A.fid==3&&A.folderData.fid==3){D.accountIsBcc=false}try{var G=(A.view.fixto||[]).concat(A.view.fixcc||[]);for(var B=G.length-1;B>-1;B--){var I=G[B].address;if(j.isSender(I)){G.splice(B,1);D.accountIsBcc=false}else{if(I.indexOf("groups.163.com")!=-1||I.indexOf("g.qq.com")!=-1||I.indexOf("googlegroups.com")!=-1){D.accountIsBcc=false}}}if(G.length==0){D.accountIsBcc=false}G=G.concat(A.fromEmail);for(var B=G.length-1;B>-1;B--){var C=h.String.trim(G[B].name)||G[B].address;if(B!=G.length-1&&C){C=", "+C}E+=C}}catch(F){}E=h.String.trim(h.String.escapeHTML(E));if(H){try{$C(A.createId("replyInput")).update({placeholder:E})}catch(F){}}return E}function q(){var D=this,B=D.module,E=$C(B.createId("replyInput")),H=$C(B.createId("replyTip")),C=$C(B.createId("replyRetryLink")),e=$C(B.createId("sendBt")),G=$C(B.createId("cancelBt")),F=h.String.trim(E.getValue());if(F.length>0){e.update({text:"发送中",disabled:true,icon:"loading",click:function(){}});B.action.quickReply(h.String.escapeHTML(F),function(I){A(I.code===S_OK)})}else{h.Msgbox.show({content:"请输入回复内容。",ok:function(){G.setDisabled(false);E.focus()}})}function A(L){var M,I=B.getDom("dvReplyBts"),K=B.getDom("spanReplyNbsp"),J={renderTo:I,text:"再回一封邮件",cls:"jI nui-txt-link",click:function(){this.hide();H.hide();e.destroy();G.destroy();e=new h.Button(h.Object.clone(B.view.replyBtConf));I.appendChild(K);K.style.display="";G=new h.Button(h.Object.clone(B.view.cancleReplyBtConf));$C(B.createId("replyInput")).setValue("");B.getDom("dvReplyInputs").style.display="";B.getDom("fullReplyLink").style.display=""}};K.style.display="none";if(L){M={text:"邮件发送成功！",type:"suc",tabindex:"0",hidefocus:"hidefocus"};B.getDom("dvReplyInputs").style.display="none"}else{M={text:"抱歉，邮件发送失败",type:"err",tabindex:"0",hidefocus:"hidefocus"};J.text="立即重试";J.click=h.Function.bind(B.head.quickReply,B.head)}e.hide();G.hide();B.getDom("fullReplyLink").style.display="none";if(H){H.update(M);H.show();H.getEl().dom.focus()}else{M.renderTo=I;M.id=B.createId("replyTip");M.subclass="normalTips";H=new h.Label(M);H.getEl().dom.focus()}if(C){C.unlistenAll();C.update(J);C.listen("click",J.click);C.show()}else{J.id=B.createId("replyRetryLink");C=new h.Link(J)}}}function k(){var E=this.module.action,G;var C=$I("util.AutoComplete");var A=h.Msgbox.show({contentType:"normal",type:"prompt",header:"原信转发",inputLabel:"收件人：",inputPlaceholder:"请输入转发地址",footer:"提示：原信转发邮件不能撤回",autoFocus:true,okText:"发 送",ok:B,close:function(){try{G._remove()}catch(I){}}});var F=A.find("input")[0],D=F.getEl().dom.parentNode;h.fly(D).append("<div>"+h.Label.html({type:"tips",text:"(如：zhangsan@example.com)"})+"</div>");F.unlisten("enter");G=new C({isTop:true,input:F.getInputEl(),inputDiv:F.getEl(),match:e});function e(M,L){try{var J=L.name;var I=L.email;var O=I.toLowerCase()}catch(N){return}M=h.String.trim(M);if(M&&Uri.matchEmail(O)){if(J.indexOf(M)>-1||O.indexOf(M)>-1){var K=I;if(J){K='"'+J+'"<'+I+">"}return K}}}function B(J){J=h.String.trim(J);if(J==""){return"请填写转发地址。"}var I=Uri.getEmails(J);if(I.wrong.length>0){return"请填写正确的转发地址。"}if(I.match.length>1){return"只能输入一个转发地址。"}E.forwardTransmit(J,H)}function H(I){if(I.code==S_OK){h.Msgbox.show({title:"转发成功 ",content:"信件已经成功转发。"})}}}function v(G){var H=this;var E=H.module;var D=E.folderData;var F=E.getDom("liMemo");var N=E.getDom("dvMemoShow");var e=E.getDom("dvMemoContent");var M=E.getDom("dvMemoEdit");var B=$C(E.createId("textMemo"));var C=D.memo||"";var L=false;switch(G){case 1:F.style.display="";H.setMemo(3);break;case 2:C="";L=true;break;case 3:N.style.display="none";M.style.display="";B.setValue(C);if(!H.memoTextListen){B.setEventListener({name:"keyup",handler:I,dom:true});H.memoTextListen=true}I();break;case 4:var J=h.String.trim(B.getValue());if(J==""){h.Msgbox.show({content:"请输入备注内容",icon:"alert32"})}else{if(J.length>100){h.Msgbox.show({content:"您已输入<strong>"+J.length+"</strong>字，超出<strong>"+(J.length-100)+"</strong>字",icon:"alert32"})}else{L=true;C=J}}break;case 5:M.style.display="none";N.style.display="";F.style.display=(C?"":"none");break;case 6:if(e){e.innerHTML=h.String.escapeHTML(C);H.setMemo(5)}break;case 7:if(e&&C!=e.innerHTML){H.setMemo(6)}break;default:if(E.getDom("ulFull").style.display==="none"){E.view.toggle("head",1)}if(C){H.setMemo(3)}else{H.setMemo(1)}break}if(L){var A={moduleName:E.listModule,memo:C,data:D,callback:K};if(C===D.memo){K(true);H.setMemo(5)}if(G==2){h.Msgbox.show({type:"confirm",title:"删除确认",content:"您确定要删除该邮件的备注吗？",ok:function(){o.setMemo(A)}})}else{o.setMemo(A)}}function K(P){if(P){var O="备注设置成功";if(G==2){O="备注删除成功"}h.Tips.show({text:O,type:"suc"})}else{h.Msgbox.show({content:"备注设置失败"})}}function I(){var O=E.getDom("spanMemoErr"),P=h.String.trim(B.getValue());if(P.length>100){O.innerHTML="您已输入<strong> "+P.length+" </strong>字，<span class='txt-err'>请删除<strong> "+(P.length-100)+" </strong>字</span>"}else{O.innerHTML="您已输入<strong> "+P.length+" </strong>字，还能输入<strong> "+(100-P.length)+" </strong>字"}}}function c(){var F=this;var D=F.module;if(D.part){return}var B=D.folderData;var A=B.flags;F.setPreAndNext();F.setMemo(7);if(Ext.tag&&D.mtype!="thread"){F.updateTag();F.updateToolbar()}var C=$S("schedule");if(C){var G="加为日程";var H="ico ico-btn ico-btn-schedule";if(C[D.mid]){G="管理日程";H="ico ico-btn ico-btn-schedule ico-btn-schedule-hover"}F.scheduleHref.update({title:G,cls:H})}if(F.top!=A.top){e();F.top=A.top}function e(){var I=A.top?"取消置顶":"置顶邮件";var K="ico ico-btn "+(A.top?"ico-btn-noTop":"ico-btn-top");try{F.topHref.update({title:I,cls:K});E(F.topToolbar,I);E(F.bottomToolbar,I)}catch(J){}}function E(O,M){var L=O.find("menubutton");var N=L[L.length-1];var J=N.find("menu");if(J){J=J[0];var K=J.find("link");var P=K[K.length-1];P.update({text:M})}else{var I=N.rawConfig.menu.items;I[I.length-1].text=M}}}function f(){var e=this;delete e.topToolbar;delete e.bottomToolbar;delete e.flagHref;delete e.memoHref;delete e.scheduleHref;delete e.topHref;delete e.infoHref;delete e.newwinHref;delete e.printHref}})();(function(){var i=window.$,a,j;try{a=$L("support.AddressSupport");j=$L("support.SenderList")}catch(w){return w}var h=i.createClass($N("module.read.ReadContent"));i.Object.extend(h,{fontSymbol:["em","%","pt","px"],fontUnit:[0.1,10,2,2],fontLimit:[[0.8,4.3],[80,430],[10,50],[12,60]],currentMod:null,gloabMouseupHandler:m});i.Object.extend(h.prototype,{initialize:q,init:c,onLoad:f,setHeight:p,checkReplyQuote:k,checkVCard:d,setMediaPlayer:l,stopMediaPlayer:n,setInnerLink:r,setPic:s,range:u,setFont:b,clearStyle:t,removeStyleTag:v,trans:o,destroy:g});function m(){var e=h,x=e.currentMod;if(x){x.content.range("close");e.currentMod=null}}function q(x){var e=this,y=window.parseInt(i.Browser.ie());e.module=x;e.isIE=!!i.Browser.ie();e.isChrome=!!i.Browser.chrome();e.newIE=(y&&y>8)}function c(x){var B=this,C=B.module,z,A,y,E;B.removeCaseExit=false;if(!x){z=C.baseUrl,A=$S("attrs").user.junkpic||0,y=300;if(A==2||(A==1&&C.fid==5)){z+="&filterImages=on";B.junkPic=true}if(C.hiddenMod){z+="&preventSetRead=on"}if(C.part){z+="&part="+C.part}if(B.isChrome){y=240}else{try{y=(document.documentElement.clientHeight||document.body.clientHeight)-414;y=window.Math.max(y,300)}catch(D){y=300}}C.getDom("dvContent").innerHTML=('<iframe id="'+C.createId("ifrmContent")+'" name="'+C.name+'" class="kA"  frameborder="0" src="'+z+'" style="height:'+y+'px" ></iframe>')}C.contentFrame=E=C.getDom("ifrmContent");B.autoHeightCount=0;B.autoHeightThread=window.setTimeout(function(){if(B.contentInited||B.autoHeightCount>5){B.autoHeightThread=null;return}B.setHeight({heightOnly:true,ignoreIE:true});B.autoHeightCount+=1;B.autoHeightThread=window.setTimeout(i.Function.bind(arguments.callee,null),1000)},1500);i.Event.listen(E,"load",function(){B.onLoad()});if(!h.gloabEventInited){i.fly(document).listen("mouseup",h.gloabMouseupHandler);h.gloabEventInited=true}}function f(){var B=this,C=B.module,x,y;try{B.ifrm=C.contentFrame;x=B.ifrm.contentWindow;y=x.document}catch(D){return}if(B.autoHeightThread){window.clearTimeout(B.autoHeightThread);B.autoHeightThread=null}var z=x.location.href,A=C.contentUrl;if(!B.reSet&&(z.indexOf(C.contentUrl)!=z.length-A.length)){B.reSet=true;x.location.href=A;return}B.reSet=true;B.checkReplyQuote();B.setInnerLink();B.setPic();if((Ext.readTran||Ext.readTran188vip)&&!B.isTrans){B.isTrans=true;C.trans.checkCall()}if(C.hasBigAttach){C.attach.updateContent(y);C.attach.updateInfo()}try{C.view.getUnSavedInfo()}catch(D){}B.checkVCard();B.setHeight();i.Event.listen(y,"click",function(){i.Event.fire(document,"click")});B.trans("init");B.range("init");B.contentInited=true}function p(e){var z=this,A=z.module,e=e||{};if(A.hiddenMod){return}var y=A.threadModule;var x=function(){try{var D=A.contentFrame||z.ifrm;if(!D){return}var B=D.contentWindow.document;if(!B){return}var G=200,H=0,C=0,E=0;if(z.isIE&&!z.newIE){H=40;G=B.body?B.body.scrollHeight:B.documentElement.scrollHeight;C=B.body?B.body.scrollWidth:B.documentElement.scrollWidth}else{if(z.newIE){D.style.width="100%"}H=20;G=B.documentElement.scrollHeight;C=B.documentElement.scrollWidth;E=B.body.scrollWidth}if(B.documentElement.scrollWidth-B.documentElement.offsetWidth>10){G+=20}if(B.documentElement.scrollHeight-B.documentElement.offsetHeight>10){C+=20;E+=20}G=Math.max(G,200);if(window.parseInt(D.style.height,10)!==G){D.style.height=(G+H)+"px"}C=Math.max(C,E);if((z.isIE||!z.widthSet)&&!A.threadModule){if(!e.heightOnly&&C>700&&C>D.offsetWidth){D.style.width=(C+30)+"px"}else{if(!z.isIE&&C==window.parseInt(D.style.width,10)){z.widthSet=true}}}if(y){y.threadLine.updatePointer({module:y})}}catch(F){}};if(!e.zoom&&z.frameHeight){A.contentFrame.style.height=z.frameHeight;if(z.frameWidth){A.contentFrame.style.width=z.frameWidth}}else{x();if(z.isIE&&!e.ignoreIE){window.setTimeout(x,0)}}}function k(){var E=this;var x=E.ifrm;if(!x){return}var L=x.contentWindow.document;if(!L){return}var G=function(M){try{return(M.getAttribute("style").cssText||M.getAttribute("style")).toLowerCase().replace(/[ \']/gi,"")}catch(N){}};var B=function(){try{var N=L.getElementsByTagName("BLOCKQUOTE");for(var M=0;M<N.length;M++){if(N[M].id=="isReplyContent"){return N[M]}}}catch(O){return false}};var K=function(){try{var N=L.getElementsByTagName("DIV");for(var M=0;M<N.length;M++){if(N[M].innerHTML=="------------------&nbsp;原始邮件&nbsp;------------------"){if(N[M].parentNode.parentNode==L.body.childNodes[1]){return N[M].parentNode}}}}catch(O){return false}};var H=function(){try{var N=L.getElementsByTagName("BLOCKQUOTE");for(var M=0;M<N.length;M++){if(N[M].className=="gmail_quote"){return N[M]}}}catch(O){return false}};var D=function(){try{var O=L.body.firstChild;var N="font-family:timesnewroman,newyork,times,serif;font-size:12pt";if(G(O)===N&&G(O.childNodes[1])===N&&G(O.childNodes[1].childNodes[1])===N){return O.childNodes[1].childNodes[1]}return false}catch(M){return false;return false}};var J=function(){try{var M=L.getElementsByTagName("HR")[0];var P=null;if(M&&M.id=="stopSpelling"){var R=L.body.childNodes;var O=[];for(var N=0;N<R.length;N++){O.push(R[N])}for(var N=0;N<O.length;N++){if(O[N]==M){P=L.createElement("DIV");M.parentNode.insertBefore(P,M);P.appendChild(O[N])}else{if(P){P.appendChild(O[N])}}}}return P}catch(Q){return false}};var A=function(){try{var M=L.body.childNodes[1];var P=null;if(G(M)==="font:10pttahoma"&&G(M.childNodes[1])==="background:#f5f5f5"&&M.childNodes[1].childNodes.length==4){var R=L.body.childNodes;var O=[];for(var N=0;N<R.length;N++){O.push(R[N])}for(var N=0;N<O.length;N++){if(O[N]==M){P=L.createElement("DIV");M.parentNode.insertBefore(P,M);P.appendChild(O[N])}else{if(P){P.appendChild(O[N])}}}}return P}catch(Q){return false}};var z=function(){try{var M=L.getElementsByTagName("BLOCKQUOTE")[0];if(M&&M.parentNode==L.body&&M.type=="cite"&&M.getAttribute("cite").indexOf("mid")==0){return M}}catch(N){return false}};var I=B()||K()||H()||D()||J()||A()||z();if(I){var F=Ud.get({field:"ntes_option",flag:"readreplystatus"});var y=L.createElement("DIV");y.innerHTML=(F=="1"?"- 隐藏引用文字 -":"- 显示引用文字 -");y.style.fontSize="12px";y.style.cursor="pointer";y.style.color="#5c6efc";i.fly(I).before(y);if(F!="1"){var C=I.offsetHeight;var e=L.body.scrollHeight-C;I.style.display="none";var x=E.ifrm;e=e<200?200:e;x.style.height=e+"px"}i.Event.listen(y,"click",function(){if(y.innerHTML=="- 显示引用文字 -"){y.innerHTML="- 隐藏引用文字 -";I.style.display="";E.setHeight()}else{y.innerHTML="- 显示引用文字 -";var N=I.offsetHeight;var O=L.body.scrollHeight-N;I.style.display="none";var M=E.ifrm;O=O<200?200:O;M.style.height=O+"px"}y.blur();return false})}}function d(){var C=this;var B=C.ifrm;if(!B){return}var Q=B.contentWindow.document;if(!Q){return}var D;var J={};if(D=Q.getElementById("divNeteaseMailCard")){if(!D.firstChild){return}var E,y,M;var S=D.getElementsByTagName("STRONG");for(var P=0;P<S.length;P++){var x=S[P];if(x.getAttribute("func")=="name"){J.name=i.String.trim(x.innerHTML)}else{if(x.getAttribute("func")=="key2"){if(x.getElementsByTagName("A").length>0){E=i.String.trim(x.getElementsByTagName("A")[0].innerHTML)}else{E=i.String.trim(x.innerHTML)}if(oEmail=Uri.matchEmail(E)){J.email=oEmail.address}else{if(/^(1[3|5|8])\d{9}$/.test(E)){y=E}}}}}if(J.email&&j.isSender(J.email)){return}var R=D.getElementsByTagName("SPAN");for(var P=0;P<R.length;P++){var G=R[P];if(!G.getAttribute("func")){continue}var N=i.String.trim(G.innerHTML);if(N.indexOf("手机")!=-1){var L=N.replace("：",":").split(":");y=i.String.trim(L[L.length-1])}else{if(N.indexOf("电话")!=-1){var L=N.replace("：",":").split(":");M=i.String.trim(L[L.length-1])}else{if(/^(1[3|5|8])\d{9}$/.test(N)){y=N}else{if(/^\d{3,4}-\d{7,8}(-\d{3,4})?$/.test(N)){M=N}}}}}J.phone=y||M;if(S.length==0&&R.length==0){return}if(!(J.email||J.name||J.phone)){return}var z=J.name||"";var F=Q.createElement("DIV");F.innerHTML='<div  style="font-size:12px;margin-bottom:10px;background-color: #FFFFE1;border-top:1px solid #C5D2DA;padding:3px 5px">电子名片-此邮件包含'+z+"的电子名片。 </div>";i.fly(D).before(F);var e=i.String.trim(J.email||"");var I=a.getAddrObj(e);var H;var K={callback:function(){i.Tips.show({type:"suc",text:"名片保存成功"});H.destroy()}};var O;if(I){K.type="modify";K.addr={id:I.CID,name:oEmail.name,phone:J.phone}}else{K.type="add";K.addr={name:z,email:e,phone:J.phone}}H=new i.Link({doc:Q,renderTo:F.firstChild,text:"保存名片到通讯录",click:function(){a.contactDialog(K)}});if($S("isFree")){var A=Ud.get({field:"ntes_compose",flag:"card"});if(A=="n"||A=="0"){new i.Link({doc:Q,renderTo:F.firstChild,text:"创建我的电子名片","left-bracket":" &nbsp ",click:function(){$E("interface.OutlinkInterface",function(T){T.goOutlink({key:"name_card_new"})})}})}}else{new i.Link({doc:Q,renderTo:F.firstChild,text:"创建我的个性名片","left-bracket":" &nbsp ",click:function(){$E("interface.OutlinkInterface",function(T){T.goOutlink({key:"vcard"})})}})}C.setHeight()}}function l(){var A=this,e=A.module;if(!A.contentInited){window.setTimeout(i.Function.bind(arguments.callee,A),300);return}var E=e.contentFrame.contentWindow.document;var C=E.getElementsByTagName("player");if(C){var D=C.length,B={},x=e.attachBack;if(!D||!x||!x.length){return}i.Array.each(x,function(F,G){B[G.filename]=G});C=i.Object.toArray(C);var y=[];var z=C.length-1;i.Array.each(C,function(F,G){var I=G.getAttribute("param"),J=G.getAttribute("media"),H=B[I];if(H){$E(["product.AvMail"],function(L){var K="NTES_MAIL_READ_FlashPlayer"+H.id;G.parentNode.innerHTML=L.getPlayHtml(e.attach.getUrl("download",H.id),J,K);y.push(K);A.mediaPlayers=y;C[F]=G=undefined;if(F==z){window.setTimeout(function(){A.setHeight({heightOnly:true})},200)}})}})}}function n(){var y=this;var x=y.mediaPlayers;if(x&&x.length){var e=y.module.contentFrame.contentWindow.document;i.Array.each(x,function(A,z){try{e.getElementById(z).stop()}catch(B){}})}}function r(){var A=this;var M=$I("init.Js35fix");var B=A.module;var z=A.ifrm;if(!z){return}var N=z.contentWindow.document;if(!N){return}var L,I,F;var P=N.getElementsByTagName("a");try{for(L=0,I=P.length;L<I;L++){F=P[L];var Q=F.href.toLowerCase();if(!Q.indexOf("#")==0){F.target="_blank"}F.target=(Q.indexOf("#")==0?"_self":"_blank");if(Q.indexOf("mailto:")==0){i.Event.listen(F,"click",i.Function.bind(function(S){var R=this.href;aTo=window.decodeURI(R.replace(/^mailto:|\?.*$/ig,"")).match(/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/g);if(aTo){$E("interface.ComposeInterface",function(e){e.entry({info:{to:aTo}})})}i.Event.stop(i.Event.getEvent(S))},F))}if(F.getAttribute("sys")==1&&(F.id||F.getAttribute("module")||F.getAttribute("interface"))){var y={};var H=Uri.getUrl(F.id);if(H&&H.indexOf("http")>-1){y={key:F.id,url:H};var x=F.href.indexOf("?");if(x>-1){var C=F.href.substr(x+1);var G=C.split("&");var E={};for(var K=0;K<G.length;K++){var J=G[K].split("=");E[J[0]]=J[1]}y.param=E}}else{if(F.getAttribute("interface")){y["interface"]=F.getAttribute("interface");y.method=F.getAttribute("method");y.param=F.getAttribute("param")}else{if(F.getAttribute("module")||F.id){var D=F.getAttribute("module")||F.id;if(M&&M.modules[D]){y=M.modules[D]}}}}if(F.id=="cards_read"){B.removeCaseExit=true;if(B.out){A.destroy();return}}if(F.getAttribute("sys_target")=="_blank"){F.href=y.url}else{if(F.id=="dock_start"){i.Event.listen(F,"click",function(e){$I("init.Dock").showDock();i.Event.stop(e)});F.target="";F.href="javascript:void(0)"}else{if(F.id=="mobile_reply"){if($S("isFree")){i.Event.listen(F,"click",i.Function.bind(function(T){var S=Uri.getUrl(this.id);var R=this.getAttribute("tauid_sig");var U=this.getAttribute("key");if(R){S+="&tauid_sig="+R}if(U){S+="&key="+U}i.Ajax.jsonp(S,e);function e(V){if(V&&V.res=="200"){var W=V.msgType||"";i.Msgbox.show({content:V.memo,type:V.type,okText:V.okText,title:V.title,ok:function(){if(V.action=="newwin"){window.open(V.url)}else{if(V.action=="link"){$E("interface.OutlinkInterface",function(X){X.goOutlink({key:V.key,param:V.param})})}else{if(V.action=="interface"){Nav.entry(V["interface"],V.param,V.method)}}}}})}else{if(V&&V.memo){i.Msgbox.show({content:V.memo})}}}i.Event.stop(T)},F));F.target="";F.href="javascript:void(0)"}}else{if(F.id=="noschedule"){i.Event.listen(F,"click",function(e){Ud.set({field:"ntes_option",flag:"schedule_notify",value:1});i.Tips.show({type:"suc",text:"您发送的定时邮件到达时将不再用邮件方式通知，您可以进入操作习惯设置再次设定发送通知邮件"});i.Event.stop(e)});F.target="";F.href="javascript:void(0)"}else{i.Event.listen(F,"click",i.Function.bind(function(X,T){if(X.key){if(X.key=="file_center"||X.key=="nf_center"||X.key=="fj_center"||X.key=="bj_center"||X.key=="photo_center"){$E("product.FileCenter",function(Y){Y.entry(X.key)})}else{if(X.key=="music_outlink"){$E(["product.Music"],function(Y){Y.entry({manage:true})})}else{if(X.key=="cards_read"||X.key=="read_postcard"){var R={to:B.data.from.toString()};$E("interface.OutlinkInterface",function(Y){Y.goOutlink({key:X.key,param:R})})}else{$E("interface.OutlinkInterface",function(Y){Y.goOutlink({key:X.key,param:X.param})})}}}}else{if(X["interface"]){Nav.entry(X["interface"],X.param,X.method)}}var U=this.href;if(U&&U.indexOf("http://count.mail.163.com/")==0){var W=U.indexOf("?")>-1?"&":"?";U+=(W+"frmjs=true");if(U.indexOf("uid=")==-1){U+=("&uid="+$S("uid"))}if(U.indexOf("domain=")==-1){U+=("&domain="+$S("domain"))}i.Ajax.request({requestType:i.Ajax.IFRAME,rnd:true,url:U})}else{var V=this.getAttribute("log");var e=this.getAttribute("logid");if(V=="1"&&e){var S="http://jslog.mail.126.com/count/c.htm?product=mailclick&uid="+$S("uid")+"&domain="+$S("domain")+"&logid="+e;i.Ajax.request({requestType:i.Ajax.IFRAME,rnd:true,url:S})}}i.Event.stop(T)},F,y))}}}}}}}catch(O){}}function s(){var z=this;var A=z.module;var G=A.name;var x=z.ifrm;if(!x){return}var K=x.contentWindow.document;if(!K){return}var I=K.getElementsByTagName("IMG");if(I.length<=0){return}if(!A.junkPicTips&&A.view.junkPic){A.view.getTips("junkPic","dvPopup");A.junkPicTips=true}var E=I.length,M=false;var D=A.threadModule?(z.isIE?62:52):0;for(var J=0;J<E;J++){var L=I[J];var B=L.width,N=L.height;if(L.src.indexOf("sid="+$S("sid"))>-1){if(N&&N>50){var F=false;if(B&&B>760){var y=(window.innerWidth||document.body.clientWidth)-201-34-D;if(B>y){L.style.width=Math.max(760,y);M=F=true}}var e=i(L);i.Event.listen(L,"mouseover",i.Function.bind(C,e,{resize:F,index:J,width:B,height:N}));i.Event.listen(L,"mouseout",i.Function.bind(H,e))}}}if(M){x.style.height="auto";z.setHeight()}function C(O){var X=this,U=X.dom,T=O.resize;if(X.timer){window.clearTimeout(X.timer)}if(Ud.get({field:"huodong_option",flag:"nf_status"})=="0"){return}if(X.saveNf){X.saveNf.style.display=""}else{var Y=U.src.replace(/.+part=/,"");var R=A.attachBack||(A.data&&A.data.attachments)||[];var W;for(var Q=0;Q<R.length;Q++){if(R[Q].id==Y){W=R[Q];break}}if(!(W||T)){return}var P=K.createElement("DIV");var S=X.position();P.style.cssText="font-size:12px;font-weight:normal;border:1px solid #ddd; background:#f4f4f4; line-height:14px; padding:5px;position:absolute;left:"+S[0]+"px;top:"+S[1]+"px";if(W||T){if(W){var V='<a href="javascript:void(0);" style="text-decoration:none;"  onclick="return false;">保存到网易网盘</a>';P.innerHTML=V;i.Event.listen(P.firstChild,"click",i.Function.bind(A.head.saveToNf,A.head,R[Q].id))}if(T){V='&nbsp;<span style="color:#999">|<span>&nbsp;<a href="javascript:void(0);" style="text-decoration:none;" onclick="window.open(\''+U.src+"', 'pic_preview_"+O.index+'\');return false;">1&nbsp;:&nbsp;1查看原图</a>&nbsp;<span style="color:#999">&nbsp;(&nbsp;原尺寸为'+O.width+"×"+O.height+"&nbsp;)&nbsp;<span>";i.fly(P).append(V)}i.Event.listen(P,"mouseover",function(){if(X.timer){window.clearTimeout(X.timer)}});i.Event.listen(P,"mouseout",i.Function.bind(H,U));K.body.appendChild(P);X.saveNf=P}}}function H(){var O=this;if(O.saveNf){O.timer=setTimeout(i.Function.bind(function(){this.saveNf.style.display="none"},O),300)}}}function b(G,z){var C=this,A=this.module;if(!G){return}if(G.nodeType==1){var B=G.currentStyle?G.currentStyle.fontSize:window.getComputedStyle(G,null).getPropertyValue("font-size");var E=D(B,z);if(E){G.style.fontSize=E;G.style.lineHeight="1.66"}}var x=G.childNodes;if(x&&x.length){var F=x.length;for(var y=0;y<F;y++){C.setFont(x[y],z)}}if(G.nodeName.toLowerCase()=="body"){var e=C.sizeStack;if(!e){e=C.sizeStack={}}if(typeof C.level=="undefined"){C.level=0}if(z){e[(C.level++).toString()]=window.parseInt(A.contentFrame.style.height)}else{A.contentFrame.style.height=Math.max((e[(--C.level).toString()]||0),200)+"px";delete e[(C.level).toString()]}A.content.setHeight({zoom:true})}function D(J,K){var M=parseFloat(J);var I,L,H;if(J.toLowerCase().indexOf("px")!=-1){H=3}else{if(J.toLowerCase().indexOf("em")!=-1){H=0}else{if(J.toLowerCase().indexOf("%")!=-1){H=1}else{if(J.toLowerCase().indexOf("pt")!=-1){H=2}else{H=3}}}}I=h.fontUnit[H];if(K){M+=I;if(M>h.fontLimit[H][1]){return}}else{M-=I;if(M<h.fontLimit[H][0]){return}}L=M+h.fontSymbol[H];return L}}function t(H,y){var E=H.nodeType,y=y||{};if(E==1){var z=H.id;if(z!=="divNeteaseBigAttach"&&z!="divNeteaseMailCard"){var x=H.nodeName.toLowerCase();var A=(H.currentStyle?H.currentStyle.fontSize:window.getComputedStyle(H,null).getPropertyValue("font-size")).toLowerCase(),C;if(A.indexOf("px")>0&&H.innerHTML){C=window.parseInt(A,10);C=Math.min(C,16);C=Math.max(C,12)}var I=(H.currentStyle?H.currentStyle.backgroundColor:window.getComputedStyle(H,null).getPropertyValue("background-color")).toLowerCase();var e=(H.currentStyle?H.currentStyle.backgroundImage:window.getComputedStyle(H,null).getPropertyValue("background-image")).toLowerCase();var G=H.style.color||H.style.fontColor;if(I||e){y.skipColor=true}if(",img,table,tr,td,col,colgroup,th,tbody,thead,tfoot,caption,".indexOf(","+x+",")>-1){H.style.fontFamily=""}else{H.removeAttribute("class");H.removeAttribute("style");H.removeAttribute("alink");H.removeAttribute("link");H.removeAttribute("text");H.removeAttribute("vlink");H.removeAttribute("face");H.removeAttribute("size");H.removeAttribute("align");H.removeAttribute("border");H.removeAttribute("height");H.removeAttribute("width");H.removeAttribute("hspace");H.removeAttribute("vspace")}if(!y.skipColor){H.removeAttribute("background");H.removeAttribute("color");H.style.backgroundColor=H.style.fontColor=""}else{if(G){H.style.color=G}}if(C){H.style.fontSize=C+"px"}if(I){H.style.backgroundColor=I}if(e){H.style.backgroundImage=e}}else{return}}else{return}var D=H.childNodes;for(var B=0,F=D.length;B<F;B+=1){arguments.callee(D[B],y)}}function v(B){var C=i.Object.toArray(this.module.contentFrame.contentWindow.document.getElementsByTagName("style"));var z=C.length-2;if(z>2){for(var y=0;y<z;y+=1){var x=C[y];try{x.parentNode.removeChild(x)}catch(A){x.innerHTML=x.innerText=""}C[y]=null}}var x=C[z];x.innerText=x.innerHTML=[(x.innerText||x.innerHTML),"a{text-decoration:none}","a:hover{text-decoration:underline}","@media screen and (min-width: 1400px){body,td{ font-size: 16px;line-height:180%;}}"].join("")}function u(F,B){var A=this;var D=A.module;if(!D.contentFrame){return}var y=D.contentFrame.contentWindow;if(!y){return}var M=y.document;if(!M){return}var N=Ud.get({field:"ntes_option",flag:"readRange"});switch(F){case"init":if(N=="0"||A.rangInited){return}i.Event.listen(M,"mouseup",function(O){i.Event.fire(document,"mouseup");A.range("check",O)});A.rangInited=true;break;case"get":var K="";if(window.getSelection){K=y.getSelection()}else{if(M.selection){userSelection=M.selection.createRange();K=userSelection.text}}return i.String.trim(K.toString());break;case"getCache":return this.rangeText;break;case"check":if(N=="0"||A.rangeDisabled){return}var J=A.range("get"),E=A.rangeDiv,z=true;if(J===A.rangeText&&E&&E.dom.style.display!="none"){z=false}if(J&&z){this.rangeText=J;if(!E){E=i.Element.create("div",D.createId("chooseReply"));E.setClass("nui-msgbox mh");E.html(['<div class="nui-msgbox-bd">','<div class="nui-msgbox-wide">','<ul class="hu">','<li class="hw">',i.Link.html({text:"回复选中",cls:"hv",click:function(){var O=A.range("getCache");D.action.reply(true,false,false,false,O);A.range("close")}}),"</li>",'<li class="fi">|</li>','<li class="hw">',i.Link.html({text:"转发选中",cls:"hv",click:function(){var O=A.range("getCache");D.action.forward(false,O);A.range("close")}}),"</li>",'<li class="fi">|</li>','<li class="hw">',i.Link.html({text:"设置",cls:"hv",click:function(){$E("interface.OptionInterface",function(O){O.entry({module:"BaseSetModule",inputName:"selectedcontent"})});A.range("close")}}),"</li>",'<li class="fi">|</li>','<li class="hw">',i.Link.html({text:"关闭",cls:"hv",click:function(){A.rangeDisabled=true;A.range("close")}}),"</li>","</ul>","</div>","</div>"].join(""));E.hide();document.body.appendChild(E.dom);A.rangeDiv=E;i.Component.setEvents(10)}B=y.event||B;var I=i.Event.get(B);var H=I.pageX;var G=I.pageY;var x=i.fly(D.contentFrame).position();var e=0;if(D.threadModule){G-=D.threadModule.getDom("ScrollDiv").scrollTop}else{G-=D.getDom("ScrollDiv").scrollTop}if(A.isIE){e=M.body?(M.body.offsetWidth):(M.documentElement.offsetWidth)}else{e=M.documentElement.offsetWidth}var C=H+x[0]+40;var L=H+280;if(L>e&&!(A.module.trans.hasTran&&A.module.trans.type==2)){E.setStyle({left:"auto",right:"0px"})}else{E.setStyle({left:C+"px",right:"auto"})}if(A.isIE){G-=document.documentElement.scrollTop}E.setStyle({top:G+x[1]+20+"px"});if(A.rangeTime){window.clearTimeout(A.rangeTime);E.hide();A.rangeTime=null}A.rangeTime=window.setTimeout(function(){var O=A.module.threadModule||A.module;if(O.transDiv&&O.transDiv.dom.style.display!="none"){return}E.show();A.constructor.currentMod=D},1000)}else{if(A.rangeTime){window.clearTimeout(A.rangeTime);A.rangeTime=null}if(A.rangeDiv){A.rangeDiv.hide()}}break;case"close":if(A.rangeDiv){A.rangeDiv.hide()}break}}function o(e,I){var C=this;var z=C.module;var A=z.threadModule||z;if(!z.contentFrame){return}var D=z.contentFrame.contentWindow;if(!D){return}var H=D.document;if(!H){return}var G,E;switch(e){case"init":if(false){return}i.Event.listen(H,"dblclick",function(J){C.trans("check",J)});break;case"check":if(window.getSelection){sText=D.getSelection()}else{if(H.selection){userSelection=H.selection.createRange();sText=userSelection.text}}var B=i.String.trim(sText.toString().toLowerCase());var x=/^[a-z]*$/;if(x.test(B)){I=D.event||I;var F=i.Event.get(I);G=F.pageX;E=F.pageY;$E("product.Translate",function(J){J.request(B,y)})}break}function y(N,V){var K=i.Eval.get("("+V+")");if(C.rangeDiv&&C.rangeDiv.dom.style.display!="none"||C.rangeTime){return}if(K.customTranslation.content.length>0){var P=K.phoneticSymbol?"["+K.phoneticSymbol+"]":"";var S="",W='<li class="jz">';if(K.customTranslation.content){S=W+K.customTranslation.content.join("</li>"+W)+"</li>"}var O=i("#readTextTrans");if(!O){O=i.Element.create("div","readTextTrans");O.setClass("nui-msgbox qk nj");O.setStyle({zIndex:999});O.html('<div class="nui-msgbox-bd"><div class="nui-msgbox-wide"></div></div>');O.hide();i.fly(document.body).append(O.dom);O.listen("click",function(){i.Event.cancelBubble()})}O.dom.firstChild.firstChild.innerHTML=['<div class="ni nui-txt-normal nui-scroll nui-scroll-hasShadow">','<div class="fH">','<strong class="gK">'+K.returnPhrase+"</strong>",'<span class="fR">'+P+"</span>","</div>",'<div class="fm">',"<ul>",S,"</ul>","</div>","</div>"].join("");O.show();var Q=i(z.contentFrame);var R=Q.position();var U=G+R[0];E=E+25+R[1]-(z.threadModule||z).getDom("ScrollDiv").scrollTop;if(C.isIE){E-=document.documentElement.scrollTop}O.setStyle({top:E+"px"});var J=0;if(C.isIE){J=H.body?(H.body.offsetWidth):(H.documentElement.offsetWidth)}else{J=H.documentElement.offsetWidth}var M=G+O.dom.offsetWidth+10;if(M>J&&!(C.module.trans.hasTran&&C.module.trans.type==2)){O.setStyle({left:"auto",right:"0px"})}else{O.setStyle({left:U+"px",right:"auto"})}var L=function(){i.fly("#readTextTrans").hide()};try{i.fly(document.body).one("click",L);if(Q.dom.contentDocument){i.fly(Q.dom.contentDocument.body).one("click",L)}else{if(Q.dom.contentWindow){i.fly(Q.dom.contentWindow.document.body).one("click",L)}}}catch(T){}O.destroy();Q.destroy()}}}function g(){var e=this,x=e.module;oIframe=x.getDom("ifrmContent");if(oIframe){i.Event.unlistenAll(oIframe)}x.contentFrame=null;i.Event.unlistenAll(i.fly(oIframe.contentWindow.document));i.fly(x.getDom("dvContent")).empty();oIframe=null;e.rangInited=false}})();(function(){var e=window.$,d;d=e.createClass($N("module.read.ReadAttachItem"));e.Object.mix(d,e.Component,{_template:['<li class="jG #{typeClass}">',"<table>","<tbody>","<tr>",'<td class="dz">','<div class="bJ">#{icon}</div>',"</td>","</tr>","<tr>",'<td class="fd">','<strong class="cx">#{name}</strong>','<span class="nui-txt-tips cy">#{size}</span>',"#{info}",'<div class="dA"><div class="cz"></div><div class="cB nui-fClear"><div class="bK">#{name}</div>#{down}#{open}#{prev}#{savenf}</div><div class="cA"></div></div>',"</td>","</tr>","</tbody>","</table>","</li>"].join(""),xtype:"readattachitem",previewSuffix:["doc","docx","ppt","pptx","xls","xlsx","pdf","zip","rar","htm","html","xml","txt","java","jsp","js","c","cpp","py","h","hpp","cs","sh","css","jpg","jpeg","gif","png","bmp，shtml","xhtml","mht，asp","aspx，ini","inf","dib","wpt","dot","dotm","dotx","docm","pot","potm","potx","pps","ppsx","pptm","dpt","xlsm","xlt","xltx","xltm","ett","war","ear","7z","tar","gz","tgz","taz","cpgz","z","bz","bz2","tbz","tbz2","cpio","ar","crx","sext","wps","rtf","et","dps","jar","ini","bmp","shtml","mht","flv","asp","aspx","mp3","wma"],icoIndex:[31,32,33,34],_events:["prevclick","savenfclick"],_listeners:[{name:"mouseover",handler:function(){this._mouseHandler("over")}},{name:"mouseout",handler:function(){this._mouseHandler("out")}},{name:"touch",handler:function(){var g=this;if(g.module.touchAttach){g.module.touchAttach._mouseHandler("out")}g._mouseHandler("over");g.module.touchAttach=g}}]},{isIcon:false,_getData:f,initialize:b,_mouseHandler:a,_checkPast:c});function b(h){var g=this;g.module=h.module;var i=d.superClass.initialize.call(g,h)||g;if(h.savenfclick){g.listen("savenfclick",h.savenfclick)}if(h.prevclick){g.listen("prevclick",h.prevclick)}return i}function a(g){var m=this,l=m.module;var j="nui-bdr-item nui-bg-item et",n=" eu",q=" ff";var h=m.el.dom.parentNode.parentNode;var p=m.el.position().x,o=e.fly(h).position().x;var i=p+m.el.dom.offsetWidth,k=o+h.offsetWidth;if(g=="over"){m.el.addClass((p-o)<20?(j+n):((k-i<50)?(j+q):j))}else{m.el.removeClass(j+n+q)}}function f(l){var o=this;try{var i=$L("util.Icon",o)}catch(B){return B}var m=l.filename;var y=l.size>=0?e.Number.convert(l.size):"";var w=m.indexOf(String.fromCharCode(92));var E="link",s="bZ",v=s+" bt",C='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bs M" /><br />下载',p='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bs N" /><br />打开',r='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bs O" /><br />预览',t='<img src="http://mimg.127.net/p/t.gif" class="nui-ico bs P" /><br />存网盘';if(w>-1){m=m.substr(w+1)}var k=m.replace(/(.|\n)*\./,"").toLowerCase();var n=e.Link.html({xtype:E,text:C,cls:v}).replace(/id\s*=\s*".+?"/,"");var u={down:n,name:m,size:y,open:n.concat("").replace("M","N").replace("下载","打开"),prev:$S("isCorp")?"":n.concat("").replace("M","O").replace("下载","预览"),savenf:n.concat("").replace("M","P").replace("下载","存网盘"),info:""};var q=i.getSubtype({type:"file",name:m});if(l.type=="common"&&q&&e.Array.has(d.icoIndex,window.parseInt(q))){o.isIcon=true;u.icon='<img src="'+l.imagesrc+'" style="display:none" onload="$I(\'module.read.ReadModule\').setPic(this);" onerror="$I(\'module.read.ReadModule\').setPic(this, true);" />'}else{var h={xtype:"icon",type:"file75",subtype:q};u.icon=this._getChildHtml(h)}if(l.type=="common"){var A={xtype:E,text:C,link:l.download,target:"ifrDownUrl",cls:s,listeners:[{name:"dragstart",handler:function(H){var G=["application/vnd.ms-excel",m,l.download].join(":");try{H.dataTransfer.setData("DownloadURL",G)}catch(I){}},dom:true}]};u.down=o._getChildHtml(A);if(l.eml&&q==9){var F={xtype:E,text:p,cls:s,click:function(){o.el.removeClass("nui-bdr-item nui-bg-item et");$I("interface.ReadInterface").entry(l.eml)}};u.open=o._getChildHtml(F)}else{if(l.openurl){var F={xtype:E,text:p,link:l.openurl,target:"_blank",cls:s};u.open=o._getChildHtml(F)}}if(Ext.prev&&!$S("isCorp")&&q&&e.Array.has(d.previewSuffix,k)){var x=({xtype:E,text:r,cls:s});if(o.isIcon){x.click=function(){o.fire("prevclick",l.imageIndex)}}else{x.link=l.prevurl;x.target="_blank"}u.prev=e.Link.html(x)}if(l.savenfclick){var z={xtype:E,text:t,cls:s,click:function(){o.fire("savenfclick",l.id)}};u.savenf=e.Link.html(z)}}else{if(l.type=="decrypt"){var A={xtype:E,text:C,link:l.download,cls:s,target:"ifrDownUrl"};u.down=o._getChildHtml(A)}else{if(l.type=="big"){var j=l.expiredate,g=o._checkPast(j);if(g.available){u.down=o._getChildHtml({xtype:E,text:C,link:l.download,cls:s,target:"_blank"});var D=l.prevurl;if(D&&!$S("isCorp")){u.prev=o._getChildHtml({xtype:E,text:r,cls:s,link:D,target:"_blank"})}}u.info=['<div class="di">','<span class="nui-txt-tips bT">('+g.text+")</span>","</div>"].join("");u.typeClass="fe";u.open=u.savenf=""}else{if(l.type="nf"){var A=({xtype:E,text:C,link:l.download,cls:"nui-txt-link",target:"_blank"});u.down=o._getChildHtml(A)}}}}return u}function c(i){var h={available:false,text:"已过期"};if(i){try{var g=i.getTime()-Misc.getTime(false).getTime(),k;if(g<5000){throw {}}k=g/86400000;if(k>1){h.text=Math.ceil(k)+"天"}else{k=g/3600000;if(k>1){h.text=Math.ceil(k)+"分"}else{k=g/60000;h.text=Math.floor(k)+"分"}}h.text+="后到期";h.available=true}catch(j){}}return h}})();(function(){var h=window.$,b,t,l;try{t=$L("module.read.ReadAttachItem")}catch(s){return s}b=$I("util.Icon");l=h.createClass($N("module.read.ReadAttach"));h.Object.extend(l.prototype,{contentAttach:0,initialize:c,getHtml:a,init:j,fixData:p,updateInfo:d,getCommon:o,updateCommon:f,getContent:u,updateContent:i,getThumbnail:r,getImage:q,getUrl:g,sort:n,flash:k,prevImages:m});function c(e){this.module=e;this.baseUrl=Uri.getUrl("read_data",true)+"&mid="+e.mid}function a(){var e=this;var v=e.module;return['<div id="'+v.createId("dvAttachBody")+'" class="pN" style="display:none;">',v.hasAttach?e.getCommon():"",e.getContent(),'<div class="nui-split nui-split-cDark"></div>',"</div>"].join("")}function j(){this.fixData()}function p(){var x=this.module;var y=x.data;var v=x.attachBack=y.attachments;var w=[];var e=Ext.newAttach;h.Array.each(v,function(z,A){A.filename=A.filename||(A.id+"");if(e&&A.inlined){return}w.push(A)});y.attachments=w}function d(x){var D=this;var A=D.module;if(!A.data){return}var C=A.data.attachments;var K=C?C.length:0;var e=(K>0);var I=$C(A.createId("compactAttachLink"));if(!e&&!A.hasBigAttach){if(x){A.getDom("spHeadAttachFlash").innerHTML='<span class="txt-info">(解密后无附件)</span>';A.getDom("dvAttachBody").style.display="none";A.getDom("spHeadAttachName").style.display="none";I.el.html("")}return}var B="查看附件";var H="";if(K>1||(e&&A.hasBigAttach)){B="查看全部附件";H="等..."}var w=(K>0?C[0].filename:D.contentFirstName)||"";var v=K+D.contentAttach;var J=h(A.getDom("liAttach"));var G,z=['<span id="'+A.createId("spHeadAttachName")+'" class="txt-info">',"(<span>"+h.Icon.html({type:"file",subtype:b.getSubtype({type:"file",name:w})})+h.String.left(w,50)+"</span> "+H+")</span>",'<span id="'+A.createId("spHeadAttachFlash")+'"> ',h.Link.html({text:B,cls:"nui-txt-link",click:function(){if(!A.threadModule){Log.cache({rkey:"read_head_attach"})}D.flash()}}),"</span>"].join("");if(A.folderData.fullSaveId){G='<span id="'+A.createId("spHeadAttachLen")+'" class="nui-txt-normal">&nbsp;&nbsp;'+v+"个云附件</span>"+z+"</span>";var F=A.getDom("spHeadCloud");if(F){F.innerHTML=G}else{G='<span id="'+A.createId("spHeadCloud")+'">'+G+"</span>";var E=J.find(".fU");if(E){h.fly(E.doms[0]).previous(G)}else{J.append('<div class="fT">附&nbsp;&nbsp;&nbsp;件：</div><div class="fU">'+G+"</div>")}}}else{G=['<div class="fT">附&nbsp;&nbsp;&nbsp;件：</div>','<div class="fU">','<span id="'+A.createId("spHeadAttachLen")+'" class="nui-txt-normal">'+v+"个</span>",z,"</div>"].join("");J.html(G)}if(I){I.update({text:"查看"+v+"个附件"})}J.show();J.destroy();if(x){var y=$C(A.createId("downloadAllLink"));if(y){y.hide()}}}function o(){oModule=this.module;return'<div id="'+oModule.createId("dvAttachHead")+'"  class="oR"></div><div id="'+oModule.createId("dvCommonAttach")+'" class="oS" style="display:none;margin-bottom:15px"><ul class="np nui-fClear" id="'+oModule.createId("ulCommonAttachItem")+'"></ul></div>'}function f(Q,K){var H=this;var I=H.module;var F=I.mid;var L=L||I.data.attachments;var P=L.length;var Z="nui-btn-active";if(Q){H.baseUrl=Uri.getUrl("read_decrypt_data",true)+"&mid="+I.mid}var w="";H.attachItems=[];H.imageItems=[];var X=Ud.get({field:"huodong_option",flag:"nf_status"});var W=X!="0"?true:false;var J=Q?"decrypt":"common";var G=["31","32","33","34","35","36","37","38"];var v=["2","3","4","43","44"];var D=["htm","html","css","ini","xml","txt","java","pdf"];for(var T=0;T<P;T+=1){var x=L[T];var B=x.filename;var E=x.id;var N=H.getUrl("download",E);var U=H.getUrl("open",E);var V=H.getUrl("pic",E);var C=H.getUrl("prev",E);var z={module:I,mid:F,type:J,filename:B,imagesrc:H.getThumbnail(x,452,332),imageIndex:H.imageItems.length,download:N,prevurl:C};try{var M=b.getSubtype({type:"file",name:B});if(h.Array.has(G,M)){z.openurl=V}else{if(h.Array.has(v,M)){z.openurl=U}else{var y=(B.replace(/(.|\n)*\./,"")).toLowerCase();if(h.Array.has(D,y)){z.openurl=U}}}}catch(Y){}if(x.contentType.toLowerCase()=="message/rfc822"&&x.isMsg){z.eml={fid:I.fid,mid:I.mid,folderData:I.folderData,group:I.group,part:E}}z.size=(x.encoding=="base64"?(x.contentLength*3/4):x.contentLength);if(W){z.savenfclick=h.Function.bind(I.head.saveToNf,I.head,E)}z.prevclick=h.Function.bind(H.prevImages,H);var ab=new t(z,E);H.attachItems.push(ab);w+=ab.html();if(ab.isIcon){H.imageItems.push(H.getImage(x))}if(!I.junkPicTips&&x.filename==="信纸.jpg"&&I.view.junkPic){I.view.getTips("junkPic","dvPopup");I.junkPicTips=true}}if(!K){var R=sSortMenu="";if(P>1){var S=[];for(var T=0;T<P;T++){S.push("&part="+L[T].id)}var A=Uri.getUrl("read_pack",true)+"&mid="+F+S.join("");R=h.Link.html({id:I.createId("downloadAllLink"),link:A,text:"打包下载",target:"ifrDownUrl",cls:"nui-txt-link hr"})}if(P>5){var aa;var O={groups:[{checkType:"radio",items:[{text:"按上传顺序排序(默认)",checked:true,click:function(){H.sort()}},{text:"按附件类型排序",click:function(){H.sort("type")}},{text:"按附件从小到大",click:function(){H.sort("size")}},{text:"按附件从大到小",click:function(){H.sort("size",true)}},{text:"按附件名升序",click:function(){H.sort("name")}},{text:"按附件名降序",click:function(){H.sort("name",true)}}]}],width:155};sSortMenu=['<div class="op">',h.Toolbar.html({groups:[{items:[{xtype:"link",id:I.createId("sortLink"),text:'附件排序(默认)<b class="nui-ico nui-ico-downArr">d</b>',cls:"nui-txt-link",listeners:[{name:"render",handler:function(){(new h.Menu(O)).attachTo({clickFrom:this.getEl(),renderTo:(I.threadModule?I.threadModule.getDom("ScrollDiv"):I.getDom("ScrollDiv")),reverse:true})}}]}]}]}),"</div>"].join("")}try{I.getDom("dvAttachHead").innerHTML=['<div id="'+I.createId("dvAttachHeadBanner")+'" class="ll">','<b class="nui-ico nui-ico-att"></b>','<strong class="hq">附件</strong>','<span class="nui-txt-tips">('+P+")</span>",R,sSortMenu,"</div>",'<div class="nui-split nui-split-cDark pl"></div>'].join("")}catch(Y){if(I.hasAttach&&!I.getDom("dvAttachHead")){I.getDom("dvAttachBody").innerHTML=H.getCommon();return H.updateCommon()}}H.commonInited=true;I.getDom("dvCommonAttach").style.display=""}if(w.length>0){I.getDom("ulCommonAttachItem").innerHTML=w;I.getDom("dvAttachBody").style.display=""}h.Component.setEvents(10)}function u(){var e=this.module;return e.hasBigAttach?'<div id="'+e.createId("dvbigAttachHead")+'" class="oR"></div><div id="'+e.createId("dvbigAttach")+'" class="oS"><ul class="np nui-fClear" id="'+e.createId("ulBigAttachItem")+'"></ul></div>':""}function i(D){var z=this;var x=z.module;var y=D.getElementById("divNeteaseBigAttach");var C=D.getElementById("divNeteaseNetfolder");if(!(y||C)){return""}var A;while(y){A=y;y.id="divNeteaseBigAttachOld";y=D.getElementById("divNeteaseBigAttach")}if(A){y=A;y.id="divNeteaseBigAttach"}var B=0;var v="";var w=function(H,F){var U=H.getElementsByTagName("A"),J=[];for(var M=0,R=U.length;M<R;M++){var Q=U[M];var N=Q.getAttribute("download");if(F=="big"){if(!N||(N.indexOf("http://fs.163.com/")!=0&&N.indexOf("http://fs.qiye.163.com/")!=0)){continue}}else{if(F=="nf"){if(!N||(N.indexOf("http://nfshare.mail.163.com/")!=0&&N.indexOf("http://nfshare.mail.126.com/")!=0&&N.indexOf("http://nfshare.mail.yeah.net/")!=0&&N.indexOf("http://nf.mail.163.com/")!=0&&N.indexOf("http://nf.mail.126.com/")!=0&&N.indexOf("http://nf.mail.yeah.net/")!=0&&N.indexOf("http://nf.mail.188.com/")!=0&&N.indexOf("http://nf.vip.163.com/")!=0&&N.indexOf("nf.vip.126.com/")!=0&&N.indexOf("http://nf.vip.188.com/")!=0)){continue}}}var L=Q.getAttribute("filename");if(B==0){v=L}B+=1;var K=Q.href;var P=Q.getAttribute("filesize")-0;var N,G,T;if(F=="big"){T=new Date(parseInt(Q.getAttribute("expiretime")));if(Misc.getTime().getTime()<T.getTime()){N=K;G=Q.getAttribute("preview")}}else{if(F=="nf"){N=K}}var I={module:x,type:F,filename:L,size:P,download:N,openurl:N,prevurl:G,expiredate:T};var S=new t(I);J.push(S.html())}try{x.getDom("ulBigAttachItem").innerHTML=J.join("")}catch(O){}};var E,e;if(y){w(y,"big");E=h(x.getDom("dvbigAttach"));x.getDom("dvbigAttachHead").innerHTML=['<div id="'+x.createId("dvBigAttachHeadBanner")+'"  class="ll">','<b class="nui-ico nui-ico-bigAtt"></b>','<strong class="hq">云附件</strong>','<span class="nui-txt-tips">('+B+")</span>","</div>",'<div class="nui-split nui-split-cDark pl"></div>'].join("");x.getDom("dvAttachBody").style.display="";nBigAttach=B;y.style.display="none";E.destroy();e=true}z.contentFirstName=v;z.contentAttach=B;if(h.Browser.chrome()&&e){x.contentFrame.style.width="100%";x.contentFrame.style.height="auto"}}function r(A,y,z){var x=this;var B=x.module.mid;var C=x.baseUrl+"&mode=inline&part="+A.id;var e=window.encodeURIComponent?window.encodeURIComponent(B):B;var w="http://pic.mail."+$S("domain");if($S("domain")=="vip.163.com"){w="http://pic.vip.163.com"}else{if($S("domain")=="vip.126.com"){w="http://pic.vip.126.com"}}var v=w+"/coremail/fcg/imgapp?funcid=thumbnail&sid="+$S("sid")+"&mid="+e+"&off="+A.contentOffset+"&len="+A.contentLength+"&enc="+A.encoding+"&conttype="+A.contentType+"&needoriginal=1&width="+y+"&height="+z;if($S("isCorp")){return C}if(A.width&&A.height){if(A.width>y&&A.height>z){return v}else{return C}}return v}function q(B){var x=this;var C=x.module.mid;var z=x.getThumbnail(B,60,60);var v=x.getThumbnail(B,800,600);var y=x.baseUrl+"&part="+B.id;var A=y+"&mode=inline";var w=y+"&mode=download&l=read&action=download_attach";var e={id:C,picture:v,thumbnail:z,title:B.filename,original:A,downloadLink:w};return e}function m(e){var v=this;if(v.imageItems&&v.imageItems.length>0){var w={};w.index=e;w.data=v.imageItems;w.downloadAble=true;$E("product.Preview",function(x){x.init(w)})}}function g(y,e){var x=this,w=x.module.mid;var v;switch(y){case"download":v=x.baseUrl+"&part="+e+"&mode=download&l=read&action=download_attach";break;case"open":v=x.baseUrl+"&part="+e+"&mode=inline&l=read&action=open_attach";break;case"pic":v=Uri.getUrl("read_pic",true)+"&mid="+w+"&part="+e+"&mode=inline&l=read&action=open_attach";break;case"prev":v=Uri.getUrl("previewattach")+"&mid="+w+"&part="+e+"&keyfrom=wm"+$S("domain");break;default:break}return v}function n(e,y){var B=this;var z=B.module;var A=z.data.attachments;var v;var C="附件排序(默认)";switch(e){case"size":if(y){C="按附件从大到小";v=function(E,D){var G=(E.encoding=="base64"?(E.contentLength*3/4):E.contentLength);var F=(D.encoding=="base64"?(D.contentLength*3/4):D.contentLength);return F-G}}else{C="按附件从小到大";v=function(E,D){var G=(E.encoding=="base64"?(E.contentLength*3/4):E.contentLength);var F=(D.encoding=="base64"?(D.contentLength*3/4):D.contentLength);return G-F}}break;case"type":C="按附件类型排序";v=function(E,D){var G=(E.filename.replace(/(.|\n)*\./,"")).toLowerCase();var F=(D.filename.replace(/(.|\n)*\./,"")).toLowerCase();if(G>F){return 1}else{if(G<F){return -1}else{return 0}}};break;case"name":if(y){C="按附件名降序";v=function(E,D){var G=E.filename.toLowerCase();var F=D.filename.toLowerCase();if(G>F){return -1}else{if(G<F){return 1}else{return 0}}}}else{C="按附件名升序";v=function(E,D){var G=E.filename.toLowerCase();var F=D.filename.toLowerCase();if(G>F){return 1}else{if(G<F){return -1}else{return 0}}}}break;default:v=function(E,D){return E.id-D.id};break}if(v){var x=B.module.decrypt.pwd?true:false;var w=A.sort(v);B.updateCommon(x,true);C+='<b class="nui-ico nui-ico-downArr">d</b>';$C(z.createId("sortLink")).getEl().html(C)}}function k(){var y=this,x=y.module,e=h(h.fly(x.getDom("dvAttachBody")).find(".oR").doms[0]),A=(x.threadModule||x).getDom("ScrollDiv"),B=e.position()[1]-200,v=0,z,w="jF",C="mV";A.scrollTop=B;if(h.Browser.chrome()||h.Browser.safari()){e.addClass(w);window.setTimeout(function(){e.setClass("oR");e.destroy()},1000)}else{z=window.setInterval(function(){if(v>8){window.clearInterval(z);e.removeClass(C);e.destroy();return}if(e.dom.className.indexOf(C)>-1){e.removeClass(C)}else{e.addClass(C)}v+=1},100)}}})();(function(){var e=window.$,c=e.createClass($N("module.read.ReadDecrypt"));e.Object.extend(c.prototype,{initialize:g,check:b,decryptMessage:a,decryptBack:d,updateContent:f});function g(h){this.module=h}function b(){var h=this.module.data.attachments;return !(h.length==0||h[0].filename.indexOf(".cmecypt")==-1||h[0].filename.indexOf("cmecypt")!=(h[0].filename.length-7))}function a(){var i=this,j=i.module;var k=$C(j.createId("decryptInput")),h=$C(j.createId("decryptTips"));var l=e.String.trim(k.getValue());if(l.length==0){h.update({text:"密码不能为空"});h.show();return}i.checkPwd=l;i.module.action.decryptMessage({param:{mid:j.mid,pwd:l},callback:i.decryptBack})}function d(m){var k=this;var l=k.module;var h=m.code;if(h==S_OK){k.pwd=k.checkPwd;l.constructor.decryptMid[l.mid]=true;try{$C(l.createId("decryptBlock")).destroy()}catch(n){}l.view.getTips("decryptSuc","dvPopup");k.decryptData=m["var"];k.updateContent();return}var j;switch(h){case"FA_MAIL_NOT_FOUND":j="信件不存在";break;case"FA_PART_NOT_FOUND":j="附件不存在";break;case"FA_INVALID_PART":j="信件Part不是嵌套信";break;case"FA_EMPTY_PASSWORD":j="没有传递密码参数";break;case"FA_INVALID_PASSWORD":j="密码错误，请重新输入";break;case"FA_INVALID_ENCRYPTED_DATA":j="数据错误";break}var i=$C(l.createId("decryptTips"));i.update({text:j});i.show()}function f(m){var i=this;var j=i.module;var l=j.contentFrame;var n=i.decryptData;try{var h=l.contentWindow;h.document.body.innerHTML=(n.html||n.text||{content:"<div>邮件正文不存在</div>"}).content;if(m){return}}catch(k){}j.data.attachments=j.attachBack=n.attachments;try{j.content.setMediaPlayer()}catch(k){}j.attach.updateCommon(true);if(j.hasBigAttach){j.attach.updateContent(l.contentWindow.document)}j.attach.updateInfo(true);i.decryptMsg=true;document.cookie=j.mid+"="+i.pwd+";path=/";j.content.setHeight()}})();(function(){var g=window.$,m,k;try{k=$L("support.AddressSupport")}catch(j){return j}m=g.createClass($N("module.read.ReadStatus"));g.Object.extend(m.prototype,{tips:null,load:null,fold:null,initialize:d,complete:a,query:o,show:n,setTips:h,getTips:p,getTable:f,recall:c,unrecallReason:b});function d(q){var e=this;e.module=q;e.tips={};e.statusItem={};e.load={};e.unFold={}}function a(e,u){var x,v=this.module.folderData;if(e=="mail"){x=[];var s={};g.Array.each(u,function(z,A){if(s[A.msgid]){s[A.msgid].push(A)}else{s[A.msgid]=[A]}});for(var q in s){var r=s[q];var t=[];g.Array.each(r,function(z,A){t.push(new Email(A.to,A.to_name))});var w={msgType:r[0].msgType,rectime:(r[0].rectime||r[0].modtime),email:t};x.push(w)}u=x}var y={"0":"发往该域的信件现不支持撤回","4":"信件不存在，可能已经被用户删除","5":"信件存在但已经被读取过","6":"信件存在但已经被客户端收取","7":"信件存在但已经被推送出去","8":"信件已过期","9":"不支持撤回发往外域帐号的邮件"};g.Array.each(u,function(I,B){var D="";var C=0;var z="";if(e=="mail"){switch(B.msgType){case 0:D="未知";break;case 1:D="新邮件";break;case 2:case 3:case 4:D="已回复";z="re";break;case 5:D="已自动回复";z="re";break;case 6:case 7:case 8:D="已转发";z="fw";break;case 9:D="已自动转发";z="fw";break}}else{var F=B.result;var A=Math.round(F/100);var K=F%100;if(A==1){switch(K){case 0:case 6:case 7:case 8:D="成功到达对方邮箱";C=1;break;case 1:D="正在投递中";C=0;break;case 2:case 5:D="未到达对方邮箱";C=2;break;case 3:case 4:D="被对方退回";C=2;break;default:D="未知操作";C=3;break}}else{if(A==2){switch(K){case 0:case 6:case 7:case 8:D="成功到达对方服务器";C=1;break;case 1:D="对方服务器未响应,重新投递中";var G=["@163.com","@126.com","@188.com","@vip.188.com","@yeah.net","@vip.163.com","@vip.126.com"];for(var E=0,J=G.length;E<J;E+=1){if(B.to.indexOf(G[E])!=-1){D="正在投递中";break}}C=0;break;case 2:case 5:D="未到达对方服务器";C=2;break;case 3:case 4:D="被对方服务器退回";C=2;break;default:D="未知操作";C=3;break}}else{if(A==3||A==4){switch(K){case 0:case 1:case 6:case 7:case 8:D="正在处理中";C=0;break;case 2:case 5:case 3:case 4:D="发送不成功，详细原因请查看退信";C=2;break;default:D="未知操作";C=3;break}}else{if(A==5||A==7){switch(K){case 0:D="撤回成功";C=5;break;case 9:D="成功到达对方邮箱";C=1;break;default:D="未知操作";C=3;break}}else{if(A==8){switch(K){case 0:D="撤回成功";C=5;break;case 9:D="成功到达对方服务器";C=1;break;default:D="未知操作";C=3;break}}else{D="未知操作";C=3}}}}}if(e=="recall"&&v.rclStatus&&C==1){D="撤回失败，原因："+(y[B.rclResult]||"其他原因");C=6}var H=["doing","suc","err","other","doing","suc","err"];z=H[C];B.email=new Email(B.to,B.to_name)}B.icon=z;B.msg=D;B.status=C});return u}function o(w,v){var s=this;var u=s.module;var r=s.getTips(w);if(v||!s.load[w]){var t={type:w,callback:g.Function.bind(s.show,s),mid:u.mid};u.action.listDeliveryHistory(t)}else{var e=$C(u.createId("readCheckStatus")),q=$C(u.createId("readRefreshStatus"));if(s.unFold[w]){s.unFold[w]=false;s.statusItem[w].hide();e.update({text:"查看详情"});q.hide()}else{s.unFold[w]=true;s.statusItem[w].show();e.update({text:"隐藏详情"});q.show()}}}function n(e,q){var y=this;var v=y.module;var r=v.data;var x=q.code;var w=(Misc.getTime(0)-r.sentDate>3600000*24*7);if(x==S_OK){y.load[e]=true;var t=y.getTips(e);var u=y.complete(e,q["var"],w);var s={type:e,data:u,expire:w};s.renderTo=t.getEl();y.statusItem[e]=y.getTable(s);if(y.unFold[e]){return}$C(v.createId("readCheckStatus")).update({text:"隐藏详情"});$C(v.createId("readRefreshStatus")).show();y.unFold[e]=true}}function h(r,e){var q=this;if(r=="mail"){q.tips.mail=e}else{q.tips.send_recall=e}}function p(q){var e=this;if(q=="mail"){return e.tips.mail}else{return e.tips.send_recall}}function f(e){var y,t,v,r=e.data||[],A=r.length,w=this.module.createId("statusTable"),x=$C(w);switch(e.type){case"send":y=[{text:"收件人"},{text:"发送状态"},{text:"时间"}];v=e.expire?"邮件发送已经超过7天，查询不到详情":"没有查到详情，请稍后再试";break;case"recall":y=[{text:"收件人"},{text:"撤回状态"},{text:"时间"}];v="没有查到详情，请稍后再试";break;case"mail":y=[{text:"处理方式"},{text:"时间"},{text:"联系人"}];v="没有查到详情，系统仅保留7天内的回复、转发信息。";break}if(A==0){t=[[{colspan:3,text:v}]]}else{t=[];for(var s=0,q,u,z;s<A;s+=1){q=r[s];u=g.Date.format((q.rectime||q.modtime),"yyyy年M月d日   HH:mm(星期w)");if(e.type=="mail"){z=[{text:'<span class="nui-txt-normal">'+q.msg+"</span>"},{text:'<span class="nui-txt-normal">'+u+"</span>"},{text:""}];g.Array.each(q.email,function(D,C){var B=C.name;if(!B){B=k.getName(C)}z[2].text+=(B?('<span title="'+C.address+'" class="nui-txt-normal">'+B+"</span>"):('<span class="nui-txt-normal">'+C.address))+(D<q.email.length-1?"、":"")+"</span>"})}else{z=[{text:'<span class="nui-txt-normal">'+g.String.encodeHTML(q.email.toString())+"</span>"},{text:'<span class="nui-txt-'+q.icon+'">'+q.msg+"</span>"},{text:'<span class="nui-txt-normal">'+u+"</span>"}]}t.push(z)}}if(x){x.destroy()}return new g.Table({id:w,subclass:"simpleTable",renderTo:e.renderTo,headCells:y,bodyCells:t})}function c(w){var u=this;var t=u.module;var v=t.action;var r=t.data;var s=t.folderData;var A="ht";var x="撤回失败";var B={0:x,1:"撤回中，请稍后查看详情",2:"成功撤回",3:"成功撤回",4:x,5:x,6:x,7:x,8:x,9:x,14:x,15:x};var z=[{text:"已发送邮箱地址"},{text:"状态"}];if(window.allowRecallBeforeDays&&Misc.getTime(0)-r.sentDate>allowRecallBeforeDays*24*3600*1000){new g.Msgbox({title:"很抱歉，该邮件不能被撤回",content:"<p>此邮件距发送时已超过"+allowRecallBeforeDays+"天，无法撤回。</p>"});return}if(!s.recallable){var C=(Misc.getTime(0)-r.sentDate<5*60*1000);if(C&&!w){$E("interface.MboxInterface",function(D){D.getLetterData({moduleName:t.listModule,mid:t.mid,refersh:true,callback:function(F,E){if(F){t.folderData=F;u.recall(true)}}})})}else{u.unrecallReason()}return}else{if(s.recalled||s.rclStatus){g.Msgbox.show({title:"该邮件已经被执行撤回，如需查看撤回结果，请点击“查看详情”。"})}else{g.Msgbox.show({type:"confirm",title:"您确定要撤回此邮件吗？",cls:A,content:['<p class="nui-item-spc1x">邮件撤回详细说明：</p>','<p class="nui-item-spc1x">1. 撤回功能开通后发送的邮件才支持撤回；</p>','<p class="nui-item-spc1x">2. 邮件发送未超过'+window.gUser.allowRecallBeforeDays+"天，在对方未读(或显示未读状态)，未被对方从邮件客户端(比如Outlook，Foxmail)收取过，才支持撤回；</p>",'<p class="nui-item-spc1x">3. 撤回成功后，对方看到的邮件将被清除，撤回的结果将通过系统邮件通知您。</p>'].join(""),ok:y})}}var q;function y(){var J="正在撤回中...",F=s.rclStatus?"正在查询撤回状态...":J,H=(r.to||[]).concat(r.cc||[]).concat(r.bcc||[]),K=[],D=[],I={};for(i=0,l=H.length;i<l;i++){var G=Uri.getAddress(H[i])||H[i];if(!I[G]){I[G]=true;K.push(H[i]);D.push([{text:G},{text:J}])}}var E={type:"confirm",contentType:"wide",title:'<b class="nui-ico nui-ico-loading">e</b>'+F,icon:"loading",extcls:A,content:(new g.Table({subclass:"simpleTable",headCells:z,bodyCells:D})).html()};q=new g.Msgbox(E);q.buttons.cancel.hide();v.recallMessage({mid:t.mid,callback:e})}function e(D){var M=D.code;if(M=="FA_UNSUPPORT_RECALL"){g.Msgbox.show({cls:A,title:"这封邮件无法撤回！"});return}s.recalled=true;var G=D["var"];var N=G.recallresult;var J="已执行撤回操作，结果如下";if(s.rclStatus){J="撤回查询已经完成！"}var N=G.recallresult;var I=[-1,-1,-1];var O=[];for(var E in N){if(N[E]==1){if(I[0]==-1){I[0]=1}I[0]=I[0]&&true}else{if(N[E]==2||N[E]==3){if(I[1]==-1){I[1]=1}I[1]=I[1]&&true}else{if(I[2]==-1){I[2]=1}I[2]=I[2]&&true}}var F=Uri.getAddress(E)||E;var P=N[E];O.push([{text:F},{text:'<span class="'+(P==1?"nui-txt-normal":((P==2||P==3)?"nui-txt-suc":"nui-txt-err"))+'">'+B[N[E]]+"</span>"}])}if(I[0]&&I[0]!=-1){s.rclStatus=1}else{if(I[1]&&I[1]!=-1){if(I[2]&&I[2]!=-1){s.rclStatus=5}else{s.rclStatus=3}}else{s.rclStatus=4}}var H="";var L="";if(s.rclStatus&&s.rclStatus>0){if(s.rclStatus<3){H="邮件撤回中"}else{if(s.rclStatus==3){H="撤回成功";L="nui-txt-suc "}else{if(s.rclStatus==4){H="撤回不成功";L="nui-txt-err "}else{if(s.rclStatus==5){H="部分成功";L="nui-txt-impt "}}}}}q.update({title:J,content:g.Table.html({subclass:"simpleTable",headCells:z,bodyCells:O})});q.buttons.cancel.hide();q.buttons.ok.update({text:"查看详情"});q.listen("ok",function(){u.query("recall",true)});var K=u.getTips("send");if(K){K.update({icon:"recallState",content:'<p><strong class="'+L+'">'+H+"</strong></p>"})}window.Listener.fire("read:recall",t.mid)}}function b(){var r=this;var t=r.module;var w=t.data;var v=t.action;var q={};var e={"5":"信件存在但已经被读取过。","6":"信件存在但已经被客户端收取过。","7":"信件存在但已经被推送出去。"};var s={type:"recall",mid:t.mid,callback:u};v.listDeliveryHistory(s);function u(x,y){var A=y["var"]||[];var H=false;var z=Uri.getUrl("read_recall_help",true);for(var B=0,F=A.length;B<F;B+=1){var C=null;if(!A[B].recallable){var G=(Misc.getTime(0)-w.sentDate<1*60*1000);if(G){C="系统处理中，请稍后尝试撤回"}else{C="撤回功能开通后发送的邮件才支持撤回，目前仅尝试撤回发往网易163、126、yeah.net、vip163、vip126和188的邮件。更详细的撤回条件可 $help$"}}else{var G=(Misc.getTime(0)-w.sentDate<3*60*1000);C=e[A[B].rclResult];if(!C&&G){C="邮件正在发送中，请稍后尝试撤回"}}if(!C){H=true}if(C){if(!q[C]){q[C]=true}}}if(H){q["其他原因邮件不支持撤回。"]=true}var D=[];for(var C in q){D.push(C)}var E='<h4 class="g-dialogBox-title">很抱歉，该邮件不能被撤回</h4>';if(D.length>0){E+='<p class="txt-info g-dialogBox-item">原因如下：'+D.join("<br>").replace("$help$",g.Link.html({link:z,text:"查看帮助",target:"_blank"}))+"</p>"}g.Msgbox.show({title:"撤回邮件",content:E})}}})();(function(){var d=window.$,e=d.createClass($N("module.read.ReadTrans"));d.Object.extend(e.prototype,{hasCall:false,hasTran:false,subject:"",initialize:c,checkCall:b,checkBack:g,showCall:h,showBack:a,change:i,setHeight:f});function c(j){this.module=j}function b(){if($S("isCorp")){return}var k=this;var j=Uri.getUrl("read_trans",true);j+="&mid="+k.module.mid;j+="&a=get";d.Ajax.request({requestType:d.Ajax.SCRIPT,url:j,rnd:true,paddingFunc:d.Function.bind(k.checkBack,k)})}function g(k){var j=this;if(k&&k.result&&k.result.fanyi){if(k.result.fanyi.lang=="west"){j.checkTips=j.module.view.getTips("transCheck","dvPopup")}else{if(k.result.fanyi.lang=="traditional Chinese"){j.checkTips=j.module.view.getTips("trans","dvPopup",{text:"翻译成简体中文"})}}}}function h(l){var o=this,p=o.module;if(o.hasTran){return}var k=p.decrypt.check(),j=p.decrypt.pwd;if(k&&!j){d.Msgbox.html({content:"<br/>抱歉，本邮件是加密邮件，请先进行解密。",ok:function(){$C(p.createId("decryptInput")).focus()}});return}var q="";switch(l){case 0:q="_btn";break;case 1:q="_tip";break;case 2:q="_rty";break;default:return}var n=Uri.getUrl("read_trans",true),m=gEnvironment.svr;n+="&a=fanyi&mid="+o.module.mid;n+="&keyform=wm"+$S("domain")+q;if(m==="hz"){n+="&svr=hz"}if(j){n+="&decryptMsg=1"}if($S("isCorp")){d.Ajax.request({requestType:d.Ajax.XMLHTTP,url:n,rnd:true,head:[{name:"Accept",value:"application/json"}],call:function(s){try{s=d.Eval.get(s.responseText)}catch(r){return}o.showBack(s)}})}else{d.Ajax.request({requestType:d.Ajax.SCRIPT,url:n,rnd:true,paddingFunc:function(r){o.showBack(r)}})}if(!o.checkTips){o.checkTips=o.module.view.getTips("transCheck","dvPopup",{text:"正在翻译，请稍候..."})}}function a(k){var s=this;var p=s.module;var t="dvPopup";if(s.checkTips){s.checkTips.destroy();s.checkTips=null}if(s.hasTran){return}if(k&&k.result&&k.result.error){s.checkTips=s.module.view.getTips("transRetry",t);return}s.hasTran=true;s.showTips=s.module.view.getTips("transShow",t);d.fly(p.getDom("dvContent")).addClass("io");if(k){var q=d.Element.create("IFRAME");q.setClass("kA dl");q.setAttr({frameBorder:"0"});q.dom.frameborder="0";p.getDom("dvContent").appendChild(q.dom);q.listen("load",function(){s.setHeight()});s.iframe=q;var r=k.result.fanyi||k.result;var w=["<html>","<head>",'<base target="_blank" />','<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"<title>网易邮箱</title>",'<style type="text/css">',"html{word-wrap:break-word;}","body{font-size:14px;font-family:arial,verdana,sans-serif;line-height:1.666;padding:10px 8px;margin:0;overflow:auto}","pre {white-space: pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space: -o-pre-wrap;word-wrap: break-word;}","</style>","</head>","<body>","<div>",(r.content||""),"</div>","</body>","</html>"].join("");var v=q.dom.contentWindow;v.document.open("text/html","replace");v.document.write(w);v.document.close();var x=v.document;var u=x.getElementsByTagName("A");for(var n=0,m=u.length;n<m;n+=1){u[n].target="_blank"}s.subject=d.String.escapeHTML(r.title||"无主题");var j=p.getDom("h1Subject");if(j){j.innerHTML=s.subject}p.content.setHeight();d.Event.listen(x,"click",function(){d.Event.fire(document,"click")})}s.type=2}function i(l){var o=this;var p=o.module;var n=p.getDom("dvContent");var m=o.showTips;var j=[$C(p.createId("transShowSource")),$C(p.createId("transShowResult")),$C(p.createId("transShowBoth"))];var k;switch(l){case 0:n.className="nui-fClear pm";k=d.String.escapeHTML(p.data.subject);j[0].setDisabled(true);j[1].setDisabled(false);j[2].setDisabled(false);p.content.setHeight({heightOnly:true});break;case 1:n.className="nui-fClear pm dU";k=o.subject;j[0].setDisabled(false);j[1].setDisabled(true);j[2].setDisabled(false);o.setHeight();break;case 2:n.className="nui-fClear pm io";k=o.subject;j[0].setDisabled(false);j[1].setDisabled(false);j[2].setDisabled(true);p.content.setHeight({heightOnly:true});o.setHeight();break}p.getDom("h1Subject").innerHTML=k;o.type=l}function f(){var l=this;var k=l.iframe;var j=k.dom.contentWindow.document;if(!j){return}var m=d.Browser.isIE()?(j.body.scrollHeight+150):(j.documentElement.scrollHeight+30);k.setStyle({height:(m<300?"300px":(m+"px"))})}})();(function(){var f=window.$,p,s,t,r,a,q,h,b,o,d,k,C,g,i;try{p=$L("interface.MboxInterface");s=$L("interface.ReadInterface");b=$L("module.read.BaseReadModule");t=$L("module.read.ReadView");r=$L("module.read.ReadListener");h=$L("module.read.ReadAction");o=$L("module.read.ReadHead");d=$L("module.read.ReadContent");k=$L("module.read.ReadAttach");C=$L("module.read.ReadDecrypt");g=$L("module.read.ReadStatus");i=$L("module.read.ReadTrans")}catch(z){return z}a=$I("module.BaseModule");q=f.createClass($N("module.read.ReadModule"));f.Object.inherit(q,b);f.Object.extend(q,{ENCODE:window.READ_ENCODE,decryptMid:{},displayCount:5,"interface":s,View:t,Action:h,Listener:r,setPic:m});f.Object.extend(q.prototype,{initialize:D,init:y,entry:j,cache:w,exit:v,switchIn:A,switchOut:l,getData:B,getText:n,getGroup:c,_initInfo:u,_askReceipt:x});function D(E,e){var F=this;if(E){F.listModule=E.moduleName;F.mid=E.id||E.mid;F.fid=E.fid;F.group=E.group;F.part=E.part;F.viewType=E.viewType;F.enterAction=E.action;if(e&&e.hidden){F.hiddenMod=true;Log.cache({rkey:"read_preload"})}}F.head=new o(F);F.content=new d(F);F.decrypt=new C(F);F.status=new g(F);F.trans=new i(F);F.attach=new k(F);F.isIE=f.Browser.isIE()}function y(){var e=this;e.content.init(true);if(!e.part&&!e.viewType&&!e.threadModule){e.head.setPreAndNext()}if(!e.threadModule){e.setRead(true);e.scroll(null,E);if(!e.hiddenMod){window.setTimeout(function(){e.getDom("h1Subject").focus()},500)}if(!e.viewType){f.fly(e.getDom("Header")).addClass("frame-main-cont-head-hasBorder nui-bg-light nui-bdr-light")}Log.cache({rkey:"read_init"})}function E(){var F=f.Event.getTarget();e.modScrollTop=e.getDom("ScrollDiv").scrollTop;if(e.scrollHandler){window.clearTimeout(e.scrollHandler)}e.scrollHandler=window.setTimeout(function(){try{e.view.zoom(F.scrollTop>0?"showTop":"hideTop")}catch(G){}},500)}}function j(e){}function w(){var E=this;var e=true;if(E.viewType){E.switchIn()}if(E.hiddenMod){e=!e;delete E.hiddenMod;if(f.Browser.chrome()){E.contentFrame.style.height="auto"}window.setTimeout(function(){E.content.setHeight();E.getDom("h1Subject").focus();E._askReceipt()},0);Log.cache({rkey:"read_preload_active"})}else{$S("lastRead",E.mid)}if(!E.threadModule){E.setRead(e);window.setTimeout(function(){E.head.setPreAndNext()},500)}}function v(){var E=this;if(E.viewType){try{E.switchOut()}catch(F){}}return true}function A(){var e=this;e.out=false;if(e.removeCaseExit){e.content.init()}if(e.modScrollTop){e.getDom("ScrollDiv").scrollTop=e.modScrollTop}}function l(){var E=this;var e=E.content;E.out=true;if(E.removeCaseExit){e.destroy()}window.setTimeout(function(){e.stopMediaPlayer()},50)}function B(I){var H=this,e=false,G=H.folderData;if(!G){G=H.folderData=H._var.folderData}if(!H.fid&&G){H.fid=G.fid}if(!H.mid&&G){H.mid=G.id}H.baseUrl=window.gEnvironment.readUrl+"&mid="+H.mid+"&color="+window.gUser.color;H.group=H.group||H.name;if(G){F()}else{p.getLetterData({moduleName:H.listModule,mid:H.mid,callback:function(L,K){if(L){H.folderData=G=L;H.fid=L.fid;if(H.textCall){var J=L.subject||"无主题";H.textCall(J)}F()}if(K&&K.code=="S_PARTIAL_OK"){f.Msgbox.show({title:"读信出错",content:"对不起，该封信件不存在。",ok:function(){Tab.remove(H);return false}})}}})}function F(){var K=G.flags;if(K){H.hasAttach=!!(K.attached);H.hasBigAttach=!!(K.linkAttached)}if(!H.part){I()}var J={param:{mid:H.mid,part:H.part,folderData:G},call:E,cacheFlag:3};if(q.decryptMid[H.mid]){J.cacheFlag=0}H.action.readMessage(J)}function E(L){if(L){H.data=L["var"]}if(H.part){var K={subject:H.data.subject,flags:{}};var J=H.data.from;if(!J||J.length==0){J=""}else{J=J[0]}K.from=J;H.folderData=K;I()}H._initInfo()}}function n(E){var e=this;if(e.folderData){return e.folderData.subject||"无主题"}else{e.textCall=E;return"信件加载中"}}function c(){return this.group}function m(I,H){if(H){I.parentNode.innerHTML=f.Icon.html({type:"file75"})}else{I.style.display="";var F=I.clientWidth,E=I.clientHeight;var e=F,J=100,G="width";if(F<J&&E<J){return}if(F>E){e=E;G="height"}if(e>J){I.style[G]=J+"px"}}I=null}function u(){var G=this;var J=G.data;var I=G.action;var F=G.folderData;var E=false;G.view.fill();if(J.attachments&&J.attachments.length){E=G.hasAttach=true;if(!G.attach){G.attach=new k(G)}G.attach.init();E=G.hasAttach=(J.attachments.length>0);try{G.content.setMediaPlayer()}catch(H){}}if(E||G.hasBigAttach){if(E){G.attach.updateCommon();if(G.decrypt.check()){G.view.getTips("decryptCheck","dvPopup")}}G.attach.updateInfo()}window.setTimeout(function(){G._askReceipt()},200);if($S("ad").show&&G.mtype.indexOf("thread")<0){G.view.flashAd();G.view.youdaoAd("init")}f.Component.setEvents(10);if(G.enterAction){switch(G.enterAction){case"reply":G.action.reply();break;case"replyAll":G.action.reply(true);break;case"forward":G.action.forward();break}G.enterAction=null}G.view.zoom("fix")}function x(){var E=this;var G=E.data;var F=E.action;if(E.markRead&&G&&G.requestReadReceipt){E.markRead=false;var e=Ud.get({field:"op_readreceipt"});if(e=="0"){f.Msgbox.show({type:"confirm",title:f.String.escapeHTML((G.from+""))+"要求发送“已读回执”，是否发送？",okText:"发送",cancelText:"不发送",ok:function(){if($C("readReceipt").getChecked()){Ud.set({field:"op_readreceipt",value:"2"})}F.sendReceipt()},cancel:function(){if($C("readReceipt").getChecked()){Ud.set({field:"op_readreceipt",value:"1"})}},content:f.Checkbox.html({id:"readReceipt",text:"以后都按这次操作"})})}else{if(e=="2"){F.sendReceipt()}}}}})();(function(){var d=$.createClass($N("module.compose.Compose"));var e=["view","info","base","event","form","action","attach","address","stationery","sign","encrypt","editor","assist","success"];$.Array.each(e,function(f,g){d.prototype[g]=null});$.Object.extend(d.prototype,{param:null,"class":null,module:null,names:e,initialize:b,init:a,clear:c});function b(f){var g=this;g.module=f;g.param=f.param;g["class"]=f["class"]}function a(){var g=this;var f=g.module;$.Array.each(g.names,function(h,j){try{g[j]=f[j]}catch(i){}})}function c(){var f=this;$.Object.each(f,function(h,g){if(g){f[h]=null}delete f[h]})}})();(function(){try{var o=$L("module.BaseAction");var k=$L("module.compose.Compose")}catch(p){return p}var s=$.Object;var b=$.createClass($N("module.compose.ComposeAction"));s.mix(b,o,null,{});s.extend(b.prototype,k.prototype);s.extend(b.prototype,{send:q,getId:u,getInfo:c,cancelId:a,restoreDraft:t,replyMessage:w,forwardMessages:g,editMessage:j,saveSent:i,saveSentAndDel:m,syncAttach:h,deleteAttach:r,save2YNote:l,cancelDeliver:n,getTasks:f,contactCorrect:d,getSubject:v});function q(x){var y=this;var e={func:"mbox:compose",log:s.extend({l:"compose"},x.log),body:x.body,error:x.error,call:x.callback};y.wmsvr(e)}function u(x){var y=this;var e={func:"mbox:compose",body:{},call:x.callback};y.wmsvr(e)}function c(x){var y=this;var e={func:"mbox:getComposeInfo",body:{id:y.info.get({cid:true})},call:x.callback};y.wmsvr(e)}function a(x){var y=this;var e={func:"mbox:cancelComposes",body:{ids:[y.info.get({cid:true})]},call:x.callback};if(x.deleteDraft){e.body["deleteDraft"]=true}y.wmsvr(e)}function t(x){var y=this;var e={func:"mbox:restoreDraft",body:x.body,call:x.callback};y.wmsvr(e)}function w(x){var y=this;var e={func:"mbox:replyMessage",log:s.extend({l:"read"},x.log),body:x.body,error:x.error,call:x.callback};y.wmsvr(e)}function g(x){var y=this;var e={func:"mbox:forwardMessages",log:s.extend({l:"read"},x.log),body:x.body,error:x.error,call:x.callback};y.wmsvr(e)}function j(x){var y=this;var e={func:"mbox:editMessage",body:x.body,call:x.callback};y.wmsvr(e)}function i(x){var y=this;var e={func:"mbox:saveSent",body:{id:x.mid},ignoreError:true,call:x.callback};y.wmsvr(e)}function m(x){var y=this;var e={func:"global:sequential",body:{items:[{func:"mbox:saveSent","var":{id:x.saveMid}},{func:"mbox:deleteMessages","var":{id:x.delMid}}]},ignoreError:true,call:x.callback};y.wmsvr(e)}function h(x){var y=this;var e={func:"mbox:compose",body:{id:y.info.get({cid:true}),action:"continue",returnInfo:true,attrs:{attachments:x.attachments}},call:x.callback};y.wmsvr(e)}function r(x){var B=this;var y=x.sid;var A=null;if(y){if(typeof y=="object"&&y.length){A=y}else{A=[y]}}else{return}var z=[];$.Array.each(A,function(D,C){z.push({id:C,deleted:true})});var e={func:"mbox:compose",body:{id:B.info.get({cid:true}),action:"continue",attrs:{attachments:z}},call:x.callback};B.wmsvr(e)}function l(x){var y=this;var e={func:"ntes:mbox:ynote",body:{action:"saveEmail",mid:x.mid},call:x.callback,error:x.error};if(y.base.get({status:"showEncrypt"})){e.body["password"]=y.encrypt.get()}y.wmsvr(e)}function n(x){var y=this;var e={func:"mbox:cancelDeliver",body:{tinfo:x.tinfo},call:x.callback,error:x.error};y.wmsvr(e)}function f(x){var y=this;var e={func:"upload:getTasks",body:{composeId:x.cid},call:x.callback,error:x.error};y.wmsvr(e)}function d(y){var z="http://"+$S("host")+"/rcmd/rcmd?format=json&uid="+$S("uid")+"&sid="+$S("sid")+"&product=webmail&cmd=wrongContact";var x=JSON.stringify(y["var"]);var e={"var":x};$.Ajax.request({requestType:$.Ajax.XMLHTTP,method:$.Ajax.POST,url:z,rnd:false,body:e,call:y.callback})}function v(x){var y=this;var e={func:"ntes:mbox:getSubject",body:{url:x.url},call:x.callback,error:x.error};y.wmsvr(e)}})();(function(){try{var r=$L("module.compose.Compose");var a=$L("support.AddressSupport");var k=$L("support.SenderList")}catch(A){return A}var n=$.createClass($N("module.compose.ComposeAddress"));var D=$.Object;D.inherit(n,r);D.extend(n.prototype,{initialize:c,init:g,clear:i,setAddrPanel:w,getAddrPanel:u,getElement:l,searchMatch:E,searchCancel:t,resultMatch:x,resultCancel:b,match:m,refresh:C,fill:f,fillGroup:F,filterGroup:q,filterItem:G,render:z,renderResult:v,renderTree:h,renderGroup:s,renderItem:p,addGroup:B,addItem:o,addFast:d,adCompose:j,renderCommon:y});function c(H){var e=this;D.extend(e,{list:{add:null,content:null,tree:null,result:null}});n.superClass.initialize.call(e,H)}function g(){var e=this;var H=e.list;n.superClass.init.call(e);var I=e.base;H.content=I.get({id:"div$id$AddressContent"});H.tree=I.get({id:"div$id$AddressTree"});H.result=I.get({id:"div$id$AddressResult"});H.add=I.get({id:"a$id$AddressAdd"});H.add.listen("click",function(J){e.addFast();Log.cache({cl_add:"1"},$.EMPTYFUNC)});H.search=I.get({component:"search"});H.search.find("icon")[0].getEl().setAttr({title:"立即查找"});H.content.listen("click",function(J){Log.cache({cl_address:"1"},$.EMPTYFUNC)})}function i(){var e=this;var H=e.list;n.superClass.clear.call(H);n.superClass.clear.call(e)}function w(H){var e=this;var I=e.base;I.set({status:"addrPanel",value:H})}function u(){var e=this;var H=e.base;return H.get({status:"addrPanel"})}function l(I){var e=this;var H=e.list;return H[I]}function E(){var e=this;var L=e.getElement("search");var H=$.Event.getEvent();var I=H.keyCode;if(I==27){L.setValue("")}var J=$.String.trim(L.getValue());if(J){var K=L.find("icon")[0];K.update({type:"close",title:"取消"});e.resultMatch({key:J})}else{e.searchCancel()}}function t(){var e=this;if(e.getAddrPanel()!="result"){return}var I=e.getElement("search");var H=I.find("icon")[0];H.update({type:"search",title:"立即查找"});if($.String.trim(I.getValue())){I.setValue("");I.showPlaceholder()}e.resultCancel()}function x(M){M=M||{};var e=this;var H=e.match(M);var L;if(H.length){L=e.renderResult({item:H})}else{L=e.renderResult({item:null})}var K=e.getElement("result");var J=e.getElement("content");var I=e.getElement("tree");K.empty();J.setAttr({scrollTop:0});K.append(L.dom);if(e.getAddrPanel()!="result"){I.hide();K.show();e.setAddrPanel("result")}}function b(){var e=this;if(e.getAddrPanel()=="result"){var J=e.getElement("result");var I=e.getElement("content");var H=e.getElement("tree");J.hide();J.empty();I.setAttr({scrollTop:0});H.show();e.setAddrPanel("tree")}}function m(K){K=K||{};var J=K.key||"";var e=[];var I=new RegExp("("+J+")","i");var H='<b class="nui-txt-mark">$1</b>';$.Object.each(a.data.extDataMap.contactLite,function(V,Q){var N=false;var P=Q.name;var L=Q.email;var W=L.length;var S=$.String.encodeHTML(P);var T;var U;if(I.test(P)){U=S.replace(I,H);N=true}else{U=S}if(N){for(var O=0;O<W;O++){var M={id:Q[EMAIL_ID],yellowPage:Q.yellowPage,name:U};T=L[O];if(I.test(L[O])){M.address=T.replace(I,H)}var R=new Email(T,P);M.email=R;e.push(M)}throw $.CONTINUE}else{for(var O=0;O<W;O++){T=L[O];if(I.test(T)){var R=new Email(T,P);var M={id:Q[EMAIL_ID],yellowPage:Q.yellowPage,name:U,email:R,address:T.replace(I,H)};e.push(M);N=true}}if(N){throw $.CONTINUE}}});return e}function C(){var e=this;if(e.base.get({status:"initAddress"})==true){e.render("list")}}function f(){var e=this;e.render("list");e.setAddrPanel("tree","list")}function F(T){var O=this;if(T.item){var W=$.Element.create("UL");W.addClass("nui-tree");if(T.type=="spec"){$.Array.each(T.item,function(e,Y){W.append(O.renderItem(Y)["dom"])});T.element.append(W.dom)}else{var X=T.item.length;var J=[];for(var L=0;L<X;L++){var Q=T.item[L];var K="";if(Q.email){K=Q.email["defaultName"];var H="";if(Q.type&&Q.type=="vip"){H='<b class="nui-ico nui-ico-user nui-ico-user-vip"></b>'}var V='<li data-id="'+L+'" ><a href="javascript:void(0)" class="ch">'+H+$.String.encodeHTML(K);if(Q.yellowPage){V+='<b companyId="'+Q.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'}V+="</a></li>";J.push(V)}else{if(Q.emails){for(var I=0;I<Q.emails.length;I++){var H="";var S=Q.emails[I];var M=new Email(S,Q.name);K=M.defaultName;var V='<li data-id="'+L+'" data-sub="'+I+'"><a href="javascript:void(0)" class="ch">'+H+$.String.encodeHTML(K);if(Q.yellowPage){V+='<b companyId="'+Q.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'}V+="</a></li>";J.push(V)}}}}W.dom.innerHTML=J.join("");W.listen("click",function(Y){var ad=N(Y);if(ad!=undefined){if(ad.companyId){var aa="http://114.163.com/company/"+ad.companyId;window.open(aa);Log.cache({cl_yellowpage:"1"},$.EMPTYFUNC)}else{var e=ad.index;var ac=T.item[e];if(ad.sub!=undefined){var Z=ac.emails[ad.sub];var ae=new Email(Z,ac.name);var ab={email:ae};O.addItem(ab)}else{O.addItem(ac)}Log.cache({cl_group:"1"},$.EMPTYFUNC)}}});if(T.type!="common"){try{W.listen("contextmenu",function(Y){var ac=N(Y);if(ac!=undefined&&ac.index>=0){var e=ac.index;var ab=T.item[e];var Z=undefined;if(ac.sub!=undefined){Z=ab.emails[ac.sub]}var aa={groups:[{items:[{text:"编辑",click:function(){a.contactDialog({type:"modify",addr:{id:ab.id,email:Z},callback:function(){O.refresh()}})}},{text:"删除",click:function(){if(Z){a.deleteContactAttr({id:ab.id,type:"email",value:Z,call:function(){O.refresh()}})}else{a.deleteContact({contacts:[ab.id],call:function(){O.refresh()}})}}}]}],width:"120px"};$I("util.Contextmenu").show(aa)}})}catch(P){}}T.element.append(W.dom);var U=W.dom.getElementsByTagName("LI");var R=U.length;for(var L=0;L<R;L++){var Q=T.item[L]}}T.element.set("fill",true)}function N(aa){var Z=$.Event.getTarget(aa);if(Z.tagName.toUpperCase()=="B"){var ac=Z.getAttribute("companyId");if(ac!=undefined){return{companyId:ac}}Z=Z.parentNode.parentNode}if(Z.tagName.toUpperCase()=="A"){Z=Z.parentNode}if(Z.tagName.toUpperCase()=="LI"){var ab=Z.getAttribute("data-id");var ad=Z.getAttribute("data-sub");if(ab!=undefined){var e=parseInt(ab,10);var ae={index:e};if(ad!=undefined){var Y=parseInt(ad,10);ae.sub=Y}return ae}}return}}function q(e,L,K){var H=this;var J=null;if(e.N){var M=e.CONTACTS;if(M.length){var I=[];$.Array.each(M,function(O,N){var P=H.filterItem(N,L,K);if(P){I.push(P)}});if(I.length){J={id:e.id,name:e.N,item:I}}}}return J}function G(I,N,K){var M=null;if(N){M=K[N[I[EMAIL_ID]]]}else{var L=null;var H=I[EMAIL_ID];if(H){var e=a.data.extDataMap.contactLite[H];if(e&&e.email&&e.email.length){var J=e.email;M={id:I[EMAIL_ID],yellowPage:e.yellowPage};if(J.length==1){M.email=new Email(J[0],e.name)}else{if(J.length>1){M.emails=J;M.name=e.name}}}}else{L=I[EMAIL_ADDRESS];M={email:new Email(L)}}if(L&&M&&Email.checkVip(L)){M.type="vip"}}return M}function z(H){var O=this;var R={};R.group=[];if(H=="list"){var M=[];var Q={type:"spec",item:M};var K=O.adCompose();if(K.length){M.push.apply(M,K)}M.push({type:"me",name:"给自己写一封信",email:new Email(k.getAccount()["address"],"我")});R.group.push(Q)}var S=a.data.extDataMap.groupArray||[];var J=[];try{J=S[0]["CONTACTS"]}catch(P){}var N={type:"all",name:(J.length?"所有":"所有联系人"),nameTitle:"所有联系人",sumTitle:"添加所有联系人",item:[]};var L={};$.Array.each(J,function(T,e){var U=O.filterItem(e);if(U){N.item.push(U);L[U.id]=N.item.length-1}});if(N.item.length>500){N.fold=true}$.Array.each(S,function(T,e){if(T==0){throw $.CONTINUE}var U=O.filterGroup(e,L,N.item);if(U){U.fold=true;U.sumTitle="添加该组联系人";R.group.push(U)}});R.group[R.group.length-1]["hasLine"]=true;R.group.push(N);var I=O.getElement("tree",H);I.empty();I.append(O.renderTree(R)["dom"]);a.getRecentContact({call:$.Function.bind(O.renderCommon,O)})}function v(J){var I=this;var H=$.Element.create("DIV");if(J.item&&J.item.length){var e=$.Element.create("DIV");e.addClass("nui-assistBlock nui-block Q");e.html("搜索到<strong>"+J.item.length+'</strong>个联系人&nbsp;[<a href="javascript:void(0)" class="nui-txt-link">全部添加</a>]');$.Event.live({context:e,selector:"A",event:"click",handler:function(){I.addGroup(J)}});H.append(e.dom);$.Array.each(J.item,function(L,O){var M=$.Element.create("A");M.addClass("J");M.setAttr({href:"javascript:void(0)",title:O.email.toString()});I.module.live(M,"click",function(Q){I.addItem(O)});var K=$.Element.create("STRONG");K.addClass("nui-tree-item-text");var N=(O.name||O.email["name"]);if(O.yellowPage){N+='<b companyId="'+O.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'}K.html(N);if(O.yellowPage){$(K.dom.lastChild).listen("click",function(R){var Q=$.Event.getTarget(R);var S=Q.getAttribute("companyId");if(S!=undefined){window.open("http://114.163.com/company/"+S);Log.cache({cl_yellowpage:"1"},$.EMPTYFUNC);$.Event.stop(R)}})}var P=$.Element.create("P");P.addClass("nui-tree-item-text");P.html((O.address||O.email["address"]));M.append(K.dom);M.append(P.dom);H.append(M.dom)})}else{var e=$.Element.create("DIV");e.addClass("nui-assistBlock nui-block Q");e.html('没有符合条件的联系人 [<a href="javascript:void(0)" class="back txt-link">返回</a>]');e.find("A").listen("click",function(K){I.searchCancel();$.Event.cancel(K)});H.append(e.dom)}return H}function h(I){var H=this;var e=$.Element.create("DIV");if(I.group){$.Array.each(I.group,function(J,K){e.append(H.renderGroup(K)["dom"]);if(K.hasLine){var L=$.Element.create("DIV");L.setClass("nui-split nui-split-dotted");e.append(L.dom)}})}return e}function s(L){var J=this;var M=L.element=$.Element.create("DIV");M.addClass("nui-tree-item");if(L.type=="spec"){M.addClass("nui-tree-item-spec")}else{var e=$.Element.create("SPAN");e.addClass("nui-tree-item-label");if(L.name){M.set("foldText","折叠");M.set("unfoldText","展开");var N=$.Element.create("A");N.addClass("g-contacts-groups-name");N.setAttr({href:"javascript:void(0)"});var P=$.Element.create("SPAN");P.addClass("nui-tree-item-symbol");e.listen("click",function(){var S=!M.get("fold");var R=M.get(S?"unfoldText":"foldText");var Q="nui-tree-item nui-tree-item-isFold";var T="nui-tree-item nui-tree-item-isUnfold";if(S){M.setClass(Q)}else{if(M.get("fill")!=true){J.fillGroup(L)}M.setClass(T)}N.setAttr({title:R});M.set("fold",S)});e.append(P.dom);new $.Icon({type:"rArr",title:"展开",extcls:"nui-tree-item-symbol-fold",renderTo:P.dom});new $.Icon({type:"dArr",title:"折叠",extcls:"nui-tree-item-symbol-unfold",renderTo:P.dom});var I=L.name.substr(0,7);if(I!=L.name){I+=".."}I=$.String.encodeHTML(I);I+="("+L.item.length+")";var H=$.Element.create("span");H.setAttr({title:L.nameTitle||L.name});H.setClass("nui-tree-item-text");H.html(I);e.append(H.dom)}if(L.item){var O=null;var K="nui-tree-item-label-hover";e.listen("mouseover",function(){e.addClass(K);if(O){O.show()}else{O=$.Element.create("A");O.addClass("nui-tree-item-ext nui-txt-link");O.setAttr({href:"javascript:void(0)"});O.html("添加该组");O.listen("click",function(Q){J.addGroup(L);$.Event.stop(Q)});e.append(O.dom)}});e.listen("mouseout",function(){e.removeClass(K);if(O){O.hide()}})}M.append(e.dom)}if(L.fold){M.addClass("nui-tree-item-isFold");M.set("fold",true)}else{if(L.type!="spec"){M.addClass("nui-tree-item-isUnfold")}M.set("fold",false);J.fillGroup(L)}return M}function p(N){var I=this;var e=$.Element.create("LI");e.addClass("nui-tree-item nui-tree-item-noChild");var J=$.Element.create("A");J.addClass("ch");J.setAttr({href:"javascript:void(0)"});if(N.click){J.listen("click",N.click)}else{J.listen("click",function(){I.addItem(N);if(N.type=="me"){Log.cache({cl_me:"1"},$.EMPTYFUNC)}})}if(N.type){var L=$.Element.create("SPAN");L.addClass("nui-tree-item-icon");var K=$.Element.create("B");K.addClass("nui-ico");switch(N.type){case"other":K.addClass("nui-ico-user nui-ico-user-other");break;case"me":K.addClass("nui-ico-user nui-ico-user-me");break;default:K.setClass(N.type);break}L.append(K.dom);J.append(L.dom)}var M="";var H="";if(N.email){M=N.email["defaultName"];H=N.email.toString()}if(N.name){M=N.name}if(M){if(!H){H=M}J.append(document.createTextNode(M))}if(N.title){H=N.title}if(H){J.setAttr({title:H})}e.append(J.dom);return e}function B(I){var e=this;var H=[];$.Array.each(I.item,function(J,M){if(M.emails){var O=M.emails;for(var K=0;K<O.length;K++){var L=O[K];var N=new Email(L,M.name);H.push(N)}}else{H.push(M.email)}});e.addItem({email:H})}function o(H){var e=this;e.form.addContact(H.email);e.form.focus()}function d(){var e=this;a.contactDialog({type:"add",callback:function(){e.refresh()}})}function j(){var H=[];try{H=fAdComposeAddressLink()}catch(I){}$.Array.each(H,function(e,J){J.border=true;if(!J.type){J.type="other"}});return H}function y(L){var I=this;if(L&&L.length){var H={N:"常用联系人",CONTACTS:L};var K=I.filterGroup(H);if(K){K.fold=true;K.type="common";K.sumTitle="添加该组联系人";var J=I.getElement("tree");var e=$(J.dom.firstChild.firstChild);if(!e.get("commonLoad")){e.set("commonLoad",true);e.after(I.renderGroup(K)["dom"])}}}}})();(function(){try{var f=$L("module.compose.Compose");var aJ=$L("support.MailAssist");var y=$L("util.Icon")}catch(ad){return ad}var aW=$.createClass($N("module.compose.ComposeAttach"));var aF=$.Object;aF.inherit(aW,f);aF.extend(aW,{cloud:{},file:{cid:"",sid:"",mid:"",fid:"",eid:"",icon:"",cloud:false,context:false,type:"",mime:"",url:"",download:"",link:null,size:0,path:"",md5:"",modtime:null,useSplit:false,skipSplit:false,offset:0,lastOffset:0,length:0,fileExist:0,pathExist:false,name:"",nameExist:false,percent:-1,bytesHashed:-1,bytesLoaded:-1,retry:0,ext:"",extLimit:false,state:"",err:"",blob:null,digest:null,speed:null,inlined:false,mixed:false,media:false,lock:false,ret:null,options:null,"delete":null,ui:null},errDescription:{extension:"文件类型受限",empty:"文件内容为空",limit:"文件大小超过限制",quota:"文件大小超过总限制",limitBig:"文件大小超过云附件限制",quotaBig:"文件大小超过云附件总限制","2038":"文件I/O错误"},filter:[{description:"所有文件 (*.*)",extension:"*.*","default":true},{description:"图片文件 (*.jpg;*.gif;*.png;*.bmp)",extension:"*.jpg;*.gif;*.png;*.bmp"},{description:"文档文件 (*.pdf;*.doc;*.xls;*.txt)",extension:"*.pdf;*.doc;*.xls;*.txt"},{description:"网页文件 (*.mht;*.htm;*.html)",extension:"*.mht;*.htm;*.html"}],filterImage:[{description:"图片文件 (*.jpg;*.gif;*.png;*.bmp)",extension:"*.jpg;*.gif;*.png;*.bmp","default":true}],sliceLength:192*1024,sliceTime:120*1000,symbol:String.fromCharCode(92)+String.fromCharCode(92)});aF.extend(aW.prototype,{initialize:ak,init:h,clear:ag,destroy:aA,browseInit:O,subInit:au,sourceGet:a0,layout:ar,set:ab,setState:aS,setInfo:D,setStart:o,setFinish:V,setLock:aN,setBytes:a3,setHash:al,setSpeed:k,setProgress:t,setTotalProgress:aO,get:aP,getCheck:am,getUploadHost:aL,getUploadUrl:J,getUploadProxy:Q,getPreview:i,skipUploadHost:b,fileCreate:ai,fileCount:c,fileGet:aX,fileAdd:K,fileDelete:z,fileHas:af,fileSize:M,fileAutoUpload:v,fileAutoHash:x,filterCheck:s,fileProgress:P,complete:aC,fileIsUpload:aG,fileIsPost:U,fileIsError:az,add:F,resum:aR,remove:Y,setAuto:aj,setInsert:I,setTips:j,commonTips:H,inlineInsert:A,inlineRemove:G,inlineGet:aV,inlineSync:aE,inlinedProgress:av,inlinedError:C,storageAdd:l,validLocal:q,validServer:N,check:u,error:aq,netCheckSet:at,netCheckFire:aM,netCheckClear:E,cancelAutoSend:ao,moveGet:ay,movePrepare:a2,moveCloud:S,moveComplete:aT,moveReplace:aZ,moveSize:r,cloudTrigger:aw,cloudRename:aQ,cloudManage:aK,cloudConvert:ap,cloudAutoTips:aY,cloudShowSize:aI,msg:Z,cloudMsg:W,netfolderMsg:T,internalMsg:L,ynoteMsg:ae,bigMsg:ah,netfolderAdd:B,internalAdd:w,ynoteAdd:a,avMailAdd:aD,netfolderStructure:d,netfolderCallBack:g,linkAdd:a4,linkParse:a1,linkHtml:aU,linkIcon:n,stationeryHas:a8,stationeryGet:R,stationeryClear:ax,stationerySync:aH,stationeryStruct:m,photoOpen:ac,photoCallBack:aB,photoGetUrl:X,cardHas:an,cardGet:a5,cardSync:a7,cardStructure:aa});aF.extend(aW,{getSize:a6,getRemain:p});function ak(a9){var e=this;aW.superClass.initialize.call(e,a9)}function h(){var a9=this;aW.superClass.init.call(a9);var e=a9.sourceGet("element");var ba=a9.base;e.link=ba.get({id:"a$id$AttachAdd"});e.browseContainer=ba.get({id:"div$id$AttachBrowse"});e.flashContainer=e.browseContainer;e.operate=ba.get({id:"div$id$AttachOperate"});e.area=ba.get({id:"div$id$AttachArea"});e.info=ba.get({id:"div$id$AttachInfo"});e.content=ba.get({id:"div$id$AttachContent"});e.progress=ba.get({id:"div$id$AttachProgress"})}function ag(){var e=this;aW.superClass.clear.call(e)}function aA(){var a9=this;if(a9.postStop){a9.postStop()}var e=a9.fileGet();$.Array.each(e,function(ba,bb){if(typeof bb["delete"]=="function"){bb["delete"]()}if(bb.cloud&&bb.state=="upload"){if(bb.ret&&bb.ret["oid"]){$.Ajax.jsonp(a9.getUploadProxy({type:"script",file:bb,cancel:true}),function(){})}}})}function O(){var bg=this;var be=bg.base;if(be.get({status:"uploadMode"})=="super"){try{if(!$S("isCrop")){$E("support.CloudSupport",function(bi){bi.init()})}var bd=false;var bf=false;var bb=$.Browser.getVersion()||[0,0];var bh=$.Browser.getInfo();var a9=navigator.userAgent;var ba=false;if((/maxthon|qqbrowser/i).test(a9)){ba=true}if($.Browser.ie()){if(bb[0]>=6){bf=true}}else{bf=true}if(bf){if(aJ.has()&&aJ.hasNewVersion()){return bg.subInit("plugin")}}if(ba){}else{if($.Browser.chrome()){if(bb[0]>=10){bd=true}if(bh.shell=="sogou"&&bb[0]<17){}}else{if($.Browser.firefox()){if(bb[0]>=4){bd=true}}else{if($.Browser.opera()){if(bb[0]>=11){}}else{if($.Browser.safari()){if((bb[0]==5&&bb[1]>=1)||bb[0]>=6){bd=true}}}}}}if(bd){return bg.subInit("native")}else{if(bh.hasFlash){return bg.subInit("flash")}}}catch(bc){var e={code:"FA_AGENT_ERROR",reason:bc,size:0,name:1,retry:0};Log.record("attach",e)}}return bg.subInit("post")}function au(be){var a9=this;var ba=a9.module;var bd="";switch(be){case"plugin":bd="ComposePlugin";break;case"native":bd="ComposeNative";break;case"flash":bd="ComposeFlash";break;case"post":bd="ComposePost";break}bd="module.compose."+bd;$E([bd],function(bg){try{var bf=new bg(ba);ba[be]=bf;bf.init();bf.browseInit();$.Array.each(aW.superClass.names,function(bi,bj){a9[bj]["attach"]=bf});ba.attach=bf}catch(bh){}});if(be=="flash"){var bc=a9.base;var e=a9.sourceGet("element");var bb=e.link;if($.Browser.ie()){window.setTimeout(function(){bb.listen("click",function(bf){a9.subInit("post");a9.commonTips({common:true,plugin:true,text:"Flash无法加载，建议你再次点击“上传”或使用邮箱助手上传附件，立即"});e.area.show();$.Event.cancel(bf)})},2*1000);window.setTimeout(function(){try{var bf=bc.get({status:"uploadMode"});if(bf!="flash"){a9.subInit("post");a9.commonTips({common:true,plugin:true,text:"Flash无法加载，已切换到普通上传模式，建议你使用邮箱助手上传附件，立即"});var bg=a9.sourceGet("element");bg.area.show()}}catch(bh){}},5*1000)}}if(be!="plugin"){var e=a9.sourceGet("element");e.browseContainer.listen("mouseover",function(){e.link.addClass("nui-txt-link-focus")});e.browseContainer.listen("mouseout",function(){e.link.removeClass("nui-txt-link-focus")})}}function a0(bb){var e=this;var ba=e.base;var a9=ba.attachments;return a9[bb]}function ar(){var bk=this;var ba=bk.sourceGet("element");var bj=bk.sourceGet("layout");var bb=ba.operate;var be=ba.content;var bi=bb.dom.clientWidth-10;if(bj.baseWidth&&bj.baseWidth==bi){return}bj.baseWidth=bi;var bf=bi+8;var bl=bi+bj.spaceWidth;be.setStyle({width:bf+"px"});var a9=bj.attachWidth+bj.spaceWidth;var bd=Math.floor(bl/a9)||1;var bh=bl%a9;var bc=Math.floor(bh/bd);var bg=bj.attachWidth+bc;bj.blockWidth=bg;var e=bk.fileGet();$.Array.each(e,function(bm,bo){var bn=bo.ui["container"];bn.setStyle({width:bg+"px"})})}function ab(ba){ba=ba||{};var a9=this;var e=ba.value;if(typeof ba.status=="string"){a9.sourceGet("status")[ba.status]=e}else{if(typeof ba.element=="string"){a9.sourceGet("element")[ba.element]=e}}}function aP(a9){a9=a9||{};var e=this;if(typeof a9.status=="string"){return e.sourceGet("status")[a9.status]}else{if(typeof a9.element=="string"){return e.sourceGet("element")[a9.element]}else{if(a9.count){return e.fileCount()}else{if(a9.file){return e.fileGet(a9.file)}}}}}function aS(bl,ba,bd){var bk=this;bl.state=ba;if(bl.ui){var bc=false;var bb=false;var bh=false;var bi="";var bf=null;var bg=$.Number.convert(bl.size)+" ";if(bl.cloud){switch(bl.state){case"select":bi="待扫描，请稍候...";break;case"hash":if(bl.percent==-1){bi="扫描中，请稍候..."}else{bi="扫描中，已完成"+bl.percent+"%"}break;case"hashover":bi="扫描完毕，开始上传";break;case"wait":if(bl.fid==""){bi="待上传，请稍候..."}else{bi="待续传，请稍候..."}break;case"upload":if(bl.bytesLoaded==-1){if(bl.fid==""){bi="正在上传..."}else{bi="正在续传..."}bk.cloudRename(bl)}else{ba="percent";var a9=bl.speed;var bj=aW.getSize(bl.bytesLoaded,2);var be=aW.getSize(a9.second,2)+"/S";var e=aW.getRemain(a9.remain);bf={uploaded:bj,speed:be,remain:e}}break;case"pause":break;case"error":bc=true;bi=bd||bl.err;break;case"success":bc=true;bb=true;bh=true;bk.cloudRename(bl);bi=bg+"上传完成";break;case"link":switch(bl.fileExist){case 1:bi=bg+'<span class="nui-txt-suc">续传完成</span>';break;case 2:bi=bg+'<span class="nui-txt-suc">已存在此文件，快速上传完成</span>';break;default:bi=bg+'<span class="nui-txt-suc">上传完成</span>';break}break;default:return;break}}else{switch(ba){case"link":bi=bg+"上传完成";break;case"error":bc=true;bi=bd||bl.err;break;case"success":bc=true;bb=true;bi=bg+'<span class="nui-txt-suc">上传完成</span>';break;case"select":case"wait":bi="待上传，请稍候...";if(bl.type=="form"){bi="您选择的附件将在点击发送后进行上传"}break;case"upload":if(bl.bytesLoaded==-1){bi="正在上传..."}else{ba="percent";var a9=bl.speed;var bj=aW.getSize(bl.bytesLoaded,2);var be=aW.getSize(a9.second,2)+"/S";var e=aW.getRemain(a9.remain);bf={uploaded:bj,speed:be,remain:e}}break;case"hash":if(bl.percent&&bl.percent==-1){bi="扫描中，请稍候..."}else{bi="扫描中，已完成"+bl.percent+"%"}break;case"fast":bi="快速上传中...";break;default:return;break}}bk.setInfo(bl,ba,bi,bf);if(ba=="error"){bk.setTotalProgress()}if(bb){if(typeof bl["delete"]=="function"){bl["delete"]()}}if(bc){bk.fileAutoUpload()}if(bh){bk.cloudConvert(bl)}}}function D(bk,e,a9,bb){e=e||"text";var bl=bk.ui;if(bl){var ba=bl.info;var bg=bl.tips;var bi=bk.ui["container"];var bd="p";if(e=="percent"){var bf=bk.percent+"%";var be=bf;var bj="";if(bb&&bb.remain){be+=",剩余时间:"+bb.remain;var bc=$.Number.convert(bk.size);bj=bk.name+", 文件大小:"+bc+", 已上传"+bb.uploaded+", 上传速度:"+bb.speed}var bh='<div class="nui-progress"><span class="nui-progress-bar"><span class="nui-progress-bar-inner" style="width:'+bf+';"></span></span><span class="nui-progress-text">'+be+"</span></div>";if(bf){ba.html(bh)}if(bj){bg.html(bj)}}else{if(e=="error"){bi.addClass(bd);if(a9){ba.html(a9)}if(bb&&bb.text){bg.html(bb.text)}else{bg.html("");bg.hide()}}else{if(e=="resum"){bi.removeClass(bd)}else{if(a9){ba.html(a9)}if(e=="success"){bg.html("");bg.hide()}}}}}}function o(a9){var e=this;if(a9.offset==0){e.setProgress(a9,0)}else{}}function V(ba){var e=this;var a9=false;if(ba.length==0){a9=true}else{if(ba.offset+ba.length==ba.size){a9=true}else{}}if(a9){e.setLock(ba,true);e.setProgress(ba,99)}}function aN(ba,a9){var e=this;if(ba){if(typeof ba.lock=="boolean"){ba.lock=a9}else{var bb=ba;$.Array.each(e.fileGet(bb),function(bc,bd){e.setLock(bd,a9)})}}}function a3(bd,ba,a9){var bb=this;var e=bd.size;var bc;var be=ba;if(bd.length==0){if(a9>e){bc=Math.floor((ba/a9)*100);be=Math.floor(e*(bc/100))}else{}}else{be+=bd.offset}bd.bytesLoaded=be;bc=Math.floor((be/e)*100);if(bc>98){bc=98}bb.setProgress(bd,bc)}function al(ba,bb,bc){var e=this;ba.bytesHashed=bb;if(bc){if(bc!="-1"){ba.md5=bc.toLowerCase()}ba.percent=-1;e.setState(ba,"wait");e.fileAutoUpload()}else{var a9=Math.floor((bb/ba.size)*100);if(ba.percent==a9){return}else{ba.percent=a9;e.setState(ba,"hash")}}}function k(bc){var bb=(new Date()).valueOf();var e=bc.speed;if(e){var bd=bb-e.time;if(bd>0){var ba=bc.bytesLoaded;if(ba>0){var a9=Math.round((ba-e.bytes)/(bd/1000));if(a9>0){e.bytes=ba;e.second=a9;e.remain=parseInt((bc.size-ba)/a9)+1}}}}else{e=bc.speed={bytes:0,second:0,remain:-1}}e.time=bb}function t(bb,ba){var a9=this;if(bb.percent==ba){var e=bb.speed;if(e){if(((new Date()).valueOf()-e.time)<=1000){return}}else{return}}else{bb.percent=ba}a9.setSpeed(bb);switch(ba){case 0:a9.setState(bb,"upload");break;case 100:a9.setState(bb,"success");break;default:a9.setState(bb,"upload");break}if(Ext.newAttach&&bb.inlined){a9.inlinedProgress()}else{a9.setTotalProgress()}}function aO(){var bd=this;var bb=bd.sourceGet("element");var e=bb.progress;var a9=bd.fileProgress();var be=a9.percent;var ba=a9.bytesLoaded;var bc=a9.bytesTotal;if(bd.get({status:"totalBytes"})==bc&&bd.get({status:"totalPercent"})==be){}else{if(be){var bf="("+be+"%,已上传"+$.Number.convert(ba)+",总文件大小"+$.Number.convert(bc)+")";e.show();e.html(bf)}else{e.hide()}bd.set({status:"totalBytes",value:bc});bd.set({status:"totalPercent",value:be})}}function am(a9){var e=this;var ba=false;if(e.getUploadHost()){if(a9.inlined){}else{if(a9.cloud){if(a9.md5){e.setInfo(a9,"","正在尝试速传，请稍候...")}else{e.setInfo(a9,"","正在检查容量，请稍候...")}ba=true}else{if(a9.md5){e.setState(a9,"fast");ba=true}else{if(a9.sid){ba=true}else{}}}}}if(ba){e.setLock(a9,true);e.setState(a9,"upload")}return ba}function aL(){var e="";if($S("isCorp")){return e}var a9=$S("uploadProxy");if(a9&&a9.length){e=a9[0]}return e}function J(bc){var a9=this;var bb=bc.type;var ba=Uri.getUrl("compose_upload_url",true);ba+="&composeId="+a9.info.get({cid:true});ba+="&type="+bb;if(bb=="flash"){if(false&&$.Browser.ie()){}else{var e=$.Cookie.get("Coremail",true);if(encodeURIComponent){e=encodeURIComponent(e)}else{e=escape(e)}ba+="&Cookie.Coremail="+e}}return ba}function Q(a9){var bg=this;var ba=a9.type;var bi=a9.file;var bj="get";if(a9.options){bj=a9.options}var be={};var bc=bg.getUploadHost();if(bc==""){bc=$S("orgHost")}var e="http://"+bc;e+="/upxmail/upload";e+="?sid="+$S("sid");e+="&uid="+$S("orgUid");e+="&cid="+bg.info.get({cid:true});e+="&host="+$S("orgHost");e+="&ver=js5";e+="&agent="+ba;if(ba=="script"){}else{be.cmc=$.Cookie.get("Coremail",true);be.urs=$S("ursCookie")}if(bi){if(bi.cloud){be.type=1}else{be.type=0}be.name=bi.name;be.size=bi.size;if(bi.path){be.path=bi.path}if(bi.md5){be.md5=bi.md5}if(bi.modtime){be.modtime=bi.modtime}if(bi.ret){aF.each(bi.ret,function(bk,bl){be[bk]=bl})}if(a9.check){if(bi.cloud){e+="&chk=true";var bf=bg.moveSize();if(bf>0){be.xsize=bf}}else{e+="&qry=true"}}else{if(a9.cancel){e+="&cal=true"}else{if(bi.offset){be.offset=bi.offset}if(bi.length){be.length=bi.length}if(bi.inlined){}}}}else{if(a9.move){e+="&mov=true"}if(a9.aid){be.aid=a9.aid.join("|")}if(typeof a9.size=="number"){be.size=a9.size}}aF.each(be,function(bk,bl){if(typeof bl!="string"){be[bk]=new String(bl).valueOf()}});switch(bj){case"body":var bh="";var bb=[];aF.each(be,function(bk,bl){bb.push(bk+"="+encodeURIComponent(bl))});if(bb.length){bh=bb.join("&")}bi.options=bh;break;case"form":bi.options=be;break;case"header":var bd={};aF.each(be,function(bk,bl){bd["Mail-Upload-"+bk]=encodeURIComponent(bl)});bi.options=bd;break;default:aF.each(be,function(bk,bl){e+=["&",bk,"=",encodeURIComponent(bl)].join("")});if(ba=="script"){}else{e+="&t="+(new Date()).valueOf()}if(bi){bi.options=null}break}return e}function i(){var e=this;var a9=[];$.Array.each(e.fileGet(),function(bb,bc){if(bc.state=="success"||bc.state=="link"){var ba={name:bc.name,icon:bc.icon};a9.push(ba)}});return a9}function b(){var e=$S("uploadProxy");if(e&&e.length){e.shift()}}function ai(ba){ba=ba||{};var bh=this;var bi={};var e=ba.type;var bd=ba.path;var be=ba.name;var bf=ba.mime;var bg=ba.size;var bb=ba.sid;var a9=ba.eid;aF.extend(bi,aW.file);if(e){bi.type=e}if(bd){bi.path=bd;if(!be){be=bd.replace(new RegExp(".*"+aW.symbol),"")}if(bh.fileGet({path:bd}).length>=1){bi.pathExist=true}}else{if(be){be=be.replace(new RegExp(".*"+aW.symbol),"")}}if(be){bi.name=be;bi.icon=y.getSubtype({type:"file32",name:be});var bj=be.split(".");if(bj.length>1){var bc=bj.pop();if(bc){bc=bc.toLowerCase();bi.ext=bc;if(EXTLIMIT.indexOf("."+bc+".")!=-1){bi.extLimit=true}}}}if(bf){bi.mime=bf}if(typeof bg=="number"){bi.size=bg;if(e=="storage"){bi.bytesLoaded=bg}}if(bb){bi.sid=bb}if(a9){bi.eid=a9}if(ba.cloud){bi.cloud=ba.cloud}return bi}function c(a9){var e=this;if(a9){return e.fileGet(a9).length}else{return aF.count(e.sourceGet("files"))}}function aX(bb){bb=bb||{};var a9=this;var e=[];var ba=a9.sourceGet("files");aF.each(ba,function(bd,be){var bc=true;aF.each(bb,function(bf,bg){if(be[bf]!=bg){bc=false}});if(bc){e.push(be)}});return e}function K(bb){var a9=this;var e=a9.get({status:"fileIndex"});var ba=a9.sourceGet("files");bb.cid="order_"+e++;a9.set({status:"fileIndex",value:e});ba[bb.cid]=bb}function z(bb,ba){var a9=this;var e="";if(typeof bb=="string"){e=bb}else{if(typeof bb=="object"){e=bb.cid}}var ba=a9.sourceGet("files");if(e){if(bb=ba[e]){delete ba[e];bb.cid="";return true}else{return false}}else{return false}}function af(ba){var a9=this;var e=false;if(a9.fileCount(ba)>0){e=true}return e}function M(bb){var ba=this;var e=0;var a9=ba.fileGet(bb);$.Array.each(a9,function(bc,bd){if(bd.size>0){e+=bd.size}});return e}function v(bc){var bb=this;var bd=bb.base;var a9=null;var ba=true;if(!bc){a9=bb.fileGet({state:"upload"});if(a9.length==0){a9=bb.fileGet({state:"wait"});if(a9.length==0){if(bd.runSequence("attachMove")){}}}}a9=bb.fileGet({type:"flash",state:"upload"},bc);if(a9.length==0){a9=bb.fileGet({type:"flash",state:"wait"},bc);if(a9.length){bb.flashCheckFile(a9[0]);ba=false}}else{ba=false}a9=bb.fileGet({type:"plugin",state:"upload"},bc);if(a9.length==0){a9=bb.fileGet({type:"plugin",state:"wait"},bc);if(a9.length){bb.pluginCheck(a9[0]);ba=false}}else{ba=false}a9=bb.fileGet({type:"native",state:"upload"},bc);if(a9.length==0){a9=bb.fileGet({type:"native",state:"wait"},bc);if(a9.length){bb.nativeCheck(a9[0]);ba=false}}else{ba=false}if(bb.fileAutoHash(bc)){ba=false}var e=!ba;if(e){}else{if(ba){if(bd){bd.runSequence("uploadResult",0)}}}return e}function x(bb){var ba=this;var e=null;var a9=false;e=ba.fileGet({type:"plugin",state:"hash"},bb);if(e.length==0){e=ba.fileGet({type:"plugin",state:"select"},bb);if(e.length){ba.pluginHash(e[0]);a9=true}}else{a9=true}return a9}function s(bk){var ba=this;var bu=bk.files;var bi=bk.submit;var bD=bk.cancel;var bb=$S("attachSize")*1024*1024;if($S("isVip")){bb=50*1024*1024}var bh=ba.fileSize();if($S("isCorp")){bh=ba.fileSize({cloud:false})}var e=ba.fileSize({context:true});var bH=0;var bm=bb-bh;var bp=0;var by=0;var bj=0;var bx=0;var be=0;var a9=true;var bB=true;var bF=false;var bs=false;if($S("cloud")&&ba.getUploadHost()){bp=$S("cloud")["fileSizeLimit"];by=$S("cloud")["capacity"];bj=by;bx=$S("cloud")["duration"]}$.Array.each(bu,function(bL,bN){if(bN.err){}else{if(bN.extLimit){bN.err="extension"}else{if(bN.size==0){bN.err="empty"}else{if(bp>0&&bN.size>bp){bN.err="limitBig"}else{if(bj>0&&bN.size+be>bj){bN.err="quotaBig"}else{if(ba.cloudTrigger()){}else{if(bN.size>bm){bN.err="limit"}else{if(bN.size+be>bm){bN.err="quota"}}}}}}}}if(bN.err){if(bN.err=="limit"||bN.err=="quota"){if(bx){bN.err="";bF=true}else{try{var bM=$S("cloud")?"1":"0";var bJ=ba.getUploadHost()?"1":"0";var bK={code:"CLOUD_ERROR",cloud:bM,host:bJ};Log.record("attach",bK)}catch(bO){}if(!$S("isCrop")){$E("support.CloudSupport",function(bP){bP.init()})}}}}if(bN.err){a9=false}else{bB=false;be+=bN.size;if(bN.inlined){bH+=bN.size}}});if(e+bH>bb){$.Msgbox.show({header:"附件上传提示",icon:"err",content:"添加的图片总大小不能超过"+$.Number.convert(bb)});return}if(bF){ba.set({status:"confirmSize",value:true});ba.cloudTrigger(true);ba.movePrepare(be);ba.filterCheck(bk);ba.cloudAutoTips();ba.commonTips({common:true,upload:true,mode:1});bs=true}if(ba.cloudTrigger()){}else{var bo=be+bh-e-bH;if(!$S("isCorp")&&bo>20*1024*1024&&!bs&&!ba.get({status:"confirmSize"})){var bl=Ud.get({field:"ntes_compose",flag:"upload_mode"});var bI=parseInt(bl);var bv=false;if(bl=="0"){var bC=ba.base;var bg=ba.form;var bn=[];var bE=[];if(bC.get({status:"useSeparate"})){bE[0]="separate"}else{bE=["to","cc","bcc"]}$.Array.each(bE,function(bK,bL){var bJ=bg.getContact("suc",bL);bn=bn.concat(bJ)});if(bn.length==0){bv=true}else{var bc=["qq.com","vip.qq.com","163.com","126.com","yeah.net","vip.163.com","vip.126.com","188.com","vip.188.com"];$.Array.each(bn,function(bK,bL){var bJ=bL.domain.toLowerCase();if(!$.Array.has(bc,bJ)){bv=true;throw $.BREAK}})}if(!bv){bI=2}}else{if(bl=="1"){bv=true}}if(bv){ba.set({status:"confirmSize",value:true});ba.cloudTrigger(true);ba.movePrepare(be);ba.filterCheck(bk);bs=true}ba.commonTips({common:true,upload:true,mode:bI})}}if(bs){return}if(a9){bi({ignore:null,select:bu})}else{if(bB){var bG="<h4>您选择的文件不能上传，原因如下：</h4>";$.Array.each(bu,function(bJ,bK){var bL=bK.name;if($.String.len(bL)>22){bL=$.String.left(bL,18)}var bM=bK.err;if(aW.errDescription[bM]){bM=aW.errDescription[bM]}bG+='<p><span title="'+bK.name+'">'+bL+'</span><span class="nui-txt-impt">('+bM+")</span></p>"});$.Msgbox.show({title:"附件上传提示",icon:"err",content:bG});bD()}else{var bd=[];var bf=[];var bt=false;if(ba.cloudTrigger()){bm=bj}bu=bu.sort(function(bK,bJ){return bJ.size-bK.size});$.Array.each(bu,function(bJ,bK){var bL=bK.name;if($.String.len(bL)>28){bL=$.String.left(bL,24)}if(bK.err=="limit"||bK.err=="quota"||bK.err=="limitBig"||bK.err=="quotaBig"){bt=true;if(bK.err=="quota"||bK.err=="quotaBig"){bK.err="";be+=bK.size}}if(bK.err){var bM=bK.err;if(aW.errDescription[bM]){bM=aW.errDescription[bM]}bf[bf.length]='<tr class="nui-table-row nui-table-row-disabled"><td class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input disabled="disabled" class="nui-chk-symbol" type="checkbox"/></label></td><td class="nui-table-cell H"><b class="nui-ico nui-ico-att"></b></td><td class="nui-table-cell r"><span title="'+bK.name+'">'+bL+'</span><span class="nui-txt-impt" title="'+bM+'">('+bM+')</span></td><td class="nui-table-cell D">'+$.Number.convert(bK.size)+"</td></tr>"}else{bd[bd.length]='<tr class="nui-table-row nui-table-row-selected"><td class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input value="'+bJ+'" checked="checked" class="nui-chk-symbol" type="checkbox"/></label></td><td class="nui-table-cell H"><b class="nui-ico nui-ico-att"></</td><td class="nui-table-cell r"><span title="'+bK.name+'">'+bK.name+'</span></td><td class="nui-table-cell D">'+$.Number.convert(bK.size)+"</td></tr>"}});var bA="您选择的部分附件由于以下原因，不能上传";if(bt){bA="本次选择的附件大小不能超过"+$.Number.convert(bm);if(ba.cloudTrigger()){}else{if(bb==bm){bA="您选择的附件总额不能超过"+$.Number.convert(bb)}}}var bG='<div class="nui-simpleTable nui-table U"><table><thead class="nui-table-head"><tr class="nui-table-row"><th class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input id="objMsgSelectAll" class="nui-chk-symbol" type="checkbox"/></label></th><th class="nui-table-cell q">文件名</th><th class="nui-table-cell z">大小</th></tr></thead></table></div><div class="Z" style="overflow-y:scroll"><div class="nui-simpleTable nui-table ba"><table id="tabMsgSelectList"><tbody class="nui-table-body">'+bf.join("")+bd.join("")+'</tbody></table></div></div><div id="divMsgSelectTips" class="nui-normalTips nui-tips S"></div>';var bq=function(){var bJ;var bK=$("#divMsgSelectTips");bK.removeClass("g-tips-popup-err");bK.removeClass("g-tips-popup-succ");if(be>bm){bJ='<b class="nui-ico nui-ico-err"></b>已选择了'+$.Number.convert(be)+"，超出"+$.Number.convert((be-bm));bK.addClass("g-tips-popup-err")}else{bJ='<b class="nui-ico nui-ico-suc"></b>已选择了'+$.Number.convert(be)+"，可以上传";bK.addClass("g-tips-popup-succ")}if(bf.length){bJ+='<span class="txt-tips">(有<strong>'+bf.length+"</strong>个不能选择)</span>"}bK.html(bJ)};var br=$.Msgbox.show({type:"confirm",header:"附件上传提示",content:bG,contentType:"wide",ok:function(){var bJ=[];var bK=[];$.Array.each(bu,function(bL,bM){if(bM.err){bJ.push(bM)}else{bK.push(bM)}});bi({ignore:bJ,select:bK})},cancel:bD,close:bD});bq();if(be>bm){br.buttons.ok.setDisabled(true)}var bz=[];var bw=$("#objMsgSelectAll");bw.listen("click",function(){var bJ=bw.dom.checked;$.Array.each(bz,function(bK,bL){if(bL.dom.checked!=bJ){bL.dom.click()}})});$("#tabMsgSelectList").find("tr").each(function(bJ,bK){bK=$(bK);var bL=bK.find("input");if(bL.dom.disabled){return}else{bz.push(bL)}bL.listen("click",function(){var bM=parseInt(bL.dom.value,10);var bN=bu[bM];if(bL.dom.checked){bN.err="";be+=bN.size;bK.addClass("nui-table-row-selected")}else{bN.err="cancel";be-=bN.size;bK.removeClass("nui-table-row-selected")}bq();br.buttons.ok.setDisabled((be>bm))});bK.listen("mouseover",function(){if(bK.dom.className.indexOf("nui-table-row-selected")==-1){bK.addClass("nui-table-row-hover")}});bK.listen("mouseout",function(){bK.removeClass("nui-table-row-hover")});bK.listen("click",function(bN){var bM=$.Event.getTarget(bN);if(bM&&typeof bM.type=="string"&&bM.type.toLowerCase()=="checkbox"){}else{bL.dom.click()}})})}}}function P(bc){var ba=this;var bb=0;var a9=0;var e=0;bc=bc||(Ext.newAttach?{inlined:false}:null);$.Array.each(ba.fileGet(bc),function(bd,be){a9+=be.size;if(be.state=="error"){}else{if(be.bytesLoaded!=-1){if(be.percent==-1){e+=be.bytesLoaded}else{e+=Math.floor(be.size*(be.percent/100))}}}});if(a9==0){e=0}else{bb=Math.round((e/a9)*100)}return{percent:bb,bytesLoaded:e,bytesTotal:a9}}function aC(be,bb){var bd=this;var bc;bd.setLock(be,false);try{bc=$.Eval.get("("+bb+")")}catch(bf){bc={code:"JS_EVAL"}}var bg={code:bc.code};if(bc.code==S_OK){if(typeof bc.type=="number"){if(be.length){be.offset+=be.length;if(be.offset==be.size){be.length=0}else{be.ret=bc.ret||be.ret;if(bc.type==0){if(be.ret&&be.ret["aid"]){be.sid=be.ret["aid"]}}bg["continue"]=true;return bg}}var a9=bc["var"];switch(bc.type){case 0:be.sid=a9.attachmentId;break;case 1:be.fid=a9.fid;if(a9.dupname){be.nameExist=true;be.name=a9.fileName}be.link=a9;break}}else{be.sid=bc.attachId}bd.setBytes(be,be.size,be.size);bd.setProgress(be,100);if(be.inlined){bd.inlineInsert(be)}else{if(!be.cloud&&$.Array.has(["31","32","33"],be.icon)){if($.Array.has(["31","32","33"],be.icon)){bd.setInsert(be)}}}be.retry=0}else{var ba=bc.overflowReason||"";if(bd.error(be,bc.code,ba)){bg.retry=true}}return bg}function aG(){var e=this;return e.fileHas({state:"upload"})||e.fileHas({state:"hash"})}function U(){var a9=this;var e=false;if(a9.fileGet({type:"form",state:"wait"}).length>=1){e=true}return e}function az(){var e=this;if(Ext.newAttach){return e.fileHas({state:"error",inlined:false})}else{return e.fileHas({state:"error"})}}function F(bj){var bh=this;var bi=bh.sourceGet("status");if(!bi.layoutInit){bh.layout();bi.layoutInit=true}var bf=bh.sourceGet("layout");if(bh.cloudTrigger()){switch(bj.type){case"flash":case"plugin":case"native":if(bj.context||bj.inlined){bj.context=true}else{bj.cloud=true}break;default:break}bh.commonTips({capacity:true})}var bg=bh.base;var bd=bj.name;var bb,a9,ba,bc,e;bb=$.Element.create("DIV");bb.setClass("v nui-bg-dark");if(bj.mixed){}else{if(bj.inlined){if(Ext.newAttach){bb.setStyle({display:"none"})}}}if(bf.blockWidth){var be=bf.blockWidth+"px";bb.setStyle({width:be})}new $.Icon({renderTo:bb,type:"file32",subtype:bj.icon});a9=$.Element.create("DIV");a9.setClass("j");a9.html($.String.escapeHTML(bd));if(bj.path){a9.setAttr({title:bj.path})}else{a9.setAttr({title:bd})}ba=$.Element.create("DIV");ba.setClass("k");e=$.Element.create("DIV");e.setClass("l");(function(){var bk=$.Element.create("A");bk.setAttr({href:"javascript:void(0)"});bk.addClass("nui-txt-link");bk.html("删除");bk.listen("click",function(bl){bh.remove(bj);bh.netCheckClear();$.Event.cancel(bl)});e.append(bk.dom)})();if(bj.download){(function(){a9.setStyle({width:"170px"});var bk=$.Element.create("SPAN");bk.html("|");e.append(bk.dom);var bl=$.Element.create("A");bl.setAttr({target:"_blank",href:bj.download});bl.addClass("nui-txt-link");bl.html("下载");if($.Browser.chrome()){if(bj.mime){bl.listen("dragstart",function(bn){var bm=[bj.mime,bd,bj.download].join(":");try{bn.dataTransfer.setData("DownloadURL",bm)}catch(bo){}})}}e.append(bl.dom)})()}bc=$.Element.create("DIV");bc.setClass("d");bc.setStyle({display:"none"});bb.append(a9.dom);bb.append(e.dom);bb.append(ba.dom);bb.append(bc.dom);bj.ui={container:bb,name:a9,info:ba,tips:bc,ctrl:e};if(bj.type=="form"){bh.setState(bj,"wait")}else{if(bj.type=="storage"){bh.setState(bj,"success");if(!bj.cloud&&!bj.url&&$.Array.has(["31","32","33"],bj.icon)){if($.Array.has(["31","32","33"],bj.icon)){bh.setInsert(bj)}}}else{if(bj.type=="link"){bh.setState(bj,"link")}else{if(bj.type=="plugin"&&bj.path){bh.setState(bj,"select")}else{bh.setState(bj,"wait")}}}}if(bg.get({status:"confirmSubject"})){if(bg.form.getSubject()==""){if(bj.url&&(bd=="名片.vcf"||bd=="信纸.jpg")){}else{(function(){var bk;if(bj.media){bk=$I("support.SenderList").getName()+"录制的音视频邮件"}else{var bl=bd.split(".");if(bl.length>1){bl.pop()}bk=bl.join(".")}bg.form.setSubject(bk)})();bg.set({status:"confirmSubject",value:false})}}}bh.fileAdd(bj);bh.setAuto({type:"add",element:bb});bh.setTips(bj)}function aR(bb){var ba=this;if(Ext.newAttach&&bb.inlined){ba.inlinedError(bb)}else{var a9=bb.ui;var bc=a9.name;var e=a9.ctrl;(function(){if(bb.ui["resum"]){return}bc.setStyle({width:"170px"});var bd=$.Element.create("SPAN");bd.html("|");e.append(bd.dom);var be=$.Element.create("A");be.setAttr({href:"javascript:void(0)"});be.addClass("nui-txt-link");be.html("续传");be.listen("click",function(bf){ba.setInfo(bb,"resum");bd.remove();be.remove();bb.ui["resum"]=null;bb.retry=0;ba.setState(bb,"wait");ba.fileAutoUpload();$.Event.cancel(bf)});e.append(be.dom);bb.ui["resum"]=be})()}}function Y(bb,bd){var ba=this;var bc=arguments;if(bb.lock){return}if(bb.sid){ba.action.deleteAttach({sid:bb.sid,callback:function(be){if(be.code==S_OK){ba.inlineRemove(bb);bb.sid="";ba.remove.apply(ba,bc)}}});return}if(typeof bb["delete"]=="function"){bb["delete"]()}if(bb.cid){ba.fileDelete(bb)}if(bb.ui){var a9=bb.ui;var e=a9.container;bb.ui=null;ba.setAuto({type:"remove",element:e})}if(bb.cloud&&bb.state=="upload"){if(bb.ret&&bb.ret["oid"]){$.Ajax.jsonp(ba.getUploadProxy({type:"script",file:bb,cancel:true}),function(){})}}ba.cancelAutoSend("您已删除上传的附件，自动发送取消");ba.fileAutoUpload();if(typeof bd=="function"){bd()}}function aj(bg){var bd=this;var bc=bd.sourceGet("element");var bf=bg.type;var a9=bg.element;var bb=bd.fileCount();if(bf=="add"){bc.content.append(a9.dom)}else{if(bf=="remove"){a9.remove()}}if(bb>0){bc.area.show()}else{bc.area.hide();bd.commonTips({remove:true,keys:[]});try{var ba=bd.sourceGet("tips");if(ba.plugin){ba.plugin.remove();ba.plugin=null}}catch(be){}}if(bf=="add"||bf=="remove"){bd.setTotalProgress()}}function I(bb){var ba=this;var a9=bb.ui;var e=a9.ctrl;var bc=$.Element.create("A");bc.setAttr({href:"javascript:void(0)"});bc.addClass("nui-txt-link");bc.html("插入正文");bc.listen("click",function(be){var bd=ba.fileSize({context:true});if(bd+bb.size>$S("attachSize")*1024*1024){$.Msgbox.show({title:"附件上传提示",icon:"err",content:"添加的图片总大小不能超过"+$.Number.convert(nSizeLimit)});return}if(Ext.newAttach){bb.mixed=true}else{bb.inlined=true}bb.context=true;ba.inlineInsert(bb);$.Event.cancel(be)});e.previous(bc.dom);a9.name.setStyle({width:"148px"})}function j(bc){var bb=bc.ui;var a9=bb.container;var e=false;var ba=$.Browser.getVersion()||[0,0];if($.Browser.ie()){if(ba[0]=6){e=true}}a9.listen("mouseover",function(){if(bb.tips.html()){bb.tips.show();if(e){a9.setStyle({zIndex:"100"})}}});a9.listen("mouseout",function(){bb.tips.hide();if(e){a9.setStyle({zIndex:"1"})}})}function H(ba){var bk=this;var bb=bk.sourceGet("element");var bd=bk.sourceGet("tips");var a9=$S("cloud");if(ba.capacity&&a9){var bg=a9.spaceUsed;var bf=a9.capacity;var be;if(bf==0){be=0}else{be=Math.floor((bg/bf)*100)}if(be>=90){if(!bd.capacity){var bn=$.Element.create("DIV");bn.setClass("B");bn.html('<div class="nui-tips nui-normalTips nui-normalTips-err">云附件容量已满，请先 <a href="javascript:void(0)">清理云附件</a> 再继续上传文件。</div>');bd.capacity=bn;bb.content.after(bn.dom);bn.find("A").listen("click",function(){bk.cloudManage()})}bd.capacity.show()}else{if(bd.capacity){bd.capacity.hide()}}}if(ba.common){var e=null;var bc=null;if(ba.plugin&&!aJ.has()&&aJ.support()){e="plugin";bc=ba.text||"想更快速闪电上传多个附件，推荐"}else{if(ba.speed){e="speed";bc="检查到你的附件上传速度较慢，推荐你进行"}else{if(ba.upload){e="upload";var bm=$S("cloud")["duration"];var bj=["收件人可能无法收取大于20M的邮件，已智能为您使用云附件发送，如需使用普通附件上传，请","附件将作为云附件上传，"+bm+"天内有效，若被删除或过期，收件人将无法下载。","收件人可能因为附件容量大小超过限制，无法收取邮件,建议 "];var bi=$I("module.compose.ComposeModule");if(bi.sms_bind==2){bj[1]+="<a href=\"javascript:void(0)\" onclick=\"$I('util.CustomAppManager').goOutLink('vipsms', '手机服务');return false;\">云附件到期提醒>></a>"}bc=ba.text||bj[ba.mode]}}}if(e&&!bd[e]){var bh=$.Element.create("DIV");bh.setClass("B");var bl=$.Element.create("DIV");bl.setClass("nui-assistBlock");bl.html(bc);bh.append(bl.dom);bb.content.after(bh.dom);bd[e]=bh;if(e=="plugin"){new $.Link({text:"安装插件",renderTo:bl.dom,click:function(){bk.assist.setup("new")}})}else{if(e=="speed"){new $.Link({text:"分析校正",renderTo:bl.dom,click:function(){window.open("http://email2.163.com/info.htm")}})}else{if(e=="upload"){if(ba.mode==2){new $.Link({text:"使用云附件上传",renderTo:bl.dom,cls:"nui-txt-link",click:function(){bk.set({status:"confirmSize",value:true});bk.cloudTrigger(true);bk.movePrepare(1);bk.fileAutoUpload();bd[e].remove();bd[e]=null;bk.commonTips({common:true,upload:true,mode:1})}});if(!gCommon.newwin){new $.Component({html:"<span> 或 </span>",renderTo:bl.dom});new $.Link({text:"修改设置",cls:"nui-txt-link",renderTo:bl.dom,click:function(){$E(["interface.OptionInterface"],function(bo){bo.entry({module:"BaseSetModule",inputName:"uploadmode"})})}})}}else{if(ba.mode==0){new $.Link({text:"点击修改",renderTo:bl.dom,click:function(){bk.base.setOption({field:"ntes_compose",flag:"upload_mode",value:"2"});$.Msgbox.show({title:"修改成功，重新写信后，50M以下附件将以普通附件形式发送。"})}})}}}}}new $.Link({cls:"nui-block-close nui-close",renderTo:bl.dom,icon:"close",click:function(){bd[e].remove();bd[e]=null;bk.setAuto({type:"auto"})}});bb.area.show()}}if(ba.remove){if(ba.keys){$.Array.each(ba.keys,function(bo,bp){if(bd[bp]){bd[bp].remove();bd[bp]=null}})}else{aF.each(bd,function(bp,bo){if(bo){bo.remove();bd[bp]=null}})}}}function A(ba){var e=this;if(ba.inlined||ba.mixed){var a9=Uri.getUrl("compose_get_data",true);a9+="&composeId="+e.info.get({cid:true});a9+="&attachId="+ba.sid;a9+="&rnd="+Math.random();e.editor.insert({image:a9})}}function G(ba){var a9=this;if(ba.inlined){var bb=new RegExp("&sid="+$S("sid")+"&composeId="+a9.info.get({cid:true})+"&attachId="+ba.sid,"i");a9.editor.remove({tag:"img",reg:bb});ba.inlined=false;if(a9.fileCount({inlined:true,state:"error"})==0){var bc=a9.base;var e=bc.get({id:"div$id$InlinedTips"});e.hide()}}}function aV(){var a9=this;var ba=[];var e=a9.fileGet({type:"storage",inlined:true});$.Array.each(e,function(bb,bc){if(bc.sid){ba.push({id:bc.sid,inlined:false})}});return ba}function aE(){var a9=this;var ba=[];var e=a9.fileGet({inlined:true});$.Array.each(e,function(bb,bc){if(bc.sid){ba.push({id:bc.sid,inlined:true})}});var e=a9.fileGet({mixed:true});$.Array.each(e,function(bb,bc){if(bc.sid){ba.push({id:bc.sid,mixed:true})}});return ba}function av(){var bi=this;var bg=bi.base;var bb=bi.fileProgress({inlined:true});var bc=bb.percent;var bj=bb.bytesLoaded;var ba=bb.bytesTotal;var bh="";var e=bi.fileCount({inlined:true});var be=bi.fileCount({inlined:true,state:"success"});var a9=bi.get({status:"inlinedExist"});var bd=e-a9;var bf=be-a9;if(bc){if(bc==100){bg.tips(bh);bi.set({status:"inlinedExist",value:be})}else{bh="图片上传中"+(bf+"/"+bd)+"..."+bc+"%";if($.Tips.moduleTips){$.Tips.moduleTips.setText(bh)}else{bg.tips(bh)}}}}function C(bh){var bg=this;var bf=bg.base;bf.tips("");var a9=bf.get({id:"div$id$InlinedTips"});a9.show();if(a9.dom.innerHTML==""){a9.html('<b class="nui-layer-arr" style="left:256px;"></b><div class="nui-layer-normal"><dl><dd><ul></ul></dd></dl></div>')}var bc=a9.dom.getElementsByTagName("UL")[0];var be=bh.name;var bi,ba,bb,bd,e;bi=$.Element.create("LI");bi.setClass("vp");ba=$.Element.create("P");ba.setClass("vq");ba.html($.String.escapeHTML(be)+'&nbsp;<span class="nui-txt-err">上传失败</span>&nbsp;&nbsp;');e=$.Element.create("DIV");e.setClass("vs");(function(){var bj=$.Element.create("A");bj.setAttr({href:"javascript:void(0)"});bj.addClass("nui-txt-link");bj.html("续传");bj.listen("click",function(bk){bg.setInfo(bh,"resum");bh.retry=0;bg.setState(bh,"wait");bg.fileAutoUpload();bi.remove();if(bg.fileCount({inlined:true,state:"error"})==0){a9.hide()}$.Event.cancel(bk)});e.append(bj.dom)})();(function(){var bj=$.Element.create("A");bj.setAttr({href:"javascript:void(0)"});bj.addClass("nui-txt-link");bj.html("删除");bj.listen("click",function(bk){bg.remove(bh);bg.netCheckClear();bi.remove();$.Event.cancel(bk)});e.append(bj.dom)})();bi.append(ba.dom);bi.append(e.dom);bc.appendChild(bi.dom);bh.ui2={container:bi,name:ba,ctrl:e}}function l(bb,bf){var bh=this;var bg=bh.base;var a9=bg.get({status:"fromEntry"});if(aF.isArray(bb)){var be="";if(bf){if(a9=="compose"){bh.action.syncAttach({attachments:bb,callback:function(bk){if(bk.code==S_OK){$.Array.each(bk["var"]["attachments"],function(bm,bl){bh.storageAdd(bl)})}}});return}else{if(a9=="draft"){be=Uri.getUrl("compose_get_data",true)+"&mode=download&composeId="+bh.info.get({cid:true})}}}$.Array.each(bb,function(bl,bk){if(be){bk.download=be+"&attachId="+bk.id}bh.storageAdd(bk)});return}if(bb.deleted){return}var e=bb.type;var bd=bb.name||bb.fileName;if(bb.displayName){bd=bb.displayName}var bc=bb.contentType;if(!bd&&bc){switch(bc.toLowerCase()){case"message/disposition-notification":bd="已读回执";break;case"message/delivery-status":bd="信息碎片";break;case"message/rfc822":bd="邮件正文.txt";break;default:bd="No name";var bj=bc.split("/");if(bj[1]){bc=bj[1].toLowerCase();if(bc=="gif"||bc=="png"){bd+="."+bc}else{if(bc=="jpg"||bc=="jpeg"){bd+=".jpg"}}}break}}var ba=bb.id||bb.attachmentId;var bi=bh.fileCreate({type:"storage",name:bd,mime:bc,size:bb.size,sid:ba});if(e=="url"){bi.url=bb.name}if(bb._mid){bi.mid=bb._mid}if(bb.inlined){bi.inlined=true;bi.context=true}if(bb.mixed){bi.mixed=true;bi.context=true}if(bb.media){bi.media=bb.media;bi.context=true}if(bb.download){bi.download=bb.download}bh.add(bi)}function q(){var bb=this;var e=bb.fileGet({state:"error"});var ba="";$.Array.each(e,function(bc,bd){ba+=bd.name+"<br/>"});var a9="以下附件尚未上传完成，请先删除或者续传附件：";$.Msgbox.show({title:a9,icon:"err",content:ba});return}function N(){var a9=this;var e=a9.info.get({cid:true});a9.action.syncAttach({cid:e,callback:function(bc){var bd={state:"success",cloud:false};var bb=a9.fileGet(bd);var be=bc["var"]["attachments"];var ba=[];$.Array.each(be,function(bh,bg){var bf=false;$.Array.each(bb,function(bi,bj){if(bg.id==bj.sid){bf=true;throw $.BREAK}});if(!bf){ba.push(bg.id)}});if(ba.length>0){a9.action.deleteAttach({sid:ba,callback:function(bf){if(bf.code==S_OK){a9.base.send({action:"deliver"})}else{}}})}else{a9.base.send({action:"deliver"})}}})}function u(bh,a9){var be=this;var ba;be.setLock(bh,false);try{ba=$.Eval.get("("+a9+")")}catch(bd){ba={code:"JS_EVAL"}}if(bh.cid){}else{return false}var bc=ba.type;var bb=ba.ext;if(bb){if(typeof bb.spaceused=="number"){$S("cloud")["spaceUsed"]=bb.spaceused}if(typeof bb.capacity=="number"){$S("cloud")["capacity"]=bb.capacity}if(typeof bb.sizelimit=="number"){$S("cloud")["fileSizeLimit"]=bb.sizelimit}if(bb.dupname&&bb.filename){bh.nameExist=true;bh.name=bb.filename}}if(ba.code==S_OK){var bg=ba["var"];if(bc==1){$S("cloud")["spaceUsed"]+=bh.size;bh.ret=ba.ret||null;if(bg){if(bg.exist){bh.fileExist=2;be.complete(bh,a9);return false}else{bh.fileExist=1;bh.fid=bg.fid;if(bg.dupname){bh.nameExist=true;bh.name=bg.filename}bh.offset=bg.existlen;$S("cloud")["spaceUsed"]-=bh.size}}else{}}else{if(bc==0){if(bg){if(bg.actualSize){if(bg.actualSize==bg.size){be.complete(bh,a9);return false}bh.offset=bg.actualSize}else{bh.sid=bg.attachmentId}}}}return true}else{if(ba.code=="UX_FILE_NOT_FOUND"){return true}else{var bf=be.error(bh,ba.code,"","check");if(bf){be.resum(bh)}return false}}}function aq(bi,bd,bj,a9){var bf=this;if(bd=="TIMEOUT"){bf.fileBreak(bi)}var ba="未知错误";var bg="，请重试";var bh=false;switch(bd){case"JS_EVAL":ba="服务器返回格式错误"+bg;break;case"JS_PLUGIN":ba="插件版本过低，请使用标准添加附件方式选择大文件";break;case"NS_402":case"FA_INVALID_SESSION":ba="登录超时，请重新登录邮箱";$I("init.Support").relogin();break;case"NS_415":ba="云附件服务器因网络问题已暂停上传，请手动重试";break;case"NS_514":ba="系统不支持多次同时重复上传同一个文件";break;case"NS_515":case"FA_OVERFLOW":case"FA_UPLOAD_SIZE_EXCEEDED":if(bj=="pref_smtp_max_send_mail_size"){ba="附件大小超过限制"}else{if(bj=="pref_flow_limit"){ba="附件流量超过限制"}else{ba="附件大小或流量超过限制"}}if(bi){if(bi.cloud){ba="超过云附件空间上限，请您先删除已上传文件"}}else{}break;case"NS_700":case"NS_701":case"NS_705":case"NS_710":ba="此文件存在不良信息，禁止上传";break;case"FA_SECURITY":ba="浏览器信息丢失，请重新登录邮箱";break;case"WX_DATA_ERROR":ba="浏览器错误"+bg;bi.skipSplit=true;break;case"JS_HTTP":case"AS_HTTP":if(bj==0){ba="服务器连接错误"}else{ba="服务器"+bj+"错误"}ba+=bg;break;case"AS_ERROR":if(bj.indexOf("Error #")!=-1){try{bj=bj.split("#")[1];bj=bj.split(":")[0];if(bj=="2038"){ba="文件可能被其他程序占用"}else{if(bj=="2049"){ba="服务器响应错误"}else{if(bj=="2032"){ba="网络错误"}else{ba="错误码："+bj}}}ba+=bg}catch(be){}}break;case"TIMEOUT":ba="上传超时"+bg;bf.commonTips({common:true,speed:true});break;case"FLASH_VERIFY_TIMEOUT":ba="附件扫描超时";break;default:ba="上传失败，错误码："+bd+bg;break}bi.err=ba;if(bi){bf.setLock(bi,false);if(bd=="JS_HTTP"||bd=="AS_HTTP"||bd=="AS_ERROR"||bd=="WX_DATA_ERROR"){if(bi.retry>=3){}else{bh=true;if(a9=="check"){bf.skipUploadHost()}else{if(bf.cloudTrigger()){}else{if(bd!="WX_DATA_ERROR"&&bi.retry==0){bf.skipUploadHost()}}}}bi.retry++}if(!bh){bf.setState(bi,"error",ba);bf.commonTips({common:true,plugin:true,text:"附件上传失败，推荐你使用邮箱助手上传附件，稳定快速并支持断点续传，立即"})}}else{$.Msgbox.show({icon:"err",title:ba})}try{var bc=encodeURIComponent(bi.name);var bb={code:bd,reason:bj,size:bi.size,retry:bi.retry,agent:bi.type,name:bc};Log.record("attach",bb)}catch(be){}if(!bh){bf.cancelAutoSend("附件上传失败，已为你取消了自动发送")}return bh}function at(ba){var a9=this;var bb=a9.base;var e=aW.sliceTime;bb.addTimer("netCheck",function(){a9.netCheckFire(ba)},e)}function aM(a9){var e=this;if(a9.state!="upload"){return}if(a9.useSplit){if(a9.offset==0||a9.offset==a9.lastOffset){if(!a9.cloud){e.set({status:"validServer",value:true})}if(e.error(a9,"TIMEOUT")){e.fileRetry(a9,{code:"TIMEOUT"})}else{e.resum(a9)}return}a9.lastOffset=a9.offset;e.netCheckSet(a9)}else{}}function E(){var e=this;var a9=e.base;a9.clearTimer("netCheck")}function ao(a9){var e=this;var ba=e.base;if(ba.sequence["uploadResult"]){delete ba.sequence["uploadResult"];if(a9){ba.tips(a9);window.setTimeout(function(){ba.tips("")},5*1000)}else{ba.tips("")}}}function ay(){var a9=this;var bb=[];var ba={state:"success",inlined:false,media:false,url:""};var e=a9.fileGet(ba);$.Array.each(e,function(bc,bd){if(bd.sid){bb.push(bd)}});return bb}function a2(a9){var e=this;var ba=e.base;ba.setSequence("attachMove",function(){var bb=e.moveGet();if(bb.length){e.moveCloud(bb,a9)}})}function S(e,bb){var ba=this;var bd=ba.base;var bc=[];var a9=0;$.Array.each(e,function(be,bf){bc.push(bf.sid);a9+=bf.size});$.Ajax.jsonp(ba.getUploadProxy({type:"script",move:true,aid:bc,size:bb}),function(be){bd.tips("");bd.set({status:"uploadParam",value:null});ba.moveComplete(be)});bd.set({status:"uploadParam",value:{action:"move",size:bb,xsize:a9}});bd.tips("正在移动附件...")}function aT(ba){var a9=this;if(ba.code==S_OK){var e=ba.move;if(e&&e.length){a9.moveReplace(e)}}else{var bb="";switch(ba.code){case"FA_OVERFLOW":bb="云附件容量超过"+$.Number.convert($S("cloud")["capacity"])+"的限制！";break;default:bb="云附件系统繁忙，错误码："+ba.code;break}$.Msgbox.show({icon:"err",title:bb})}}function aZ(e){var a9=this;var ba=[];$.Array.each(e,function(bb,bc){ba.push(bc.attachmentId)});a9.action.deleteAttach({sid:ba,callback:function(bb){if(bb.code==S_OK){$.Array.each(e,function(bc,be){var bd=a9.fileGet({sid:be.attachmentId})[0];if(bd){bd.sid="";a9.cloudConvert(bd,be)}})}else{}}})}function r(){var ba=this;var bb=ba.base;var e=0;var a9=bb.get({status:"uploadParam"});if(a9&&a9.action=="move"&&a9.xsize>0){e=a9.xsize}return e}function aw(a9){var e=this;if(typeof a9=="boolean"){if(a9&&!$S("cloud")){e.set({status:"cloudTrigger",value:true})}else{e.set({status:"cloudAttach",value:a9})}}else{if(e.get({status:"cloudTrigger"})){if($S("cloud")){e.set({status:"cloudAttach",value:true});e.set({status:"cloudTrigger",value:false})}}}if(e.getUploadHost()){return e.get({status:"cloudAttach"})}else{return false}}function aQ(a9){var e=a9.ui;if(a9.nameExist&&e){e.name.html($.String.escapeHTML(a9.name));e.tips.html("你已上传过同名文件，本文件已自动改名以避免覆盖旧文件")}}function ap(bc,e){var bb=this;if(aF.isArray(bc)){$.Array.each(bc,function(bd,be){bb.cloudConvert(be)});return}if(typeof bc.link=="object"&&!e){e=bc.link}var a9={type:"bigattach",url:$S("cloud")["displayUrl"]+e.url,name:e.fileName,id:e.id,size:e.existlen,time:e.expireTime};if(e.preview){a9.preview=$S("cloud")["previewUrl"]+e.url}bc.type="link";var ba="";if(a9.id&&a9.id!=-1){ba=[a9.type,a9.id].join(":")}bc.eid=ba;bc.url=a9.url;bc.link=a9;if(a9.size){bc.size=bc.bytesLoaded=a9.size}bb.setState(bc,"link")}function aY(){var a9=this;var bd=a9.module;var be=a9.base;var bc=Ud.get({field:"ntes_letter",flag:"autoSendTips"});if(bc!="0"){return}var ba=be.get({component:"toolbar"});var bb=ba.find("button")[0];if(!bb){return}var e=new $.Layer({icon:{type:"info",size:"m"},width:"230px",items:[{html:"<span>附件正在上传，点击发送按钮，即可在<br/>上传完成后自动发送。 </span>"},{xtype:"link",text:"不再提示",cls:"nui-txt-link",click:function(){Ud.set({field:"ntes_letter",flag:"autoSendTips",value:"1"});this.ownerCt.destroy()}}],params:"hasArr arrUp hasClose",doNotHide:true,renderTo:bd.container});e.pointTo(bb.getEl(),$.fly(bd.container));be.set({component:"autoSendTips",value:e})}function aI(){var bh=this;var bf=bh.base;if($S("cloud")){try{var bi=bh.base.get({status:"uploadMode"});if(bi!="post"){var be=$.Number.convert($S("cloud")["capacity"]);var ba='(最大<strong class="nui-txt-impt">'+be+"</strong>)";var bg="添加附件"+ba;var a9=bh.sourceGet("element");var bc=a9.link;bc.html(bg);if(be=="2.5G"){a9.browseContainer.setStyle({width:"115px"})}if($S("isFree")){var bb=bf.get({component:"update3g"});if(be=="2G"){bb.show()}else{bb.hide()}}}}catch(bd){}}}function aK(){$E(["product.FileCenter"],function(e){e.entry("bj_center")})}function Z(e){var a9=this;Log.cache({cl_attachmsg:""+e},$.EMPTYFUNC);switch(e){case 0:a9.cloudMsg();break;case 1:a9.netfolderMsg();break;case 2:a9.internalMsg();break;case 3:a9.ynoteMsg();break}}function W(){try{var a9=$L("product.CloudAttach")}catch(ba){return ba}a9.entry({from:"compose"})}function T(){try{var ba=$L("product.NetfolderAttach")}catch(bb){return bb}var a9=$S("advLock");if(a9&&!a9.authenticated2&&!a9.disabled&&a9.nf){AdvLock.show(function(){ba.entry({from:"compose"})});return}ba.entry({from:"compose"})}function g(a9){var ba=this;var bb=ba.base;if(a9&&a9.length){var e=[];$.Array.each(a9,function(bd,bc){if(bc&&bc.checked){if(ba.fileGet({type:"storage",mid:bc.mid}).length==0){e.push(ba.netfolderStructure(bc))}}});if(e.length){ba.action.syncAttach({attachments:e,callback:function(bd){if(bd.code==S_OK){var bc=[];var be=bd["var"]["attachments"];$.Array.each(be,function(bg,bf){$.Array.each(e,function(bh,bi){if(bf._mid==bi._mid){bc.push(bf)}})});ba.storageAdd(bc)}}})}}else{}bb.setPage("compose")}function d(a9){var e={};e.type="netfolder";e.id=-1;e._mid=a9.mid;e.name=a9.name;e.contentType=a9.type;if(typeof a9.size=="string"){a9.size=parseInt(a9.size,10)}e.size=a9.size;return e}function L(){try{var a9=$L("product.InternalAttach")}catch(ba){return ba}a9.entry({from:"compose"})}function ae(){try{var ba=$L("product.YNoteAttach")}catch(a9){return a9}ba.entry({from:"compose"})}function ah(){var a9=this;try{a9.cancelAutoSend("进入云附件，取消自动发送")}catch(ba){}try{var bb=$L("product.BigAttach")}catch(ba){return ba}bb.entry({from:"compose"})}function a4(e){var ba=this;if(aF.isArray(e)){$.Array.each(aF.toArray(e),function(bd,bc){ba.linkAdd(bc)});return}var a9="";if(e.id&&e.id!=-1){a9=[e.type,e.id].join(":");if(ba.fileGet({type:"link",eid:a9}).length){return}}else{if(ba.fileGet({type:"link",url:e.url}).length){return}}var bb=ba.fileCreate({type:"link",name:e.name,eid:a9,cloud:e.cloud});bb.url=e.url;bb.link=e;if(e.size){bb.size=bb.bytesLoaded=e.size}ba.add(bb)}function a1(){var bb=this;var be=bb.base;var ba=be.get({status:"fromEntry"});var e=false;var a9=false;if(ba=="draft"||ba=="timeset"){e=true}else{if(ba=="compose"){return}}var bd=[];var bc;while(1){if(bc=bb.editor.get({id:"divEditorAttachLink"})){if(e){e=false;$.Array.each(aF.toArray(bc.childNodes),function(bh,bg){try{var bj=bg.innerHTML;var bf=JSON.parse(bj);if(bf.type=="bigattach"){a9=true}bf.cloud=true;bd.push(bf)}catch(bi){}})}$(bc).remove()}else{break}}if(a9){bb.cloudTrigger(true)}bb.linkAdd(bd)}function aU(e){var be=this;var bd="";var ba=be.fileGet({type:"link"});if(ba.length){var bg=e.action;var a9=e.subject;a9=encodeURIComponent(a9);var bb=true;if(bg=="deliver"||bg=="schedule"){bb=false}var bf=[];var bc={};$.Array.each(ba,function(bq,bs){var bl=bs.link;if(bb){bf[bf.length]="<xmp>"+JSON.stringify(bl)+"</xmp>"}else{var bm=bs.url;var bp=bs.name;var bk=bl.type;var bj=bc[bk];if(!bj){bj=bc[bk]=[]}var bh="";var br=be.linkIcon(bs);if(bk=="netfolder"){bh='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+bm+'"><img border="0" src="'+br+'" /></a></div><div><div style="padding:0px;font-size:12px;line-height:14px"><a href="'+bm+'" download="'+bm+'" fileid="'+bl._mid+'" filename="'+bp+'" filesize="'+bl.size+'" target="_blank" style="color:#000;text-decoration:none">'+bp+'</a><span style="color:#bbb"> ('+$.Number.convert(bl.size)+')</span></div><div style="padding:4px 0px;font-size:12px;line-height:14px"><a href="'+bm+'">下载</a></div></div></div>'}else{if(bk=="bigattach"){var bi=bl.preview||"";var bn=new Date(bl.time);var bo=$.Date.format(bn,"yyyy年M月d日 H:mm");bm=$.String.addParam(bm,"title="+a9);if(bi){bi=$.String.addParam(bi,"title="+a9)}bh='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+bm+'"><img border="0" src="'+br+'" /></a></div><div><div style="padding:0px;font-size:12px;line-height:14px"><a href="'+bm+'" download="'+bm+'" preview="'+bi+'" fileid="'+bl.id+'" filename="'+bp+'" filesize="'+bl.size+'" expiretime="'+bl.time+'" target="_blank" style="color:#000;text-decoration:none">'+bp+'</a><span style="color:#bbb"> ('+$.Number.convert(bl.size)+", "+bo+' 到期)</span></div><div style="padding:4px 0px;font-size:12px;line-height:14px">'+(bi?'<a href="'+bi+'">在线预览</a> | ':"")+'<a href="'+bm+'">下载</a></div></div></div>'}}bj.push(bh)}});if(bb){bd='<div id="divEditorAttachLink" style="display:none">'+bf.join("")+"</div>"}else{aF.each(bc,function(bi,bh){if(bi=="netfolder"){bd+='<div id="divNeteaseNetfolder" style="clear:both;margin-top:10px;margin-bottom:15px;background:#DEE8F2;padding:4px;font-family:verdana,Arial,Helvetica,sans-serif"><div style="font-size:14px;padding:4px 8px 8px 8px;line-height:16px"><b>从网易'+$S("product")+'邮箱发来的文件</b></div><div style="background:#fff;padding:4px">'+bh.join("")+"</div></div>"}else{if(bi=="bigattach"){bd+='<div id="divNeteaseBigAttach" style="clear:both;margin-top:10px;margin-bottom:15px;background:#DEE8F2;padding:4px;font-family:verdana,Arial,Helvetica,sans-serif"><div style="font-size:14px;padding:4px 8px 8px 8px;line-height:16px"><b>从网易'+$S("product")+'邮箱发来的云附件</b></div><div style="background:#fff;padding:4px">'+bh.join("")+"</div></div>"}}})}}return bd}function n(bb){var ba=Uri.getUrl("compose_attach_icon",true);var a9=[ba,"1",".gif"];var e=bb.ext;if(e){if(y.icoFileIndex[e]){a9[1]=y.icoFileIndex[e]}}return a9.join("")}function B(a9){var ba=this;if(a9&&a9.length){var e=[];$.Array.each(a9,function(bd,bc){var be=bc.name;be=be.split("&")[0];var bb=ba.fileGet({type:"storage",size:bc.size});$.Array.each(bb,function(bf,bg){if(bg.url&&bg.url.indexOf(be)==0){bc=null;throw $.BREAK}});if(bc){e.push(bc)}});if(e.length){ba.action.syncAttach({attachments:e,callback:function(bc){if(bc.code==S_OK){var bb=[];var bd=bc["var"]["attachments"];$.Array.each(bd,function(bf,be){$.Array.each(e,function(bg,bh){if(be.name==bh.name){bb.push(be)}})});ba.storageAdd(bb)}}})}}}function w(e){var a9=this;if(e&&e.length){a9.action.syncAttach({attachments:e,callback:function(bb){if(bb.code==S_OK){var ba=[];var bc=bb["var"]["attachments"];$.Array.each(e,function(bd,be){$.Array.each(bc,function(bg,bf){if(bf.type=="internal"&&!bf.deleted&&bf.name==be.name){var bh=bf._mid;var bj=be._mid;if(bh.indexOf(":")!=-1){bh=bh.split(":")[1]}if(bj.indexOf(":")!=-1){bj=bj.split(":")[1]}var bi=Math.abs(bf.size-be.size);if(bh==bj&&bi<100){ba.push(bf);throw $.BREAK}}})});a9.storageAdd(ba)}}})}}function a(a9){var e=this;if(a9&&a9.length){var ba=[];$.Array.each(a9,function(bb,bc){if(bc.code==S_OK){ba.push(bc["var"])}});e.storageAdd(ba)}}function aD(ba){var e=this;var a9=e.editor;$.Array.each(ba,function(be,bc){e.storageAdd(bc);var bf=bc.fileName;var bd=bc.attachmentId;var bh=bc.mediaType;var bb=bc.totalTime;var bg="";if(bh=="video"){Log.cache({cl_video:1},$.EMPTYFUNC);bg='<div><img data-media="'+bd+'" border="0" src="http://mimg.127.net/p/js5/lib/img/ico_video.gif" style="vertical-align: middle;"/><player id="cmd:voice" param="'+bf+'" media="video"></player><span style="padding : 3px 5px">'+bb+'</span><span style="line-height: 1.7; color: rgb(128, 128, 128);">(如果您看不到视频，请下载附件)</span></div>'}else{if(bh=="audio"){Log.cache({cl_audio:1},$.EMPTYFUNC);bg='<div><img data-media="'+bd+'"  border="0" src="http://mimg.127.net/p/js5/lib/img/ico_audio.gif" style="vertical-align: middle;"/><player id="cmd:voice" param="'+bf+'" media="audio"></player><span style="padding : 3px 5px">'+bb+'</span><span style="line-height: 1.7; color: rgb(128, 128, 128);">(如果您看不到音频，请下载附件)</span></div>'}}if(bg){bg="<div>这个是我刚才录制的哇，你看看呀～～</div>"+bg+"<br/><div>&nbsp;&nbsp;</div>";a9.insert({html:bg})}})}function a8(){var a9=this;var e=false;if(a9.fileGet({type:"storage",name:"信纸.jpg"}).length>=1){e=true}return e}function R(){var a9=this;var ba=null;var e=a9.get({status:"stationeryUrl"});if(e){ba=a9.fileGet({type:"storage",url:e})[0]}return ba}function ax(a9){var e=this;var ba=e.stationeryGet();if(ba){e.remove(ba,function(){e.set({status:"stationeryUrl",value:""});if(a9){a9()}});return}}function aH(bc,ba){var a9=this;var bb=a9.stationeryGet();if(bb){a9.stationeryClear(function(){a9.stationerySync(bc,ba)});return}var e=a9.stationeryStruct(bc);a9.set({status:"stationeryUrl",value:e.name});a9.action.syncAttach({attachments:[e],callback:function(bf){if(bf.code==S_OK){var be=[];$.Array.each(bf["var"]["attachments"],function(bi,bh){if(bh.name==e.name){if(bh.deleted){}else{be.push(bh)}}});if(be.length>=1){var bd=be.pop();bd.inlined="true";a9.storageAdd(bd);return ba(bd.name);var bg=Uri.getUrl("compose_get_data",true);bg+="&composeId="+a9.info.get({cid:true});bg+="&attachId="+bd.id;bg+="&rnd="+Math.random();return ba(bg)}}return ba(null)}})}function m(a9){var e={};e.id=-1;e.type="url";e.mode="copy";e.name=a9.imageUrl;e.displayName="信纸.jpg";e.contentType=a9.contentType;e.size=a9.size;return e}function ac(){var e=this;var a9=e.base;a9.setPage("photo")}function aB(ba){var a9=this;var bd=a9.base;bd.setPage("compose");var bb=a9.editor;if($.String.trim(ba)){var e=ba.split(";");var bc="";$.Array.each(e,function(bf,bg){var be=bg.split("+");bc+='<a href="'+be[1]+'" target="_blank"><img border="0" src="'+be[0]+'"></a><br>'});bb.insert({html:bc})}else{}}function X(){var e=this;var a9=Uri.getUrl("compose_photo",true);var ba=Uri.getUrl("compose_attach",true);var bb=e.base.getCallName(function(){e.photoCallBack.apply(e,arguments)},true);ba+="&call=window.parent."+bb;a9+="&backurl="+encodeURIComponent(ba);return a9}function an(){var a9=this;var e=false;if(a9.fileGet({type:"storage",name:"名片.vcf"}).length>=1){e=true}return e}function a5(){var a9=this;var ba=null;var e=a9.get({status:"cardUrl"});if(e){ba=a9.fileGet({type:"storage",url:e})[0]}return ba}function a7(ba){var a9=this;var bb=a9.cardGet();if(bb){a9.remove(bb,function(){a9.set({status:"cardUrl",value:""});a9.cardSync(ba)});return}var e=a9.cardStructure(ba);a9.set({status:"cardUrl",value:e.name});a9.action.syncAttach({attachments:[e],callback:function(bd){if(bd.code==S_OK){var bc=[];$.Array.each(bd["var"]["attachments"],function(bf,be){if(be.name==e.name){if(be.deleted){}else{bc.push(be)}}});if(bc.length>=1){a9.storageAdd(bc.pop())}}}})}function aa(a9){var e={};e.id=-1;e.type="url";e.mode="copy";e.name=a9.ecardVCFUrl;e.displayName="名片.vcf";e.contentType="text/x-vCard";e.size=a9.ecardVCFFileSize;return e}function a6(be,ba){be=be||0;if(typeof ba=="number"){if(ba<0){ba=0}}else{ba=2}var bd=Math.pow(10,ba);var e=[];var a9=0;var bc=0;var bb=["","B","K","M","G","T"];if(be==0){}else{if(be<1024){bc=1;a9=be}else{if(be<Math.pow(1024,2)){bc=2;a9=Math.round(be/1024*bd)/bd}else{if(be<Math.pow(1024,3)){bc=3;a9=Math.round(be/Math.pow(1024,2)*bd)/bd}else{bc=4;a9=Math.round(be/Math.pow(1024,3)*bd)/bd}}}}e.push(new String(a9));if(e[0].indexOf(".")==-1){if(ba){e.push(".");$.Array.each((new Array(ba)),function(){e.push("0")})}}else{e=e[0].split(".");(function(){var bf=ba-e[1].length;if(bf>0){$.Array.each((new Array(bf)),function(){e[1]+="0"})}})();e=[e.join(".")]}e.push(bb[bc]);return e.join("")}function p(e){var a9="";if(e==-1){a9="??:??:??"}else{if(e>86400){a9="23:59:59"}else{var ba=new Array(3);ba[2]=e%60;e-=ba[2];e/=60;ba[1]=e%60;e-=ba[1];e/=60;ba[0]=e;$.Array.each(ba,function(bc,bb){if(bb<10){a9+="0"}a9+=bb;if(bc<2){a9+=":"}})}}return a9}})();(function(){try{var j=$L("module.compose.Compose");var z=$L("component.editor.Editor");var x=$L("interface.OptionInterface");var N=$L("interface.OutlinkInterface");var o=$L("support.MailAssist")}catch(Q){return Q}var r=$.Object;var C=$.Function;var F=$.createClass($N("module.compose.ComposeEditor"));r.inherit(F,j);r.extend(F.prototype,{initialize:v,init:H,clear:p,create:M,render:n,custom:b,get:c,getPreview:i,getFinal:q,getWindow:k,getMask:h,setMask:l,getBarHeight:d,getBreakLine:I,set:G,setSize:A,setOriginal:E,setMode:B,setHtmlbar:D,focus:s,insert:L,remove:f,keyPress:m,switchText:u,addImage:R,addPortrait:y,createSignMenu:K,createPortraitMenu:w,showStationery:a,related:t,pasteAction:P,getSubject:J,fillSubject:O,showVoice:g});function v(e){var S=this;r.extend(S,{element:{toolBar:null,typoBar:null,container:null},component:null});F.superClass.initialize.call(S,e)}function H(){var S=this;var e=S.element;F.superClass.init.call(S);var T=S.base;e.container=T.get({id:"div$id$Editor"})}function p(){var e=this;F.superClass.clear.call(e.element);F.superClass.clear.call(e)}function M(){var T=this;var U=T.base;try{T.render()}catch(S){U.addTimer("editor",function(){try{T.render()}catch(V){}},100)}}function n(){var S=this;var T=S.base;var e={};e.height=T.layout["editorHeight"]+"px";e.editMode=(T.get({status:"showHtmlbar"})?"basic":"hide");e.tabIndex=1;e.setDefault=true;e.container=S.element["container"]["dom"].id;S.component=new z(e);S.component.addListener("createsignMenu",C.bind(S.createSignMenu,S));S.component.addListener("createportraitMenu",C.bind(S.createPortraitMenu,S));S.component.addListener("stationeryClick",C.bind(S.showStationery,S));S.component.addListener("microphoneClick",C.bind(S.showVoice,S));S.component.addListener("related",C.bind(S.related,S));S.component.addListener("captureClick",function(){if(Ud.get({field:"ntes_option",flag:"flashupload"})!="1"){S.assist.captureStart()}else{$.Msgbox.show({title:"普通附件上传模式不支持截图，请切换到高级上传模式"})}Log.cache({cl_capture:"1"},$.EMPTYFUNC)});S.component.addListener("imageClick",C.bind(S.addImage,S));S.component.addListener("onEndChangeEditMode",function(U){if(U=="html"){S.setHtmlbar({visibility:true});S.form.setCheckbox("text",false,true)}else{if(U=="text"){S.setHtmlbar({visibility:false});S.form.setCheckbox("text",true,true)}}});S.component.addListener("beforeClick",function(V){if(V=="paste"){var U=$.Event.getEvent(S.dow().event);S.assist.clipMenu(U)}});S.custom();T.layoutInit();if(Ud.get({field:"ntes_letter",flag:"editorToolbar"})==1){z.ui.changeEditMode(S.component,"full")}}function b(){var V=this;var Y=V.base;var S=V.event;var X=$(V.getWindow());var W=$(X.dom.document);var U=$(W.dom.body);W.listen("click",C.bind(S.hideFloat,S,"editor"));W.listen("keydown",C.bind(V.keyPress,V));var T=W;if($.Browser.ie()){T=U}T.listen("paste",$.Function.bind(V.pasteAction,V));var e=$.Browser.getInfo();switch(e.os){case"ipad":case"ipod":case"iphone":case"android":V.switchText({text:true,force:true});break}Y.addTimer("editor",function(){V.assist.dragInit();V.assist.clipInit()},100)}function c(T){T=T||{};var S=this;if(typeof T.status=="string"){if(T.status=="text"){return S.component.isTextMode()}else{return null}}else{if(T.empty){var e=S.base.get({status:"defaultContent"});return S.component.isEmpty(e)}else{if(typeof T.id=="string"){return S.component.getIframeEl("#"+T.id)}else{if(typeof T.tag=="string"){return S.component.getIframeEl(T.tag)}else{if(T.html){return S.component.getContent("html")}else{if(T.text){return S.component.getContent("text")}else{return S.component.getContent()}}}}}}}function i(){var e=this;return e.component.getPreviewContent()}function q(e){var S=this;if(S.component&&S.component.getFinalContent){return S.component.getFinalContent(e)}else{return""}}function k(){var e=this;return e.component.getWin()}function h(){var e=this;return e.component.getMask()}function l(e){var S=this;S.component.showMask(e)}function d(){var e=this;return e.component.getTbHeight()}function I(e){var S=this;return S.component.getBreakLine(e)}function G(S){var e=this;if(typeof S.html=="string"){return e.component.setContent(S.html,"html")}else{if(typeof S.text=="string"){return e.component.setContent(S.text,"text")}else{return e.component.setContent(S)}}}function A(e){var S=this;S.component.setSize(e)}function E(W,ac){var ab=this;var aa=ab.base;var U=aa.get({status:"fromEntry"});var ae=aa.get({status:"paramBody"});if(W.indexOf("附件")!=-1){aa.set({status:"confirmAttach",value:false})}if(ac=="text"){if(U=="edit"||U=="draft"||U=="timeset"){}else{ac="html";W=$.String.encodeHTML(W);W=["<pre>","<br>",W,"</pre>"].join("")}}if(ac=="html"){if(U=="reply"||U=="forward"){W=W.replace(new RegExp('id="*(spnEditorSign|divEditorGraphSign|divNeteaseMailCard)"*',"ig"),"");var ad="0";try{ad=Ud.get({field:"ntes_option",flag:"signPosition"})}catch(X){}if(ad=="0"){var V=ae.defaultContent||"";V+=ab.getBreakLine(5);V+='<div id="spnEditorSign"></div>';if($S("isFree")){V+='<div id="divNeteaseMailCard"></div>'}else{if($S("isVip")){V+='<div id="divEditorGraphSign"></div>'}else{if($S("isCorp")){var S=gAttrs.letterAngle;if(S&&S.langle_apply==1){var T=S.langle_position;var Y='<div id="dvLetterAngle"></div>';if(T==0){V=ab.getBreakLine(5)+Y+'<div id="spnEditorSign"></div>'}else{V+=Y}}}}}V+=ab.getBreakLine(1);W=V+W}else{var Z=ae.defaultContent||"";Z+=ab.getBreakLine(5);W=Z+W}}}if(ac=="html"){if(W){ab.set({html:W});var af=$.Browser.getInfo();switch(af.os){case"ipad":case"ipod":case"iphone":case"android":ab.switchText({text:true,force:true});break}}else{}}else{ab.set({text:W})}ab.sign.load()}function B(e){var S=this;S.component.changeEditMode(e)}function D(V){V=V||{};var T=this;var U=T.base;var S=U.get({status:"showHtmlbar"});var e=V.toggle;if(V.show){if(S){return false}else{e=true}}if(V.hide){if(!S){return false}else{e=true}}if(e){S=T.component.toogleToolbar();U.set({status:"showHtmlbar",value:S});if(V.click){Log.cache({cl_bar:S?"1":"0"},$.EMPTYFUNC)}return true}else{return false}}function s(S){var e=this;e.component.focus(S)}function L(S){var e=this;e.component.insert(S)}function f(S){var e=this;e.component.del(S)}function m(T){var V=this;var X=V.base;var W=V.form;if(Ext.shortcut&&(T.ctrlKey||T.metaKey)){var S=T.keyCode;if(S==13||S==83){if(X.getAction()){}else{if(S==13){try{W.focus("subject");W.blur("subject")}catch(U){}X.send({action:"deliver",source:"shortcut"})}else{if(S==83){if($.Browser.chrome()){X.addTimer("save",function(){try{X.send({action:"save"})}catch(Y){}},500)}else{X.send({action:"save"})}}}}}}if(T.keyCode==27){setTimeout(function(){V.base.get({id:"div$id$Editor"}).dom.nextSibling.focus()},0)}if(T.shiftKey){if(T.keyCode==9){X.form.focus("subject")}}}function u(T){T=T||{};var S=this;var e=T.text;if(S.get({status:"text"})==e){return false}if(e){if(T.force){S.setMode("text")}else{if(S.get({empty:true})){S.switchText({text:true,force:true})}else{$.Msgbox.show({type:"confirm",title:"将此邮件转换为纯文本将会遗失某些格式，您确定要继续吗？",ok:function(){S.switchText({text:true,force:true})}})}}}else{S.setMode("html")}}function R(){var U=this;var V='<div class="nui-normalTabs nui-tabs"><div id="dvMsgBoxTab1" class="nui-tabs-item nui-tabs-item-selected">我的电脑</div><div id="dvMsgBoxTab2" class="nui-tabs-item nui-tabs-item-hover">网址URL</div></div><ul class="APP-editor-insertPic-panel"><li id="liMsgBoxPanel1" class="APP-editor-insertPic-panel-item"><div class="APP-editor-insertPic-remark">点击“浏览”，在您电脑中选择要上传的图片，每张图片上传完毕后将会自动添加到正文中</div></li><li id="liMsgBoxPanel2" class="APP-editor-insertPic-panel-item" style="display:none"></li></ul>';var T=null;T=$.Msgbox.show({header:"添加图片",content:V,extcls:"APP-editor-insertPic",contentType:"normal",autoFocus:false,listeners:[{name:"fullrender",handler:function(){new $.Button({renderTo:$("#liMsgBoxPanel1")["dom"].firstChild,text:"浏览",subclass:"mainBtn",click:function(){if(Ud.get({field:"ntes_option",flag:"flashupload"})!="1"){if(o.has()){if(o.hasNewVersion()){U.attach.pluginBrowse({type:"image",title:"选择要上传的图片",call:function(Y){if(Y.length){$.Array.each(Y,function(Z,aa){aa.inlined=aa.context=true});U.attach.pluginSelect(Y)}else{}}})}else{U.assist.setup("upload")}}else{if(U.attach.nativeBrowse){var W=U.attach;var X=$("#inputFileImage");if(!X){X=$.Element.create("input");X.setStyle({visibility:"hidden"});X.setAttr({id:"inputFileImage",type:"file",size:"1",multiple:true,accept:"image/*"});document.body.appendChild(X.dom)}X.one("change",function(){var Z=X.dom.files;if(Z.length){Z=$.Object.toArray(Z);$.Array.each(Z,function(ab,aa){aa.inlined=aa.context=true});W.nativeSelect(Z);try{X.dom.value=""}catch(Y){}}else{}});X.dom.click()}else{U.assist.setup()}}T.close()}else{$.Msgbox.show({title:"普通附件上传模式不支持本地图片上传，请切换到高级上传模式"})}}});new $.Button({renderTo:$("#liMsgBoxPanel1")["dom"].firstChild,text:"取消",click:function(){T.close()}});new $.Component({html:"<span></span>",renderTo:"liMsgBoxPanel2",items:[{xtype:"input"},{xtype:"button",text:"添加",subclass:"mainBtn",click:function(){var X=this.ownerCt.find("input")[0];var W=X.getValue();if(W&&W!="http://"){U.insert({image:W});T.close()}else{X.showTips("请输入合法的地址","err")}}},{xtype:"button",text:"取消",click:function(){T.close()}},{html:'<p class="APP-editor-insertPic-remark">请在输入框里面填上要添加图片的URL</p>'}]});this.buttons.ok.hide()}}]});if(Ext.photo){T.add({xtype:"link",text:"从博客相片选择",cls:"nui-txt-link",renderTo:T.footer,click:function(){T.close();U.attach.photoOpen()}})}var e=$("#dvMsgBoxTab1","#dvMsgBoxTab2");var S=$("#liMsgBoxPanel1","#liMsgBoxPanel2");e.listen("click",function(Y){var Z=0;var W=1;var X=$.Event.getTarget(Y);if(X.id=="dvMsgBoxTab2"){Z=1;W=0}var aa="nui-tabs-item-selected";if(e.doms[Z].className.indexOf(aa)==-1){$(e.doms[W]).setClass("nui-tabs-item nui-tabs-item-hover");$(S.doms[W]).hide();$(e.doms[Z]).setClass("nui-tabs-item nui-tabs-item-selected");$(S.doms[Z]).show()}});Log.cache({cl_image:"1"},$.EMPTYFUNC)}function y(e){var S=this;S.component.hidePopup();S.insert({image:e})}function K(e){var X=this;if(r.isArray(e)){e=e[0]}var U=X.sign;var S=[];var T={};var W={renderTo:e,groups:[T]};if($S("isVip")){W.width="403px";var Y=X.base.getCallName(function(ab,Z,aa){switch(ab){case"get":return U.get({text:true});break;case"set":if(Z==0){N.goOutlink({key:"vcard"})}else{if(Z==1){x.entry("SignModule")}else{if(Z==2){N.goOutlink({key:"shangdao"})}}}break;case"select":if(Z==0){U.fillGraph(aa)}else{if(Z==1){U.fillText(aa)}}break}});var V=$.String.addParam(Uri.getUrl("compose_sign"),"call=window.parent."+Y);T.content='<iframe src="'+V+'" style="display:block;width:401px;height:240px" scrolling="no" frameborder="0"></iframe>'}else{U.each({text:true,call:function(aa,Z){if(Z){S.push({text:$.String.escapeHTML(Z.name),click:function(){U.select({text:true,id:Z.id})}})}}});U.each({card:true,call:function(Z,aa){if(Z==0&&S.length){S.push({type:"split"})}S.push({text:$.String.escapeHTML(aa.cardName),click:function(){U.select({card:true,id:aa.id})}})}});if(S.length){S.push({type:"split"})}S.push({text:"个性签名",click:function(){U.showCustom()}});S.push({text:"设置签名",hidden:gCommon.newwin,click:function(){x.entry("SignModule")}});if($S("isFree")){S.push({text:"设置电子名片",hidden:gCommon.newwin,click:function(){N.goOutlink({key:"compose_ecard_entry",group:"ecard"})}})}T.items=S}Log.cache({cl_sign:"1"},$.EMPTYFUNC);return(new $.Menu(W).getEl()["dom"])}function w(e){var U=this;if(r.isArray(e)){e=e[0]}var V=U.base.getCallName(C.bind(U.addPortrait,U));var T=$.String.addParam(Uri.getUrl("compose_portrait",true),"call=window.parent."+V);var S={width:"382px",extcls:"APP-editor-menuNoBorder APP-editor-menuNoBorder-insertFace",renderTo:e,groups:[{content:'<iframe class="APP-editor-menu-iframe" allowtransparency="allowtransparency" src="'+T+'" frameborder="0" scrolling="no"></iframe>'}]};Log.cache({cl_portrait:"1"},$.EMPTYFUNC);return(new $.Menu(S).getEl()["dom"])}function a(){var S=this;var T=S.base;var e="stationery";if(T.get({status:"showSide"})&&T.get({status:"sidePanel"})==e){}else{S.event.switchSide({show:true,panel:e})}Log.cache({cl_stationery:"1"},$.EMPTYFUNC)}function g(){var T=this;var S=$.Browser.getVersion()||[0,0];if($.Browser.chrome()&&S[0]>=11){var U='<div class="APP-editor-speech"><div class="nui-multiLineIpt nui-ipt"><textarea id="textAreaComposeVoice" class="nui-ipt-input"></textarea></div><div class="APP-editor-speech-tips nui-txt-tips nui-txt-s12"><span class="APP-editor-speech-tipsLeft">请点击图标</span><span class="APP-editor-speech-iptOuter"><input id="inputComposeVoice" class="nui-ipt-input" type="text" autocomplete="off" value="" x-webkit-speech="" style="cursor:pointer" title="请点击话筒图标，开始语音输入"></span><span class="APP-editor-speech-tipsRight">开始语音输入</span></div></div>';$.Msgbox.show({type:"confirm",contentType:"wide",header:"语音输入",content:U,ok:function(){var V=$("#textAreaComposeVoice").dom.value;T.insert({html:V})}});$("#inputComposeVoice").listen("webkitspeechchange",function(){var V=$("#inputComposeVoice").dom;$("#textAreaComposeVoice").dom.value+=V.value;V.value=""});$("#inputComposeVoice").listen("focus",function(){$("#textAreaComposeVoice").dom.focus()})}else{var e="您的浏览器不支持语音输入功能，建议您选择<br/>Google Chrome浏览器进行体验，";if($.Browser.chrome()){e="您的Chrome浏览器版本过低，建议您升级到新版本进行体验，"}var U=e+'<a href="http://codown.youdao.com/163chrome/b/output/ChromeSetup/ChromeSetup.exe" target="_blank">立即下载</a>。<br/>点击此处<a href="http://chrome.163.com" target="_blank">了解详情</a>。';$.Msgbox.show({title:U})}}function J(e){var S=this;var T=S.base;if(T.get({status:"confirmSubject"})){if(T.form.getSubject()==""){S.action.getSubject({url:e,callback:$.Function.bind(S.fillSubject,S),error:function(){return true}});T.set({status:"confirmSubject",value:false})}}}function O(e){var S=this;var T=S.base;if(T.form.getSubject()==""){if(e.code==S_OK){T.form.setSubject(e["var"]["title"])}}}function P(e){var S=this;var T=S.form;if(T.getSubject()==""){var U=S.get({text:true});setTimeout(function(){var W=S.get({text:true});var ac=U.length;var V=W.length;var ab=3000;if(ac>ab||V>ab){return}for(var X=0;X<ac&&X<V;X++){if(U.charAt(ac-X-1)!=W.charAt(V-X-1)){break}}var Y=ac-X;var aa=V-X;for(var X=0;X<ac&&X<V;X++){if(U.charAt(X)!=W.charAt(X)){break}}if(X<Y){Y=X}var Z=(Y==aa?W:W.substring(Y,aa)).replace(/[\r\n]/ig,"");if(Z.indexOf("http://")==0){S.getSubject(Z)}},15)}}function t(X){var W=this;if(X&&X.length){var V=X[0];var U=W.attach;var S=V.action;switch(S){case"deleteAttach":var T=V.id;var e=U.fileGet({sid:T});if(e&&e.length==1){U.remove(e[0])}break}}}})();(function(){try{var d=$L("module.compose.Compose")}catch(f){return f}var k=$.createClass($N("module.compose.ComposeEncrypt"));var g=$.Object;g.inherit(k,d);g.extend(k.prototype,{initialize:l,init:h,clear:i,get:j,verify:c,focus:b,toggle:a});function l(e){var m=this;g.extend(m,{component:{encrypt:null,save:null,pass:null},element:{area:null}});k.superClass.initialize.call(m,e)}function h(){var n=this;k.superClass.init.call(n);var o=n.base;var m=n.component;var e=n.element;m.encrypt=o.get({component:"encrypt"});m.save=o.get({component:"encryptSave"});m.pass=o.get({component:"encryptPass"});e.area=o.get({id:"div$id$Encrypt"});e.focus=o.get({id:"a$id$EncryptFocus"})}function i(){var e=this;k.superClass.clear.call(e.element);k.superClass.clear.call(e)}function j(n){n=n||{};var m=this;var e=m.component;if(n.save){return e.save.getChecked()}else{return e.pass.getValue()}}function c(){var o=this;var m=true;var e=o.get();if(e){if(e.length==6){var n=new RegExp("[_\\W]");if(n.test(e)){m=false}}else{m=false}}else{m=false}if(m){return m}else{new $.Msgbox({content:"密码必须是六位的字母、数字组成，字母区分大小写。",ok:function(){o.focus({select:true})}});return m}}function b(p){p=p||{};var o=this;var m=o.component;try{m.pass.focus()}catch(n){}if(p.select){try{m.pass.select()}catch(n){}}}function a(s){s=s||{};var q=this;var r=q.base;var o=q.element;var n=r.get({status:"showEncrypt"});var m=true;if(s.open){if(n){return false}}if(s.close){if(!n){return false}}if(m){if(n){o.area.hide()}else{if(r.get({status:"showSchedule"})){new $.Msgbox({content:'抱歉，"邮件加密"功能无法与"定时发信"功能同时使用。'});return false}o.area.show();o.focus.show();try{o.focus["dom"].focus();o.focus["dom"].blur()}catch(p){}o.focus.hide()}r.set({status:"showEncrypt",value:!n});return true}else{return false}}})();(function(){try{var k=$L("module.compose.Compose");var g=$L("interface.OutlinkInterface")}catch(q){return q}var r=$.Object;var d=$.createClass($N("module.compose.ComposeEvent"));r.inherit(d,k);r.extend(d.prototype,{initialize:l,init:o,fireTab:b,fireBar:s,setTo:m,setCc:a,setBcc:h,setSeparate:c,activePanel:j,switchPanel:f,switchSide:i,hideFloat:p,setDragArea:n});function l(t){var e=this;d.superClass.initialize.call(e,t)}function o(){var e=this;d.superClass.init.call(e);var t=e.base;if($S("isCorp")){t.set({element:"panelCorpAddress",value:t.get({id:"div$id$Corp"})})}t.set({element:"panelAddress",value:t.get({id:"div$id$Address"})});t.set({element:"panelStationery",value:t.get({id:"div$id$Stationery"})});t.get({id:"a$id$Switch"}).listen("click",function(u){e.switchSide({click:true});Log.cache({cl_switch:"1"},$.EMPTYFUNC)})}function b(u){u=u||{};var t=this;var e=u.func;switch(e){case"corp":Log.cache({cl_corp_address:"1"},$.EMPTYFUNC);t.switchPanel({name:"corp"});break;case"address":Log.cache({cl_address:"1"},$.EMPTYFUNC);t.switchPanel({name:"address"});break;case"stationery":Log.cache({cl_stationery:"2"},$.EMPTYFUNC);t.switchPanel({name:"stationery"});break;default:return;break}}function s(A){A=A||{};var v=this;var z=v.base;var t=A.func;var u=(A.pos=="bottom"?"2":"1");switch(t){case"deliver":Log.cache({cl_send:u},$.EMPTYFUNC);z.send({action:"deliver"});break;case"save":Log.cache({cl_save:u},$.EMPTYFUNC);z.send({action:"save"});break;case"preview":Log.cache({cl_preview:u},$.EMPTYFUNC);z.preview();break;case"cancel":Log.cache({cl_cancel:u},$.EMPTYFUNC);if(gCommon.newwin){window.close()}else{Tab.remove(v.module)}break;case"postcard":Log.cache({cl_postcard:"1"},$.EMPTYFUNC);g.goOutlink({key:"read_postcard",param:{from:"compose"}});break;case"card":Log.cache({cl_card:"1"},$.EMPTYFUNC);g.goOutlink({key:"cards_read",param:{from:"compose"}});break;case"dict":Log.cache({cl_dict:u},$.EMPTYFUNC);try{var y=$L("product.Translate")}catch(x){return x}y.change();break;case"template":Log.cache({cl_template:u},$.EMPTYFUNC);g.goOutlink({key:"compose_vip_template",param:{from:"compose"}});break;case"new":var w=Uri.getUrl("compose_new",true);window.open(w);break;case"upTips":setInterval(function(){$.Popup.show({content:$.Date.format(new Date(),"yyyy年M月d日 H:mm:ss 提示框")})},6000);break;case"newTips":setInterval(function(){$.Tips.show({succ:true,expire:0,text:$.Date.format(new Date(),"邮件已于H:mm:ss成功保存到草稿箱")})},6000);break;case"baseTips":setInterval(function(){var e=$.Date.format(new Date(),"yyyy年M月d日 H:mm:ss 自动保存新邮件提示");z.tips(e)},3000);break;default:break}}function m(x){x=x||{};var u=this;var w=u.base;var t=w.get({status:"showTo"});var v=w.get({id:"div$id$to"});var e=x.toggle;if(x.show){if(t){return}else{e=true}}if(x.hide){if(!t){return}else{e=true}}if(e){if(t){v.hide()}else{v.show()}w.set({status:"showTo",value:!t})}}function a(z){z=z||{};var v=this;var y=v.base;var x=v.form;var t=y.get({status:"showCc"});var w=y.get({id:"div$id$cc"});var u=y.get({component:"ccLink"});var e=z.toggle;if(z.show){if(t){return}else{e=true}}if(z.hide){if(!t){return}else{e=true}}if(e){if(t){if(z.separate){}else{if(!x.getContact("empty","cc")){new $.Msgbox({type:"confirm",title:"要删除已经存在的所有抄送地址吗？",ok:function(){x.setContact(null,"cc");v.setCc({hide:true})}});return}}u.setText("添加抄送");w.hide();if(!z.separate){if(y.get({status:"inputChoose"})=="cc"){x.focus("to")}}}else{u.setText("删除抄送");w.show();if(!z.separate){x.focus("cc")}}y.set({status:"showCc",value:!t})}}function h(z){z=z||{};var u=this;var y=u.base;var x=u.form;var w=y.get({status:"showBcc"});var v=y.get({id:"div$id$bcc"});var t=y.get({component:"bccLink"});var e=z.toggle;if(z.show){if(w){return}else{e=true}}if(z.hide){if(!w){return}else{e=true}}if(e){if(w){if(z.separate){}else{if(!x.getContact("empty","bcc")){new $.Msgbox({type:"confirm",title:"要删除已经存在的所有密送地址吗？",ok:function(){x.setContact(null,"bcc");u.setBcc({hide:true})}});return}}t.setText("添加密送");v.hide();if(!z.separate){if(y.get({status:"inputChoose"})=="bcc"){x.focus("to")}}}else{t.setText("删除密送");v.show();if(!z.separate){x.focus("bcc")}}y.set({status:"showBcc",value:!w})}}function c(v){v=v||{};var E=this;var C=E.base;var D=E.form;var y=C.get({status:"useSeparate"});var u=C.get({id:"div$id$separate"});var F=C.get({component:"separateLink"});var w=C.get({component:"ccLink"});var A=C.get({component:"bccLink"});var B=v.toggle;if(v.show){if(y){return}else{B=true}}if(v.hide){if(!y){return}else{B=true}}if(B){if(y){w.show();A.show();F.setText("使用群发单显");u.hide();var x=D.getContact("suc","separate");var G=x.length;var z={};$.Array.each(x,function(H,I){z[I.address.toLowerCase()]=1});var t=function(I){var H=[];if(G){$.Array.each(D.getContact("suc",I),function(J,L){var K=L.address.toLowerCase();if(z[K]){z[K]++;H.push(L)}else{}})}if(H.length){D.setContact(H,I)}else{D.setContact(null,I)}};if(y.showTo){t("to");E.setTo({show:true,separate:true})}if(y.showCc){t("cc");E.setCc({show:true,separate:true})}if(y.showBcc){t("bcc");E.setBcc({show:true,separate:true})}if(G){var e=[];$.Array.each(x,function(H,I){if(z[I.address.toLowerCase()]>1){}else{e.push(I)}});D.addContact(e,"to")}D.setContact(null,"separate");D.focus(y.inputChoose);y=null}else{y={};y.inputChoose=C.get({status:"inputChoose"});w.hide();A.hide();F.setText("取消群发单显");u.show();if(C.get({status:"showTo"})){D.addContact(D.getContact("suc","to"),"separate");E.setTo({hide:true,separate:true});y.showTo=true}if(C.get({status:"showCc"})){D.addContact(D.getContact("suc","cc"),"separate");E.setCc({hide:true,separate:true});y.showCc=true}if(C.get({status:"showBcc"})){D.addContact(D.getContact("suc","bcc"),"separate");E.setBcc({hide:true,separate:true});y.showBcc=true}D.focus("separate")}C.set({status:"useSeparate",value:y})}}function j(y){y=y||{};var u=this;var x=u.base;var w=y.name;var t=x.get({component:"sideTab"});try{t.find("#"+w).active()}catch(v){}}function f(z){z=z||{};var t=this;var y=t.base;var x=z.name;if(x==y.get({status:"sidePanel"})){return false}var e=[y.get({element:"panelAddress"}),y.get({element:"panelStationery"})];var w=arguments.callee;var v=function(){w.call(t,z)};if(x=="address"){if(y.initAddress({call:v})==true){e[1].hide();if($S("isCorp")){y.get({element:"panelCorpAddress"}).hide()}e[0].show();y.set({status:"sidePanel",value:"address"});return true}}else{if(x=="stationery"){if(y.initStationery({call:v})==true){e[0].hide();if($S("isCorp")){y.get({element:"panelCorpAddress"}).hide()}e[1].show();y.set({status:"sidePanel",value:"stationery"});return true}}else{if(x=="corp"){if(y.initCorp({call:v})==true){var u=y.get({element:"panelCorpAddress"});u.show();e[0].hide();e[1].hide();y.set({status:"sidePanel",value:"corp"});return true}}}}return false}function i(y){y=y||{};var e=this;var x=e.base;var w=x.get({status:"showSide"});var u=x.get({element:"main"});var v=x.get({id:"a$id$Switch"});var t=true;if(y.panel){e.activePanel({name:y.panel})}else{if(x.get({status:"sidePanel"})==""){e.activePanel({name:"address"})}}if(y.show){if(w){return false}}if(y.hide){if(!w){return false}}if(t){if(w){v.dom.title="显示通讯录";v.dom.firstChild.firstChild.className="nui-ico nui-ico-lArr";u.addClass("pr")}else{v.dom.title="隐藏通讯录";v.dom.firstChild.firstChild.className="nui-ico nui-ico-rArr";u.removeClass("pr")}x.set({status:"showSide",value:!w});if(!y.init){Ud.set({field:"ntes_global",flag:"compose_showContacts",value:(w?"1":"0")})}x.addTimer("layout",function(){e.attach.layout()},300);return true}else{return false}}function p(e,t){$.Event.fire(document.body,"click")}function n(e){var z=this;var y=z.base;var A=y.get({element:"dragArea"});var w=y.get({element:"dragClose"});var t=(A.dom.style.display!="none");if(e.toggle){if(t){z.setDragArea({hide:true,force:true})}else{z.setDragArea({show:true,close:true})}return}if(e.show){if(!t){if(e.close){A.set("dragType","close");w.show()}else{A.set("dragType","auto");w.hide()}z.setDragArea({auto:true});A.show()}if($.Browser.ie()&&!e.close){z.editor.setMask(true)}return}if(e.hide){var u=false;if(t){if(A.get("dragType")=="close"){if(e.force){u=true}else{}}else{u=true}}if(u){y.addTimer("dragarea",function(){A.hide()},$.Browser.ie()?0:500)}if($.Browser.ie()){z.editor.setMask(false)}return}if(e.auto){var x=0;x+=y.get({element:"subject"})["dom"].offsetHeight;x+=y.get({element:"attach"})["dom"].offsetHeight;x+=y.get({id:"div$id$AttachArea"})["dom"].offsetHeight;x+=z.editor.getBarHeight();x+=82;var v=x+"px";A.setStyle({height:v,lineHeight:v});return}}})();(function(){try{var r=$L("module.compose.Compose");var b=$L("support.AddressSupport")}catch(u){return u}var w=$.Object;var f=$.createClass($N("module.compose.ComposeForm"));w.inherit(f,r);w.extend(f.prototype,{initialize:n,init:l,setSender:y,getSender:h,addContact:m,setContact:g,getContact:t,removeContact:p,showContact:d,remindValid:s,remindShow:c,remindRemove:o,setSubject:k,getSubject:v,getCheckbox:j,setCheckbox:a,focus:q,choose:x,blur:i,todo:function(){}});function n(e){var z=this;w.extend(z,{element:{priority:null,receipt:null,text:null,sms:null},fixData:{},fixElement:{}});f.superClass.initialize.call(z,e)}function l(){var e=this;f.superClass.init.call(e);var z=e.base;z.get({component:"subject"})._inputEl.setAttr({id:z.get({"$id$":"obj$id$Subject"})})}function y(A){var z=this;var e=z.base.get({component:"sender"});if(typeof A=="string"){A=Uri.matchEmail(A);if(A){A=new Email(A.address,A.name)}else{return}}e.setValue(A)}function h(){var z=this;var e=z.base.get({component:"sender"});var A=e.getValue();return A}function m(e,z){var A=this;var C=A.base;if(!z){z=C.get({status:"inputChoose"})}var B=C.get({component:z});B.addItem(e)}function g(K,E,P){var N=this;var M=N.base;if(!E){E=M.get({status:"inputChoose"})}var D=M.get({component:E});if(K){if(P){var C=[];try{for(var F=0,O=K.length;F<O;F+=1){var A=Uri.getEmails(K[F],null,true);var L=A.match;var H;if(L.length>0){H=L[0];C.push(H)}}}catch(J){}var I=b.mappingEmails(C,P);var G=[];var B=I.data;for(var F=0,O=B.length,z;F<O;F+=1){z=B[F];G.push(new Email(z.address,z.name))}D.setItem(G)}else{D.setItem(K)}}else{D.clearItem()}}function t(D,z){var A=this;var C=A.base;if(!z){z=C.get({status:"inputChoose"})}var B=C.get({component:z});if(D=="build"){var e=B.get("suc");$.Array.each(e,function(E,F){if(F.name&&F.name.indexOf('"')!=-1){F.name=F.name.replace('"',"")}e[E]=F.toString()});return e}else{return B.get(D)}}function p(e,z){var A=this;var C=A.base;if(!z){z=C.get({status:"inputChoose"})}var B=C.get({component:z});B.delItem(e)}function d(B){var A=this;A.choose(B);var z={to:"收件人",cc:"抄送人",bcc:"密送人",separate:"群发单显"};var e=z[B];$E(["component.SelectContact"],function(D){var C=A.getContact("suc",B);D.show({exist:C,title:e,callback:function(F){var E=[];$.Array.each(F,function(G,H){E.push(H)});A.setContact(E,B);A.focus(B)}})})}function s(C){var G=this;var F=G.base;if(!Ext.contactCorrect){return}var E=G.getContact("build",C);var H=F.change;if(!H.composeInfo){return}if(w.compare(E,H.composeInfo[C])){return}else{H.composeInfo[C]=E}if(!C){C=F.get({status:"inputChoose"})}var B=F.get({component:C});var z=B.get("array");var D=[];for(var A=0;A<z.length;A++){D.push(z[A].address)}var e={"var":{input:D},callback:function(I){G.remindShow(C,I)}};G.action.contactCorrect(e)}function c(D,H){var J=this;var I=J.base;var B=H.responseText;var G=$.Eval.get(B);if(G&&G.code==200){var e=G.data;var E=e.wrongbob;var F=e.wrongdomain;if(w.isEmpty(E)&&w.isEmpty(F)){return}if(!J.fixElement[D]){J.fixElement[D]={};J.fixElement[D]["child"]={}}var z=J.fixElement[D];w.each(E,function(L,M){J.fixData[L]={address:M,type:0}});w.each(F,function(L,M){if(J.fixData[L]){throw $.CONTINUE}var N=L.split("@")[0]+"@"+M;J.fixData[L]={domain:M,address:N,type:1}});var K=z.component;var C=I.get({component:D});if(K){K.empty();K.show()}else{K=$.Element.create("DIV");K.setClass("bo");C.getEl().after(K.dom);z.component=K}var A=$.Element.create("P");A.html("我们发现您输入的地址可能有误，请选择修改：");K.append(A.dom);w.each(J.fixData,function(O,P){var M=P.type;var R=P.address;var Q=C.findItem(O);if(!Q){throw $.CONTINUE}Q.setWarn(M);var U=$.Element.create("P");var N=$.Element.create("SPAN");N.html(O+" →");var L=$.Element.create("A");L.setAttr({href:"javascript:void(0)"});L.setClass("nui-txt-link");var S=M==0?R:P.domain;L.html(S);L.listen("click",function(V){Q.fixWarn({address:R});J.remindRemove(D,O);$.Event.cancel(V)});U.append(N.dom);U.append(L.dom);K.append(U.dom);var T=O.toLowerCase();z.child[T]=U});new $.Link({text:"关闭该提醒功能",cls:"nui-txt-link",renderTo:K,click:function(){K.empty();K.hide();I.setOption({field:"ntes_letter",flag:"remindShow",value:"1"},true);w.each(J.fixData,function(L,M){var N=C.findItem(L);if(!N){throw $.CONTINUE}N.fixWarn({address:N.address})})}})}}function o(A,z){var B=this;var e=B.fixElement[A];z=z.toLowerCase();e.child[z].remove();delete e.child[z];if(w.isEmpty(e.child)){e.component.empty();e.component.hide()}}function k(z){var A=this;var e=A.base.get({component:"subject"});e.setValue(z);A.module.setText(z)}function v(){var z=this;var e=z.base.get({component:"subject"});return e.getValue()}function j(e){var z=this;var A=z.base.get({component:e});return A.getChecked()}function a(e,C,B){var z=this;var A=z.base.get({component:e});A.setChecked(C,B)}function q(e){var z=this;if(e){if(e=="subject"){}else{z.choose(e)}}else{e=z.base.get({status:"inputChoose"})}z.base.get({component:e}).focus()}function x(z){var A=this;var B=A.base;var e=B.get({status:"inputChoose"});if(z!=e){e=z;B.set({status:"inputChoose",value:e})}}function i(e){var z=this;if(e){}else{e=z.base.get({status:"inputChoose"})}z.base.get({component:e}).blur()}})();(function(){try{var c=$L("module.compose.Compose")}catch(d){return d}var f=$.Object;var b=$.createClass($N("module.compose.ComposeInfo"));f.inherit(b,c);f.extend(b.prototype,{initialize:j,init:i,getClientId:h,set:g,get:a});function j(k){var e=this;f.extend(e,{cid:"",did:"",mid:"",ids:null,obj:{},con:[]});b.superClass.initialize.call(e,k)}function i(){var e=this;b.superClass.init.call(e)}function h(){var k;try{k=$I("util.Misc").getTime(0)}catch(l){k=new Date()}return["c",k.valueOf()].join(":")}function a(k){k=k||{};var e=this;if(k.cid){return e.cid}else{if(k.did){return e.did}else{if(k.mid){return e.mid}else{if(k.ids){return e.ids}else{if(k.obj){return e.obj}else{if(k.con){return e.con}}}}}}}function g(k){k=k||{};var e=this;if(typeof k.obj=="object"){e.obj=k.obj;if(k.obj["id"]){k.cid=k.obj["id"]}}if(typeof k.cid=="string"){e.cid=k.cid}if(typeof k.did=="string"){e.did=k.did}if(typeof k.mid=="string"){e.mid=k.mid}if(typeof k.ids=="object"){e.ids=k.ids}if(typeof k.con=="object"){e.con=k.con}}})();(function(){var a=$I("module.BaseListener");ComposeListener=$.createClass($N("module.compose.ComposeListener"));$.Object.inherit(ComposeListener,a,{_listeners:{"options:composeModify":{handler:b},"options:personalModify":{handler:b},"addr:dataInit":{handler:c},"addr:dataReset":{handler:c}}});function b(g){var d=this["module"];var h=d.base;try{h.fireOption(g)}catch(f){}}function c(){var f=this["module"];var d=f.address;try{d.refresh()}catch(g){}}})();(function(){try{var g=$L("interface.ComposeInterface");var p=$L("module.compose.ComposeAction");var b=$L("support.SenderList")}catch(i){return i}var j=$.Object;var n=$.createClass($N("module.compose.ComposeManager"));j.extend(n,{"interface":g,entry:f,error:c,verify:k,test:m,quickBuild:h,quickReply:o,quickForward:a,quickSuccess:l,quickError:d});function f(s){var q={module:"compose.ComposeModule",param:s};if(!s){s={}}s.type=s.type||"compose";if(s.type=="compose"){if(s.info){q.reset=false;q.forceRemove=true}else{q.useCache=true}}else{if(s.type=="reply"||s.type=="forward"||s.type=="draft"||s.type=="edit"){q.reset=false;q.forceRemove=true}}if(!s.info){s.info={}}else{q.reset=false}var e=Context.module;if(e&&e.mtype!="compose.ComposeModule"){var e=null;JS5.each(function(t,u){if(u.mtype=="compose.ComposeModule"){e=u;return $.BREAK}});if(e){if(e.empty()){JS5.go({module:"compose.ComposeModule",useCache:true});e.param=s;var r=e.base;r.set({status:"initSign",value:false});r.set({status:"useSign",value:null});e.getData($.EMPTYFUNC);r.autoSave();return}else{if(Tab.exist(e)){JS5.go({module:"compose.ComposeModule",useCache:true})}}}}JS5.go(q)}function c(q){var e=this;var r="";switch(q.code){case"FA_FORBIDDEN":r="发信附加功能权限不足！";break;case"FA_OVERFLOW":if(q.overflowReason){r=q.overflowReason;switch(r){case"pref_smtp_max_mail_count":r="信件封数超过限制！";break;case"pref_smtp_max_num_rcpts":r="收件人个数超过限制！";break;case"pref_smtp_max_send_mail_size":r="信件大小超过限制！";break;case"pref_flow_limit":r="信件流量超过限制！";break;case"pref_quota":r="存草稿或定时发信时邮箱容量超过限制，请尽快清理邮箱。";break}}else{r="";r+="1、收件人个数超过限制　　　　　&nbsp;<br>";r+="2、信件大小或流量超过限制　　　&nbsp;<br>";r+="3、存草稿或定时发信容量超过限制&nbsp;"}break;case"FA_NO_RECEIPT":r="发信时缺少收件人！";break;case"FA_WRONG_RECEIPT":r="收件人地址格式错误！";if(q.badAddress){r+="("+$.String.escapeHTML(q.badAddress)+")"}break;case"FA_INVALID_ACCOUNT":r="发件人地址格式错误！";if(q.badAddress){r+="("+$.String.escapeHTML(q.badAddress)+")"}break;case"FA_INVALID_DATE":r="定时发信设置时间错误！";break;case"FR_INVALID_REQUEST":r="发信内容格式错误！";break;case"FA_MTA_USER_BLACK_LIST":r="黑名单用户不允许发信！";break;case"FA_MTA_TOO_MANY_RCPTS":r="发送人数超过限制！";break;case"FA_MTA_RCPT_ERROR":(function(){var v;var x=q.errorRcpts;var w="";var u=[];for(w in x){if(typeof w=="string"&&w.indexOf("@")!=-1){if(x[w]){switch(x[w]){case"MTA5104":v="帐号被停用";break;case"MTA5107":v="帐号不存在";break;default:v="帐号被禁止";break}}else{v="系统不允许"}v='<label title="'+v+'">'+w+"</label>";u.push(v)}}r=u.join("<br>")})();if(r){r="以下邮件地址将无法成功收到信件："+r}else{r="对不起，存在部分收件人无法收到信件！"}break;case"FA_MTA_REJECTED":if(q.mtaCode){switch(q.mtaCode){case 5510:r="IP地址异常，请求被拒绝！";break;case 5511:r='对不起，您的帐号目前被系统禁止发信，请<a href="http://feedback.mail.126.com/antispam/complain.php?user='+$S("uid")+'" target="_blank">点击这里申诉</a>。';break;case 5520:r="对不起，您今天发送邮件数量超过限制，请明日再试！";break;case 5521:r="短时间发信过多，请稍后再试！";break;case 5530:r="对不起，您今天发送对象过多，请明日再试！";break;case 5531:r="短时间发送对象过多，请稍候尝试！";break;case 5522:r="操作过于频繁，请求被拒绝！";break;case 4512:case 5540:case 5910:r="邮件含敏感内容，请求被拒绝！";break;case 5911:r="对不起，您只能发送邮件给系统管理员！";break;case 5532:r="对不起，您本次群发的收件人数量超过限制，请减少后重发！";break;case 5550:r="5550";break;default:break}}if(!r){r="对不起，未知原因导致服务器拒绝发送！";if(q.mtaCode){r+="(错误码:"+q.mtaCode+")"}}break;default:break}return r}function k(e,x,t){var w={need:"非常抱歉，系统认为您需要输入验证码才能继续完成发信，如有不便，敬请体谅！",invalid:"验证码不正确，请重新输入！"};var u=w[e];var q="s?func=user:generateVerifyCodeImage&sid="+$S("sid")+"&time="+(new Date()).valueOf();var v="<p>"+u+'</p><img id="imgMsgBoxVerify" src="'+q+'" alt="验证码图片" ><p><a id="aMsgBoxVerify" href="javascript:void(0)" class="nui-txt-link">看不清楚？换一个</a></p>';$.Msgbox.show({type:"prompt",header:"发信验证",title:"填写验证码",content:v,inputWidth:"300px",ok:function(z){var y=$.String.trim(z);if(!y){return"验证码不能为空"}if(x){x(y)}},cancel:function(){if(t){t()}}});var s=$("#aMsgBoxVerify");var r=$("#imgMsgBoxVerify");s.listen("click",function(){var y=r.dom.src;var z=new RegExp("&time=.*|$","i");y=y.replace(z,"&time="+(new Date()).valueOf());r.dom.src=y;return false})}function m(){var q=this;var s=$S("uid");var r=[];var e=false;r.each(function(t,u){if(u==s){e=true;throw $.BREAK}});return e}function h(s){var r=this;var q;if(s.attrs){q=s.attrs}else{q=s.attrs={}}if(typeof q.account!="string"){try{q.account=b.getDefault().toString()}catch(t){}}if(typeof q.saveSentCopy!="boolean"){if($S("attrs").user.save_sent<2){q.saveSentCopy=true}}if(typeof q.requestReadReceipt!="boolean"){if(Ud.get({field:"ntes_option",flag:"requirereceipt"})=="1"){q.requestReadReceipt=true}}if(typeof q.charset!="string"){if(Ud.get({field:"ntes_option",flag:"mailencode"})=="1"){q.charset="UTF-8"}}s.returnInfo=false;s.action="deliver";if($S("attrs").user.save_sent==0){s.saveTextThreshold=1048576}return s}function o(s){var r=this;var q=s.id;var e=s.body;e.id=q;s.flag="replied";p.prototype.replyMessage({body:r.quickBuild(e),log:{action:"fastreply"},error:$.Function.bind(r.quickError,r,s,r.quickReply),callback:$.Function.bind(r.quickSuccess,r,s)});$.Tips.show("正在回复邮件...")}function a(s){var r=this;var q=s.id;var e=s.body;e.ids=[q];s.flag="forwarded";p.prototype.forwardMessages({body:r.quickBuild(e),log:{action:"quickForward"},error:$.Function.bind(r.quickError,r,s,r.quickForward),callback:$.Function.bind(r.quickSuccess,r,s)});$.Tips.show("正在转发邮件...")}function l(r,q){var e=this;if(r.callback){r.callback({code:q.code})}$E(["interface.MboxInterface"],function(s){s.setReFw(r.id,r.flag)})}function d(v,r,s){var q=this;var u=v.callback||$.EMPTYFUNC();var t=q.error(s);if(t){u({code:"S_ERROR"});return t}else{switch(s.code){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var e=s.code.split("_")[1].toLowerCase();q.verify(e,function(w){v.body["verifyCode"]=w;r.call(q,v)},function(){u({code:"S_ERROR"})});return true;break}u({code:"S_ERROR"});return false}}})();(function(){try{var m=$L("module.compose.Compose");var k=$I("util.Misc")}catch(p){return p}var h=$.createClass($N("module.compose.ComposeSchedule"));var q=$.Object;q.inherit(h,m);q.extend(h.prototype,{initialize:a,init:f,clear:l,get:o,getDay:i,set:g,setChange:b,setDefault:j,verify:d,toggle:s,fill:c,update:n,createOption:r});function a(t){var e=this;q.extend(e,{component:{schedule:null},element:{area:null,year:null,month:null,day:null,hour:null,minute:null,focus:null,info:null},status:{fill:false,date:null}});h.superClass.initialize.call(e,t)}function f(){var e=this;var t=e.element;h.superClass.init.call(e);var w=e.base;t.area=w.get({id:"div$id$Schedule"});new $.Link({cls:"nui-block-close nui-close",icon:"close",renderTo:t.area,click:function(){var x=w.get({component:"schedule"});x.setChecked(false)}});var v='发送时间：<select id="obj$id$ScheduleYear"></select> 年 <select id="obj$id$ScheduleMonth"></select> 月 <select id="obj$id$ScheduleDay"></select> 日 <select id="obj$id$ScheduleHour"></select> 时 <select id="obj$id$ScheduleMinute"></select> 分 <p class="Y">本邮件将在 <strong id="str$id$ScheduleInfo"></strong> 发送到对方邮箱</p><a id="a$id$ScheduleFocus" href="javascript:void(0)" hidefocus="hidefocus" style="text-decoration:none;display:none">　</a>';v=v.replace(new RegExp("\\$id\\$","ig"),"Compose");w.get({id:"div$id$ScheduleInner"}).html(v);t.year=w.get({id:"obj$id$ScheduleYear"});t.month=w.get({id:"obj$id$ScheduleMonth"});t.day=w.get({id:"obj$id$ScheduleDay"});t.hour=w.get({id:"obj$id$ScheduleHour"});t.minute=w.get({id:"obj$id$ScheduleMinute"});t.focus=w.get({id:"a$id$ScheduleFocus"});t.info=w.get({id:"str$id$ScheduleInfo"});var u=function(x){e.setChange()};$.Array.each(["year","month","day","hour","minute"],function(x,y){t[y].listen("change",u)})}function l(){var e=this;h.superClass.clear.call(e.element);h.superClass.clear.call(e)}function o(t){t=t||{};var e=this;if(typeof t.status=="string"){return e.status[t.status]}else{return e.get({status:"date"})}}function i(v){v=v||{};var t=0;var e=v.year;var u=v.month;if(v.date){e=v.date.getFullYear();u=v.date.getMonth()+1}if(!(e&&u)){return t}if(((e%4==0&&e%100!=0)||e%400==0)&&u==2){t=29}else{switch(u){case 1:case 3:case 5:case 7:case 8:case 10:case 12:t=31;break;case 2:t=28;break;case 4:case 6:case 9:case 11:t=30;break}}return t}function g(t){t=t||{};var e=this;if(t.date){e.set({status:"date",value:t.date});e.update({sync:true})}else{if(typeof t.status=="string"){e.status[t.status]=t.value}else{e.setDefault(t);e.toggle({open:true})}}}function b(){var e=this;var u=e.element;var w=[];$.Array.each(["year","month","day","hour","minute"],function(x,y){w.push(parseInt(u[y]["dom"].value,10))});var t=e.getDay({year:w[0],month:w[1]});if(w[2]>t){w[2]=t}w[1]--;var v=new Date(w[0],w[1],w[2],w[3],w[4]);e.set({date:v})}function j(u){var e=this;var t=k.getTime(0);e.fill({date:t});if(u){t=u}else{t.setDate(t.getDate()+1);t.setHours(0);t.setMinutes(0);t.setSeconds(0,0)}e.set({date:t});return t}function d(){var e=this;if(e.get()<=k.getTime(0)){new $.Msgbox({content:"定时发信时间不能比当前时间早！"});return false}return true}function s(z){z=z||{};var u=this;var w=u.element;var y=u.base;var v=y.get({status:"showSchedule"});var t=true;if(z.open){if(v){return false}}if(z.close){if(!v){return false}}if(t){if(v){w.area.hide()}else{if(y.get({status:"useSms"})){new $.Msgbox({title:'抱歉，"定时发信"功能无法与"短信通知"功能同时使用。'});return false}if(y.get({status:"showEncrypt"})){new $.Msgbox({title:'抱歉，"定时发信"功能无法与"邮件加密"功能同时使用。'});return false}if(!u.get({status:"date"})){u.setDefault()}w.area.show();w.focus.show();try{w.focus["dom"].focus();w.focus["dom"].blur()}catch(x){}w.focus.hide()}y.set({status:"showSchedule",value:!v});return true}else{return false}}function c(v){v=v||{};var y=this;if(y.get({status:"fill"})){return}var x=y.element;var B=v.date;var z=B.getFullYear();var A=z+5;for(;z<A;z++){x.year.append(y.createOption({value:new String(z)}))}var w=1;for(;w<=12;w++){x.month.append(y.createOption({value:new String(w)}))}var e=1;for(;e<=31;e++){x.day.append(y.createOption({value:new String(e)}))}var u=0;for(;u<24;u++){x.hour.append(y.createOption({value:new String(u)}))}var t=0;for(;t<60;t++){x.minute.append(y.createOption({value:new String(t)}))}y.set({status:"fill",value:true})}function n(F){F=F||{};var u=this;var A=u.element;var I=u.get({status:"date"});if(F.sync){$.Array.each(["year","month","day","hour","minute"],function(M,Q){var P=A[Q];var O;switch(M){case 0:O=I.getFullYear();try{var N=P.dom.options;var L=parseInt(N[N.length-1].value,10);if(O>L){P.append(u.createOption({value:new String(O)}))}}catch(R){}break;case 1:O=I.getMonth()+1;break;case 2:O=I.getDate();break;case 3:O=I.getHours();break;case 4:O=I.getMinutes();break;default:O=0;break}var S=new String(O);if(P.dom.value!=S){P.dom.value=S}});u.update({day:true});u.update({info:true})}else{if(F.day){var v=A.day;var y=u.getDay({date:I});var E=v.dom.options.length;if(y!=E){var e;if(y>E){e=E+1;for(;e<=y;e++){v.append(u.createOption({value:new String(e)}))}}else{e=E;for(;e>y;e--){(new $.Element(v.dom.options[e-1])).remove()}}}}else{if(F.info){var G="";var z=I.getFullYear();var D=I.getMonth()+1;var x=I.getDate();var w=I.getHours();var K=I.getMinutes();var t=k.getTime(0);t.setHours(0,0,0,0);var H=t.getDay();if(H==0){H=7}var B=new Date(I.valueOf());B.setHours(0,0,0,0);var C=B.valueOf()-t.valueOf();C=C/(1000*60*60*24);switch(C){case -2:G="前天";break;case -1:G="昨天";break;case 0:G="今天";break;case 1:G="明天";break;case 2:G="后天";break;default:var J=$.Date.getWeek(I);if((1-H)<=C&&C<=(7-H)){G="本周"+J}else{if((7-H)<C&&C<=(14-H)){G="下周"+J}else{if((-7-H)<C&&C<(1-H)){G="上周"+J}else{if(z!=t.getFullYear()){G=z+"年"}if(z==t.getFullYear()&&I.getMonth()==t.getMonth()){G+="本月"}else{G+=D+"月"}G+=x+"日周"+J}}}break}if(w<6){G+="凌晨"}else{if(w<11||(w==11&&K<30)){G+="早上"}else{if(w<13||(w==13&&K<30)){G+="中午"}else{if(w<18){G+="下午"}else{if(w<24){G+="晚上"}}}}}G+=w+":";if(K<10){G+="0"}G+=K;A.info["dom"].innerHTML=G}}}}function r(v){v=v||{};var u=v.value||"";var e=v.text||u;var t=document.createElement("option");t.innerHTML=e;t.value=u;return t}})();(function(){try{var o=$L("module.compose.Compose");var b=$L("support.OptionSupport");var j=$L("interface.OptionInterface")}catch(u){return u}var x=$.Object;var z=$.createClass($N("module.compose.ComposeSign"));x.inherit(z,o);x.extend(z.prototype,{initialize:s,init:w,load:l,set:v,get:c,getItem:h,getStationery:p,getCardList:q,getGraphList:d,each:i,select:t,selectDefault:y,fillHas:g,fillData:a,fillText:r,fillCard:f,fillGraph:m,fillLetterAngle:n,showCustom:k});function s(A){var e=this;x.extend(e,{data:{text:null,card:null,graph:null},fill:{text:-1,card:-1,graph:-1}});z.superClass.initialize.call(e,A)}function w(){var e=this;z.superClass.init.call(e)}function l(){var e=this;var A=e.base;if(A.get({status:"initSign"})==true){return}else{A.set({status:"initSign",value:true})}b.getSignList(function(E){if($S("isCorp")){var B=gAttrs.letterAngle;if(B&&B.langle_apply==1){var D=B.langle_position;var F=B.langle_content;e.fillLetterAngle(F,D)}}var C=false;if(E){e.set({text:E});e.selectDefault({text:true})}else{}C=e.getStationery();if($S("isFree")){e.getCardList(function(G){e.set({card:G});if(!C){e.selectDefault({card:true})}})}else{if($S("isVip")){e.getGraphList(function(G){e.set({graph:G});if(!C){e.selectDefault({graph:true})}})}}})}function v(A){var e=this;if(A.text){e.data["text"]=A.text}else{if(A.card){e.data["card"]=A.card}else{if(A.graph){e.data["graph"]=A.graph}}}}function c(A){var e=this;if(A.text){return e.data["text"]}else{if(A.card){return e.data["card"]}else{if(A.graph){return e.data["graph"]}}}}function h(B){var e=this;var A=null;B.call=function(D,C){if((B["default"]&&(C.isDefault||C.defaultCard))||B.index==D||B.id==C.id){A=C;throw $.BREAK}};e.each(B);return A}function p(){var A=this;if(A.form.getCheckbox("text")){}else{var e=A.base.get({status:"fromEntry"});if(e=="compose"){var B=Ud.get({field:"ntes_compose",flag:"letter"});if(B=="1"){$.Ajax.jsonp(Uri.getUrl("letterpaper_default"),function(C){if(C&&C.html){A.stationery.select({item:C,callback:function(){A.base.changeSync()}})}},"jsonp");return true}}}return false}function q(B){var e=this;var C=Ud.get({field:"ntes_compose",flag:"card"});if(C=="1"||C=="2"){var D=e.base.getCallName(function(E){if(E.result=="success"){B(E.msg)}},true);var A=$.String.addParam(Uri.getUrl("compose_ecard",true),"callback=window."+D);$.Ajax.request({url:A,requestType:$.Ajax.SCRIPT});return true}return false}function d(B){var e=this;var C=e.base.getCallName(function(D){if(D&&D.length){B(D)}},true);var A=$.String.addParam(Uri.getUrl("compose_graphsign"),"func=window."+C);$.Ajax.request({url:A,charset:"gbk",requestType:$.Ajax.SCRIPT})}function i(B){var A=this;var e=A.get(B);if(e){$.Array.each(e,B.call)}}function t(E){var A=this;var D=A.base;var C=A.getItem(E);if(C){var B=D.get({status:"useSign"})||{};if(E.text){B.text=C;var e=C.content;if(!C.isHtml&&e){e=$.String.escapeHTML(C.content)}A.fillText(e)}else{if(E.card){if(B.card==C){}else{B.card=C;A.attach.cardSync(C)}A.fillCard(C.html)}else{if(E.graph){B.graph=C;A.fillGraph(C.str)}}}if(E["default"]){B["default"]=C;D.changeSync()}D.set({status:"useSign",value:B});return true}return false}function y(G){var D=this;var F=D.base;if(D.form.getCheckbox("text")){return}var C=F.get({status:"fromEntry"});if(C=="compose"){}else{if(C=="reply"||C=="forward"){if(C=="reply"&&Ud.get({field:"ntes_option",flag:"replySign"})=="1"){return}if(C=="forward"&&Ud.get({field:"ntes_option",flag:"forwardSign"})=="0"){return}}else{if(C=="timeset"){if(D.fillHas()){return}if(G.card&&D.attach.cardHas()){return}}else{if(C=="draft"){if(D.fillHas()){return}try{if(D.module["param"]["param"]["cancel"]){return}}catch(E){}}else{if(C=="edit"){return}else{return}}}}}if(F.get({status:"useSign"})){return}var A=D.fillData(G);if(A!=-1){G.id=A}else{G["default"]=true}D.select(G);if(F.get({status:"fromEntry"})=="compose"){var B=D.editor["component"].getContent();F.set({status:"defaultContent",value:B})}}function g(F){var C=this;var A=false;if(F){var B="";if(F.text){B="spnEditorSign"}else{if(F.card){B="divEditorGraphSign"}else{if(F.graph){B="divNeteaseMailCard"}}}if(B){try{var D=C.editor.get({id:B});if(D&&D.innerHTML){A=true}}catch(E){}}}else{if(C.fillHas({text:true})||C.fillHas({card:true})||C.fillHas({graph:true})){A=true}}return A}function a(A){var e=this;if(typeof A.text=="boolean"&&A.text){return e.fill["text"]}else{if(typeof A.text=="number"){e.fill["text"]=A.text}else{if(typeof A.card=="boolean"&&A.card){return e.fill["card"]}else{if(typeof A.card=="number"){e.fill["card"]=A.card}else{if(typeof A.graph=="boolean"&&A.graph){return e.fill["graph"]}else{if(typeof A.graph=="number"){e.fill["graph"]=A.graph}}}}}}}function r(C){var B=this;var G=B.editor;if(C==$.String.stripTags(C)){C=C.replace(/ /g,"&nbsp;");C=C.replace(/\n/g,"<br>")}if(C.indexOf("$date$")!=-1){var D=$I("util.Misc").getTime(true);var F=$.Date.format(D,"yyyy年M月d日");C=C.replace(/\$date\$/g,F)}C="--<br>"+C;var H=G.get({html:true});if(H.indexOf("spnEditorSign")!=-1){try{var A=G.get({id:"spnEditorSign"});if(A){A.innerHTML=C}}catch(E){}}else{H=[H,G.getBreakLine(5),'<div id="spnEditorSign">',C,"</div>"].join("");G.set({html:H})}}function f(B){var A=this;var E=A.editor;var F=E.get({html:true});if(F.indexOf("divNeteaseMailCard")!=-1){try{var C=E.get({id:"divNeteaseMailCard"});if(C){C.innerHTML=B}}catch(D){}}else{F=[F,E.getBreakLine(5),'<div id="divNeteaseMailCard">',B,"</div>"].join("");E.set({html:F})}}function m(C){var B=this;var E=B.editor;var F=E.get({html:true});if(F.indexOf("divEditorGraphSign")!=-1){try{var A=E.get({id:"divEditorGraphSign"});if(A){A.innerHTML=C}}catch(D){}}else{F=[F,E.getBreakLine(5),'<div id="divEditorGraphSign">',C,"</div>"].join("");E.set({html:F})}}function n(D,A){var J=this;var I=J.editor;var H=I.get({html:true});if(H.indexOf("dvLetterAngle")!=-1){try{var F=I.get({id:"dvLetterAngle"});if(F){F.innerHTML=D}}catch(E){}}else{var H=I.get({html:true});var G='<div id="dvLetterAngle">'+D+"</div>";var C='<div id="spnEditorSign"></div>';var B;if(A==0){B=[H,I.getBreakLine(5),G,C]}else{B=[H,I.getBreakLine(5),C,G]}H=B.join("");I.set({html:H})}}function k(){var e=this;j.showSignList(function(A){if(A){e.fillText(A)}})}})();(function(){try{var n=$L("module.compose.Compose")}catch(w){return w}var y=$.Object;var x=$.createClass($N("module.compose.ComposeStationery"));y.inherit(x,n);y.extend(x,{pageLimit:9,pageLimit2:4});y.extend(x.prototype,{initialize:f,init:c,clear:B,getObj:t,getVer:l,getNon:m,getPageSize:i,getCategory:a,getItem:s,getContent:p,getCurId:z,getCurList:u,getCurCategory:g,getCurPage:d,getCurPageCount:A,setObj:h,setCurId:k,setCurCategory:v,setCurPage:o,page:q,select:j,fill:b,render:r});function f(C){var e=this;y.extend(e,{element:{category:null,content:null,page:null}});x.superClass.initialize.call(e,C)}function c(){var e=this;var C=e.element;x.superClass.init.call(e);var D=e.base;C.category=D.get({component:"menubutton_stationery"});C.content=D.get({id:"div$id$StationeryContent"});C.page=D.get({id:"div$id$StationeryPage"})}function B(){var e=this;x.superClass.clear.call(e.element);x.superClass.clear.call(e)}function t(){var e=this;var D=e.base;var C=D.letterpaper;return C}function l(){var e=this;var C=e.getObj();return C.ver||""}function m(){var e=this;var C=e.getObj();return C.nonUse}function i(){var e=this;var C=e.getObj();return C.pageSize}function a(D){var C=this;if(typeof D=="undefined"){var E=C.getObj();return E.category}else{var e=null;var F=C.getCategory();if(F){$.Array.each(F,function(G,H){if(H.id==D){e=H;throw $.BREAK}})}return e}}function s(E){var C=this;var e=null;if(E=="0"){e=C.getNon()}else{var D=C.getCurList();$.Array.each(D,function(F,G){if(G.id==E){e=G;throw $.BREAK}})}return e}function p(){var D=this;var C=D.getCurId();var e=[];var E=[D.getNon()].concat(D.getCurList());$.Array.each(E,function(F,H){var G={id:H.id,title:H.name||"",src:H.wmIconUrl||H.iconUrl,active:false};if(H.id=="0"&&C==""){G.active=true}if(H.id==C){G.active=true}e.push(G)});return e}function z(){var e=this;var D=e.getObj();var C=D.curId||"";return C}function u(){var e=this;var D=e.getObj();var C=D.curData;return C}function g(){var e=this;var C=e.getObj();var D=C.curCategory;return D}function d(){var e=this;var D=e.getObj();var C=D.curPage;return C}function A(){var e=this;var D=e.getCurCategory();var C=D.pageCount;return C}function h(D){var e=this;var C=e.getObj();C.curCategory=D.curCategory;C.curPage=D.curPage;C.curData=D.letterPaper}function k(D){var e=this;var E=e.getObj();var C=e.getVer();E.curId=D;if(C){e.base["log"]["letterId"]=C+"_"+D;e.render()}}function v(C){var e=this;var E=e.getObj();var D=e.element;var F=e.getCategory(C);E.curCategory=F;D.category.setText(F.name);e.setCurPage(1);Log.cache({cl_stationery_category:C},$.EMPTYFUNC)}function o(C){var e=this;var D=Uri.getUrl("letterpaper_get");D+="&categoryValue="+e.getCurCategory()["id"];D+="&nextPage="+C;D+="&pageSize="+e.getPageSize();$.Ajax.jsonp(D,function(E){e.setObj(E);e.render()},"jsonp")}function q(F){var e=this;var D=F.index;var E=e.getCurPage();if(F.prev||F.next){var C=e.getCurPageCount();if(F.prev){D=E-1;if(D<1){D=C}}else{D=E+1;if(D>C){D=1}}}e.setCurPage(D);Log.cache({cl_stationery_page:""+D},$.EMPTYFUNC)}function j(E){var K=this;var G=null;var J=null;if(E.item){J=E.item;G=J.id}else{if(E.id){G=E.id;J=K.getItem(G)}}var N=K.getCurId();if(G==N){return false}var M="";try{M=K.editor.get({html:true})}catch(I){}var H="";var F=new RegExp("<STATIONERY>","i");var D="<br><br><br><br><br><br><br><br><br><br>";if(N==""){if(F.test(M)){N="draft"}}if(N==""||N=="0"){H=M;var C=false;try{oSign=K.editor.get({id:"spnEditorSign"});if(oSign&&oSign.innerHTML){C=true}}catch(I){}if(!C){H+=D}}else{var L=M.split(F);if(L&&L.length&&L[1]){H=L[1];if(G=="0"){H=H.replace(new RegExp(D,"i"),"")}}if(H=="undefined"||!H){H=M}}if(J.imageType=="custom"){K.attach.stationerySync(J,function(e){if(e){O(e)}})}else{K.attach.stationeryClear();O()}function O(Q){if(J.html){var P=J.html;if(Q){P=P.replace(J.imageUrl,Q)}var e=P.split("<STATIONERY><STATIONERY>");var T=e[0]+"<STATIONERY>";var S="<STATIONERY>"+e[1];M=[T,"<div>",H,"</div>",S].join("")}else{M="<div>"+H+"</div>"}K.editor.set({html:M});var R=K.editor.get({tag:"STATIONERY"});if(R&&R.length){K.editor.focus({element:R[0]})}else{K.editor.focus()}K.setCurId(G);if(typeof E.callback=="function"){E.callback()}}return true}function b(){var e=this;var C=e.element;var F=e.getCategory();var D=[];$.Array.each(F,function(H,I){var G={text:I.name,click:function(){if(I.id!=e.getCurCategory()["id"]){e.setCurCategory(I.id)}}};D.push(G)});var E={menu:{xtype:"menu",groups:[{items:D}]}};C.category.update(E);e.render()}function r(){var L=this;var e=L.element;var J=L.getContent();e.content.empty();$.Array.each(J,function(N,R){var M=$.Element.create("DIV");M.addClass("K");var P=$.Element.create("a");P.addClass("u");P.dom.title=R.title;P.dom.href="javascript:void(0)";var Q=$.Element.create("img");Q.addClass("x");Q.dom.src=R.src;P.append(Q.dom);M.append(P.dom);if(R.active){var O=$.Element.create("DIV");O.addClass("s f");O.html('<b class="nui-ico i">z</b>');M.append(O.dom)}else{P.listen("click",function(S){L.select({id:R.id,click:true});$.Event.cancel(S);Log.cache({cl_stationery_paper:R.id},$.EMPTYFUNC)})}e.content.append(M.dom)});e.page.empty();var F=L.getCurPageCount();var H=L.getCurPage();if(F>1){var G=$.Element.create("A");G.dom.href="javascript:void(0)";G.dom.innerHTML="上页";G.listen("click",function(N){var M={click:true,prev:true};L.page(M);$.Event.cancel(N)});e.page.append(G.dom)}var D=[];for(var E=1;E<=F;E++){var K={text:(E+"/"+F),value:E};if(E==H){K.checked=true}D.push(K)}var C={options:D,subclass:"simpleSelect",renderTo:e.page.dom,selectedchange:function(N){var M={click:true,index:this.value};L.page(M);$.Event.cancel(N)}};new $.Select(C);if(F>1){var I=$.Element.create("A");I.dom.href="javascript:void(0)";I.dom.innerHTML="下页";I.listen("click",function(N){var M={click:true,next:true};L.page(M);$.Event.cancel(N)});e.page.append(I.dom)}}})();(function(){try{var c=$L("module.compose.Compose");var B=$L("support.AddressSupport");var i=$L("support.SenderList");var d=$L("interface.ReadInterface");var j=$L("interface.MboxInterface");var q=$L("interface.ComposeInterface");var m=$L("interface.OptionInterface");var G=$I("util.Misc")}catch(I){return I}var f=$.Object;var K=$.createClass($N("module.compose.ComposeSuccess"));f.inherit(K,c);f.extend(K.prototype,{initialize:o,init:g,render:E,fill:z,fillTips:k,fillTop:L,fillStamp:h,fillContact:F,fillAd:y,fillLetter:u,fillCancel:t,save2YNote:A,resize:v,setSaveSend:H,setSaveAddress:n,setMailList:w,setMboxFlag:x,cloudMusic:D,sendSmspack:b,vipSms:a,sms:J,smsSend:l,smsReply:r,smsPriority:s});f.extend(K,{ad:[],greetRead:[["我看书,这使我多活几度生命","三毛传","http://yuedu.163.com/source/e18fb8a3e3e1474fb16454a914d06961_4?act=rdyxcg_20130308_01&utm_source=yxcg&utm_medium=20130308_01"],["为疲惫的心灵找个出口","分开修行","http://yuedu.163.com/source/nb_000BOPSE_4?act=rdyxcg_20130308_02&utm_source=yxcg&utm_medium=20130308_02"],["真正的记忆，是不必抢救的","聆听父亲","http://yuedu.163.com/source/nb_000BOPMR_4?act=rdyxcg_20130308_05&utm_source=yxcg&utm_medium=20130308_05"],["无私的感情，正是见到了人心","人心与人生","http://yuedu.163.com/source/nb_000BOMcb_00011100_4?act=rdyxcg_20130308_07&utm_source=yxcg&utm_medium=20130308_07"]],greet1:["做你喜欢的事是自由；喜欢你做的事是幸福。","痛而不言是智慧，笑而不语是豁达。","人生的冷暖取决于心灵的温度。","人生如茶，不会苦一辈子，但会苦一阵子。","不是看到希望才去坚持，而是坚持了才看得到希望！","不贪功急进，不张扬自我，成功时低调，失败后洒脱。","旅行或读书，身体和灵魂，总有一个在路上。","成功是长叶的时候，而失败是长根的时候。","生活的理想，就是为了理想的生活。","千灯万盏，不如心灯一盏。","路不在脚下，路在心里。"],greet2:["夜已深，做一场穿越时空的梦吧。","伸一个懒腰，触摸一夜无垠的星空。","灯火阑珊处，最幸福的事莫过于做个好梦。","注意身体哦，健康才是革命的本钱。","再不睡，身体要闹革命啦。","月牙儿在轻轻地叫唤着：是时候休息了！","早睡早起，迎接新的一天开始！","夜已深，把心放下，做个好梦吧！"],getAd:p,encrypt:C});function o(M){var e=this;f.extend(e,{saveContact:{}});K.superClass.initialize.call(e,M)}function g(){var e=this;K.superClass.init.call(e)}function E(N,M){var O=this;var Q=O.base;try{O.fill(N,M)}catch(P){}O.resize();O.setMboxFlag();Q.setPage("success");if(Q.sendMsgBox){try{Q.sendMsgBox.close();Q.sendMsgBox=null}catch(P){}}if(Ud.get({field:"ntes_compose",flag:"undo_send"})!="1"){if($S("isFree")&&!Ext.smspack){try{O.sms(N,M)}catch(P){}}if($S("isVip")){O.vipSms()}}try{O.sendSmspack()}catch(P){}$.Tips.show({hidden:true})}function z(M,e){var N=this;N.fillTips(M);N.fillTop(M);N.fillStamp(M);N.fillContact(M);N.fillAd(M);N.fillLetter(M);if(Ud.get({field:"ntes_compose",flag:"undo_send"})=="1"){N.fillCancel(M)}N.save2YNote(M);return}function k(e){var O=this;var V=O.base;var S=V.get({status:"sendParam"});var T=V.info.get({obj:true});var W=V.get({id:"div$id$SuccTips"});var X=null;var N=null;if(S.action=="schedule"){var U=$.Date.format(T.scheduleDate,"邮件将在yyyy年M月d日 H:mm发送")+"，邮件发送前，暂时保存在";X=[{html:"<span>"+U+"</span>"},{xtype:"link",text:"草稿箱",click:function(){Log.cache({sl_draft:"1"},$.EMPTYFUNC);j.entry({fid:2})}}];if(gCommon.newwin){U="<span>"+U+"草稿箱</span>";X=[{html:U}]}}else{if(S.action=="deliver"){if(T.saveSentCopy){if(e.saveSentFailed){}else{if(e.saveSentIgnored){var U="<span>因为邮箱容量已满，未能保存到“已发送”文件夹</span>";X=[{html:U}]}else{if(e.saveSentId){if($S("attrs").user.save_sent==0){if(e.savedSent){var U="<span>邮件大小超过了 <b>1M</b>，正文已保存到“已发送”，附件未保存。</span>";X=[{html:U},{xtype:"link",text:"保存该邮件",click:function(){Log.cache({sl_save:"1"},$.EMPTYFUNC);O.action.saveSentAndDel({saveMid:e.saveSentId,delMid:[e.savedSent["msid"],e.savedSent["mid"]].join(":"),callback:function(Z){if(Z.code==S_OK){N.hide();var ab={renderTo:W,extcls:"oa",subclass:"assistBlock",params:"hasClose",content:"保存成功！同时已为你设置发信后邮件全部自动保存。"};new $.Block(ab);O.setSaveSend()}else{var aa;var Y=Z["var"][0]["code"];switch(Y){case"FA_MAIL_NOT_FOUND":aa="确认超时，系统未能保存该邮件！";break;case"FA_INVALID_PARAMETER":aa="格式错误，系统未能保存该邮件！";break;default:aa="异常错误，系统未能保存该邮件！";break}$.Msgbox.show({title:aa})}}})}}]}else{var U="<span>邮件大小超过了 <b>1M</b>，没有保存到“已发送”，</span>";X=[{html:U},{xtype:"link",text:"保存该邮件",click:function(){Log.cache({sl_save:"1"},$.EMPTYFUNC);O.action.saveSent({mid:e.saveSentId,callback:function(Y){if(Y.code==S_OK){N.hide();var ab='<span>保存成功！<span class="nui-txt-tips">您可以设置自动保存以后所有已发送邮件</span> </span>';var aa={renderTo:W,extcls:"oa",subclass:"assistBlock",params:"hasClose",items:[{html:ab},{xtype:"link",text:"自动保存",bracket:true,click:function(){Log.cache({sl_setsave:"2"},$.EMPTYFUNC);O.setSaveSend(this)}}]};new $.Block(aa)}else{var Z;switch(Y.code){case"FA_MAIL_NOT_FOUND":Z="确认超时，系统未能保存该邮件！";break;case"FA_INVALID_PARAMETER":Z="格式错误，系统未能保存该邮件！";break;default:Z="异常错误，系统未能保存该邮件！";break}$.Msgbox.show({title:Z})}}})}}]}}}else{}}}}else{var U="<span>邮件未保存&nbsp;</span>";X=[{html:U},{xtype:"link",text:"设置自动保存",hidden:gCommon.newwin,click:function(){Log.cache({sl_setsave:"1"},$.EMPTYFUNC);m.entry({module:"BaseSetModule",inputName:"afterSendRule"})}}]}if(V.get({status:"showEncrypt"})){var U='<span>&nbsp;邮件已加密，密码为：<strong class="nui-txt-impt">'+$.String.escapeHTML(O.encrypt.get())+"</strong></span>";var R={html:U};if(X){X.push(R)}else{X=[R]}}if($S("isFree")){var T=V.info.get({obj:true});if(T.priority==1){Log.cache({sl_sms:"2"},$.EMPTYFUNC);var U="<span>&nbsp;温馨提示：此邮件勾选了“<strong class='nui-txt-impt'>紧急</strong>” ，你可以发送</span>";var Q={html:U};var P={xtype:"link",text:"免费短信通知收件人",click:function(){Log.cache({sl_sms:"5"},$.EMPTYFUNC);O.smsPriority()}};if(X){X.push({html:"<span><br/></span>"});X.push(Q);X.push(P)}else{X=[Q,P]}}}}}if(X){var M={renderTo:W,extcls:"oa",subclass:"assistBlock",params:"hasClose",items:X};N=new $.Block(M);W.show()}}function L(e){var M=this;var Q=M.base;var O=Q.get({status:"sendParam"});var S="发送成功";if(O.action=="schedule"){S="定时发信设置成功"}var N=Q.get({id:"span$id$SuccInfo"});N.html(S);var R=Q.get({id:"div$id$SuccTop"});if(gCommon.newwin){new $.Link({renderTo:R,renderBy:"before",text:"关闭",tabindex:"2",cls:"ra",icon:"close",click:function(){window.close()}})}else{var T=M.info.get({mid:true});if(T){new $.Link({renderTo:R,tabindex:"2",cls:"oc",text:'<b class="nui-ico oD lr"></b>返回该邮件',click:function(){Log.cache({sl_back:"1"},$.EMPTYFUNC);var U=M.module;if(U.param["history"]){d.entry(U.param["history"])}else{d.entry({id:T,from:"compose"})}}})}else{new $.Link({renderTo:R,tabindex:"2",cls:"ob",text:'<b class="nui-ico oD ls"></b>返回收件箱',click:function(){Log.cache({sl_inbox:"1"},$.EMPTYFUNC);j.entry({fid:1})}})}if(O.action=="deliver"){var P=Q.info.get({obj:true});if(P.saveSentCopy){if(e.saveSentFailed||e.saveSentIgnored){}else{M.sentLink=new $.Link({renderTo:R,tabindex:"2",cls:"oc",text:'<b class="nui-ico oD lr"></b>查看已发邮件',click:function(){Log.cache({sl_view:"1"},$.EMPTYFUNC);d.entry({id:[e.savedSent["msid"],e.savedSent["mid"]].join(":")})}})}}}}new $.Link({renderTo:R,tabindex:"2",cls:"oE",text:'<b class="nui-ico oD mi"></b>继续写信',click:function(){Log.cache({sl_continue:"1"},$.EMPTYFUNC);q.compose()}})}function h(e){if(gCommon.newwin){return}var N=this;var R=N.base;var O=R.get({status:"sendParam"});if(O.action!="deliver"){return}if(Ext.stamp){var P=R.get({id:"div$id$SuccStamp"});var T="";$.Array.each(R.info.get({con:true}),function(W,V){var X=V.replace(/^.*<|>$/g,"").toLowerCase();var U=X.split("@")[1];if(U=="163.com"||U=="126.com"){T=X;throw $.BREAK}});var M=Uri.getUrl("compose_stamp_get");M+="&mid="+(new Date()).valueOf();if(T){M+="&to="+T}var Q=R.info.get({obj:true});M+="&subject="+encodeURIComponent(Q.subject);var S=$.Element.create("iframe");S.setClass("fE");S.setStyle({width:"400px",height:"200px"});S.setAttr({frameBorder:0,allowTransparency:true,src:M});P.append(S.dom);P.show()}}function F(T){var R=this;var af=R.base;var ag=af.get({status:"sendParam"});if(ag.action!="deliver"){return}if(T.pabResult){try{B.addExtContact(T.pabResult)}catch(ab){}try{$.Array.each(T.pabResult,function(ah,e){if(e.action=="added"){R.saveContact[e.item["EMAIL;PREF"].toLowerCase()]=e.item}})}catch(ab){}}var Z=af.get({id:"div$id$Contact"});var U=new $.Link({cls:"od",renderTo:Z,click:function(){Log.cache({sl_contact:"0"},$.EMPTYFUNC);if(ac.dom.style.display=="none"){this.getEl().addClass("hY");ac.show();ad()}else{this.getEl().removeClass("hY");ac.hide()}}});var ac=$.Element.create("DIV");ac.setClass("js");ac.setStyle({display:"none"});var N={};var O=0;var M=af.info.get({con:true});$.Array.each(M,function(e,ai){var am=Uri.matchEmail(ai);if(!am){throw $.CONTINUE}am.key=am.address.toLowerCase();if(!N[am.key]){N[am.key]=am;am.added=R.saveContact[am.key];am.exist=B.data.extDataMap.email[am.key];am.id="";am.phone="";if(am.added){var ah=am.added;am.id=ah.id}else{if(am.exist){var ah=am.exist[0];am.id=ah[EMAIL_ID];am.name=B.getGivenName(ah);am.phone=ah[EMAIL_PHONE]||"";am.groups=ah.groups||[]}else{O++}}if(am.name==am.address){am.name=am.name.split("@")[0]}var al=$.Element.create("DIV");al.setClass("eO");var aj=$.Element.create("SPAN");aj.setClass("co");aj.html(W(am));al.append(aj.dom);ac.append(al.dom);var ak=null;ak=new $.Link({renderTo:al,cls:"cL",text:(am.added||am.exist)?'<b class="nui-ico oD kI"></b>编辑':'<b class="nui-ico oD lO"></b>添加',click:function(){if(am.added||am.exist){Log.cache({sl_edit:"1"},$.EMPTYFUNC);B.contactDialog({type:"modify",addr:{id:am.id},callback:function(an){aj.html(W(an))}})}else{Log.cache({sl_add:"1"},$.EMPTYFUNC);B.contactDialog({type:"add",addr:{name:am.name,email:am.address},callback:function(an){am.id=an.id;am.added=an;aj.html(W(an));ak.update({text:'<b class="nui-ico oD kI"></b>编辑'});var ao='<b class="nui-ico oD mj"></b>';R.newCount--;if(R.newCount){ao+=R.newCount+"个收件人不在通讯录中";R.linkRev=U}else{ao+="已成功发送到收件人("+R.allCount+")"}U.update({text:ao})}})}}});al.listen("mouseover",function(){al.addClass("cn")});al.listen("mouseout",function(){al.removeClass("cn")})}});var Y='<b class="nui-ico oD mj"></b>';var X=f.count(N);if(O){Y+=O+"个收件人不在通讯录中";R.newCount=O;R.allCount=X;R.linkRev=U}else{Y+="已成功发送到收件人("+X+")"}U.update({text:Y});var Q=$.Element.create("DIV");Q.setClass("go");var P="";var aa="0";var V="";if($S("attrs").user.aftersend_saveaddr==1){V="已自动添加到通讯录";P="取消自动添加"}else{V="尚未设置自动添加收件人到通讯录";P="设置自动添加";aa="1"}new $.Link({id:"compose_success_saveaddr",cls:"du",renderTo:Q,text:P,click:function(){Log.cache({sl_setaddress:aa},$.EMPTYFUNC);R.setSaveAddress(this)}});if($S("isFree")){if(f.count(N)>=3){new $.Link({renderTo:Q,text:"加入邮件列表",hidden:gCommon.newwin,cls:"du",click:function(){Log.cache({sl_list:"1"},$.EMPTYFUNC);R.setMailList(N)}})}}var S=$.Element.create("SPAN");S.html(V);Q.append(S.dom);ac.append(Q.dom);Z.append(ac.dom);function W(ah){var e=ah.name?('"'+ah.name+'"<'+ah.address+">"):ah.address;return $.String.escapeHTML(e)}function ae(){var ai=$.Event.getTarget();try{var ah=$.Element.inside(ai,ac.dom)||$.Element.inside(ai,U.getEl().dom);if(!ah){ac.hide();U.getEl().removeClass("hY")}}catch(aj){}}function ad(){if(!R.click2Hide){R.click2Hide=ae;$(document).listen("click",R.click2Hide)}}}function y(O){var P=this;var S=P.base;var N=S.get({id:"div$id$SuccAd"});var M=document.body.clientWidth;var R="";if($S("isFree")){if($S("ad").show){try{if(M>1270){R=oExtUtil.random(fAdComposeSendImg1)}else{R=oExtUtil.random(fAdComposeSendImg2)}}catch(Q){}}else{try{if(M>1270){R=fExtComposeWide()}else{R=fExtCompose()}}catch(Q){}}}else{if($S("isVip")){if(M>1270){R='<iframe src="'+Uri.getUrl("compose_vip_suc",true)+'?w=260" frameborder="0" scrolling="no" width="260" height="398"></iframe>'}else{if(M<=1024){}else{R='<iframe src="'+Uri.getUrl("compose_vip_suc",true)+'?w=145" frameborder="0" scrolling="no" width="145" height="398"></iframe>'}}}}if(R){N.append(K.getAd(R))}}function u(){var P=this;var U=P.base;var Q=U.get({id:"div$id$SuccLetter"});var O=true;if(Math.floor(10*Math.random())%2==0){O=false}if(O&&$S("isFree")){var X=true;if(Math.floor(10*Math.random())%2==0){X=false}var T,V="";if(X){T=K.greetRead[Math.floor(K.greetRead.length*Math.random())];V='<a href="'+T[2]+'" hidefocus="true" target="_blank"  class="ug"><span class="uk">《'+T[1]+'》</span><span class="gn">'+T[0]+'</span></a><a href="http://yuedu.163.com/?act=rdyxfszy_20130508_0" hidefocus="true" target="_blank" class="uj">摘自手机上最好的阅读软件&nbsp;<strong class="uq"><b class="oD uo"></b>网易云阅读</strong></a><a href="http://yuedu.163.com/?act=rdyxfszy_20130508_0" hidefocus="true" target="_blank" class="ul"></a>'}else{Q.dom.parentNode.className="um ui";var S="来这里听明星的私房歌单";var M=true;if(M){var e=Ext.compose_cloud_music?"javascript:void(0);":"http://pr.da.netease.com/receiver/?action=ad&camMethod=6&camName=1370426396457&channel=appstore,official&version=&productId=3003&target=http%3A%2F%2Fmusic.163.com%2F%23%2Fm%2Falbum%3Fid%3D2397083";Q.dom.parentNode.style.background="url(http://mimg.127.net/ggimg/all/img16/130606_music_792x400.jpg) no-repeat 100% 0 ";V='<a href="'+e+'" hidefocus="true" target="_blank"  class="ug" style="left:300px;top:160px;height:130px;width:400px;"></a><a href="'+e+'" hidefocus="true" target="_blank" class="uj"></a><a href="'+e+'" hidefocus="true" target="_blank" class="ul"></a>'}else{var e=Ext.compose_cloud_music?"javascript:void(0);":Uri.getUrl("compose_cloud_music",true);V='<a href="'+e+'" hidefocus="true" target="_blank"  class="ug"><span class="uk">'+S+'</span><span class="gn">下载网易云音乐APP，发现好音乐</span></a><a href="'+e+'" hidefocus="true" target="_blank" class="uj">来自手机上最好的音乐社交产品&nbsp;<strong class="ut"><b class="oD us"></b>网易云音乐</strong></a><a href="'+e+'" hidefocus="true" target="_blank" class="ul"></a>'}if(Ext.compose_cloud_music){$.Event.live({context:Q,selector:"A",event:"click",handler:function(Y){$.Event.cancel(Y);P.cloudMusic();return false}})}}}else{var R="Ta的回信也许马上到，记得回来看啊！";var W=G.getTime();var N=W.getHours();if(N>=22||N<4){R=K.greet2[Math.floor(K.greet2.length*Math.random())]}else{R=K.greet1[Math.floor(K.greet1.length*Math.random())]}Q.dom.parentNode.className="um uZ";V='<span  class="ug"><span class="uk">'+R+"</span></span>"}Q.html(V);setTimeout(function(){try{Q.focus()}catch(Y){}},0)}function D(){var M=Uri.getUrl("compose_cloud_msg",true)+"&uid="+$S("orgUid")+"&type=3";$.Ajax.jsonp(M,e);function e(P){var N="http://pr.da.netease.com/receiver/?action=ad&camMethod=6&camName=1370426396457&channel=appstore,official&version=&productId=3003&target=http%3A%2F%2Fmusic.163.com%2F%23%2Fm%2Falbum%3Fid%3D2397083";var O="";if(P.code==999){O='明星私房歌单、320K高品质音乐，尽在全新音乐软件<a style="color:#dd0000" href="'+N+'" target="_blank">&nbsp;<img src="http://mimg.127.net/index/163/effects/130523_music.png" alt="网易云音乐" />&nbsp;网易云音乐</a>。<br/><br/>跟音乐说声Hi吧，就好像刚认识一样，欢迎免费下载网易云音乐。'}else{O='非常感谢您的支持！您将收到<strong>一条短信</strong>，点击短信内链接免费下载全新音乐软件<a style="color:#dd0000" href="'+N+'"  target="_blank">&nbsp;<img src="http://mimg.127.net/index/163/effects/130523_music.png" alt="网易云音乐" />&nbsp;网易云音乐</a>。<br/><br/>明星私房歌单、320K高品质音乐，尽在网易云音乐！'}$.Msgbox.show({type:"confirm",contentType:"normal",content:O,okText:"体验云音乐",ok:function(Q){window.open(N)}})}}function t(O){var S=this;var W=S.base;var V=S.action;var P=W.get({id:"div$id$SuccCancel"});var X=null;var U=null;var e=30;var R=null;if(O.sentTInfo){X=new $.Link({renderTo:P,text:"取消发送",click:function(){if(O.saveSentId&&$S("attrs").user.save_sent==0){S.action.saveSent({mid:O.saveSentId,callback:function(Y){if(Y.code==S_OK){T()}else{var Z;switch(Y.code){case"FA_MAIL_NOT_FOUND":Z="确认超时，系统未能保存该邮件！";break;case"FA_INVALID_PARAMETER":Z="格式错误，系统未能保存该邮件！";break;default:Z="异常错误，系统未能保存该邮件！";break}$.Tips.show(Z)}}})}else{T()}}});U=$.Element.create("SPAN");U.setClass("nui-txt-aside");U.html("("+e+")");P.append(U.dom);R=window.setInterval(Q,1000)}else{P.hide()}function T(){var Y={tinfo:O.sentTInfo,callback:M,error:N};V.cancelDeliver(Y)}function M(Z){window.clearInterval(R);P.hide();var Y={id:Z["var"]["draftMid"],cancel:true};q.draft(Y);$.Tips.show("发送撤销成功")}function N(){X.setText("重试");$.Tips.show("撤销失败，请重试")}function Q(){if(e>0){e--;U.html("("+e+")")}else{window.clearInterval(R);P.hide()}}}function A(M){var P=this;var R=P.base;var Q=R.get({status:"save2YNote"});if(Q){var O="保存到有道云笔记失败，请手动保存 。";var e=M.code;if(e==S_OK){var N=[M.savedSent["msid"],M.savedSent["mid"]].join(":");P.action.save2YNote({mid:N,callback:function(){$.Tips.show({succ:true,text:"邮件成功保存到有道云笔记"})},error:function(U){e=U.code;if(e=="S_PARTIAL_OK"){var V=U["var"];var T="";if(V&&V.fails&&V.fails.length){var W=V.fails;for(var S=0;S<W.length;S++){T+=$.String.escapeHTML(W[S]["resource"])+"<br/>"}}$.Msgbox.show({title:"邮件部分保存成功！<br/>以下附件因类型受限，无法保存：",content:T})}else{$.Msgbox.show({title:O})}}})}else{$.Msgbox.show({title:O})}}}function v(){var N=this;var P=N.base;var M=P.get({id:"div$id$SuccMain"});var e=document.body.clientWidth;var O="pV";if(e>1280){O+=" oC"}else{if(e<=1024){O+=" oB"}}if(M){M.setClass(O)}}function H(M){var e="邮箱参数设置成功";if(Ud.get({field:"save_sent"})!=1){Ud.set({field:"save_sent",value:1,call:function(){if(M){M.setText("取消自动保存")}$.Tips.show({succ:true,text:e})}})}else{Ud.set({field:"save_sent",value:2,call:function(){if(M){M.setText("自动保存")}$.Tips.show({succ:true,text:e})}})}}function n(O){var M=O.getEl();var e="邮箱参数设置成功";var N=["设置自动添加","取消自动添加"];if(M.html()==N[1]){Ud.set({field:"aftersend_saveaddr",value:0,call:function(){M.html(N[0]);$.Tips.show({succ:true,text:e})}})}else{Ud.set({field:"aftersend_saveaddr",value:1,call:function(){M.html(N[1]);$.Tips.show({succ:true,text:e})}})}}function w(e){var M={dp:"addt",t:"m"};var N=[];f.each(e,function(O,P){N.push(P.address)});M.members=N.join(",");$E(["interface.AddressInterface"],function(O){O.entry({action:"mailgroups",param:M})})}function x(){var Q=this;var e=Q.info;var M=Q.base.get({status:"fromEntry"});var O="";if(M=="reply"){O="replied"}else{if(M=="forward"){O="forwarded"}else{return}}var N=e.get({mid:true});var P=e.get({ids:true});if(N){j.setReFw(N,O)}else{if(P){$.Array.each(P,function(R,S){j.setReFw(S,O)})}}}function b(){var M=this;var S=M.form;if(!S.getCheckbox("chargesms")){return}var N=M.module;var R=M.base;var T=M.info;var P=R.get({status:"sendParam"});if(P.action=="deliver"){var Q=T.get({obj:true});var O=Q.subject;var e=R.get({status:"chargeSmsData"});N.smsNotify.send(O,e,function(V){if(V&&V.result==1){var U="";var W=V.results;$.Array.each(W,function(Y,Z){var X="";switch(Z.result){case 1:break;case 0:case -3:case -4:X="系统出错，本条短信通知未能发出";break;case -2:case -6:X="联系人手机号码错误，本条短信通知未能发出";break;case -8:X="当天发送超过限制，本条短信通知未能发出";break;case -11:X="联系人号码在SMS的黑名单列表中，本条短信通知未能发出";break;case -12:X="信息内容包含敏感词汇，本条短信通知未能发出";break;case -100:X="短信通知余额不足，本条短信通知未能发出";break;default:X="错误码："+Z.result;break}if(X){U+=X;U+="</br>"}});if(U){$.Msgbox.show({title:U})}}else{}})}}function a(){var N=this["base"];var e=Ud.get({field:"smsaddr"})||"";if(e&&e.charAt(0)=="1"){}else{var M=N.get({id:"div$id$SmsTips"});new $.Link({cls:"nui-txt-link",renderTo:M,text:'<b class="nui-ico nui-ico-sms"></b>Ta若回邮件，短信提醒我',click:function(O){$I("util.CustomAppManager").goOutLink("eaw",{param:{source:"open_eaw_write2"}})}})}}function J(V,S){var U=this;var af=U.base;var O=$I("util.Misc");var ab=U.form;var ag=af.get({status:"sendParam"});if(ag.action!="deliver"){return}var ad=af.info.get({obj:true});if(ad.priority==1){return}var P=ab.getSender().address;var T=P.split("@")[1].toLowerCase();if(!(T=="163.com"||T=="126.com"||T=="yeah.net")){return}var N=Ud.get({field:"ntes_compose",flag:"free_sms"});if(N!=3&&N!=4){var Q=O.getMobile();if(Q&&Q==P){N=3}else{if(Math.floor(10*Math.random())%2==0){N=3}else{N=4}}Ud.set({field:"ntes_compose",flag:"free_sms",value:N})}var R="",Z="";if(N==3){R=U.smsSend();Z="免费短信通知收件人"}else{if(N==4){R=U.smsReply();Z="回信免费短信通知"}}if(R){Log.cache({sl_sms:N},$.EMPTYFUNC);var ae;try{ae=O.getTime(0)}catch(ac){ae=new Date()}var M=G.getTime();var X=M.getHours();var aa=ae.valueOf()+"";var Y=K.encrypt(aa);R+="&mid="+encodeURIComponent(aa)+"&sign="+encodeURIComponent(Y);var W=af.get({id:"div$id$SmsTips"});new $.Link({cls:"nui-txt-link",renderTo:W,text:'<b class="nui-ico nui-ico-sms nui-ico-sms"></b>'+Z,click:function(e){if(N==3&&(X<8||X>22)){new $.Layer({content:"夜深了，为了不打扰对方休息，<br/>建议您在 8:00-22:00时间段使用短信通知。",params:"arrUp",pointTo:this.el,renderTo:U.module.container});$.Event.stop(e)}else{$.Msgbox.show({header:"免费短信通知",contentType:"custom",noFooter:true,content:'<iframe id="composeSucSmsIframe" src="'+R+'" style="display:block;width:100%;height:300px" scrolling="no" frameborder="0"></iframe>'})}}})}}function l(){var W=this;var af=W.base;var aa=W.info;var ag=af.get({status:"sendParam"});if(ag.action!="deliver"){return}var O=aa.get({con:true});var S=O.length;if(S!=1){return}var M=O[0];var R=null;var Q=Uri.getEmails(M,"Email");if(Q.match.length==1){R=Q.match[0]}if(!R){return}var U=R.address;var Y=R.name;if(i.isSender(U)){return}var X=U.split("@");var N=X[0];var e=X[1].toLowerCase();if(e=="vip.163.com"||e=="vip.126.com"||e=="188.com"){return}if(Email.checkMobile(N)&&(e=="163.com"||e=="126.com"||e=="yeah.net")){return}var ae=aa.get({obj:true});var ad=i.getName();var T=ae.subject;var Z=B.getAddrObj(U);var ab="",V="";if(Z){ab=Z[EMAIL_ID];V=Z[EMAIL_PHONE]||""}var ac=Uri.getUrl("compose_sms_send");var P={title:T,tauid:U,receiver_nick:Y,mobile:V,cid:ab,from:"compose",sender_nick:ad};for(var ah in P){ac+="&"+ah+"="+encodeURIComponent(P[ah])}return ac}function r(){var O=this;var U=O.base;var W=O.info;var T=W.get({obj:true});var Q=$I("util.Misc").getMobile()||"";if(Q&&Q==O.form.getSender().address){return}var S=T.subject;var R="multi";var X="";var N=U.info.get({con:true});if(N.length==1){var P=Uri.matchEmail(N[0]);if(!P){return}X=P.name;R=P.address;if(i.isSender(R)){return}}var M=Uri.getUrl("compose_sms_reply");var e={title:S,tid:R,tname:X,mobile:Q,from:"compose"};for(var V in e){M+="&"+V+"="+encodeURIComponent(e[V])}return M}function s(){var V=this;var Y=V.info;var ah=Y.get({obj:true});var af=i.getName();var ai;try{ai=oMisc.getTime(0)}catch(ag){ai=new Date()}var ae=ai.valueOf()+"";var aa=K.encrypt(ae);var U=ah.subject;var ab=Uri.getUrl("compose_sms_priority");var O=Y.get({con:true});var T=O.length;var W=[];for(var ad=0;ad<T;ad++){var M=O[ad];var N=null;var S=Uri.getEmails(M,"Email");if(S.match.length==1){N=S.match[0]}else{continue}var R=N.address;var Q=N.name;var ac={tauid:R,receiver_nick:Q};var X=B.getAddrObj(R);if(X){ac.cid=X[EMAIL_ID];ac.mobile=X[EMAIL_PHONE]||"";if(f.isArray(ac.mobile)){ac.mobile=ac.mobile[0]}}W.push(ac)}$.Msgbox.show({header:"免费短信通知",contentType:"custom",noFooter:true,content:'<iframe id="composeSucSmsIframe"  name="composeSucSmsIframe" src="about:blank" style="display:block;width:100%;height:300px" scrolling="no" frameborder="0"></iframe>'});var P={mid:ae,title:U,tid:aa,sender_nick:af,muti:"true",from:"compose",tas:W};function Z(){var ak=document.createElement("FORM");ak.action=ab;ak.method="POST";ak.target="composeSucSmsIframe";for(var aj in P){var e=document.createElement("INPUT");e.type="hidden";e.name=aj;var al;if(aj=="tas"){al=JSON.stringify(P[aj])}else{al=P[aj]}e.value=al;ak.appendChild(e)}document.body.appendChild(ak);ak.submit()}Z()}function p(O){if($.String.has(O,"<embed")||$.String.has(O,"<object")){var N=K.ad;var M=null;$.Array.each(N,function(Q,P){if(P.html==O){M=P.dom;throw $.BREAK}});if(!M){var e=$.Element.create("div");e.html(O);M=e.dom.firstChild;N.push({html:O,dom:M})}return M}else{return O}}function C(N){var P="";var e="";N=N.substr(1);var O=N.length;for(var M=0;M<O;M++){var Q=M;if(M==1){Q=4}else{if(M==4){Q=1}}P=(N.charCodeAt(Q)<<1)+M;e+=String.fromCharCode(P)}return e}})();(function(){try{var B=$L("module.BaseView");var v=$L("module.compose.Compose");var h=$L("support.SenderList");var d=$L("component.emailinput.EmailContainer")}catch(A){return A}var C=$.Object;var i=$.Function;var r=$.createClass($N("module.compose.ComposeView"));C.mix(r,B,null,{});C.extend(r.prototype,v.prototype);C.extend(r.prototype,{getHtml:p,getToolbar:c,getOption:f,getSection:D,getHeader:o,getSender:y,getRev:x,getSubject:q,getAttach:s,getContent:m,getExt:b,getSchedule:l,getEncrypt:z,getChargeSms:a,getAside:k,getCorp:u,getContact:n,getLetter:w,getFooter:j,getSuccess:t,getPage:g});function c(I){var F=this;var E=F.module.event;var H={groups:[{items:[{xtype:"button",tabindex:"2",text:"&nbsp;发 送&nbsp;",subclass:"mainBtn",click:function(){E.fireBar({func:"deliver",pos:"top"})}}]},{items:[{xtype:"button",text:"存草稿",tabindex:"2",click:function(){E.fireBar({func:"save",pos:"top"})}}]},{items:[{xtype:"button",text:"预 览",tabindex:"2",click:function(){E.fireBar({func:"preview"})}}]},{items:[{xtype:"button",text:(gCommon.newwin?"关 闭":"取 消"),tabindex:"2",click:function(){E.fireBar({func:"cancel"})}}]},{items:[{xtype:"link",text:"商务模板",tabindex:"2",cls:"nui-txt-link",click:function(){E.fireBar({func:"template"})}}],hidden:!$S("isVip"),type:"ext"},{items:[{xtype:"link",text:"贺卡",tabindex:"2",cls:"nui-txt-link",click:function(){E.fireBar({func:"card"})}}],hidden:!Ext.cardShow,type:"ext"},{items:[{xtype:"link",text:"明信片",tabindex:"2",cls:"nui-txt-link",click:function(){E.fireBar({func:"postcard"})}}],hidden:!Ext.cardShow,type:"ext"},{items:[{xtype:"button",icon:"newWin",title:"新窗口写信",tabindex:"2",subclass:"roundBtn",click:function(){E.fireBar({func:"new"})}}],hidden:gCommon.newwin,type:"ext"},{items:[{xtype:"button",icon:"setting",title:"写信设置",tabindex:"2",subclass:"roundBtn",menu:F.getOption()}],hidden:gCommon.newwin,type:"ext"}]};var K="";try{var G=new $.Toolbar(H);var L=this.module.base;L.set({component:"toolbar",value:G});K=G.html()}catch(J){}return K}function f(){var O=this.module.base;var e=Ud.get({field:"ntes_htmlbar"})!=2?true:false;var K=Ud.get({field:"ntes_global",flag:"compose_showContacts"})!="1"?true:false;var N=Ud.get({field:"ntes_option",flag:"flashupload"})!="1"?true:false;var P=Ud.get({field:"ntes_compose",flag:"upload_mode"});var H=Ud.get({field:"ntes_option",flag:"replySign"})=="0"?true:false;var I=Ud.get({field:"ntes_option",flag:"forwardSign"})=="1"?true:false;var E=Ud.get({field:"ntes_option",flag:"signPosition"})!="1"?true:false;var L=Ud.get({field:"ntes_option",flag:"requirereceipt"})=="1"?true:false;var M=Ud.get({field:"save_sent"});var J=Ud.get({field:"aftersend_saveaddr"})==1?true:false;var F=Ud.get({field:"ntes_option",flag:"composeSound"})=="0"?true:false;var G={xtype:"menu",reverse:true,groups:[{items:[{text:"正文工具栏",menu:{groups:[{items:[{text:"默认展开",checked:e,click:i.bind(O.setOption,O,{field:"ntes_htmlbar",value:1})},{text:"默认折叠",checked:!e,click:i.bind(O.setOption,O,{field:"ntes_htmlbar",value:2})}],checkType:"radio"}]}},{text:"右侧通讯录",menu:{groups:[{items:[{text:"默认展开",checked:K,click:i.bind(O.setOption,O,{field:"ntes_global",flag:"compose_showContacts",value:"0"})},{text:"默认折叠",checked:!K,click:i.bind(O.setOption,O,{field:"ntes_global",flag:"compose_showContacts",value:"1"})}],checkType:"radio"}]}},{text:"上传附件模式",menu:{groups:[{items:[{text:"高级上传模式",checked:N,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"flashupload",value:"0"})},{text:"普通上传模式",checked:!N,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"flashupload",value:"1"})}],checkType:"radio"}]}},{text:"20M~50M附件上传模式",hidden:$S("isCorp"),menu:{groups:[{items:[{text:"智能识别上传",checked:(P=="0"),click:i.bind(O.setOption,O,{field:"ntes_compose",flag:"upload_mode",value:"0"})},{text:"云附件上传",checked:(P=="1"),click:i.bind(O.setOption,O,{field:"ntes_compose",flag:"upload_mode",value:"1"})},{text:"普通附件上传",checked:(P=="2"),click:i.bind(O.setOption,O,{field:"ntes_compose",flag:"upload_mode",value:"2"})}],checkType:"radio"}]}},{text:"收件人域名检查与提示",hidden:$S("isCorp"),menu:{groups:[{items:[{text:"开启",checked:Ext.contactCorrect,click:i.bind(O.setOption,O,{field:"ntes_letter",flag:"remindShow",value:"0"})},{text:"关闭",checked:!Ext.contactCorrect,click:i.bind(O.setOption,O,{field:"ntes_letter",flag:"remindShow",value:"1"})}],checkType:"radio"}]}}]},{items:[{text:"回复时添加签名",menu:{groups:[{items:[{text:"添加",checked:H,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"replySign",value:"0"})},{text:"不添加",checked:!H,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"replySign",value:"1"})}],checkType:"radio"}]}},{text:"转发时添加签名",menu:{groups:[{items:[{text:"添加",checked:I,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"forwardSign",value:"1"})},{text:"不添加",checked:!I,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"forwardSign",value:"0"})}],checkType:"radio"}]}},{text:"回复转发时签名位置",menu:{groups:[{items:[{text:"在引用内容上方",checked:E,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"signPosition",value:"0"})},{text:"在引用内容下方",checked:!E,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"signPosition",value:"1"})}],checkType:"radio"}]}}]},{items:[{text:"默认要求已读回执",menu:{groups:[{items:[{text:"启用",checked:L,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"requirereceipt",value:"1"})},{text:"关闭",checked:!L,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"requirereceipt",value:"0"})}],checkType:"radio"}]}},{text:"发信后自动保存邮件",menu:{groups:[{items:[{text:"保存小于1M的邮件和大于1M邮件的正文",checked:(M==0),click:i.bind(O.setOption,O,{field:"save_sent",value:0})},{text:"全部保存到“已发送”文件夹",checked:(M==1),click:i.bind(O.setOption,O,{field:"save_sent",value:1})},{text:"不保存",checked:(M==2),click:i.bind(O.setOption,O,{field:"save_sent",value:2})}],checkType:"radio"}]}},{text:"发信后自动保存联系人",menu:{groups:[{items:[{text:"保存到“通讯录”",checked:J,click:i.bind(O.setOption,O,{field:"aftersend_saveaddr",value:1})},{text:"不保存",checked:!J,click:i.bind(O.setOption,O,{field:"aftersend_saveaddr",value:0})}],checkType:"radio"}]}},{text:"写信时情景模式",menu:{groups:[{items:[{text:"开启",checked:F,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"composeSound",value:0})},{text:"关闭",checked:!F,click:i.bind(O.setOption,O,{field:"ntes_option",flag:"composeSound",value:0})}],checkType:"radio"}]}}]},{items:[{text:"发件人设置",click:function(){$E(["interface.OptionInterface"],function(Q){Q.entry({module:"AccountCenterModule"})})}},{text:"签名设置",click:function(){$E(["interface.OptionInterface"],function(Q){Q.entry("SignModule")})}}]},{items:[{text:"更多设置",click:function(){$E(["interface.OptionInterface"],function(Q){Q.entry({module:"BaseSetModule"})})}}]}]};return G}function p(){var e=this;var E='<header id="div$id$Toolbar" class="frame-main-cont-head frame-main-cont-head-hasBorder nui-bg-light nui-bdr-light">'+e.getToolbar()+'<div id="div$id$Scene" class="EFT-wrapper" style="display:none"></div></header><div id="div$id$Scroll" class="frame-main-cont-body nui-scroll"><div id="div$id$Main"  class="qt nui-bg-light pr">'+e.getSection()+e.getAside()+e.getFooter()+'</div><div id="div$id$Succ" class="qt pr" style="display:none">'+e.getSuccess()+"</div>"+e.getPage()+"</div>";E=E.replace(new RegExp("\\$id\\$","ig"),"Compose");return E}function D(){var E=this;var F="";try{F=E.getExt()}catch(G){}var H='<section class="oZ"><a id="a$id$Switch" href="javascript:void(0)" class="fC" title="展开/收起通讯录"><span class="dr"><b class="nui-ico nui-ico-lArr"></b></span></a>'+E.getHeader()+E.getContent()+F+"</section>";return H}function o(){var e=this;var E='<header class="ku">'+e.getSender()+e.getRev("to")+e.getRev("cc")+e.getRev("bcc")+e.getRev("separate")+e.getSubject()+e.getAttach()+"</header>";return E}function y(){var H=this;var M=H.module;var aa=M.base;var P=M.event;var T=[];try{var Z=h.getList();var J=h.getDefault();$.Array.each(Z,function(ab,ad){var e=$.String.encodeHTML(ad.toString());var ac={text:e,click:function(){V.setValue(ad)}};if(ad.address==J.address){ac.checked=true}T.push(ac)})}catch(W){J=new Email($S("uid"))}var R={xtype:"menu",groups:[{items:T,checkType:"radio"},{items:[{text:"设置默认发件人与昵称",hidden:gCommon.newwin,click:function(){Log.cache({cl_defaultsender:"1"},$.EMPTYFUNC);$E(["interface.OptionInterface"],function(e){e.entry({module:"AccountCenterModule"})})}}]}]};var G={cls:"nui-txt-link bm",tabindex:"2",title:"发件人地址，点击可以设置发件人",text:U(J,true),listeners:[{name:"render",handler:function(){var e=this;e.menu=new $.Menu(R);e.menu.attachTo({clickFrom:e.getEl(),renderTo:M.container})}}]};var N="";try{var V=new $.Link(G);aa.set({component:"sender",value:V});V.value=J;V.setValue=U;V.getValue=function(){return this.value};N=V.html()}catch(W){}var L={cls:"bW  nui-txt-link",tabindex:"2",text:"添加抄送",title:"同时将这封邮件发给其他联系人",click:function(){P.setCc({toggle:true,click:true});Log.cache({cl_cc:"1"},$.EMPTYFUNC)}};var K={cls:"bW  nui-txt-link",tabindex:"2",text:"添加密送",title:"同时将这封邮件发给其他联系人，但收件人和抄送人不会看到密送人",click:function(){P.setBcc({toggle:true,click:true});Log.cache({cl_bcc:"1"},$.EMPTYFUNC)}};var I={cls:"bW nui-txt-link",tabindex:"2",text:"使用群发单显",title:"会对多个人一对一的发送， 每个人将单独收到发给他/她的邮件",click:function(){P.setSeparate({toggle:true,click:true});Log.cache({cl_separate:"1"},$.EMPTYFUNC)}};var Y,O,F;Y=O=F="";try{var E=new $.Link(L);var Q=new $.Link(K);var X=new $.Link(I);aa.set({component:"ccLink",value:E});aa.set({component:"bccLink",value:Q});aa.set({component:"separateLink",value:X});Y=E.html();O=Q.html();F=X.html()}catch(W){}var S='<div class="fA ck"><label class="cH">发件人</label><div>'+N+'<div class="bh class nui-bg-light">'+Y+O+F+"</div></div></div>";return S;function U(ad,e){var ab=this;if(C.compare(ab.value,ad)){return}var ac="";if(ad.name){ac='<span class="bn">'+$.String.encodeHTML(ad.name)+'</span><span class="re">&lt;'+ad.address+"&gt;</span>"}else{ac='<span class="re">'+ad.address+"</span>"}ac+=' <b class="nui-ico nui-ico-dArr">d</b>';if(e){return ac}ab.setText(ac);ab.value=ad}}function x(N){var J=this;var M=J.module;var W=M.base;var T=M.form;var I="163.com";if($S("isFree")){I=$S("domain")}var P="";var G={xtype:"emailcontainer",containerfocus:function(){T.choose(N)},domain:I};if(Ext.contactCorrect){G.containerblur=function(){T.remindValid(N)};G.itemwarnremove=function(e){T.remindRemove(N,e)}}var O="地址输入框，请输入邮件地址，多人时地址请以分号隔开";var V={to:{tabIndex:1,tips:{text:$S("isCorp")?"":"输入对方手机号，就能给他发邮件"},title:"发给多人时地址请以分号隔开",inputLable:"收件人"+O,choose:true},cc:{tabIndex:1,inputLable:"抄送"+O},bcc:{tabIndex:1,title:"该地址对于其他收件人是不可见的",inputLable:"密送"+O},separate:{tabIndex:1,inputLable:"群发单显"+O}};C.extend(G,V[N]);try{var F=new d(G);W.set({component:N,value:F});P=F.html()}catch(U){}var K={to:"收件人",cc:"抄送人",bcc:"密送人",separate:"群发单显"};var S=K[N];var E=new $.Link({text:S,cls:"nui-txt-link bV",title:"点击添加"+S,click:function(){Log.cache({cl_rev:N},$.EMPTYFUNC);T.showContact(N)}});var H=S;try{H=E.html()}catch(U){}var L="div$id$"+N;var R=N=="to"?"":' style="display:none;"';var Q='<div id="'+L+'" class="fA cj" '+R+">"+H+'<div class="bM"><div class="R">'+P+"</div></div>"+(N=="separate"?'<div class="bw">群发的邮件，采用一对一单独发送，每个收件人只看到自己的地址。</div>':"")+"</div>";return Q}function q(){var E=this;var G=E.module;var J=G.base;var F={tabIndex:1,ariaLabel:"邮件主题输入框，请输入邮件主题",maxLength:"256",voiceInput:true,listeners:[{name:"blur",handler:function(){G.setText(this.getValue())}}]};try{J.set({component:"subject",value:new $.Input(F)});sHtmlSubject=J.get({component:"subject"}).html()}catch(H){}var I='<div id="div$id$Subject" class="fA cI"><label for="obj$id$Subject" class="cH">主　题</label><div class="bM"><div class="R">'+sHtmlSubject+"</div></div></div>";return I}function s(){var L=this;var N=L.module;var aa=N.base;var I=N.attach;var S=N.event;var W={xtype:"menu",groups:[{items:[{text:"从“云附件”添加",click:function(){I.cloudMsg();Log.cache({cl_cloud:"1"},$.EMPTYFUNC)}},{text:"从“网盘”添加",click:function(){I.netfolderMsg();Log.cache({cl_nf:"1"},$.EMPTYFUNC)}},{text:"从“往来附件”添加",click:function(){I.internalMsg()}}]}]};if(Ext.ynote){W.groups[0]["items"].push({text:"从“有道云笔记”添加",click:function(){I.ynoteMsg()}})}if($.Browser.ie()||$.Browser.firefox()||$.Browser.chrome()){W.groups.push({items:[{text:"拖拽添加",click:function(){if(S.assist.get({status:"dragSupport"})){S.setDragArea({toggle:true})}else{S.assist.setup("new")}Log.cache({cl_drag:"1"},$.EMPTYFUNC)}}]})}var J={xtype:"link",icon:"dArr",tabindex:"-1",cls:"nui-txt-link W",listeners:[{name:"render",handler:function(){new $.Menu(W).attachTo({clickFrom:this.getEl()})}}]};var K="";var E="110px";if($S("isCorp")){E="56px";var H=[{html:'<span class="qx">-</span>'},{xtype:"link",text:"云附件",cls:"nui-txt-link",click:function(){I.bigMsg()}},{html:'<span class="qx">-</span>'},{xtype:"link",text:"网盘附件",cls:"nui-txt-link",click:function(){I.netfolderMsg()}}];var G=[{html:'<span class="qx">-</span>'},{xtype:"link",text:"拖拽添加",cls:"nui-txt-link",click:function(){if(S.assist.get({status:"dragSupport"})){S.setDragArea({toggle:true})}else{S.assist.setup("new")}Log.cache({cl_drag:"1"},$.EMPTYFUNC)}}];var Z=$S("cos").perm_func_netfolder?H.concat(G):G;var Q={html:"<div></div>",items:Z};K=new $.Component(Q).html()}else{try{var F=new $.Link(J);K='<span class="qx">|</span>'+F.html()}catch(X){}}var O="";var U="";var P='<iframe id="ifr$id$AttachUpload" name="ifr$id$AttachUpload" src="about:blank" style="display:none"></iframe>';if(Ud.get({field:"ntes_option",flag:"flashupload"})!="1"&&!$S("isCorp")){var Y=$S("isFree")?"2G":"4G";if($S("cloud")){try{Y=$.Number.convert($S("cloud")["capacity"])}catch(X){}}U='(最大<strong class="nui-txt-impt">'+Y+"</strong>)";if($S("isFree")){var M=true;if($S("cloud")&&Y=="2G"){M=false}var R={text:"升级到3G",hidden:M,cls:"rW",click:function(){var e=$I("util.Misc");var ac=e.getMobile()||"";var ab=Uri.getUrl("compose_attach_3g");ab+="&from=compose";if(ac){$.Msgbox.show({content:"请在新开的页面中完成云附件升级。",okText:"我已经完成升级",ok:function(){$E("support.CloudSupport",function(ad){ad.init(true)})}});window.open(ab)}else{$.Msgbox.show({content:"开通手机号码邮箱，即可领取3G附件！",okText:"立即开通",ok:function(){window.open(ab);$.Msgbox.show({content:"请在新开的页面中完成手机号码邮箱开通与云附件升级。",okText:"我已经完成上述操作",ok:function(){$E("support.CloudSupport",function(ad){ad.init(true)})}})}})}}};try{var V=new $.Link(R);aa.set({component:"update3g",value:V});O=V.html()}catch(X){}}}var T='<div id="div$id$AttachOperate" class="fA cl"><a id="a$id$AttachAdd" href="javascript:void(0)" tabindex="2" aria-label="点击添加附件" class="nui-txt-link">添加附件'+U+"</a>"+O+K+'<span id="div$id$AttachProgress" class="nui-txt-tips"></span>'+P+'<div id="div$id$AttachBrowse" class="L"  style="width:'+E+';display:none"></div><div id="div$id$AttachDrag" class="nui-assistBlock nui-block dN" style="display:none"><a id="a$id$AttachDragClose" href="javascript:void(0)" class="nui-block-close nui-close" hidefocus="hidefocus"><b class="nui-ico nui-ico-close">x</b></a>请把文件拖放到这个区域，就可作为附件添加。</div></div><div id="div$id$AttachArea" class="X" style="display:none"><div id="div$id$AttachContent"></div><div class="clearLine"></div></div><div id="div$id$InlinedTips" style="display:none" class="nui-tipsLayer nui-tipsLayer-arrDown nui-layer nui-layer-arrDown vt"></div>';return T}function m(){var e='<div id="div$id$Editor" class="dd"></div>';return e}function b(){var I=this;var L=I.module;var U=L.base;var M=L.editor;var K=new $.Checkbox({text:"紧急",title:"设置邮件投递优先级"});U.set({component:"priority",value:K});var Q=new $.Checkbox({text:"已读回执",title:"启用回执功能，您可以了解收件人是否阅读了您发送的邮件"});U.set({component:"receipt",value:Q});var J=new $.Checkbox({text:"纯文本",title:"把邮件内容切换成纯文本，它将无法插入表情，图片以及将丢失正文颜色等",checkedchange:function(){var W=this.getChecked();this.setChecked(false,true);M.switchText({text:W,click:true});Log.cache({cl_text:"1"},$.EMPTYFUNC)}});U.set({component:"text",value:J});var H=new $.Checkbox({text:"定时发送",checkedchange:function(X){var Y=this;if(!L.schedule){var Z=$L("module.compose.ComposeSchedule");var W=new Z(L);W.init();L.schedule=W}if(!L.schedule.toggle({click:true})){Y.setChecked(false,true)}Log.cache({cl_schedule:"1"},$.EMPTYFUNC)}});U.set({component:"schedule",value:H});var F=new $.Checkbox({text:"邮件加密",checkedchange:function(W){if(!L.encrypt.toggle({click:true})){this.setChecked(false,true)}Log.cache({cl_encrypt:"1"},$.EMPTYFUNC)}});U.set({component:"encrypt",value:F});var E=false,O=false;if($S("isFree")){if(Ext.smspack){O=true}else{E=true}}else{O=true;if(!Ext.smspack_vip){E=true}}var R={text:"短信通知收件人",hidden:E,checkedchange:function(W){var X=this;if(L.smsNotify){if(!L.smsNotify.toggle({click:true})){X.setChecked(false,true)}}else{$E("product.SmsNotify",function(Z){var Y=new Z(L);Y.init();L.smsNotify=Y;if(!L.smsNotify.toggle({click:true})){X.setChecked(false,true)}})}Log.cache({cl_charge_sms:"1"},$.EMPTYFUNC)}};var V=new $.Checkbox(R);U.set({component:"chargesms",value:V});var G="";if(Ext.ynote){var S=new $.Checkbox({text:"保存到有道云笔记"});U.set({component:"ynote",value:S});G=S.html();var T=Uri.getUrl("ynote",true);var N=new $.Link({cls:"nui-fIBlock",icon:"help",link:T,title:"什么是有道云笔记?",attrs:"style = 'margin:-4px 0 0 -3px'",target:"_blank"}).html();G+=N}var e=new $.Link({text:'更多选项 <b class="nui-ico">j</b>',cls:"nui-txt-link",click:function(){var W=U.get({id:"div$id$Option"});if(W.dom.style.display=="none"){Log.cache({cl_more_s:"1"},$.EMPTYFUNC);this.setText('隐藏选项 <b class="nui-ico">k</b>')}else{Log.cache({cl_more_h:"2"},$.EMPTYFUNC);this.setText('更多选项 <b class="nui-ico">j</b>')}W.toggle()}});var P='<b tabindex="1" title="您已退出编辑器，Tab键继续导航，Shift+Tab返回编辑器"></b><div class="cJ">'+e.html()+'</div><div id="div$id$Option" class="gm" style="display:none"><div class="bx"><div class="ds">'+K.html()+Q.html()+J.html()+H.html()+F.html()+V.html()+G+"</div></div>"+I.getSchedule()+I.getEncrypt()+I.getChargeSms()+"</div>";return P}function l(){var e=this;var E='<div id="div$id$Schedule" class="nui-assistBlock nui-block dt" style="display:none"><div id="div$id$ScheduleInner"></div></div>';return E}function z(){var E=this;var F=E.module;var J=F.base;var I=new $.Link({cls:"nui-block-close nui-close",icon:"close",click:function(){var K=J.get({component:"encrypt"});K.setChecked(false)}});var e=new $.Checkbox({text:"在已发送邮件中保存密码"});J.set({component:"encryptSave",value:e});var H=new $.Input({extcls:"nui-smallIpt",maxLength:6});J.set({component:"encryptPass",value:H});var G='<div id="div$id$Encrypt" class="nui-assistBlock nui-block dt" style="display:none">'+I.html()+'<strong>邮件加密</strong> 收信人需要密码才能查看邮件<div class="bi"><label class="G">设置查看密码：</label>'+H.html()+'<span class="nui-txtTips">&nbsp;(请输入6位数字、字母，区分大小写)</span><p class="bj">'+e.html()+'</p></div><a id="a$id$EncryptFocus" href="javascript:void(0)" hidefocus="hidefocus" style="text-decoration:none;display:none">　</a></div>';return G}function a(){var E=this;var F=E.module;var I=F.base;var H=new $.Link({cls:"nui-block-close nui-close",icon:"close",click:function(){var J=I.get({component:"chargesms"});J.setChecked(false)}});var e=new $.Link({link:"compose_sms_help",target:"_blank",text:"短信示例",cls:"nui-txt-link"});var G='<div id="div$id$Sms" class="nui-block dt bC" style="display:none">'+H.html()+'<div  class="bd"><strong>短信通知收件人</strong><span class="nui-txtTips">(<span id="span$id$SmsTips"></span>，'+e.html()+')<span id="span$id$SmsErr"></span></span> </div><div id="div$id$SmsTable" class="nui-normalTable nui-table"></div><a id="a$id$SmsFocus" href="javascript:void(0)" hidefocus="hidefocus" style="text-decoration:none;display:none">　</a></div>';return G}function k(){var H=this;var G=H.module;var K=G.base;var L=G.event;var M="";var F={type:"common",sideTab:true,items:[{id:"address",text:"通讯录",skipDbClick:true,click:function(){L.fireTab({func:"address"})}},{id:"stationery",text:"信 纸",skipDbClick:true,click:function(){L.fireTab({func:"stationery"})},width:"95px"}]};if($S("isCorp")){F.items=[{id:"corp",text:"企业",skipDbClick:true,click:function(){L.fireTab({func:"corp"})},width:"63px"},{id:"address",text:"个人",skipDbClick:true,click:function(){L.fireTab({func:"address"})},width:"63px"},{id:"stationery",text:"信 纸",skipDbClick:true,click:function(){L.fireTab({func:"stationery"})},width:"62px"}]}try{var E=new $.Tab(F);K.set({component:"sideTab",value:E});M=E.html()}catch(I){}var J='<aside id="td$id$Right" class="kb"><div class="ek">'+M+H.getCorp()+H.getContact()+H.getLetter()+"</div></aside>";return J}function u(){var E=this;if(!$S("isCorp")){return""}var F=E.module;var H=F.base;var e=H.layout["addressHeight"];var G='<div id="div$id$Corp" class="fB"><div id="div$id$CorpContent" class="dc nui-scroll" style="height:'+(e+55)+'px"><iframe id="div$id$CorpIframe" style="width:100%;height:'+(e+50)+'px" src="about:blank" frameborder="0"></iframe></div></div>';return G}function n(){var H=this;var G=H.module;var M=G.base;var I=G.address;var F=({placeholder:"查找联系人",iconBtn:"search",iconbtnclick:function(){I.searchCancel()},listeners:[{name:"keyup",handler:function(){I.searchMatch()}}]});var E="";try{var J=new $.Input(F);M.set({component:"search",value:J});E=J.html()}catch(K){}var L='<div id="div$id$Address" class="fB"><div class="dM">'+E+'<a id="a$id$AddressAdd" title="快速添加联系人" href="javascript:void(0)" class="cg"><b class="nui-ico nui-ico-add2"></b></a></div><div id="div$id$AddressContent" class="dc nui-scroll" style="height:'+M.layout["addressHeight"]+'px"><div id="div$id$AddressTree" class="nui-simpleTree nui-tree"></div><div id="div$id$AddressResult" class="nui-simpleTree nui-tree"></div></div></div>';return L}function w(){var G=this;var F=G.module;var L=F.base;var M="";var I={text:"全部",subclass:"dropdownBtn"};var H={text:"自创信纸",icon:"add",hidden:gCommon.newwin||$S("isCorp"),click:function(){Log.cache({cl_stationery_define:"1"},$.EMPTYFUNC);$E(["interface.OptionInterface"],function(e){e.entry({module:"options.OptionOutLinkModule",linkName:"letterpaper_create"})})}};try{var E=new $.Button(I);var N=new $.Button(H);L.set({component:"menubutton_stationery",value:E});L.set({component:"button_stationery",value:N});M=E.html()+N.html()}catch(J){}var K='<div id="div$id$Stationery" class="ci" style="display:none"><div class="bB">'+M+'</div><div id="div$id$StationeryContent" class="bl nui-scroll" style="height:'+L.layout["stationeryHeight"]+'px"></div><div id="div$id$StationeryPage" class="bc"></div></div>';return K}function j(){var F=this;var E=F.module.event;var H={groups:[{items:[{xtype:"button",text:"&nbsp;发 送&nbsp;",subclass:"mainBtn",click:function(){E.fireBar({func:"deliver",pos:"bottom"})}}]},{items:[{xtype:"button",text:(gCommon.newwin?"&nbsp;关 闭&nbsp;":"&nbsp;取 消&nbsp;"),click:function(){E.fireBar({func:"cancel",pos:"bottom"})}}]}]};var J="";try{var G=new $.Toolbar(H);J='<footer class="lN">'+G.html()+"</footer>"}catch(I){}return J}function t(){var e='<div id="div$id$SuccMain" class="pV oC"><div id="div$id$SuccTips" style="display:none"></div><div class="up"><div id="div$id$SuccTop"></div><div id="div$id$Contact" class="un"></div></div><div class="ur"><b class="oD kJ"></b><span id="span$id$SuccInfo"></span><div id="div$id$SuccCancel" class="mH" tabindex="1"></div><div id="div$id$SmsTips" class="sJ"></div></div><div id="div$id$SuccAd" class="pa"></div><div class="kH"><div class="um uh"><div id="div$id$SuccStamp" style="display:none"></div><div id="div$id$SuccLetter"></div></div></div></div>';return e}function g(){var e='<div id="div$id$Page" class="qt" style="display:none"><div class="jr"><iframe id="ifr$id$Page" name="ifr$id$Page" class="dO" src="about:blank" frameborder="0" scrolling="no" allowtransparency="allowtransparency"></iframe><form target="ifr$id$Page" method="post" style="height:0"></form></div></div>';return e}})();(function(){try{var h=$L("module.compose.ComposeAttach")}catch(m){return m}var g=$.createClass($N("module.compose.ComposePlugin"));var o=$.Object;o.inherit(g,h);o.extend(g.prototype,{initialize:p,init:n,browseInit:f,pluginBrowse:k,pluginSelect:l,pluginHash:d,pluginCheck:c,fileUpload:b,fileRetry:a,fileBreak:i,fileRemove:j});function p(e){var q=this;g.superClass.initialize.call(q,e)}function n(){var e=this;g.superClass.init.call(e)}function f(){var q=this;var r=q.base;var e=q.sourceGet("element");e.link.listen("click",function(s){q.pluginBrowse({type:"file",title:"选择要上传的文件",call:function(t){if(t.length){q.pluginSelect(t)}else{}}});$.Event.cancel(s)});r.set({status:"uploadMode",value:"plugin"})}function k(s){var q=this;var r=q.assist.create("desktop");if(!r){return}var e={};if(s.single){e.singleFile=true}else{e.singleFile=false}if(s.title){e.title=s.title}switch(s.type){case"file":e.filter2=h.filter;break;case"image":e.filter2=h.filterImage;break}r.openFiles(function(t){var u=s.call;var v=o.toArray(t);if(typeof u=="function"){q.base.addTimer("pluginBrowse",function(){u(v)},0)}},e)}function l(q){var r=this;var e=[];$.Array.each(q,function(u,x){var s=0;try{s=x.blob.length}catch(w){}var t="";try{t=x.path}catch(w){}var v=r.fileCreate({type:"plugin",name:x.name,path:t,size:s});v.blob=x.blob;if(x.inlined){v.inlined=v.context=true}e.push(v)});r.filterCheck({files:e,submit:function(s){$.Array.each(s.select,function(t,u){u["delete"]=function(){r.fileRemove(u);u["delete"]=null};r.add(u)});r.fileAutoUpload()},cancel:function(){}})}function d(q){var r=this;var e=r.assist.create("digest");if(e){r.setState(q,"hash");q.digest=e.CalculateMD5WithProgress(q.blob,function(s){if(q.digest){q.digest=null}else{return}s=s||"-1";r.setHash(q,q.size,s)},function(t,s){if(q.digest){r.setHash(q,t)}})}}function c(r,t){var s=this;if(s.getCheck(r)){var q=s.assist.requestGet();if(!q){return}if(r.path){}else{s.error(r,"JS_PLUGIN");return}q.onreadystatechange=function(){if(q.readyState==4){q.onreadystatechange=null;if(q.status==200){if(s.check(r,q.responseText)){s.fileUpload(r);s.netCheckSet(r)}}else{if(s.error(r,"JS_HTTP",q.status,"check")){s.pluginCheck(r,{code:"JS_HTTP",reason:q.status})}else{s.resum(r)}}}};var e=s.getUploadProxy({type:"plugin",file:r,options:"body",check:true},t);q.open($.Ajax.POST,e,true);q.setRequestHeader("Content-Type","application/x-www-form-urlencoded");q.send(r.options)}else{s.fileUpload(r);s.netCheckSet(r)}}function b(z,t){var x=this;var q=x.assist.requestGet();if(!q){return}q.upload.onprogress=function(e){if(e.lengthComputable){x.setBytes(z,e.loaded,e.total)}};q.onreadystatechange=function(){switch(q.readyState){case 1:x.setStart(z);break;case 2:if(z.path){}else{}break;case 4:q.onreadystatechange=q.upload.onprogress=null;x.netCheckClear();if(z.blob){if(q.status==200){var e=x.complete(z,q.responseText);if(e.code==S_OK){if(e["continue"]){x.fileUpload(z);x.netCheckSet(z)}}else{if(e.retry){x.fileRetry(z,{code:e.code})}else{x.resum(z)}}}else{if(x.error(z,"JS_HTTP",q.status)){x.fileRetry(z,{code:"JS_HTTP",reason:q.status})}else{x.resum(z)}}}else{}break}};if(x.getUploadHost()&&z.path){var w=z.blob;if(true){z.useSplit=true;z.length=h.sliceLength;if(z.offset+z.length>z.size){z.length=z.size-z.offset}w=w.slice(z.offset,z.length)}var r=x.getUploadProxy({type:"plugin",file:z,options:"header"},t);q.open($.Ajax.POST,r,true);if(z.options){o.each(z.options,function(e,B){q.setRequestHeader(e,B)})}q.setRequestHeader("Content-Type","application/octet-stream");q.send(w)}else{q.open($.Ajax.POST,x.getUploadUrl({type:"plugin"}),true);var v="------neteasemailpluginupload"+(new Date).getTime();var A="--";var s="\r\n";var y=[];y.push(A,v,s);y.push('Content-Disposition: form-data; name="Filedata"; filename="',z.name,'"',s);y.push("Content-Type: application/octet-stream",s,s);y.push(z.blob);y.push(s);y.push(A,v,A,s);q.setRequestHeader("Content-Type","multipart/form-data; boundary="+v);q.setRequestHeader("Cookie","Coremail="+$.Cookie.get("Coremail"));try{var w=x.assist.create("blob");if(w){w.append(y);q.send(w.getAsBlob())}}catch(u){}}}function a(e,r){var q=this;q.pluginCheck(e,r)}function i(r){var t=this;if(r.state!="success"&&r.state!="wait"){var q=t.assist.requestGet();try{q.abort()}catch(s){}}}function j(q){var s=this;if(q.blob){q.blob=null}if(q.digest){try{q.digest.abort()}catch(r){}q.digest=null}s.fileBreak(q)}})();(function(){try{var g=$L("module.compose.ComposeAttach")}catch(j){return j}var c=$.createClass($N("module.compose.ComposeNative"));var k=$.Object;k.inherit(c,g);k.extend(c.prototype,{initialize:l,init:f,browseInit:b,nativeBrowse:o,nativeSelect:d,nativeCheck:m,fileUpload:p,fileRetry:n,fileBreak:a,fileRemove:i,nativeGet:h});function l(e){var q=this;c.superClass.initialize.call(q,e)}function f(){var e=this;c.superClass.init.call(e)}function b(){var t=this;var q=$.Browser;var e=q.getInfo();var v=t.base;var r=t.sourceGet("element");var s=false;var u=r.input=$.Element.create("input");u.setClass("t");if(q.chrome()||q.safari()){s=true}if(s){u.setStyle({visibility:"hidden"})}u.setAttr({type:"file",size:"1",multiple:true});if(e.os=="windows"&&q.safari()){u.setAttr({multiple:false})}u.listen("change",function(){var x=u.dom.files;if(x.length){x=k.toArray(x);t.nativeSelect(x);try{u.dom.value=""}catch(w){}}else{}});r.browseContainer.append(u.dom);if(s){r.browseContainer.listen("click",function(y){var x=$.Event.getTarget(y,true);if(x&&x.tagName){var w=x.tagName.toLowerCase();if(w=="div"){t.nativeBrowse()}else{if(w=="input"){}}}})}r.browseContainer.show();v.set({status:"uploadMode",value:"native"})}function o(){var q=this;var e=q.sourceGet("element");e.input["dom"].click()}function d(r){var q=this;var e=[];$.Array.each(r,function(u,s){var x=s.name||s.fileName;var t=0;if(typeof s.size=="number"){t=s.size}else{if(typeof s.fileSize=="number"){t=s.fileSize}}var v=q.fileCreate({type:"native",name:x,size:t});if(s.lastModifiedDate){try{v.modtime=s.lastModifiedDate.valueOf()}catch(w){}}v.blob=s;if(s.inlined){v.inlined=true}e.push(v)});q.filterCheck({files:e,submit:function(s){$.Array.each(s.select,function(t,u){u["delete"]=function(){q.fileRemove(u);u["delete"]=null};q.add(u)});q.fileAutoUpload()},cancel:function(){}})}function m(r,t){var s=this;if(s.getCheck(r)){var q=s.nativeGet(r);if(!q){return}q.onreadystatechange=function(){if(q.readyState==4){q.onreadystatechange=null;if(q.status==200){if(s.check(r,q.responseText)){s.fileUpload(r);s.netCheckSet(r)}}else{if(s.error(r,"JS_HTTP",q.status,"check")){s.nativeCheck(r,{code:"JS_HTTP",reason:q.status})}else{s.resum(r)}}}};var e=s.getUploadProxy({type:"native",file:r,options:"body",check:true},t);q.open($.Ajax.POST,e,true);q.setRequestHeader("Content-Type","application/x-www-form-urlencoded");q.send(r.options)}else{s.fileUpload(r);s.netCheckSet(r)}}function p(E,u){var y=this;var q=y.nativeGet(E);if(!q){return}if(q.upload){q.upload.onprogress=function(e){if(e.lengthComputable){y.setBytes(E,e.loaded,e.total)}}}else{}q.onreadystatechange=function(){switch(q.readyState){case 1:y.setStart(E);break;case 2:y.setFinish(E);break;case 4:q.onreadystatechange=null;if(q.upload){q.upload.onprogress=null}y.netCheckClear();if(E.blob){if(q.status==200){var e=y.complete(E,q.responseText);if(e.code==S_OK){if(e["continue"]){y.fileUpload(E);y.netCheckSet(E)}}else{if(e.retry){var G={code:e.code};y.fileRetry(E,G)}else{y.resum(E)}}}else{if(E.abort){E.abort=false}else{if(y.error(E,"JS_HTTP",q.status)){var G={code:{code:"JS_HTTP",reason:q.status}};y.fileRetry(E,G)}else{y.resum(E)}}}}else{}break}};if(y.getUploadHost()){var B=E.blob;var A=false;if(B.slice||B.mozSlice||B.webkitSlice){A=true}if(E.skipSplit){E.useSplit=false;E.offset=0;E.length=0}else{if(A){E.useSplit=true;E.length=g.sliceLength;if(E.offset+E.length>E.size){E.length=E.size-E.offset}var z=E.offset+E.length;if(B.slice){B=B.slice(E.offset,z)}else{if(B.mozSlice){B=B.mozSlice(E.offset,z)}else{if(B.webkitSlice){B=B.webkitSlice(E.offset,z)}}}}}var r=y.getUploadProxy({type:"native",file:E,options:"header"},u);q.open($.Ajax.POST,r,true);if(E.options){k.each(E.options,function(e,G){q.setRequestHeader(e,G)})}q.setRequestHeader("Content-Type","application/octet-stream");q.send(B)}else{q.open($.Ajax.POST,y.getUploadUrl({type:"native"}),true);if(typeof FormData!="undefined"){try{var C=new FormData();C.append("Filedata",E.blob);q.send(C)}catch(x){}}else{if(E.blob.getAsBinary){var w=encodeURIComponent(E.name);w=w.replace(new RegExp("%(\\w{2})","ig"),function(e,G){return String.fromCharCode(parseInt(G,16))});var v="------neteasemailnativeupload"+(new Date).getTime();var F="--";var t="\r\n";var s=[];s.push(F,v,t);s.push('Content-Disposition: form-data; name="Filedata"; filename="',w,'"',t);s.push("Content-Type: application/octet-stream",t,t);s.push(E.blob.getAsBinary(),t);s.push(F,v,F,t);q.setRequestHeader("Content-Type","multipart/form-data; boundary="+v);try{var D=s.join("");q.sendAsBinary(D)}catch(x){}}else{}}}}function n(e,r){var q=this;q.nativeCheck(e,r)}function a(r){var t=this;if(r.state!="success"&&r.state!="wait"){var q=t.get({element:"nativeRequest"});try{r.abort=true;q.abort()}catch(s){}}}function i(e){var q=this;if(e.blob){e.blob=null}q.fileBreak(e)}function h(r){var t=this;if($.Browser.firefox()){t.set({element:"nativeRequest",value:null})}if($.Browser.chrome()){if(r.retry>0){t.set({element:"nativeRequest",value:null})}}var q=t.get({element:"nativeRequest"});if(!q){try{q=new XMLHttpRequest()}catch(s){}if(q){t.set({element:"nativeRequest",value:q})}}return q}})();(function(){try{var f=$L("module.compose.ComposeAttach")}catch(s){return s}var d=$.createClass($N("module.compose.ComposeFlash"));var t=$.Object;t.inherit(d,f);t.extend(d.prototype,{initialize:c,init:p,browseInit:o,flashReady:a,flashSelect:n,flashCheckFile:b,flashVerify:j,flashCheck:h,fileUpload:r,fileRetry:k,fileBreak:l,fileRemove:l,flashTimerSet:m,flashTimerCheck:q,flashTips:g,flashDispatch:i});function c(e){var u=this;d.superClass.initialize.call(u,e)}function p(){var e=this;d.superClass.init.call(e)}function o(){var w=this;var v=w.sourceGet("element");var D=w.base;var x=Uri.getUrl("compose_upload_swf",true);var F=$.Browser.getInfo();try{var u=F.flashVersion;var A=u.split(",");if(A[0]<10||A[0]==10&&A[1]==0){x=Uri.getUrl("compose_upload_fix_swf",true)}}catch(y){}if($.Browser.ie()){x+="?t="+(new Date()).valueOf()}var z=D.getCallName(function(){return w.flashDispatch.apply(w,arguments)});var E="apiMulti=1&apiDiff=200&apiListener=window."+z;if(window.gIsDebug){E="apiDebug=true&apiMulti=1&apiDiff=200&apiListener=window."+z}var B="";var C=D.get({"$id$":"obj$id$FlashFile"});if($.Browser.ie()){B='<object id="'+C+'" width="100%" height="100%" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"><param name="movie" value="'+x+'" /><param name="flashVars" value="'+E+'" /><param name="quality" value="high" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /></object>'}else{B='<embed id="'+C+'" src="'+x+'" flashvars="'+E+'" quality="high" wmode="transparent" allowscriptaccess="always" width="100%" height="100%" type="application/x-shockwave-flash" />'}D.set({status:"flashReady",value:true});v.flashContainer.show();v.flashContainer.html(B)}function a(){var x=this;var u=x.sourceGet("element");var w=x.base;if(!w.get({status:"flashReady"})){return}u.flash=u.flashContainer["dom"].firstChild;try{}catch(v){}try{u.flash.setMenu("网易邮箱附件上传插件")}catch(v){}w.set({status:"uploadMode",value:"flash"})}function n(u){var v=this;var e=[];$.Array.each(u,function(w,y){var x=v.fileCreate({type:"flash",name:y.name,size:y.size,eid:y.id,modtime:y.modification});if(y.error){x.err=y.error}e.push(x)});v.filterCheck({files:e,submit:function(w){if(w.ignore){$.Array.each(w.ignore,function(x,y){v.fileRemove(y)})}$.Array.each(w.select,function(x,y){y["delete"]=function(){v.fileRemove(y);y["delete"]=null};v.add(y)});v.fileAutoUpload()},cancel:function(){$.Array.each(e,function(w,x){v.fileRemove(x)})}})}function b(w){var x=this;var v={func:"checkFileState",argu:[w.eid]};if(!x.getUploadHost()){v.argu.push(true)}x.flashTimerCheck(v);x.setState(w,"hash");var e=w.size;var u=15*1000;if(e<Math.pow(1024,2)){u=15*1000}else{if(e<10*Math.pow(1024,2)){u=30*1000}else{if(e<50*Math.pow(1024,2)){u=45*1000}else{if(e<200*Math.pow(1024,2)){u=60*1000}else{u=120*1000}}}}x.base.addTimer("flashHash",function(){v.argu.push(true);x.flashTimerCheck(v)},u)}function j(v){var y=this;var w=y.fileGet({type:"flash",eid:v.fileId})[0];if(w){w.useSplit=v.useSplit;y.flashCheck(w);y.setState(w,"hashover");y.base.clearTimer("flashHash")}else{try{var u={code:"FLASH_VERIFY_ERROR",name:v.fileId};Log.record("attach",u)}catch(x){}}}function h(u){var v=this;if(v.getCheck(u)){var e=v.getUploadProxy({type:"flash",file:u,options:"body",check:true});v.action.request({type:$I("core.DataAction").FLASH,noTips:true,data:{url:e,method:$.Ajax.POST,body:u.options,call:function(w){if(v.check(u,w)){v.fileUpload(u)}},error:function(){if(v.error(u,"AS_HTTP","","check")){v.flashCheck(u)}else{v.resum(u)}}}})}else{v.fileUpload(u)}}function r(w,z){var y=this;try{var v="";if(y.getUploadHost()){if(w.useSplit){w.length=f.sliceLength;if(w.offset+w.length>w.size){w.length=w.size-w.offset}v=y.getUploadProxy({type:"flash",file:w,options:"header"},z);var u={func:"startUpload",argu:[w.eid,v,w.options,w.offset,w.length]};y.netCheckSet(w);y.flashTimerCheck(u)}else{v=y.getUploadProxy({type:"flash",file:w,options:"form"},z);var u={func:"startUpload",argu:[w.eid,v,w.options]};y.flashTimerCheck(u)}}else{v=y.getUploadUrl({type:"flash"});var u={func:"startUpload",argu:[w.eid,v,w.options]};y.flashTimerCheck(u)}}catch(x){}}function k(e,v){var u=this;u.flashCheck(e,v)}function l(v){var x=this;var u=x.sourceGet("element");try{u.flash.removeFile(v.eid)}catch(w){}}function m(x){x=x?true:false;var y=this;var u=y.sourceGet("element");var v=y.sourceGet("status");try{v.flashTimer=x;if(x){u.flash.setTimer(x)}}catch(w){}}function q(u){var x=this;var e=x.sourceGet("element");var w=x.sourceGet("status");if(w.flashTimer){x.timerCall=u}else{var v=e.flash;v[u.func].apply(v,u.argu)}}function g(u){try{var v=$L("support.MailAssist")}catch(A){return A}var z=this;var w=z.sourceGet("element");var y=z.sourceGet("tips");if(u.browseFail||u.checkFail){if(!y.flashError){var x="检查到你的Flash暂时无法响应，建议你 ";var B=$.Element.create("DIV");B.setClass("B");var C=$.Element.create("DIV");C.setClass("nui-normalTips nui-tips");C.html(x);if(!v.has()&&v.support()){new $.Link({text:"安装邮箱插件",renderTo:C.dom,click:function(){z.assist.setup("new")}});new $.Component({html:"<span>&nbsp;上传，或者 </span>",renderTo:C.dom})}new $.Link({text:"切换到普通模式",renderTo:C.dom,click:function(){Ud.set({field:"ntes_option",flag:"flashupload",value:"1",notPost:"true"});z.base.set({status:"empty",value:false});$.Tips.show("设置成功，请重新进入写信")}});new $.Component({html:"<span>&nbsp;上传。</span>",renderTo:C.dom});new $.Link({cls:"nui-block-close nui-close",renderTo:C.dom,icon:"close",click:function(){y.flashError.remove();y.flashError=null}});B.append(C.dom);w.content.after(B.dom);y.flashError=B;w.area.show()}}if(u.hide){if(y.flashError){y.flashError.remove();y.flashError=null;z.setAuto({type:"auto"})}}}function i(w){var A=this;var z=w.type;var x=null;var u=null;if(w.fileId){x=A.fileGet({type:"flash",eid:w.fileId})[0]}else{if(w.files){u=t.toArray(w.files)}}switch(z){case"onReady":A.flashReady();break;case"onBrowse":if(w.result){A.flashTips({hide:true})}else{A.flashTips({browseFail:true})}break;case"onSelected":A.flashSelect(u);break;case"onCancel":break;case"onVerify":A.flashVerify(w);break;case"onOpen":A.setStart(x);break;case"onProgress":A.setBytes(x,w.bytesLoaded,w.bytesTotal);break;case"onComplete":A.setFinish(x);break;case"onCompleteData":var v=A.complete(x,w.data);A.netCheckClear();if(v.code==S_OK){if(v["continue"]){A.fileUpload(x)}}else{if(v.retry){A.fileRetry(x)}else{A.resum(x)}}break;case"onHttpError":case"onIoError":case"onSecurityError":var e=(z=="onHttpError")?"AS_HTTP":"AS_ERROR";if(A.error(x,e,w.error)){A.fileRetry(x)}else{A.resum(x)}break;case"onTimer":if(A.timerCall){var y=A.timerCall;A.timerCall=null;return y}break;default:break}}})();(function(){try{var c=$L("module.compose.ComposeAttach")}catch(l){return l}var b=$.createClass($N("module.compose.ComposePost"));var n=$.Object;n.inherit(b,c);n.extend(b.prototype,{initialize:o,init:m,browseInit:h,postCreate:a,postSwitch:f,postStop:g,postUpload:k,postResult:j,postAdd:i,postSelect:d,todo:function(){}});function o(p){var e=this;b.superClass.initialize.call(e,p)}function m(){var e=this;b.superClass.init.call(e)}function h(){var q=this;q.postCreate();q.postAdd();q.postSwitch({enable:true});try{var p=q.sourceGet("element");var s=p.link;s.html("添加附件");q.base.set({status:"uploadMode",value:"post"})}catch(r){}}function a(){var q=this;var p=q.sourceGet("element");var e="ifrComposeAttachUpload";var r=$.Element.create("FORM");r.setClass("L");r.dom.target=e;r.dom.method="POST";p.operate.append(r.dom);p.formContainer=r}function f(r){var q=this;var p=q.sourceGet("element");if(typeof r.enable=="boolean"){var e=p.formContainer;if(r.enable){e.show()}else{e.hide()}}}function g(){var q=this;var p=q.base.get({status:"uploadParam"});if(p&&p.action=="form"){try{$.fly("#ifrComposeAttachUpload").setAttr({src:"about:blank"})}catch(r){}}}function k(){var p=this;var s=p.base;var e=p.sourceGet("element");var q=p.getUploadUrl({type:"form"});var r=s.getCallName(function(){p.postResult.apply(p,arguments)},true);q+="&call=window.parent."+r;e.formContainer.setAttr({action:q,encoding:"multipart/form-data",enctype:"multipart/form-data"});s.set({status:"uploadParam",value:{action:"form"}});e.formContainer["dom"].submit();s.tips("正在上传附件...");p.setLock({type:"form",state:"wait"},true)}function j(q){var p=this;var t=p.base;var s={type:"form",state:"wait"};t.set({status:"uploadParam",value:null});p.setLock(s,false);if(q.code==S_OK){var e=p.fileGet(s);var r=n.toArray(q.composeAttach);r=r.slice(r.length-e.length);$.Array.each(e,function(u,v){$.Array.each(r,function(x,w){if(w&&(w.name==v.name||w.name==v.path)){v.sid=w.id;v.size=v.bytesLoaded=w.size;r[x]=null;throw $.BREAK}});p.setState(v,"success")});t.runSequence("postResult")}else{p.error(null,q.code,q.overflowReason)}t.tips("")}function i(){var r=this;var q=r.sourceGet("element");var t=$.Element.create("input");var e=r.get({status:"inputIndex"});t.setClass("t");t.setAttr({type:"file",size:"1",name:"file"+e++});r.set({status:"inputIndex",value:e});t.listen("keydown",function(u){$.Event.cancel(u)});var p=false;var s=function(u){if(p==true){return}else{p=true}if(r.postSelect(t)){}else{t.remove()}r.postAdd()};t.one("change",s);t.one("propertychange",s);q.formContainer.append(t.dom)}function d(s){var q=this;var p=q.element;var e=s.dom.value;if(e){}else{return false}var r=q.fileCreate({type:"form",path:e});if(r.extLimit){$.Msgbox.show({title:'您所选择的附件：<span style="color:#f00">'+r.name+"</span> ，出于安全考虑，请勿添加该类附件！"});return false}if(r.pathExist){$.Msgbox.show({title:"您已选择了此附件，请勿重复添加相同附件！"});return false}s.setStyle({zIndex:-1});r["delete"]=function(){s.remove();r["delete"]=null};q.add(r);return true}})();(function(){try{var q=$L("module.compose.Compose");var f=$L("module.compose.ComposeNative");var u=$L("support.MailAssist")}catch(A){return A}var E=$.Object;var b=$.createClass($N("module.compose.ComposeAssist"));E.inherit(b,q);E.extend(b.prototype,{initialize:h,init:j,clear:t,get:s,set:k,create:o,setup:r,install:x,destroy:c,requestGet:G,captureGet:i,captureStart:z,captureResult:w,captureUpload:d,captureDestroy:p,clipInit:D,clipMenu:g,clipKey:C,clipPaste:v,clipImage:y,nativeClipImage:F,dragInit:m,dragHas:B,dragCheck:n,dragOver:l,dragDrop:a});function h(H){var e=this;E.extend(e,{assist:{request:null,capture:null},status:{captureDialog:false,captureIndex:0,dragSupport:"",dragTarget:"",dragEffect:""}});b.superClass.initialize.call(e,H)}function j(){var e=this;b.superClass.init.call(e)}function t(){var e=this;e.assist["request"]=null;e.assist["capture"]=null;b.superClass.clear.call(e)}function s(H){var e=this;if(typeof H.status=="string"){return e.status[H.status]}else{if(typeof H.assist=="string"){return e.assist[H.assist]}}}function k(I){var e=this;var H=I.value;if(typeof I.status=="string"){e.status[I.status]=H}else{if(typeof I.assist=="string"){e.assist[I.assist]=H}}}function o(J,e){var H=this;if(!u.has()&&!e){H.setup();return null}if(!u.hasNewVersion()&&!e){H.setup("upload");return null}switch(J){case"request":J="beta.httprequest";break;case"capture":J="ntes.screencapture";break;case"blob":J="beta.blobbuilder";break;case"desktop":J="beta.desktop";break;case"digest":J="ntes.blobdigest";break}var I=u.create(J);if(I){return I}else{H.setup("update");return null}}function r(e){var N=this;var L=N.base;var I="安装";var O="安 装";if(e=="upload"){I="升级";O="升 级"}var H=u.support();if(H){var K="2G";if($S("cloud")){K=$.Number.convert($S("cloud")["capacity"])}var M="<div>"+I+"后您可以：<ol><li>1. 发送"+K+"超大附件</li><li>2. 截屏功能</li><li>3. 直接拖曳文件到写信窗口成为附件</li><li>4. 复制粘贴文件成为附件</li><li>5. 在邮件正文中插入本地图片</li></ol>★ 安装过程可能会离开本页面，当前如有信件内容将被保存到草稿箱</div>";var J=null;J=$.Msgbox.show({type:"confirm",title:"使用此功能，需要先"+I+"网易邮箱插件",content:M,okText:O,ok:function(){if(L.empty()){N.install(J)}else{var P=$.Browser.getVersion()||[0,0];if($.Browser.chrome()&&P[0]>=21){N.install(J,L)}else{L.send({action:"force",call:function(){N.install(J)}})}}return true}})}else{var M="<b>当前浏览器不支持安装本功能插件，请使用以下浏览器</b><br />1. Internet Explorer<br />2. IE内核模式浏览器，如360浏览器，世界之窗等<br />3. 火狐浏览器(Mozilla Firefox)<br />4. 谷歌浏览器(Google Chrome)<p>★上述浏览器插件目前只限于Windows操作系统支持</p>";$.Msgbox.show({title:"邮箱插件提示",content:M})}return}function x(e,H){u.install({close:function(){e.close()}},H)}function c(){var e=this;e.captureDestroy()}function G(){var e=this;var H=e.get({assist:"request"});if(H){if(typeof H.send=="undefined"){e.set({assist:"request",value:H=null})}}if(!H){H=e.create("request")}if(H){e.set({assist:"request",value:H});return H}return null}function i(){var e=this;var H=e.get({assist:"capture"});if(H){if(typeof H.captureScreen=="undefined"){e.set({assist:"capture",value:H=null})}}if(!H){H=e.create("capture")}if(H){e.set({assist:"capture",value:H});return H}return null}function z(){var e=this;var H=e.captureGet();if(H){if(e.get({status:"captureDialog"})){H.focusCaptureDialog()}else{e.set({status:"captureDialog",value:true});H.captureScreen(function(I){e.set({status:"captureDialog",value:false});e.captureResult(I)})}}}function w(H){var e=this;if(H&&H.count==1){e.captureUpload(H.files[0])}else{}}function d(I){var H=this;var e=H.get({status:"captureIndex"})+1;H.set({status:"captureIndex",value:e});var J="截图"+e+".png";I.name=J;I.inlined=true;H.attach.pluginSelect([I])}function p(){var H=this;var I=H.get({assist:"capture"});if(I){if(H.get({status:"captureDialog"})){try{I.closeCaptureDialog()}catch(J){}H.set({status:"captureDialog",value:false})}H.set({assist:"capture",value:I=null})}}function D(){var e=this;if(u.has()){if(!window.composeClip){$(window.document).listen("keydown",function(){if(window.composeClip){window.composeClip.apply(null,arguments)}})}window.composeClip=function(L){e.clipKey(L,"globe")};var K=$(e.editor.getWindow());var J=$(K.dom.document);var I=$(J.dom.body);var H=J;J.listen("keydown",function(L){e.clipKey(L,"editor")});if($.Browser.ie()){H=I;J.listen("contextmenu",$.Function.bind(e.clipMenu,e))}H.listen("paste",$.Function.bind(e.clipImage,e))}else{if($.Browser.chrome()){var K=$(e.editor.getWindow());var J=$(K.dom.document);J.listen("paste",function(L){e.nativeClipImage(L,"editor")})}}}function g(I){var H=this;if($.Browser.ie()){var K=H.create("desktop");if(K){try{K.highLightPasteMenu(I)}catch(J){}}}else{}}function C(I,H){var e=this;if((I.ctrlKey||I.metaKey)&&I.keyCode==86){e.clipPaste(I,H)}}function v(K,J){var I=this;var N=I.create("desktop",true);if(N){var M=null;try{M=N.getClipboardData(K)}catch(L){}if(M&&M.count>=1){var H=E.toArray(M.files);I.base.addTimer("clippaste",function(){I.attach.pluginSelect(H)},200);$.Event.stop(K)}else{if(J=="editor"){I.clipImage(K)}}}}function y(I){var H=this;var O=H.create("desktop",true);if(O){var J=null;var M=null;try{J=O.getClipboardDataType()}catch(L){}if(J){if(J.files){return}if(J.html){return}if(J.text){if(J.bitmap&&$.Browser.firefox()){var N="";try{N=O.getClipboardText("text")}catch(L){}if(N){H.editor.insert({text:N});$.Event.stop(I);return}else{}}else{return}}if(J.bitmap){}}try{M=O.getClipboardImage(I)}catch(L){}if(M&&M.count==1){var K=M.files[0];H.base.addTimer("clipimage",function(){H.captureUpload(K)},200);$.Event.stop(I)}else{}}}function F(O,I){var N=this;var e=O.clipboardData;if(e&&e.items&&e.items.length==1){var J=[];var L=e.items[0];if(L.kind=="file"&&L.type.indexOf("image")!=-1){var H=N.get({status:"captureIndex"})+1;N.set({status:"captureIndex",value:H});var K="截图"+H+".png";var M=L.getAsFile();M.name=K;M.inlined=true;J.push(M)}N["native"].nativeSelect(J)}}function m(){var O=this;var L=O.base;var M=O.editor;var N="";if($.Browser.firefox()||$.Browser.chrome()){if(typeof FileReader!="undefined"){N="native"}}else{if($.Browser.safari()){if(typeof FileList!="undefined"){N="native"}}}if($.Browser.ie()||$.Browser.firefox()||$.Browser.chrome()){if(!N&&u.has()){N="plugin"}}if(N){O["native"]=O.attach;if(N=="native"&&u.has()){var I=O.module;var K=new f(I);K.init();O["native"]=K}O.set({status:"dragSupport",value:N});if(!window.composeDrag){var Q=$(window);if($.Browser.ie()){Q=$(Q.dom.document.body);Q.listen("dragenter",function(R){$.Event.stop(R)})}Q.listen("dragover",function(){window.composeDrag.apply(null,arguments)})}window.composeDrag=function(R){O.dragOver(R,"globe")};if($.Browser.ie()){$(M.getWindow().document.body).listen("dragover",function(R){O.dragOver(R,"editor")});var H=$(M.getMask());H.listen("dragover",function(R){O.dragOver(R,"editor")});H.listen("drop",function(R){O.dragDrop(R,"editor")})}else{var e=$(M.getWindow());e.listen("dragover",function(R){O.dragOver(R,"editor")});if($.Browser.firefox()){e.listen("drop",function(R){O.dragDrop(R,"editor")},true)}e.listen("drop",function(R){O.dragDrop(R,"editor")})}var P=L.get({element:"dragArea"});var J=L.get({element:"dragClose"});P.listen("dragover",function(R){O.dragOver(R,"area")});P.listen("drop",function(R){O.dragDrop(R,"area")});P.listen("click",function(R){$.Event.stop(R)});J.listen("click",function(R){O.event.setDragArea({hide:true,force:true})})}}function B(L){var I=this;var J=I.get({status:"dragSupport"});var M=false;if(J=="native"){var K=L.dataTransfer;if(K.files&&K.files.length){M=true}else{if(K.types){$.Array.each(E.toArray(K.types),function(P,e){if(e=="text/html"){throw $.BREAK}if(e=="Files"){M=true;throw $.BREAK}})}}}else{if(J=="plugin"){var O=I.create("desktop");if(O){try{var H=O.getDragData(L,"application/x-gears-files");if(H.count>0){M=true}}catch(N){if(N.number==-2146827287){M=true}}}}}return M}function n(R,J){var Q=this;var P=Q.get({status:"dragSupport"});if(Q.dragHas(R)){var L=false;if(J=="editor"){var H=0;if(P=="native"){var I=R.dataTransfer;if(typeof I.mozItemCount=="number"){H=I.mozItemCount}else{if(I.files){if(I.files.length>0){H=I.files.length}else{H=1}}}}else{if(P=="plugin"){var O=Q.create("desktop");var K=null;try{K=O.getDragData(R,"application/x-gears-files")}catch(N){}if(K){if(K.count==1){var M=(new String(K.mimeTypes)).toLowerCase();if(M.indexOf("image/")==0){H=1}else{}}}}}if(H==1){L=true}}if(J=="area"){L=true}if(J=="globe"||J=="editor"){Q.event.setDragArea({show:true})}Q.set({status:"dragEffect",value:(L?"copy":"none")})}else{}}function l(J,H){var e=this;if(e.get({status:"dragTarget"})!=H){e.set({status:"dragTarget",value:H});e.dragCheck(J,H)}var K=e.get({status:"dragEffect"});if(K){var I=J.dataTransfer;if($.Browser.ie()){I.dropEffect="copy"}else{I.effectAllowed=K;I.dropEffect=K}e.base.addTimer("dragstop",function(){e.set({status:"dragTarget",value:""});e.set({status:"dragEffect",value:""});e.event.setDragArea({hide:true})},200);$.Event.stop(J)}else{e.base.addTimer("dragstop",function(){e.set({status:"dragTarget",value:""})},200)}}function a(M,Y){var X=this;if(!X.get({status:"dragEffect"})){return}X.event.setDragArea({hide:true,force:true});$.Event.stop(M);var N=X.get({status:"dragSupport"});var J=null;var Q=null;if(N=="native"){var S=M.dataTransfer;J=S.files}else{if(N=="plugin"){var L=X.create("desktop");if(L){try{Q=L.getDragData(M,"application/x-gears-files");J=Q.files}catch(W){}}}}if(J&&J.length>=1){J=E.toArray(J)}else{return}if(Y=="area"){if(N=="native"){X["native"].nativeSelect(J)}else{if(N=="plugin"){X.attach.pluginSelect(J)}}}if(Y=="editor"){if(J.length!=1){return}var P=J[0];var O="";if(N=="native"){O=P.type}else{if(N=="plugin"){O=Q.mimeTypes}}if(O){O=(new String(O)).toLowerCase()}if(O.indexOf("image/")==0){P.inlined=true;if(N=="native"){X["native"].nativeSelect([P])}else{if(N=="plugin"){X.attach.pluginSelect([P])}}}else{if(O=="text/html"||O=="text/plain"){var U="";if(P.getAsBinary&&P.getAsText){var T=P.size||P.fileSize||0;if(T>0&&T<=1024*100){}else{return}var I="";var H=P.getAsBinary();var K=H.substr(0,3);if(K==String.fromCharCode(239,187,191)){}else{if(K.substr(0,2)==String.fromCharCode(255,254)){}else{if(K.substr(0,2)==String.fromCharCode(254,255)){}else{I="GBK"}}}U=P.getAsText(I)}else{if(0){var V=P.blob;var R=V.getBytes();if(R[0]==239&&R[1]==187&&R[2]==191){(function(){var Z=[];var ab,aa=3,e=R.length;for(;aa<e;){ab=R[aa];if(ab>=224){ab=((ab&15)<<12)|((R[aa+1]&63)<<6)|(R[aa+2]&63);aa+=3}else{aa++}Z.push(ab)}U=String.fromCharCode.apply(null,Z)})()}else{}}}if(U){if(O=="text/html"){X.editor.set({html:U})}else{X.editor.set({text:U})}}}}}}})();(function(){try{var l=$L("module.compose.Compose");var j=$L("module.compose.ComposeManager");var O=$L("support.AddressSupport");var N=$L("support.OptionSupport");var w=$L("support.SenderList")}catch(Z){return Z}var Q=$.createClass($N("module.compose.ComposeBase"));var p=$.Object;p.inherit(Q,l);p.extend(Q.prototype,{initialize:E,init:aa,layoutNew:d,layoutInit:u,layoutAdjust:V,start:c,initTimer:v,fillContent:m,set:g,setPage:t,get:z,getAction:h,send:K,sendSuccess:S,sendError:J,sendCheck:C,sendBuild:T,focus:x,empty:F,changeCheck:I,changeSync:R,addTimer:k,clearTimer:s,initAddress:A,initCorp:H,initStationery:W,uploadLocate:Y,autoSave:a,autoKeep:L,tips:P,userDataSave:b,userDataRemove:B,userDataResume:o,connectBreak:U,setSequence:n,runSequence:G,getCallName:y,removeCallName:i,preview:q,scene:f,share:r,setOption:X,fireOption:M,destroy:D});function E(e){var ab=this;p.extend(ab,{index:0,delayTime:33,saveTextThreshold:1048576,timer:{},sequence:{},change:{},layout:{},element:{},component:{},letterpaper:{},log:{},blackList:{},sendMsgBox:null,elementData:{toolbar:"div$id$Toolbar",scroll:"div$id$Scroll",main:"div$id$Main",succ:"div$id$Succ",page:"div$id$Page",sender:"div$id$Sender",to:"div$id$To",cc:"div$id$Cc",bcc:"div$id$Bcc",separate:"div$id$Separate",subject:"div$id$Subject",attach:"div$id$AttachOperate",content:"div$id$Content",dragLink:"a$id$AttachDrag",dragArea:"div$id$AttachDrag",dragClose:"a$id$AttachDragClose",tips:"div$id$Tips"},status:{fromEntry:"",curPage:"compose",inputChoose:"to",sidePanel:"",addrPanel:"",sendParam:null,defaultContent:"",uploadParam:null,uploadMode:"form",flashReady:false,moduleOut:false,empty:true,paramBody:null,autoSaveTime:2,existActiveDraft:false,sendCheckCount:0,initTimer:false,initSign:false,initAddress:false,initStationery:false,chargeSmsData:null,useSms:null,useSign:null,useSeparate:null,showTo:true,showCc:false,showBcc:false,showSide:false,showSchedule:false,showEncrypt:false,save2YNote:false,showHtmlbar:true,confirmDeleteDraft:true,confirmAttach:true,confirmSubject:true,confirmExit:true,saveContact:true},attachments:{files:{},element:{link:null,browseContainer:null,input:null,formContainer:null,formIframe:null,flash:null,flashContainer:null,nativeRequest:null,area:null,info:null,content:null,ulContainer:null,progress:null},tips:{},layout:{attachWidth:278,spaceWidth:4},status:{validServer:false,layoutInit:false,confirmSize:false,cloudTrigger:false,cloudAttach:false,flashTimer:false,cardUrl:"",totalPercent:-1,totalBytes:-1,flashIndex:0,fileIndex:1,inputIndex:1,inlinedExist:0}}});Q.superClass.initialize.call(ab,e);ab.layoutNew()}function aa(){var e=this;Q.superClass.init.call(e)}function u(){var ab=this;var e=ab.layout;e.address=ab.get({id:"div$id$AddressContent"});e.stationery=ab.get({id:"div$id$StationeryContent"})}function d(){var ac=this;var ab=ac.layout;ab.base=document.documentElement;ab.baseHeight=ab.base.clientHeight;ab.baseTop=88;ab.topToolbar=49;ab.bottomToolbar=48;ab.baseCenter=126;ab.addressDiff=33;ab.sideBottom=32;ab.editorHeight=ab.baseHeight-(ab.baseTop+ab.topToolbar+ab.baseCenter+ab.bottomToolbar)-3;ab.editorMin=300;var e=ab.editorMin-ab.editorHeight;if(e>0){ab.editorHeight+=e}ab.addressHeight=ab.editorHeight+ab.addressDiff;ab.stationeryHeight=ab.addressHeight-ab.sideBottom}function V(ac){var aj=this;if(ac.timer){aj.addTimer("layout",function(){ac.timer=false;aj.layoutAdjust(ac)},10);return}var ah=aj.layout;if(ah&&ah.base){}else{return}var ad=0,ag=0,ak=0;var al=false,ai=false,am=false;if(ac.all){var ae=ah.base.clientHeight;if(ae!=ah.baseHeight){ah.baseHeight=ae;al=ai=true;aj.success.resize()}}var af=0;if(al){ad=ah.baseHeight-(ah.baseTop+ah.topToolbar+ah.baseCenter+ah.bottomToolbar)-3;af=ah.editorMin-ad;if(af>0){ad=ah.editorMin;ai=true}else{if(ah.editorHeight==ah.editorMin){ai=true}}}if(ai){ag=ad+ah.addressDiff;am=true}if(am){ak=ag-ah.sideBottom}if(ad){if(ah.editorHeight!=ad){aj.editor.setSize({height:ad+"px"});ah.editorHeight=ad}}if(ag){if(ah.addressHeight!=ag){ah.address.setStyle({height:ag+"px"});ah.addressHeight=ag;if($S("isCorp")){var ab=ag+55+"px";var e=ag+50+"px";aj.get({id:"div$id$CorpContent"}).setStyle({height:ab});aj.get({id:"div$id$CorpIframe"}).setStyle({height:e})}}}if(ak){if(ah.stationeryHeight!=ak){ah.stationery.setStyle({height:ak+"px"});ah.stationeryHeight=ak}}}function c(){var ab=this;if(Ud.get({field:"ntes_option",flag:"requirereceipt"})=="1"){ab.form.setCheckbox("receipt",true)}if(Ud.get({field:"ntes_global",flag:"compose_showContacts"})=="0"){if($S("isCorp")){ab.event.switchSide({init:true,show:true,panel:"corp"})}else{ab.event.switchSide({init:true,show:true,panel:"address"})}}var e=$S("attrs").user.ntes_htmlbar;if(typeof e=="number"){if(e==2){ab.set({status:"showHtmlbar",value:false})}}if(Ud.get({field:"ntes_option",flag:"flashupload"})!="1"){ab.set({status:"uploadMode",value:"super"})}ab.editor.create();ab.addTimer("init",function(){ab.initTimer()})}function v(ab){var e=this;if(e.get({status:"initTimer"})==true){return true}e.userDataResume();e.uploadLocate();e.attach.browseInit();e.focus();e.autoSave();e.autoKeep();if(!$S("isCorp")){e.scene({type:"onReady"})}e.set({status:"initTimer",value:true})}function m(ar,af){var au=this;var ap=au.form;var am=au.event;var ai=au.module;ar=ar||au.info.get({obj:true});var e=ar.account;if(e){ap.setSender(e)}var aj=false;if(ai.param&&ai.param["type"]=="reply"){aj=(Ud.get({field:"ntes_option",flag:"sendershow"})=="2")}var at=ar.to;if(at){ap.setContact(at,"to",aj)}var ag=ar.cc;if(ag){ap.setContact(ag,"cc",aj);if(ag.length){am.setCc({show:true,separate:true})}}var al=ar.bcc;if(al){ap.setContact(al,"bcc",aj);if(al.length){am.setBcc({show:true,separate:true})}}var ac=ar.showOneRcpt;if(ac){am.setSeparate({show:true})}var ad=ar.subject;if(typeof ad=="string"){ap.setSubject(ad)}var ae=ar.priority;if(ae==1){ap.setCheckbox("priority",true)}var ah=ar.requestReadReceipt;if(ah){au.form.setCheckbox("receipt",true)}var aq=ar.scheduleDate;if(aq){ap.setCheckbox("schedule",true);ai.schedule.set(aq)}if(af){return}var ao=ar.content||"";var an="html";if(typeof ar.isHtml=="boolean"&&!ar.isHtml){an="text"}au.editor.setOriginal(ao,an);var ab=ar.attachments;if(ab){au.attach.storageAdd(ab,true)}var ak=ar.link;if(ak){au.attach.linkAdd(ak)}else{au.attach.linkParse()}if(typeof ar.card=="number"){au.sign.fillData({card:ar.card})}au.changeSync()}function g(ac){var ab=this;var e=ac.value;if(typeof ac.status=="string"){ab.status[ac.status]=e}else{if(typeof ac.element=="string"){if(typeof e=="string"){e=ab.get({id:e})}ab.element[ac.element]=e}else{if(typeof ac.component=="string"){ab.component[ac.component]=e}}}}function t(al){var ai=this;var ag=ai.get({element:"main"});var ak=ai.get({element:"succ"});var aj=ai.get({element:"page"});var af=ai.get({element:"toolbar"});var ab=ai.get({element:"scroll"});var ad,e;if(ai.get({status:"curPage"})==al){return}if(al=="compose"){aj.hide();e=aj.find("iframe");e.setAttr({src:"about:blank"});ag.show();af.show();ab.removeClass("frame-main-cont-body-noToolbar")}else{if(al=="success"){ak.show();ag.hide();af.hide();ab.addClass("frame-main-cont-body-noToolbar")}else{if(al=="photo"){ad=aj.find("form");ad.empty();aj.setStyle({height:ag.dom.offsetHeight+"px"});aj.show();ad.setAttr({action:ai.attach.photoGetUrl()});ad.dom.submit();ag.hide();af.hide();ab.addClass("frame-main-cont-body-noToolbar")}else{if(al=="netfolder"){var ad=aj.find("form");ad.empty();aj.setStyle({height:ag.dom.offsetHeight+"px"});aj.show();var ac=Uri.getUrl("compose_netfolder");var ah=ai.attach;var ae=ai.getCallName(function(){ah.netfolderCallBack.apply(ah,arguments)},true);ac+="&call=window.parent."+ae;ad.setAttr({action:ac});ad.dom.submit();ag.hide();af.hide();ab.addClass("frame-main-cont-body-noToolbar")}}}}ai.set({status:"curPage",value:al})}function z(ad){var ac=this;if(typeof ad["$id$"]=="string"){return ad["$id$"].replace(new RegExp("\\$id\\$","i"),"Compose")}else{if(typeof ad.id=="string"){return $("#"+ac.get({"$id$":ad.id}))}else{if(typeof ad.id=="object"){var ab=ad.id;p.each(ab,function(ae,af){ab[ae]=ac.get({"$id$":af})});return $.apply(window,ab)}else{if(typeof ad.status=="string"){if(ac.status){return ac.status[ad.status]}else{return""}}else{if(typeof ad.element=="string"){var e=ac.element[ad.element];if(e){return e}else{if(ac.elementData[ad.element]){e=ac.get({id:ac.elementData[ad.element]});ac.element[ad.element]=e;return e}}return ac.element[ad.element]}else{if(typeof ad.component=="string"){return ac.component[ad.component]}}}}}}}function h(){var ad=this;var e="";var ab=ad.get({status:"sendParam"});var ac=ad.get({status:"uploadParam"});if(ab){e=ab.action}else{if(ac){e=ac.action}}return e}function K(ac){var aj=this;if(!aj.sendCheck(ac)){return false}if(aj.get({status:"curPage"})=="success"){return}if(aj.get({component:"autoSendTips"})){try{aj.get({component:"autoSendTips"}).hide()}catch(af){}}var ab={};var ah={action:ac.action};var ae=aj.info.get({cid:true});if(ae){ab.id=ae}if(ac.action=="verify"){ab.verifyCode=ac.code}else{var ai=ab.attrs=aj.sendBuild(ac);aj.info.set({obj:ai});aj.info.set({con:[].concat(ai.to,ai.cc,ai.bcc)});if(ac.action=="auto"&&ai.skipAutoSave){return false}}if(ac.action=="deliver"||ac.action=="schedule"||ac.action=="verify"){ab.returnInfo=false}else{ab.returnInfo=true}var ak=ac.action;if(ac.action=="auto"||ac.action=="force"){ak="save"}else{if(ac.action=="verify"){ak="deliver"}}ab.action=ak;if(aj.attach.fileHas({type:"link"})){ab.flagLinkAttached=true}if(ac.action=="deliver"){if($S("attrs").user.save_sent==0){ab.saveTextThreshold=aj.saveTextThreshold}}if(ac.action=="deliver"){if($S("attrs").user.aftersend_saveaddr==1){try{$.Array.each(aj.info.get({con:true}),function(e,am){var al=am.replace(/^.*<|>$/g,"").toLowerCase();if(!O.data.extDataMap.email[al]){ab.autosaveRcptsMode="add";throw $.BREAK}})}catch(af){}}}if(ac.action=="schedule"){if(Ud.get({field:"ntes_option",flag:"schedule_notify"})=="0"){ab.notifyEML=true}}if(ac.action=="deliver"){if(aj.get({status:"showEncrypt"})){ab.encryptPassword=aj.encrypt.get();if(aj.encrypt.get({save:true})){ab.savePassword=true;ab.attrs["saveSentCopy"]=true;delete ab.saveTextThreshold}}}if(Ext.ynote){if(aj.form.getCheckbox("ynote")){aj.set({status:"save2YNote",value:true});ab.attrs["saveSentCopy"]=true;delete ab.saveTextThreshold;Log.cache({cl_ynote:"1"},$.EMPTYFUNC)}}if(ac.action=="deliver"){if(Ud.get({field:"ntes_compose",flag:"undo_send"})=="1"){ab.delayTime=aj.delayTime}}if(ac.action=="deliver"||ac.action=="schedule"){p.extend(ah,aj.log);if(aj.get({status:"useSign"})){ah.sign="1"}if(aj.get({status:"showEncrypt"})){ah.encrypt="1"}var ad=aj.get({status:"fromEntry"});if(ad!="compose"){ah.from=ad}if(ac.source=="shortcut"){ah.cl_st=1}}ac.body=ab;aj.set({status:"sendParam",value:ac});aj.action.send({body:ab,log:ah,callback:$.Function.bind(aj.sendSuccess,aj),error:$.Function.bind(aj.sendError,aj)});var ag="";switch(ac.action){case"deliver":ag="正在发送邮件...";break;case"schedule":ag="正在保存定时发信...";break;case"save":ag="正在保存邮件...";break;case"auto":case"force":ag="正在自动保存草稿...";break;case"verify":ag="正在进行验证码核对并发送邮件...";break}if(ag){aj.tips(ag)}}function C(ae){var ay=this;var ar=ay.form;var ac=ay.attach;var ai=ae.action;if(ai=="verify"){return true}if(!(ai=="auto"||ai=="force")){var ah=ay.get({status:"sendCheckCount"});if(ah>=0){var az=ay.get({status:"sendParam"});var au=ay.get({status:"uploadParam"});if(az||au){if(az){if(az.action=="save"||az.action=="auto"){$.Msgbox.show({title:"您的信件正在保存中，请稍候！"})}else{ay.sendMsgBox=$.Msgbox.show({title:"您的信件正在发送中，请稍候！"})}}else{if(au.action=="form"){$.Msgbox.show({title:"您的附件正在上传中，请稍候！"})}else{if(au.action=="move"){$.Msgbox.show({title:"您的附件正在移动中，请稍候！"})}}}ah++;if(ah>=2){ah=-1}ay.set({status:"sendCheckCount",value:ah});return false}}ay.set({status:"sendCheckCount",value:0})}if(!(ai=="force")){var aw=ay.get({status:"fromEntry"});if(aw=="edit"||aw=="draft"||aw=="timeset"||aw=="reply"||aw=="forward"){if(ay.info.get({cid:true})==""){if(ai=="auto"){}else{$.Msgbox.show({title:"您的信件正在加载中，请稍候！"})}return false}}}if(ai=="deliver"||ai=="save"){if(ay.get({status:"showSchedule"})){if(ay.module["schedule"].verify()){ai=ae.action="schedule"}else{return false}}}if(ai=="deliver"||ai=="schedule"){if(Ud.get({field:"helptips",flag:"senderName"})=="0"){var aq=ay.form.getSender();function aj(aC){Ud.set({field:"helptips",flag:"senderName",value:"1"});var e="用户名";if(aC=="mobile"){e="手机号"}var aB="收件人只能看到您的"+e+"，可能没法知道是您的邮件。<br />为方便对方确认，请填写您的姓名：";$.Msgbox.show({type:"prompt",title:"您还没设置姓名！",content:aB,okText:"保存并发送",inputWidth:"300px",ok:function(aE){var aD=$.String.trim(aE);if(!aD){return"姓名不能为空"}$.Tips.show({succ:true,text:"发件人姓名设置成功"});ay.form.setSender(new Email(aq.address,aD));ay.addTimer("sendCheck",function(){ay.send(ae)},10);$E(["interface.WelcomeInterface"],function(aF){aF.trueName("set",aD)})}});return false}var am=aq.address.split("@");if($S("domain")==am[1]&&aq.name==am[0]){if(Email.checkMobile(aq.name)){return aj("mobile")}if($S("attrs").user.true_name==""){var an=$S("attrs").user.displaysender;if(an==0){return aj("account")}else{if(an==1){if($S("attrs").user.nick_name==""){return aj("account")}}}}}}}if(ai=="deliver"||ai=="schedule"){var ab=0;function aA(aG){var aH;var aB=function(){if($.Msgbox.msgbox){$.Msgbox.msgbox.close()}};var aE=function(){aB();ay.addTimer("sendCheck",function(){ay.send(ae)},10)};var aD=function(){aB();ar.focus(aG)};var aF=ar.getContact("object",aG);if(aF.fail&&aF.fail.length){aH="";$.Array.each(aF.fail,function(aI,aJ){aH+=aJ.address+"\n"});aH=$.String.encodeHTML(aH);aH=aH.replace(/\n/g,"<br>");$.Msgbox.show({title:"请正确填写以下邮件地址：",content:aH,buttons:[{xtype:"button",text:"发送并删除",click:function(){ar.removeContact(aF.fail,aG);aE()}},{xtype:"button",text:"返回编辑",type:"impt",click:aD}]});return false}var e=[];$.Array.each(aF.suc,function(aI,aJ){if(N.isRefuse(aJ)){if(ay.blackList[aJ.address.toLowerCase()]){}else{e.push(aJ)}}});if(e.length){aH="以下地址已经在您的黑名单中，您将无法收到他们的回信，是否不给他们发信？<br/>";aH='<strong class="nui-txt-impt">';for(var aC=0;aC<e.length;aC++){aH+=$.String.encodeHTML(e[aC].toString())+"<br/>"}aH+="</strong>";$.Msgbox.show({title:"以下地址已在您的黑名单中，将无法收到回信",content:aH,buttons:[{xtype:"button",text:"发信（但不给他们）",type:"impt",click:function(){ar.removeContact(e,aG);aE()}},{xtype:"button",text:"继续给他们写信",click:function(){$.Array.each(e,function(aI,aJ){ay.blackList[aJ.address.toLowerCase()]=true});aE()}},{xtype:"button",text:"返回编辑",click:aD}]});return false}ab+=aF.suc.length;return true}if(ay.get({status:"useSeparate"})){if(aA("separate")){}else{return false}}else{if(aA("to")&&aA("cc")&&aA("bcc")){}else{return false}}if(ab==0){ay.tips({text:"请填写收件人地址后再发送",expires:6000});ar.focus();return false}var ax=$S("attrs").cos.pref_smtp_max_num_rcpts||0;if(ab>ax){(function(){var aB="您选择的发件人总数为"+ab+"人，超过"+ax+"人的限制！";if($S("isFree")){if($S("domain")=="163.com"){aB+='<br><br><a href="http://reg.vip.163.com/upgradeIndex.m?b10dye1" target="_blank">升级VIP超量群发，最多可单次群发400封</a>'}else{if($S("domain")=="126.com"){aB+='<br><br><a href="http://reg.vip.126.com/upgradeIndex.m?b66dye1" target="_blank">升级VIP超量群发，最多可单次群发400封</a>'}}}else{var e;if(ax==5){e={"vip.163.com":"http://reg.vip.163.com/pay.m?b10ele1","vip.126.com":"http://reg.vip.126.com/pay.m?b66ele1","188.com":"http://pay.mail.188.com/html/pay/list.jsp?b11ele1"};aB='邮箱尚未开通，发送人数不可超过5人！<br>开通VIP邮箱，最高可群发400人！<a href="'+e[$S("domain")]+'" target="_blank">马上开通&gt;&gt;</a>'}else{if(ax==100){e={"vip.163.com":"b10dye5","vip.126.com":"b66dye5","188.com":"b11dye5"};aB+="<br>"+$.Link.html({text:"升级400封单次群发",click:function(){$E("interface.OutlinkInterface",function(aC){aC.goOutlink({url:Uri.getUrl("option_viptype",true)+"?"+e[$S("domain")],key:"option_viptype"})});$.Msgbox.msgbox.close()}})}}}$.Msgbox.show({title:aB,ok:function(){ar.focus()}});$.Component.setEvents()})();return false}}if(ai=="deliver"||ai=="schedule"){if($.String.trim(ar.getSubject())==""){if(ae.source=="shortcut"){window.setTimeout(af,300)}else{af()}return false}}if(ai=="deliver"){if(ay.get({status:"showEncrypt"})){if(ay.encrypt.verify()){}else{return false}}}if(ai=="deliver"||ai=="schedule"){if(ay.get({status:"confirmAttach"})){ay.set({status:"confirmAttach",value:false});var at=ac.get({count:true});if(ac.cardGet()){at--}if(at==0){var ao=ay.editor.get({text:true});if(ao.indexOf("附件")!=-1){$.Msgbox.show({type:"confirm",title:"邮件中显示您可能希望发送附件，但实际没有任何附件，您确认继续发送吗？",okText:"继续发送",cancelText:"返 回",ok:function(){ay.addTimer("sendCheck",function(){ay.send(ae)},10)}});return false}}}}if(ai=="deliver"||ai=="schedule"||ai=="save"||ai=="auto"||ai=="force"){if(false&&ac.fileSize({state:"success"})>$S("attachSize")*1024*1024){$.Msgbox.show({title:"附件大小超过"+$S("attachSize")+"M的限制！"});return false}}if(ai=="deliver"||ai=="schedule"||ai=="verify"||ai=="save"){if(ac.fileIsPost()){ay.setSequence("postResult",function(){ay.send(ae)});ac.postUpload();return false}if(ac.fileIsUpload()){ay.setSequence("uploadResult",function(){ay.send(ae)});if(ai=="save"){ay.tips("正在上传附件，上传完成后将自动保存到草稿箱")}else{var ad={items:[{html:"<span>正在上传附件，上传完成后将自动发送 </span>"},{xtype:"link",bracket:true,text:"取消自动发送",click:function(){delete ay.sequence["uploadResult"];this.destroy();ay.tips()}}]};ay.tips(ad)}return false}if(ac.fileIsError()){ac.validLocal();return false}if(ac.get({status:"validServer"})){ac.set({status:"validServer",value:false});ac.validServer();return false}}if(ai=="deliver"){if(ar.getCheckbox("chargesms")){try{var al=ay.module;var ap=al.smsNotify;var ak=ap.checkData();if(ak){ay.set({status:"chargeSmsData",value:ak})}else{return false}}catch(av){}}}if(ae.source=="shortcut"&&(Ud.get({field:"ntes_global",flag:"shortcut_tip"})=="0")){Ud.set({field:"ntes_global",flag:"shortcut_tip",value:"1"});var ag=function(){if($.Msgbox.msgbox){$.Msgbox.msgbox.close()}};$.Msgbox.show({header:"快捷键发送",title:"您使用了 ctrl+enter 快捷键发送邮件，是否发送？",buttons:[{xtype:"button",text:"发 送",subclass:"mainBtn",click:function(){ag();ay.addTimer("sendCheck",function(){ay.send(ae)},10)}},{xtype:"button",text:"取 消",click:function(){ag()}},{xtype:"button",text:"取消并关闭快捷键",click:function(){Ext.shortcut=false;Ud.set({field:"ntes_option",flag:"shortcut_enable",value:"1"});ag()}}]});return false}function af(){$.Msgbox.show({type:"confirm",title:"确定真的不需要写主题吗？",ok:function(){ar.setSubject("来自"+(w.getName()||$S("orgUid"))+"的邮件");ay.addTimer("sendCheck",function(){ay.send(ae)},10)},cancel:function(){ay.addTimer("sendCheck",function(){ar.focus("subject")},10)}})}return true}function T(e){var ai=this;var aj=ai.form;var ak=ai.editor;var al=ai.attach;e=e||{};var ah={};var am=aj.getSender();ah.account=am.toString();if(am.smtp){ah.accountSettings={smtpHost:"@",popWebId:am.popId}}if(ai.get({status:"useSeparate"})){ah.showOneRcpt=true;ah.to=aj.getContact("build","separate");ah.cc=ah.bcc=[]}else{ah.showOneRcpt=false;ah.to=aj.getContact("build","to");ah.cc=aj.getContact("build","cc");ah.bcc=aj.getContact("build","bcc")}var ag=$.String.trim(aj.getSubject());if(!ag){if(e.action=="auto"){var ac=$I("util.Misc").getTime(0);ag=$.Date.format(ac,"yyyy年M月d日 H:mm:ss 自动保存草稿")}}ah.subject=ag;var af=ak.getFinal();if(e.action=="auto"&&af==""){ah.skipAutoSave=true}if(aj.getCheckbox("text")){ah.isHtml=false}else{ah.isHtml=true;if(e.action=="deliver"){af=af.replace(new RegExp('id="*(spnEditorSign|divEditorGraphSign)"*',"ig"),"")}}var ae=al.linkHtml({action:e.action,subject:ag});if(ae){if(!ah.isHtml){ah.isHtml=true;af=ak.getFinal("html")}af+=ae}ah.content=af;ah.priority=aj.getCheckbox("priority")?1:3;if(ah.priority==1){Log.cache({cl_priority:"1"},$.EMPTYFUNC)}ah.requestReadReceipt=aj.getCheckbox("receipt");if(ah.requestReadReceipt==1){Log.cache({cl_receipt:"1"},$.EMPTYFUNC)}ah.saveSentCopy=($S("attrs").user.save_sent<2);if(e.action=="schedule"){ah.scheduleDate=ai.module["schedule"].get()}var ab=al.inlineSync();if(ab&&ab.length){ah.attachments=ab}var ad="GBK";if(Ud.get({field:"ntes_option",flag:"mailencode"})=="1"){ad="UTF-8"}ah.charset=ad;return ah}function x(){var ad=this;var ac=ad.form;var ab=ad.editor;var e="to";if(ad.get({status:"useSeparate"})){e="separate"}if(ac.getContact("empty",e)){ac.focus(e)}else{if($.String.trim(ac.getSubject())){ab.focus()}else{ac.focus("subject")}}}function F(){var ac=this;var ab=ac.form;var e=true;if(ac.get({status:"curPage"})=="success"){return e}if(ac.get({status:"fromEntry"})=="compose"){if(!ab.getContact("empty","to")){e=false}else{if(!ab.getContact("empty","cc")){e=false}else{if(!ab.getContact("empty","bcc")){e=false}else{if(!ab.getContact("empty","separate")){e=false}else{if($.String.trim(ab.getSubject())!=""){e=false}else{if(ac.attach.get({count:true})>0){e=false}else{if(!ac.editor.get({empty:true})){e=false}else{if(!ac.get({status:"empty"})){e=false}}}}}}}}}else{e=false}return e}function I(){var af=this;var ad=af.attach;var e=af.change;var ae=false;if(e.composeInfo){var ab=ad.get({count:true});if(ad.cardGet()){ab--}if(ad.stationeryGet()){ab--}if(ab!=e.attachCount){ae=true}if(!ae){var ac=af.sendBuild();if(!p.compare(ac,e.composeInfo)){ae=true}}}else{}return ae}function R(){var ad=this;var ac=ad.attach;var e=ad.change;e.composeInfo=ad.sendBuild();var ab=ac.get({count:true});if(ac.cardGet()){ab--}if(ac.stationeryGet()){ab--}e.attachCount=ab}function S(ae){var ah=this;ah.tips("");var ad=ah.get({status:"sendParam"});if(ad.action=="save"||ad.action=="auto"||ad.action=="force"||ad.action=="continue"){ah.info.set({obj:ae["var"]});if(ae.draftId){ah.info.set({did:ae.draftId})}if(ad.action=="save"||ad.action=="force"){ah.set({status:"existActiveDraft",value:true})}ah.changeSync();var af=$I("util.Misc").getTime(0);if(ad.action=="auto"||ad.action=="save"){$.Tips.show({succ:true,expire:0,text:$.Date.format(af,"邮件已于H:mm成功保存到草稿箱")})}if(typeof ad.call=="function"){ah.addTimer("force",function(){ad.call()})}}else{ah.clearTimer();var ac=ah.info.get({cid:true});ah.info.set({cid:""});if(ad.action=="verify"){ad.action="deliver"}ah.success.render(ae,ac)}ah.userDataRemove();try{var ab=[2];if(ad.action=="deliver"){ab.push(3)}Listener.fire("compose:send",ab);$I("init.Folder").checkMail()}catch(ag){}ah.set({status:"sendParam",value:null})}function J(ae){var al=this;al.tips("");var an=al.info;var am=al.attach;var ac=al.get({status:"sendParam"});al.set({status:"sendParam",value:null});if(ac.action=="auto"){return true}var ah=ae.code;var ab=ae["var"];if(ah==S_OK){if(typeof ab=="string"){an.set({cid:ab})}else{if(typeof ae["var"]=="object"){an.set({obj:ab})}}}var ak=j.error(ae);if(ak){if(ak=="5550"){var e=Uri.getUrl("compose_epay_bill",true);$.Msgbox.show({title:"无法发信",content:"您的网易宝已超过还款期限，导致无法使用发信功能，还款后即可恢复。<a href='"+e+"' class='nui-txt-link' target='_blank'>查看还款账单</a>",okText:"立即付款",ok:function(){var ao=Uri.getUrl("compose_epay_repayment",true);window.open(ao)}});al.send({action:"auto"});return true}return ak}else{switch(ah){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var ag=ah.split("_")[1].toLowerCase();j.verify(ag,function(ao){al.send({action:"verify",code:ao})});break;case"FA_ATTACH_NOT_COMPLETED":case"FA_ATTACH_CRC_FAILED":var aj=ae.badAttachment;if(aj){var af=aj.name||"";af=$.String.encodeHTML(af);var ai="附件"+af+"上传不完整，部分文件丢失，是否删除？";$.Msgbox.show({type:"confirm",header:"附件校验出错",content:ai,ok:function(){al.action.deleteAttach({sid:aj.id,callback:function(ao){if(ao.code==S_OK){}else{$.Msgbox.show({content:"删除失败，请保存草稿后重新打开。"})}}})}})}break;default:var ad=am.fileGet({state:"success"});if(ad&&ad.length){return false}else{an.set({cid:""})}return false;break}return true}}function k(ac,ad,e){e=e||0;var ae=this;var ab=ae.timer;ae.clearTimer(ac);ab[ac]=window.setTimeout(function(){delete ab[ac];ad()},e)}function s(ab){var ac=this;var e=ac.timer;if(e){if(ab){if(typeof e[ab]=="number"){window.clearTimeout(e[ab]);delete e[ab]}}else{p.each(e,function(ad){ac.clearTimer(ad)})}}}function A(ab){ab=ab||{};var e=this;if(e.get({status:"initAddress"})==true){return true}setTimeout(function(){e.address.fill()},200);e.set({status:"initAddress",value:true});if(typeof ab.call=="function"){ab.call()}}function H(ac){ac=ac||{};var ab=this;if(ab.get({status:"initCorp"})==true){return true}var e=Uri.getUrl("compose_corp_address");ab.get({id:"div$id$CorpIframe"}).setAttr({src:e});ab.set({status:"initCorp",value:true});if(typeof ac.call=="function"){ac.call()}}function W(ae){ae=ae||{};var ad=this;var e=ad.letterpaper;if(ad.get({status:"initStationery"})==true){return true}if(!e.category){var ac=arguments.callee;var ab=Uri.getUrl("letterpaper_get")+"&pageSize=11";$.Ajax.jsonp(ab,function(af){e.category=af.category;(function(ag){return;var ah=ag[ag.length-1];if(ah.name=="自定义"){}else{ag.push({id:"10",name:"自定义",pageCount:1})}})(e.category);if(typeof e.curId!="string"){e.curId=""}e.curCategory=af.curCategory;e.curPage=af.curPage;e.curData=af.letterPaper;e.nonUse=af.nonUse;e.ver=af.date;e.pageSize=af.pageSize;ac.call(ad,ae)},"jsonp");return false}ad.stationery.fill();ad.set({status:"initStationery",value:true});if(typeof ae.call=="function"){ae.call()}}function Y(){if($S("uploadProxy")){return}var e=$.Cookie.get("mail_upx",true);e=$.String.trim(e);if(e){var ab=e.split("|");if(ab.length){$S("uploadProxy",ab)}}}function a(){var e=this;e.addTimer("save",function(){if(e.get({status:"curPage"})=="compose"){if(e.get({status:"sendParam"})||e.get({status:"uploadParam"})||e.attach.fileIsUpload()||!e.changeCheck()){}else{if(e.get({status:"autoSaveTime"})==2){e.set({status:"autoSaveTime",value:5})}e.send({action:"auto"})}}e.autoSave()},1000*5*e.get({status:"autoSaveTime"}))}function L(){var e=this;e.addTimer("keep",function(){if(e.info.get({cid:true})){e.action.getInfo({callback:function(){}})}e.autoKeep()},1000*60*25)}function P(ac){try{$.Tips.module(ac)}catch(ab){}}function b(){var ag=this;var af=ag.form;var ad=$S("uid").replace("@",".");var ae=af.getContact("build","to");var e=af.getSubject();var ac=ag.editor.get();var ab={to:ae,subject:e,content:ac};$.Storage.set(ad,JSON.stringify(ab));window.composeResume=false}function B(){var ab=$S("uid").replace("@",".");try{$.Storage.remove(ab)}catch(ac){}}function o(){var af=this;if(af.get({status:"fromEntry"})=="compose"){if(!window.composeResume){window.composeResume=true;var ac=$S("uid").replace("@",".");var ae="";try{ae=$.Storage.get(ac)}catch(ad){}if(ae){af.userDataRemove();var ab=null;try{ab=JSON.parse(ae)}catch(ad){}if(ab){af.fillContent(ab)}}}}}function U(){var e=this;if(!e.empty()){$.Msgbox.show({type:"confirm",title:"网络连接已断开，是否将信件内容保存到本地电脑？<br>（提示：下次登录邮箱，写信时内容将自动恢复）",ok:$.Function.bind(e.userDataSave,e)})}}function n(e,ab){var ac=this;ac.sequence[e]=ab}function G(ab,e){var ad=this;var ac=ad.sequence[ab];if(typeof ac=="function"){if(typeof e=="number"){ad.addTimer("sequence"+ab,function(){ad.runSequence(ab)},e);return true}delete ad.sequence[ab];ac();return true}return false}function y(ad,e){var ac="ComposeCall";if(typeof window[ac]!="object"){window[ac]={}}var ab="f"+$I("util.Misc").getTime(0).valueOf();if(typeof window[ac][ab]!="undefined"){ab+="x"}window[ac][ab]=function(){if(e){delete window[ac][ab]}if(ad){return ad.apply(null,arguments)}};return ac+"."+ab}function i(){var e="ComposeCall";if(typeof window[e]=="object"){p.each(window[e],function(ab){window[e][ab]=null;delete window[e][ab]})}if(window.composeClip){window.composeClip=$.EMPTYFUNC()}if(window.composeDrag){window.composeDrag=$.EMPTYFUNC()}}function q(){var ae=this;var e=Uri.getUrl("compose_preview");var ad=ae.getCallName(function(){var ah=ae.form;var ag={};ag.sender=ah.getSender();if(ae.get({status:"useSeparate"})){ag.separate=ah.getContact("suc","separate")}else{ag.to=ah.getContact("suc","to");ag.cc=ah.getContact("suc","cc");ag.bcc=ah.getContact("suc","bcc")}var af=ah.getSubject();if(af){af=$.String.escapeHTML(af)}else{af="(无主题)"}ag.subject=af;ag.editor=ae.editor.getPreview();ag.attach=ae.attach.getPreview();return ag});e+="&call=window.opener."+ad;var ac=document.createElement("FORM");ac.action=e;ac.method="POST";ac.target="_blank";var ab=document.createElement("INPUT");ab.type="hidden";ab.name="content";ab.value=ae.editor.getFinal();ac.appendChild(ab);document.body.appendChild(ac);ac.submit()}function f(al){var ai=this;var ak=Ud.get({field:"ntes_option",flag:"composeSound"});if(ak!="0"){return}if(!$.Browser.getInfo().hasFlash){return}al=al||{};var e=al.type;if(e=="onReady"){ai.addTimer("scene",function(){ai.scene({type:"onPlay"})},1000*3);return}else{if(e=="onPlay"){var ac=new Date();var ad=ac.getHours();var ae=ac.getTime();if(gUser.lastComposeSceneTime){if(ae-gUser.lastComposeSceneTime<30*60*1000){return}}var ab;if(ad>=6&&ad<8){ab={type:"bird","class":"EFT-birdflash",src:"http://mail.163.com/flash/130509_compose/bird.swf",pic:Uri.getUrl("bird",true),text:"#网易邮箱情景模式# 闻到树的芬芳，听到鸟的啼鸣，打开网易邮箱，让第一束阳光和第一缕风唤醒新的一天。早晨，你好——我正在使用网易邮箱最新推出的情景模式“草长莺飞版”，每天早上6点到8点登录邮箱，就像漫步在清晨的西子湖畔，凉风拂面甘之如饴，你也来试试吧。"}}else{if(ad>=20){ab={type:"frog","class":"EFT-frogflash",src:"http://mail.163.com/flash/130509_compose/frog.swf",pic:Uri.getUrl("frog",true),text:"#网易邮箱情景模式# 荷塘莲叶田田，月光如水潺潺，一只蛙蹦跳而过，荡开涟漪点点。这寂静而忙碌的夜晚，网易邮箱提醒您，工作累了，休息一下眼睛哦——我正在使用网易邮箱最新推出的情景模式“荷塘月色版”，每天晚上8点到12点登录邮箱，和朱自清一同感受月夜风致，你也来试试吧"}}else{return}}var ah=ai.getCallName(function(){ai.scene(arguments[0])},true);var aj="apiListener=window."+ah;var af='<div class="'+ab["class"]+'"><embed src="'+ab.src+'" flashvars="'+aj+'" allowscriptaccess="always"  width="100%" height="100%" type=application/x-shockwave-flash wmode="transparent" quality="high"></embed></div>';var ag=ai.get({id:"div$id$Scene"});ag.show();ag.html(af);if(!ai.shareDiv){ag.listen("mouseover",$.Function.bind(ai.share,ai,ab))}gUser.lastComposeSceneTime=ae;ai.addTimer("scene",function(){ai.scene({type:"onPlay"})},1000*60*30)}else{if(e=="onComplete"){var ag=ai.get({id:"div$id$Scene"});ag.hide();ag.empty();if(ai.shareDiv){ai.shareDiv.remove();ai.shareDiv=null}}else{return}}}}function r(ac){var ae=this;if(!ae.shareDiv){var ad=$.Element.create("DIV");ae.shareDiv=ad;ad.setClass("EFT-bar EFT-bar-"+ac.type);var ab=ae.get({element:"main"});ab.append(ad.dom);var e="http://service.weibo.com/share/share.php?pic="+encodeURIComponent(ac.pic)+"&title="+encodeURIComponent(ac.text);new $.Link({renderTo:ad,cls:"EFT-bar-share",target:"_blank",link:e});new $.Link({cls:"EFT-bar-close",renderTo:ad,click:function(){ae.scene({type:"onComplete"});Ud.set({field:"ntes_option",flag:"composeSound",value:"1"})}})}}function X(ab,e){var af=this;if(ab){ab.module="compose";ab.noFire=true;N.setAttr(ab);if(typeof e!="boolean"){e=false}af.fireOption([ab],!e);var ae=ab.flag?ab.flag:ab.field;var ad=ab.value;var ac={};ac[ae]=ad;Log.cache(ac,$.EMPTYFUNC)}}function M(af,ag){var ah=this;var ab=ah.event;$.Array.each(af,function(ax,aj){var az="";var ao=aj.flag?aj.flag:aj.field;var aw=aj.value;switch(ao){case"ntes_htmlbar":var ak=aw!=2?true:false;ah.editor.setHtmlbar({show:ak,hide:!ak});break;case"compose_showContacts":var au=aw!="1"?true:false;ab.switchSide({panel:"address",show:au,hide:!au});break;case"remindShow":Ext.contactCorrect=(aw=="0")?true:false;break;case"composeSound":break;case"flashupload":case"replySign":case"forwardSign":case"signPosition":case"upload_mode":az="设置成功，下次进入写信生效";ah.set({status:"empty",value:false});break;case"requirereceipt":var av=aw=="1"?true:false;var ap=ah.get({component:"receipt"});ap.setChecked(av);break;case"true_name":case"nick_name":case"displaysender":var ay=ah.get({component:"sender"});var an={type:"sender",tabindex:"2",raiaLabel:"发件人地址，点击可以设置发件人"};var al=[];try{var ai=$I("util.Icon");var aq=w.getList();var ar=w.getDefault();$.Array.each(aq,function(aA,aC){var e=$.String.encodeHTML(aC.toString());var aB=ai.getSubtype({type:"folder",domain:aC.domain});if(aB=="dft"){aB="other"}al.push({text:e,icon:{type:"folder",subtype:aB},click:function(){ay.setValue(aC)}})});an.email=ar;var am={xtype:"menu",groups:[{items:al},{items:[{text:"设置默认发件人与昵称",click:function(){$E(["interface.OptionInterface"],function(e){e.entry("SenderModule")})}}]}]};an.menu=am;ay.update(an)}catch(at){}break;case"signUpdate":case"cache":ah.set({status:"empty",value:false});break;default:break}if(ag&&az){$.Tips.show(az)}});if(!ag){try{var ad=ah.get({component:"toolbar"});var ac=ah.view.getOption();ad.find("button")[5].menu.update(ac)}catch(ae){}}}function D(){var ac=this;if(ac.info.get({cid:true})){var e=false;if(!ac.get({status:"confirmDeleteDraft"})){if(!ac.get({status:"existActiveDraft"})&&ac.info.get({did:true})){e=true}}ac.action.cancelId({deleteDraft:e,callback:null});ac.info.set({cid:""})}ac.clearTimer();ac.attach.destroy();ac.assist.destroy();ac.set({status:"curPage",value:"destroy"});ac.tips("");$.Tips.show({hidden:true});ac.removeCallName();$.Array.each(["to","cc","bcc","separate"],function(ad,ae){ac.get({component:ae}).exit()});var ab=ac.module;$.Array.each(ab.names,function(ad,ae){ab[ae].clear()});$.Array.each(["param","class","module","names","stationery"],function(ad,ae){ab[ae]=null;delete ab[ae]})}})();(function(){var k={};try{var c=$L("module.BaseModule");var q=$L("module.compose.Compose");var p=k.view=$L("module.compose.ComposeView");var i=$L("module.compose.ComposeListener");k.info=$L("module.compose.ComposeInfo");k.base=$L("module.compose.ComposeBase");k.event=$L("module.compose.ComposeEvent");k.form=$L("module.compose.ComposeForm");k.action=$L("module.compose.ComposeAction");k.attach=$L("module.compose.ComposeAttach");k.schedule=$L("module.compose.ComposeSchedule");k.encrypt=$L("module.compose.ComposeEncrypt");k.address=$L("module.compose.ComposeAddress");k.stationery=$L("module.compose.ComposeStationery");k.sign=$L("module.compose.ComposeSign");k.editor=$L("module.compose.ComposeEditor");k.assist=$L("module.compose.ComposeAssist");k.success=$L("module.compose.ComposeSuccess");var f=$L("support.SenderList")}catch(h){return h}var y=$.Object;var n=$.createClass($N("module.compose.ComposeModule"));y.mix(n,c,null,{});y.extend(n.prototype,q.prototype);y.extend(n,{View:p,Listener:i});y.extend(n.prototype,{useCache:false,forceRemoveDom:true,initialize:w,init:t,getData:o,getGroup:d,getText:a,setText:u,reset:v,empty:g,exit:s,resize:x,cache:l,onBeforeDisappear:m,switchOut:z,getHistoryParam:r,vipSmsCheck:b,vipCheck:j,vipCheckSuc:e});function w(A){var B=this;B.param=A;B["class"]=n;B.module=B;$.Array.each(B.names,function(C,E){try{B[E]=new k[E](B)}catch(D){}})}function t(){var A=this;$.Array.each(A.names,function(B,D){try{A[D].init()}catch(C){}});A.base.start();if($S("isVip")){A.vipCheck();A.vipSmsCheck()}}function o(N){var E=this;var A=E.param;var K=E.base;var M=E.info;var I=E.action;var B="compose";if(A.type){B=A.type}var G=A.param||{};var C="";var D=null;if(G.id){C=G.id}if(typeof C!="string"){D=C;C=""}var J=A.info||{};if(G.info){J=G.info}var L=A.body||{};if(G.body){L=G.body}if(B=="reply"||B=="forward"){if(!L.attrs){L.attrs={}}if(!L.attrs["account"]){L.attrs["account"]=f.getDefault().toString()}}var F={action:B};K.set({status:"fromEntry",value:B});K.set({status:"paramBody",value:L});switch(B){case"draft":M.set({did:C});N();L.id=C;var H=null;if(G.time){H=new Date(G.time)}if(G.date){H=G.date}if(H){K.set({status:"fromEntry",value:"timeset"})}I.restoreDraft({body:L,callback:function(P){var O=P["var"];if(H){O.scheduleDate=H}M.set({obj:O});K.set({status:"existActiveDraft",value:true});K.fillContent();K.focus()}});break;case"edit":M.set({mid:C});N();L.id=C;I.editMessage({body:L,callback:function(O){M.set({obj:O["var"]});K.fillContent();K.focus()}});break;case"reply":M.set({mid:C});N();K.fillContent(L.attrs,true);L.id=C;if(L.toAll){F.action="replyall"}if(L.withAttachments){F.action="replyallattach"}I.replyMessage({body:L,log:F,callback:function(O){M.set({obj:O["var"]});K.fillContent();K.focus()}});break;case"forward":if(D){M.set({ids:D})}else{M.set({mid:C})}N();K.fillContent(L.attrs,true);if(D){L.mode="attach";L.ids=D}else{L.ids=[C]}I.forwardMessages({body:L,log:F,callback:function(O){M.set({obj:O["var"]});K.fillContent();K.focus()}});break;default:M.set({cid:M.getClientId()});N();K.fillContent(J);break}}function d(){return this.mtype}function a(B){var A=this;A.fTextCall=B;return A.stext||A.setText("",true)}function u(A,C){var D=this;if(!D.fTextCall){return}if(A){}else{var B="";try{B=D.base.get({status:"fromEntry"})}catch(E){}switch(B){case"draft":A="草稿";break;case"reply":A="回复";break;case"forward":A="转发";break;default:A="写信";break}}if(C){if(A!="写信"){A+="加载中"}return A}else{D.stext=A;D.fTextCall(A)}}function v(B){var A=this;var C=A.base;if(C.get({status:"curPage"})=="compose"){if(C.empty()){C.focus();return false}}else{}return true}function g(){var C=this;var E=C.base;var B=C.attach;var A=false;try{if(B.get({cloud:true})){}else{if(E.get({status:"curPage"})=="compose"){A=E.empty()}}}catch(D){}return A}function s(B,F,C){var E=this;if(E.destroyFinish){return true}var H=E.base;if(!H){return true}if(E.empty()){H.clearTimer("save");return true}if(H.get({status:"curPage"})=="destroy"){return true}if(H.get({status:"confirmExit"})){var D=function(){H.set({status:"confirmExit",value:false});F()};var A=function(){if($.Msgbox.msgbox){$.Msgbox.msgbox.close()}};if(H.get({status:"curPage"})!="success"){if(H.get({status:"uploadParam"})||H.attach.fileIsUpload()){if(B){$.Msgbox.show({type:"confirm",title:"附件正在上传，确定中断和放弃对此信件所作的操作?",ok:D})}else{A()}return false}else{if(H.changeCheck()){if(B){$.Msgbox.show({title:"您正在写信中，是否离开写信页面？",closeClick:function(){if(C){C()}},buttons:[{text:"离开并存草稿",subclass:"mainBtn",click:function(){H.send({action:"force",call:D});A()}},{text:"离开不存草稿",click:function(){H.set({status:"confirmDeleteDraft",value:false});D();A()}},{text:"取消",click:function(){A();if(C){C()}}}]})}else{A()}return false}}}}else{}if(H.get({status:"uploadMode"})=="flash"){try{E.attach.flashTimerSet(false)}catch(G){}}H.destroy();JS5.cleanCache(E);E.destroyFinish=true;return true}function x(){var B=this;var A=$.Browser.getInfo();switch(A.os){case"ipad":case"ipod":case"iphone":case"android":break;default:B.base.layoutAdjust({all:true,timer:true});B.attach.layout();break}}function l(){var A=this;if($S("isVip")){A.vipCheck()}}function m(){var A=this;var B=A.base;if(B.get({status:"uploadMode"})=="flash"){B.set({status:"moduleOut",value:true});A.attach.flashTimerSet(true)}}function z(){var A=this;var B=A.base;if(B.get({status:"confirmExit"})){if(B.get({status:"sendParam"})||B.get({status:"uploadParam"})||B.attach.fileIsUpload()||!B.changeCheck()){}else{B.send({action:"auto"})}}}function r(){return{}}function j(F){if(n.isValid){return true}var B=false;var E=$S("attrs").subcos;var A=E.split(",");if($S("isvip")){if($.Array.has(A,"192")){B=true}}else{if($S("is188")){if($.Array.has(A,"230")){B=true}}else{if($S("is126vip")){if($.Array.has(A,"101")){B=true}}}}if(B){var D=Uri.getUrl("vip_compose_valid");$.Msgbox.show({header:"发信激活",contentType:"custom",noFooter:true,content:'<iframe id="composeSucSmsIframe" src="'+D+'" style="display:block;width:100%;height:200px" scrolling="no" frameborder="0"></iframe>',close:C});return false}function C(){if(n.isValid){return false}else{var G=Context.getModule();if(G&&G.mtype&&G.mtype=="compose.ComposeModule"){JS5.back()}else{$E("interface.WelcomeInterface",function(H){H.entry()})}}}return true}function e(){n.isValid=true;var A="http://"+$S("host")+"/js5/api/reload.jsp?sid="+$S("sid");$.Ajax.request({requestType:$.Ajax.IFRAME,rnd:true,url:A});if($.Msgbox.msgbox){$.Msgbox.msgbox.close()}}function b(){if(n.sms_bind){return}n.sms_bind=-1;var A=Uri.getUrl("sms_bind",true);$.Ajax.jsonp(A,function(B){if(B&&B.code==200){if(B.state==0){n.sms_bind=2}}})}})();